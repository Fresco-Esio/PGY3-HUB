(()=>{"use strict";var e={3005:(e,t,a)=>{var s=a(5043),i=a(4391),r=(a(411),a(6213)),o=a(3546),l=a(7845),n=a(7782),c=a(6833),d=a(7819),u=a(7856),p=a(2024),m=a(614),h=a(8693),x=a(6382),g=a(7118),b=a(9917),y=a(2626),v=a(2054),f=a(1827),j=a(2119),w=a(9855),N=a(5087),k=a(579);const C=e=>{let{message:t="Loading..."}=e;return(0,k.jsx)("div",{className:"flex items-center justify-center p-8",children:(0,k.jsxs)("div",{className:"flex flex-col items-center gap-2",children:[(0,k.jsx)(p.A,{className:"w-6 h-6 animate-spin text-blue-600"}),(0,k.jsx)("span",{className:"text-sm text-gray-600",children:t})]})})},S=(0,s.lazy)(()=>Promise.all([a.e(96),a.e(261)]).then(a.bind(a,6261))),_=(0,s.lazy)(()=>a.e(524).then(a.bind(a,4524))),A=(0,s.lazy)(()=>Promise.all([a.e(96),a.e(213)]).then(a.bind(a,4213))),T=(0,s.lazy)(()=>Promise.resolve().then(a.bind(a,9432))),P=(0,s.lazy)(()=>Promise.resolve().then(a.bind(a,7173))),z=(0,s.lazy)(()=>Promise.resolve().then(a.bind(a,8531))),O=(e,t)=>a=>(0,k.jsx)(s.Suspense,{fallback:(0,k.jsx)(C,{message:t}),children:(0,k.jsx)(e,{...a})}),D=(O(S,"Loading editor..."),O(_,"Loading templates..."),O(A,"Loading literature viewer..."));O(T,"Loading case details..."),O(P,"Loading topic details..."),O(z,"Loading task details...");var E=a(9432),$=a(7173),I=a(8531);function M(e,t,a){const{x:s,y:i,width:r,height:o}=e,{x:l,y:n}=t,{x:c,y:d}=a,u=s,p=s+r,m=i,h=i+o,x=c-l,g=d-n;if(Math.abs(x)<.001)return{x:l,y:g>0?h:m,side:g>0?"bottom":"top"};if(Math.abs(g)<.001)return{x:x>0?p:u,y:n,side:x>0?"right":"left"};const b=g/x,y=n-b*l,v=[],f=b*u+y;f>=m&&f<=h&&v.push({x:u,y:f,side:"left",distance:Math.hypot(u-l,f-n)});const j=b*p+y;j>=m&&j<=h&&v.push({x:p,y:j,side:"right",distance:Math.hypot(p-l,j-n)});const w=(m-y)/b;w>=u&&w<=p&&v.push({x:w,y:m,side:"top",distance:Math.hypot(w-l,m-n)});const N=(h-y)/b;N>=u&&N<=p&&v.push({x:N,y:h,side:"bottom",distance:Math.hypot(N-l,h-n)});const k=v.filter(e=>{const t=e.x-l,a=e.y-n;return(x>0&&t>=0||x<0&&t<=0)&&(g>0&&a>=0||g<0&&a<=0)});return k.sort((e,t)=>e.distance-t.distance),k[0]||{x:l,y:n,side:"center"}}const L=(0,s.memo)(e=>{var t,a,i,r,o,n;let{id:c,source:d,target:u,sourceX:p,sourceY:m,targetX:h,targetY:x,sourcePosition:g,targetPosition:b,style:y={},markerEnd:v,markerStart:f,data:j,...w}=e;const{getNode:N}=(0,l.VH)();let C,S;try{C=N(d),S=N(u)}catch(P){C=null,S=null}const{edgePath:_,labelX:A,labelY:T}=(0,s.useMemo)(()=>{if(null!==j&&void 0!==j&&j.__isAnimating||null!==j&&void 0!==j&&j.__forceUpdate)return{edgePath:`M${p},${m} L${h},${x}`,labelX:(p+h)/2,labelY:(m+x)/2};if(!C||!S)return{edgePath:`M${p},${m} L${h},${x}`,labelX:(p+h)/2,labelY:(m+x)/2};try{var e,t,a,s,i,r,o,l,n,c;const d=Boolean(C.width||(null===(e=C.dimensions)||void 0===e?void 0:e.width)||(null===(t=C.data)||void 0===t?void 0:t.width)||(null===(a=C.style)||void 0===a?void 0:a.width)),u=Boolean(S.width||(null===(s=S.dimensions)||void 0===s?void 0:s.width)||(null===(i=S.data)||void 0===i?void 0:i.width)||(null===(r=S.style)||void 0===r?void 0:r.width));if(!d||!u)return{edgePath:`M${p},${m} L${h},${x}`,labelX:(p+h)/2,labelY:(m+x)/2};const g=e=>{var t,a,s,i;const r="topic"===e.type?180:200,o="topic"===e.type?50:100;return{width:e.width||(null===(t=e.dimensions)||void 0===t?void 0:t.width)||(null===(a=e.data)||void 0===a?void 0:a.width)||r,height:e.height||(null===(s=e.dimensions)||void 0===s?void 0:s.height)||(null===(i=e.data)||void 0===i?void 0:i.height)||o}},b=g(C),y=g(S),v=function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{sourcePosition:s={x:0,y:0},targetPosition:i={x:0,y:0},sourceWidth:r=200,sourceHeight:o=100,targetWidth:l=200,targetHeight:n=100,sourceX:c,sourceY:d,targetX:u,targetY:p,offset:m=0}=a;if(void 0!==c&&void 0!==d&&void 0!==u&&void 0!==p&&(r<=10||l<=10))return{sourceX:c,sourceY:d,targetX:u,targetY:p,sourceSide:"direct",targetSide:"direct"};const h={x:s.x+r/2,y:s.y+o/2},x={x:i.x+l/2,y:i.y+n/2},g={x:s.x,y:s.y,width:r,height:o},b={x:i.x,y:i.y,width:l,height:n},y=M(g,h,x),v=M(b,x,h),f=x.x-h.x,j=x.y-h.y,w=Math.sqrt(f*f+j*j);if(w>0){const e=f/w,t=j/w,a=3;y.x-=e*a,y.y-=t*a,v.x+=e*a,v.y+=t*a,m>0&&(y.x+=e*m,y.y+=t*m,v.x-=e*m,v.y-=t*m)}return!!a.debug&&(console.log("Source Node:",e),console.log("Target Node:",t),console.log("Source Intersection:",y),console.log("Target Intersection:",v)),{sourceX:y.x,sourceY:y.y,targetX:v.x,targetY:v.y,sourceSide:y.side,targetSide:v.side}}(C,S,{sourcePosition:{x:(null===(o=C.positionAbsolute)||void 0===o?void 0:o.x)||C.position.x,y:(null===(l=C.positionAbsolute)||void 0===l?void 0:l.y)||C.position.y},targetPosition:{x:(null===(n=S.positionAbsolute)||void 0===n?void 0:n.x)||S.position.x,y:(null===(c=S.positionAbsolute)||void 0===c?void 0:c.y)||S.position.y},sourceX:p,sourceY:m,targetX:h,targetY:x,sourceWidth:b.width,sourceHeight:b.height,targetWidth:y.width,targetHeight:y.height,debug:!1}),{sourceX:f,sourceY:j,targetX:w,targetY:N}=v;return{edgePath:`M ${f},${j} L ${w},${N}`,labelX:(f+w)/2,labelY:(j+N)/2}}catch(P){return console.warn("FloatingEdge calculation error:",P),{edgePath:`M${p},${m} L${h},${x}`,labelX:(p+h)/2,labelY:(m+x)/2}}},[d,u,p,m,h,x,null===j||void 0===j?void 0:j.__forceUpdate,null===j||void 0===j?void 0:j.__isAnimating,null===(t=C)||void 0===t?void 0:t.id,null===(a=S)||void 0===a?void 0:a.id,null===(i=C)||void 0===i?void 0:i.width,null===(r=C)||void 0===r?void 0:r.height,null===(o=S)||void 0===o?void 0:o.width,null===(n=S)||void 0===n?void 0:n.height]);return(0,k.jsx)(l.tE,{id:c,path:_,labelX:A,labelY:T,style:{stroke:"#64748b",strokeWidth:3,strokeLinecap:"round",strokeOpacity:.95,transition:"none",...y},markerEnd:v,markerStart:f})},(e,t)=>{var a,s;return e.sourceX===t.sourceX&&e.sourceY===t.sourceY&&e.targetX===t.targetX&&e.targetY===t.targetY&&e.source===t.source&&e.target===t.target&&(null===(a=e.data)||void 0===a?void 0:a.__forceUpdate)===(null===(s=t.data)||void 0===s?void 0:s.__forceUpdate)}),X=L,H=(0,s.memo)(e=>{let{id:t,source:a,target:s,sourceX:i,sourceY:r,targetX:o,targetY:c,sourcePosition:d,targetPosition:u,style:p={},markerEnd:m,markerStart:h,label:x,sourceHandleId:g,targetHandleId:b,data:y,selected:v,animated:f}=e;const[j,w,N]=(0,n.Fp)({sourceX:i,sourceY:r,sourcePosition:d,targetX:o,targetY:c,targetPosition:u});return(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(l.tE,{id:t,path:j,style:p,markerEnd:m,markerStart:h}),x&&(0,k.jsx)(l.rV,{children:(0,k.jsx)("div",{style:{position:"absolute",transform:`translate(-50%, -50%) translate(${w}px,${N}px)`,fontSize:12,pointerEvents:"all"},className:"nodrag nopan bg-white px-2 py-1 rounded shadow border text-xs",children:x})})]})});H.displayName="EnhancedEdge";const F=H,R=e=>{let{fromX:t,fromY:a,toX:s,toY:i,connectionLineStyle:r}=e;const o=`M ${t},${a} L ${s},${i}`,l={stroke:"#3b82f6",strokeWidth:3.5,strokeLinecap:"round",strokeDasharray:"5,3",filter:"drop-shadow(0 0 6px rgba(59, 130, 246, 0.6))",animation:"flowingDash 1s linear infinite",...r};return(0,k.jsxs)("g",{children:[(0,k.jsx)("path",{d:o,fill:"none",style:l}),(0,k.jsx)("path",{d:o,fill:"none",stroke:"transparent",strokeWidth:15,style:{pointerEvents:"stroke"}})]})};var Y=a(6099);const B=e=>{let{message:t="Loading your mind map...",progress:a=null}=e;return(0,k.jsx)("div",{className:"fixed inset-0 bg-gradient-to-br from-blue-50 to-purple-50 flex items-center justify-center z-50",children:(0,k.jsxs)("div",{className:"text-center",children:[(0,k.jsxs)("div",{className:"relative mb-6",children:[(0,k.jsx)(x.A,{className:"w-16 h-16 text-blue-600 mx-auto animate-pulse"}),(0,k.jsx)(Y.A,{className:"w-6 h-6 text-purple-500 absolute -top-2 -right-2 animate-bounce"})]}),(0,k.jsxs)("div",{className:"flex items-center justify-center gap-3 mb-4",children:[(0,k.jsx)(p.A,{className:"w-6 h-6 animate-spin text-blue-600"}),(0,k.jsx)("span",{className:"text-lg font-medium text-gray-700",children:t})]}),null!==a&&(0,k.jsx)("div",{className:"w-64 bg-gray-200 rounded-full h-2 mx-auto mb-2",children:(0,k.jsx)("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300 ease-out",style:{width:`${Math.max(0,Math.min(100,a))}%`}})}),(0,k.jsx)("div",{className:"text-sm text-gray-500 max-w-md mx-auto mt-4",children:(0,k.jsx)("p",{children:"\ud83d\udca1 Tip: Use the force layout button to auto-arrange your nodes"})})]})})};var U=a(9350),q=a(5088);const J=e=>{let{data:t,selected:a}=e;const[i,r]=(0,s.useState)(t.skipAnimation||!1);(0,s.useEffect)(()=>{if(!t.skipAnimation){const e=setTimeout(()=>r(!0),100);return()=>clearTimeout(e)}},[t.skipAnimation]);const o=t.flashcard_count>0?(t.completed_flashcards||0)/t.flashcard_count*100:0;return(0,k.jsxs)("div",{className:`group px-4 py-3 rounded-xl shadow-lg border-2 transition-all duration-700 min-w-[220px] relative hover:shadow-2xl transform hover:scale-105 backdrop-blur-sm ${a?"border-teal-400 shadow-xl scale-105 ring-4 ring-teal-200 animate-pulse":"border-transparent hover:border-teal-300 hover:ring-2 hover:ring-teal-100"} ${i?"opacity-100 scale-100 translate-y-0":"opacity-0 scale-75 translate-y-8"}`,style:{backgroundColor:t.color||"#3B82F6",color:"white",boxShadow:a?`0 0 20px ${t.color||"#3B82F6"}40`:`0 4px 20px ${t.color||"#3B82F6"}20`,transition:"all 0.7s cubic-bezier(0.34, 1.56, 0.64, 1), transform 0.3s ease"},children:[(0,k.jsx)(l.h7,{id:"top",type:"source",position:n.yX.Top,className:"w-3 h-3 !bg-blue-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{left:"50%",transform:"translateX(-50%)",zIndex:2},isConnectable:!0}),(0,k.jsx)(l.h7,{id:"top",type:"target",position:n.yX.Top,className:"w-3 h-3 !bg-blue-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{left:"50%",transform:"translateX(-50%)",zIndex:1},isConnectable:!0}),(0,k.jsx)(l.h7,{id:"right",type:"source",position:n.yX.Right,className:"w-3 h-3 !bg-blue-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{top:"50%",transform:"translateY(-50%)",zIndex:2},isConnectable:!0}),(0,k.jsx)(l.h7,{id:"right",type:"target",position:n.yX.Right,className:"w-3 h-3 !bg-blue-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{top:"50%",transform:"translateY(-50%)",zIndex:1},isConnectable:!0}),(0,k.jsx)(l.h7,{id:"bottom",type:"source",position:n.yX.Bottom,className:"w-3 h-3 !bg-blue-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{left:"50%",transform:"translateX(-50%)",zIndex:2},isConnectable:!0}),(0,k.jsx)(l.h7,{id:"bottom",type:"target",position:n.yX.Bottom,className:"w-3 h-3 !bg-blue-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{left:"50%",transform:"translateX(-50%)",zIndex:1},isConnectable:!0}),(0,k.jsx)(l.h7,{id:"left",type:"source",position:n.yX.Left,className:"w-3 h-3 !bg-blue-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{top:"50%",transform:"translateY(-50%)",zIndex:2},isConnectable:!0}),(0,k.jsx)(l.h7,{id:"left",type:"target",position:n.yX.Left,className:"w-3 h-3 !bg-blue-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{top:"50%",transform:"translateY(-50%)",zIndex:1},isConnectable:!0}),t.priority&&(0,k.jsx)("div",{className:"absolute -top-2 -right-2",children:(0,k.jsx)("div",{className:"w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold border-2 border-white "+("high"===t.priority?"bg-red-500":"medium"===t.priority?"bg-yellow-500":"bg-green-500"),children:"high"===t.priority?"!":"medium"===t.priority?"\u2022":"\u2713"})}),(0,k.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,k.jsxs)("div",{className:"flex items-center gap-1",children:[(0,k.jsx)(x.A,{size:16,className:"drop-shadow-sm"}),t.tags&&t.tags.length>0&&(0,k.jsx)(U.A,{size:12,className:"opacity-75"})]}),(0,k.jsx)("div",{className:"font-semibold text-sm truncate flex-1",children:t.label}),t.onDelete&&(0,k.jsx)("button",{onClick:e=>{e.preventDefault();const a=setTimeout(()=>{e.stopPropagation(),t.onDelete()},300);e.currentTarget.deleteTimeout=a},onDoubleClick:e=>{e.currentTarget.deleteTimeout&&(clearTimeout(e.currentTarget.deleteTimeout),e.currentTarget.deleteTimeout=null)},className:"ml-auto p-1 hover:bg-white hover:bg-opacity-20 rounded transition-all duration-200 hover:scale-110 opacity-70 hover:opacity-100",children:(0,k.jsx)(m.A,{size:12})})]}),(0,k.jsx)("div",{className:"text-xs opacity-90 mb-2",children:t.category}),t.flashcard_count>0&&(0,k.jsxs)("div",{className:"text-xs mt-2 space-y-1",children:[(0,k.jsxs)("div",{className:"flex justify-between items-center",children:[(0,k.jsxs)("span",{className:"opacity-90",children:[t.completed_flashcards,"/",t.flashcard_count," flashcards"]}),(0,k.jsxs)("span",{className:"font-semibold",children:[Math.round(o),"%"]})]}),(0,k.jsx)("div",{className:"w-full bg-white bg-opacity-20 rounded-full h-2 overflow-hidden",children:(0,k.jsx)("div",{className:"h-full bg-white rounded-full transition-all duration-1000 ease-out",style:{width:`${o}%`}})})]}),t.tags&&t.tags.length>0&&(0,k.jsxs)("div",{className:"flex flex-wrap gap-1 mt-2",children:[t.tags.slice(0,3).map((e,t)=>(0,k.jsx)("span",{className:"px-2 py-1 bg-white bg-opacity-20 rounded-full text-xs",children:e},t)),t.tags.length>3&&(0,k.jsxs)("span",{className:"px-2 py-1 bg-white bg-opacity-20 rounded-full text-xs",children:["+",t.tags.length-3]})]}),t.updated_at&&(0,k.jsx)("div",{className:"absolute bottom-1 right-1 opacity-50",children:(0,k.jsx)(q.A,{size:10})})]})};var V=a(8646);const W={topic:J,case:e=>{let{data:t,selected:a}=e;const[i,r]=(0,s.useState)(t.skipAnimation||!1);(0,s.useEffect)(()=>{if(!t.skipAnimation){const e=setTimeout(()=>r(!0),150);return()=>clearTimeout(e)}},[t.skipAnimation]);const o=(e=>{var t,a;const s=(null===(t=e.chief_complaint)||void 0===t?void 0:t.toLowerCase())||"",i=(null===(a=e.diagnosis)||void 0===a?void 0:a.toLowerCase())||"";return["emergency","urgent","crisis","acute","severe"].some(e=>s.includes(e)||i.includes(e))?"high":"normal"})(t);return(0,k.jsxs)("div",{className:`group px-4 py-3 rounded-xl shadow-lg border-2 transition-all duration-600 min-w-[220px] bg-white relative hover:shadow-2xl transform hover:scale-105 ${a?"border-blue-400 shadow-xl scale-105 ring-4 ring-blue-200":"border-gray-200 hover:border-blue-300 hover:ring-2 hover:ring-blue-100"} ${"high"===o?"ring-2 ring-red-300":""} ${i?"opacity-100 scale-100 translate-y-0 rotate-0":"opacity-0 scale-90 translate-y-6 rotate-1"}`,style:{transition:"all 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94), transform 0.3s ease"},children:[(0,k.jsx)(l.h7,{id:"top",type:"source",position:n.yX.Top,className:"w-3 h-3 !bg-blue-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{left:"50%",transform:"translateX(-50%)",zIndex:2},isConnectable:!0}),(0,k.jsx)(l.h7,{id:"top",type:"target",position:n.yX.Top,className:"w-3 h-3 !bg-blue-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{left:"50%",transform:"translateX(-50%)",zIndex:1},isConnectable:!0}),(0,k.jsx)(l.h7,{id:"right",type:"source",position:n.yX.Right,className:"w-3 h-3 !bg-blue-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{top:"50%",transform:"translateY(-50%)",zIndex:2},isConnectable:!0}),(0,k.jsx)(l.h7,{id:"right",type:"target",position:n.yX.Right,className:"w-3 h-3 !bg-blue-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{top:"50%",transform:"translateY(-50%)",zIndex:1},isConnectable:!0}),(0,k.jsx)(l.h7,{id:"bottom",type:"source",position:n.yX.Bottom,className:"w-3 h-3 !bg-blue-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{left:"50%",transform:"translateX(-50%)",zIndex:2},isConnectable:!0}),(0,k.jsx)(l.h7,{id:"bottom",type:"target",position:n.yX.Bottom,className:"w-3 h-3 !bg-blue-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{left:"50%",transform:"translateX(-50%)",zIndex:1},isConnectable:!0}),(0,k.jsx)(l.h7,{id:"left",type:"source",position:n.yX.Left,className:"w-3 h-3 !bg-blue-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{top:"50%",transform:"translateY(-50%)",zIndex:2},isConnectable:!0}),(0,k.jsx)(l.h7,{id:"left",type:"target",position:n.yX.Left,className:"w-3 h-3 !bg-blue-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{top:"50%",transform:"translateY(-50%)",zIndex:1},isConnectable:!0}),"high"===o&&(0,k.jsx)("div",{className:"absolute -top-2 -right-2",children:(0,k.jsx)("div",{className:"w-6 h-6 bg-red-500 rounded-full flex items-center justify-center border-2 border-white animate-pulse",children:(0,k.jsx)(d.A,{size:14,className:"text-white"})})}),(0,k.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,k.jsxs)("div",{className:"flex items-center gap-1",children:[(0,k.jsx)(g.A,{size:16,className:"text-blue-600"}),t.linked_topics&&t.linked_topics.length>0&&(0,k.jsx)("div",{className:"text-xs bg-blue-100 text-blue-600 px-1 rounded",children:t.linked_topics.length})]}),(0,k.jsx)("div",{className:"font-semibold text-sm text-gray-800 truncate flex-1",children:t.label}),t.onDelete&&(0,k.jsx)("button",{onClick:e=>{e.preventDefault();const a=setTimeout(()=>{e.stopPropagation(),t.onDelete()},300);e.currentTarget.deleteTimeout=a},onDoubleClick:e=>{e.currentTarget.deleteTimeout&&(clearTimeout(e.currentTarget.deleteTimeout),e.currentTarget.deleteTimeout=null)},className:"ml-auto p-1 hover:bg-gray-200 rounded transition-all duration-200 hover:scale-110 opacity-70 hover:opacity-100",children:(0,k.jsx)(m.A,{size:12})})]}),(0,k.jsx)("div",{className:"text-xs text-gray-600 mb-2 truncate",children:t.diagnosis}),(0,k.jsxs)("div",{className:"space-y-1",children:[t.age&&(0,k.jsxs)("div",{className:"text-xs text-blue-600 flex items-center gap-1",children:[(0,k.jsx)(V.A,{size:10}),"Age: ",t.age]}),t.status&&(0,k.jsx)("span",{className:`inline-block px-2 py-1 rounded-full text-xs border ${(e=>{switch(e){case"active":return"bg-green-100 text-green-800 border-green-200";case"archived":return"bg-gray-100 text-gray-800 border-gray-200";case"follow_up":return"bg-yellow-100 text-yellow-800 border-yellow-200";default:return"bg-blue-100 text-blue-800 border-blue-200"}})(t.status)}`,children:t.status})]}),t.tasks_count&&t.tasks_count>0&&(0,k.jsxs)("div",{className:"mt-2 text-xs text-gray-500 flex items-center gap-1",children:[(0,k.jsx)(b.A,{size:10}),t.completed_tasks||0,"/",t.tasks_count," tasks"]}),t.updated_at&&(0,k.jsx)("div",{className:"absolute bottom-1 right-1 opacity-30",children:(0,k.jsx)(q.A,{size:10})})]})},task:e=>{let{data:t,selected:a}=e;const[i,r]=(0,s.useState)(t.skipAnimation||!1);(0,s.useEffect)(()=>{if(!t.skipAnimation){const e=setTimeout(()=>r(!0),200);return()=>clearTimeout(e)}},[t.skipAnimation]);return(0,k.jsxs)("div",{className:`group px-4 py-3 rounded-xl shadow-lg border-2 transition-all duration-500 min-w-[200px] text-white relative hover:shadow-2xl transform hover:scale-105 ${a?"border-yellow-400 shadow-xl scale-105 ring-4 ring-yellow-200":"border-transparent hover:border-yellow-300 hover:ring-2 hover:ring-yellow-100"} ${{pending:"bg-yellow-500",in_progress:"bg-blue-600",completed:"bg-green-700 opacity-60"}[t.status]||"bg-gray-500"} ${i?"opacity-100 scale-100 translate-x-0":"opacity-0 scale-85 -translate-x-4"}`,style:{transition:"all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55), transform 0.3s ease"},children:[(0,k.jsx)(l.h7,{id:"top",type:"source",position:n.yX.Top,className:"w-3 h-3 !bg-blue-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{left:"50%",transform:"translateX(-50%)",zIndex:2},isConnectable:!0}),(0,k.jsx)(l.h7,{id:"top",type:"target",position:n.yX.Top,className:"w-3 h-3 !bg-blue-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{left:"50%",transform:"translateX(-50%)",zIndex:1},isConnectable:!0}),(0,k.jsx)(l.h7,{id:"right",type:"source",position:n.yX.Right,className:"w-3 h-3 !bg-blue-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{top:"50%",transform:"translateY(-50%)",zIndex:2},isConnectable:!0}),(0,k.jsx)(l.h7,{id:"right",type:"target",position:n.yX.Right,className:"w-3 h-3 !bg-blue-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{top:"50%",transform:"translateY(-50%)",zIndex:1},isConnectable:!0}),(0,k.jsx)(l.h7,{id:"bottom",type:"source",position:n.yX.Bottom,className:"w-3 h-3 !bg-blue-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{left:"50%",transform:"translateX(-50%)",zIndex:2},isConnectable:!0}),(0,k.jsx)(l.h7,{id:"bottom",type:"target",position:n.yX.Bottom,className:"w-3 h-3 !bg-blue-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{left:"50%",transform:"translateX(-50%)",zIndex:1},isConnectable:!0}),(0,k.jsx)(l.h7,{id:"left",type:"source",position:n.yX.Left,className:"w-3 h-3 !bg-blue-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{top:"50%",transform:"translateY(-50%)",zIndex:2},isConnectable:!0}),(0,k.jsx)(l.h7,{id:"left",type:"target",position:n.yX.Left,className:"w-3 h-3 !bg-blue-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{top:"50%",transform:"translateY(-50%)",zIndex:1},isConnectable:!0}),(0,k.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,k.jsx)(b.A,{size:16}),(0,k.jsx)("div",{className:"font-semibold text-sm",children:t.label}),t.onDelete&&(0,k.jsx)("button",{onClick:e=>{e.preventDefault();const a=setTimeout(()=>{e.stopPropagation(),t.onDelete()},300);e.currentTarget.deleteTimeout=a},onDoubleClick:e=>{e.currentTarget.deleteTimeout&&(clearTimeout(e.currentTarget.deleteTimeout),e.currentTarget.deleteTimeout=null)},className:"ml-auto p-1 hover:bg-white hover:bg-opacity-20 rounded transition-all duration-200 hover:scale-110 opacity-70 hover:opacity-100",children:(0,k.jsx)(m.A,{size:12})})]}),(0,k.jsxs)("div",{className:"text-xs opacity-90",children:["Priority: ",t.priority]}),t.due_date&&(0,k.jsxs)("div",{className:"text-xs mt-1 opacity-90",children:["Due: ",new Date(t.due_date).toLocaleDateString()]})]})},literature:e=>{let{data:t,selected:a}=e;const[i,r]=(0,s.useState)(t.skipAnimation||!1);return(0,s.useEffect)(()=>{if(!t.skipAnimation){const e=setTimeout(()=>r(!0),250);return()=>clearTimeout(e)}},[t.skipAnimation]),(0,k.jsxs)("div",{className:`group px-4 py-3 rounded-xl shadow-lg border-2 transition-all duration-650 min-w-[200px] bg-purple-50 relative hover:shadow-2xl transform hover:scale-105 ${a?"border-purple-400 shadow-xl scale-105 ring-4 ring-purple-200":"border-purple-200 hover:border-purple-300 hover:ring-2 hover:ring-purple-100"} ${i?"opacity-100 scale-100 translate-x-0 rotate-0":"opacity-0 scale-95 translate-x-4 -rotate-1"}`,style:{transition:"all 0.65s cubic-bezier(0.175, 0.885, 0.32, 1.275), transform 0.3s ease"},children:[(0,k.jsx)(l.h7,{id:"top",type:"source",position:n.yX.Top,className:"w-3 h-3 !bg-purple-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{left:"50%",transform:"translateX(-50%)",zIndex:2},isConnectable:!0}),(0,k.jsx)(l.h7,{id:"top",type:"target",position:n.yX.Top,className:"w-3 h-3 !bg-purple-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{left:"50%",transform:"translateX(-50%)",zIndex:1},isConnectable:!0}),(0,k.jsx)(l.h7,{id:"right",type:"source",position:n.yX.Right,className:"w-3 h-3 !bg-purple-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{top:"50%",transform:"translateY(-50%)",zIndex:2},isConnectable:!0}),(0,k.jsx)(l.h7,{id:"right",type:"target",position:n.yX.Right,className:"w-3 h-3 !bg-purple-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{top:"50%",transform:"translateY(-50%)",zIndex:1},isConnectable:!0}),(0,k.jsx)(l.h7,{id:"bottom",type:"source",position:n.yX.Bottom,className:"w-3 h-3 !bg-purple-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{left:"50%",transform:"translateX(-50%)",zIndex:2},isConnectable:!0}),(0,k.jsx)(l.h7,{id:"bottom",type:"target",position:n.yX.Bottom,className:"w-3 h-3 !bg-purple-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{left:"50%",transform:"translateX(-50%)",zIndex:1},isConnectable:!0}),(0,k.jsx)(l.h7,{id:"left",type:"source",position:n.yX.Left,className:"w-3 h-3 !bg-purple-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{top:"50%",transform:"translateY(-50%)",zIndex:2},isConnectable:!0}),(0,k.jsx)(l.h7,{id:"left",type:"target",position:n.yX.Left,className:"w-3 h-3 !bg-purple-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{top:"50%",transform:"translateY(-50%)",zIndex:1},isConnectable:!0}),(0,k.jsxs)("div",{className:"flex items-center gap-2 mb-1 cursor-pointer",onClick:e=>{e.preventDefault();const a=setTimeout(()=>{e.stopPropagation(),t.onLiteratureClick&&t.onLiteratureClick(t)},300);e.currentTarget.clickTimeout=a},onDoubleClick:e=>{e.currentTarget.clickTimeout&&(clearTimeout(e.currentTarget.clickTimeout),e.currentTarget.clickTimeout=null)},children:[(0,k.jsx)(y.A,{size:16,className:"text-purple-600"}),(0,k.jsx)("div",{className:"font-semibold text-sm text-gray-800",children:t.label}),t.onDelete&&(0,k.jsx)("button",{onClick:e=>{e.preventDefault();const a=setTimeout(()=>{e.stopPropagation(),t.onDelete()},300);e.currentTarget.deleteTimeout=a},onDoubleClick:e=>{e.currentTarget.deleteTimeout&&(clearTimeout(e.currentTarget.deleteTimeout),e.currentTarget.deleteTimeout=null)},className:"ml-auto p-1 hover:bg-purple-200 rounded transition-all duration-200 hover:scale-110 opacity-70 hover:opacity-100",children:(0,k.jsx)(m.A,{size:12})})]}),(0,k.jsx)("div",{className:"text-xs text-gray-600",children:t.authors}),(0,k.jsx)("div",{className:"text-xs text-purple-600 mt-1",children:t.year})]})}};const K=[{id:1,title:"Efficacy of Cognitive Behavioral Therapy for Depression: A Meta-Analysis",authors:"Smith, J.A., Johnson, B.K., Williams, C.D.",year:"2023",type:"meta-analysis",journal:"Journal of Clinical Psychology",volume:"79",pages:"234-251",doi:"10.1002/jclp.23456",abstract:"This meta-analysis examines the efficacy of cognitive behavioral therapy (CBT) for treating major depressive disorder across 45 randomized controlled trials involving 3,242 participants. Results indicate that CBT shows significant effectiveness with a large effect size (d = 0.85) compared to control conditions. The analysis also reveals that individual CBT may be more effective than group CBT for severe depression cases.",keywords:"cognitive behavioral therapy, depression, meta-analysis, psychotherapy, mental health",notes:"",pdf_url:"https://example.com/sample-cbt-meta-analysis.pdf",position:{x:300,y:100}},{id:2,title:"DSM-5-TR Clinical Cases",authors:"American Psychiatric Association",year:"2022",type:"guideline",journal:"American Psychiatric Publishing",abstract:"A comprehensive collection of clinical cases that illustrate the diagnostic criteria and clinical features of mental disorders as defined in the DSM-5-TR. Each case includes detailed patient presentations, differential diagnoses, and treatment considerations.",keywords:"DSM-5, diagnosis, clinical cases, psychiatric disorders, differential diagnosis",notes:"Essential reference for diagnostic clarity",position:{x:500,y:200}},{id:3,title:"Pharmacological Treatment of Bipolar Disorder: Current Evidence",authors:"Rodriguez, M.L., Chen, K.H., Anderson, P.R.",year:"2023",type:"review",journal:"Bipolar Disorders",volume:"25",pages:"123-145",doi:"10.1111/bdi.13289",abstract:"This comprehensive review examines current evidence for pharmacological treatments of bipolar disorder, including mood stabilizers, antipsychotics, and adjunctive therapies. The review covers efficacy, safety profiles, and treatment-resistant cases.",keywords:"bipolar disorder, pharmacotherapy, mood stabilizers, lithium, antipsychotics",notes:"Important for medication management decisions",position:{x:700,y:150}},{id:4,title:"Mindfulness-Based Interventions for Anxiety Disorders: A Systematic Review",authors:"Taylor, S.M., Brown, A.J., Davis, L.K.",year:"2023",type:"review",journal:"Clinical Psychology Review",volume:"88",pages:"102-118",abstract:"Systematic review of mindfulness-based interventions for treating various anxiety disorders. Analysis of 28 studies shows moderate to large effect sizes for reducing anxiety symptoms, with particular effectiveness for generalized anxiety disorder.",keywords:"mindfulness, anxiety disorders, meditation, systematic review, GAD",notes:"Good evidence for mindfulness approaches",position:{x:400,y:300}},{id:5,title:"Case Study: Treatment-Resistant Schizophrenia with Clozapine",authors:"Wilson, K.R., Martinez, E.S.",year:"2022",type:"case-study",journal:"Schizophrenia Bulletin",volume:"48",pages:"567-572",abstract:"Detailed case study of a 28-year-old male with treatment-resistant schizophrenia who showed significant improvement after clozapine initiation. The case discusses monitoring protocols, side effect management, and long-term outcomes.",keywords:"schizophrenia, clozapine, treatment-resistant, case study, antipsychotics",notes:"Useful for understanding clozapine protocols",position:{x:600,y:400}}],G=[{id:"conn-1",source:"literature-1",target:"case-101",label:"Treatment approach"},{id:"conn-2",source:"literature-2",target:"topic-201",label:"Reference guide"},{id:"conn-3",source:"literature-3",target:"case-102",label:"Medication guidance"},{id:"conn-4",source:"literature-4",target:"case-103",label:"Treatment option"},{id:"conn-5",source:"literature-5",target:"case-104",label:"Treatment protocol"}],Q=(e,t,a)=>{e(e=>{const s=new Set(e.literature.map(e=>e.id)),i=K.filter(e=>!s.has(e.id));if(0===i.length)return a("Sample literature data already exists","info"),e;const r=new Set(e.cases.map(e=>e.id)),o=new Set(e.topics.map(e=>e.id)),l=[{id:101,label:"Major Depression Case",primary_diagnosis:"Major Depressive Disorder",chief_complaint:"Persistent sadness and loss of interest",secondary_diagnoses:["Anxiety","Insomnia"],position:{x:100,y:100}},{id:102,label:"Bipolar Disorder Case",primary_diagnosis:"Bipolar I Disorder",chief_complaint:"Mood swings and impulsivity",position:{x:200,y:200}},{id:103,label:"Generalized Anxiety Case",primary_diagnosis:"Generalized Anxiety Disorder",chief_complaint:"Excessive worry and restlessness",position:{x:300,y:300}},{id:104,label:"Schizophrenia Case",primary_diagnosis:"Schizophrenia",chief_complaint:"Auditory hallucinations and delusions",position:{x:400,y:400}}].filter(e=>!r.has(e.id)),n=[{id:201,title:"Diagnostic Criteria",category:"Assessment",tags:["DSM-5","diagnosis","criteria"],position:{x:150,y:50}}].filter(e=>!o.has(e.id)),c=new Set(e.connections.map(e=>e.id)),d=G.filter(e=>!c.has(e.id)),u={...e,literature:[...e.literature,...i],cases:[...e.cases,...l],topics:[...e.topics,...n],connections:[...e.connections,...d]};return t(u),a(`Added ${i.length} literature items, ${l.length} cases, and ${n.length} topics`,"success"),u})},Z=()=>a.e(497).then(a.bind(a,7115)),ee=`${"https://2dfe9b59-ae06-48cd-aaa6-476baf8e16c7.preview.emergentagent.com".replace(/\/$/,"")}/api`,te=console.error;console.error=function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];t[0]&&t[0].includes&&t[0].includes("ResizeObserver loop")||te(...t)};const ae=e=>{let{message:t,type:a="success",onClose:i,duration:r=3e3}=e;(0,s.useEffect)(()=>{const e=setTimeout(i,r);return()=>clearTimeout(e)},[i,r]);return(0,k.jsx)("div",{className:`fixed top-4 right-4 z-50 px-6 py-3 rounded-lg shadow-lg transition-all duration-500 transform ${{success:"bg-green-600 text-white border-l-4 border-green-400",error:"bg-red-600 text-white border-l-4 border-red-400",info:"bg-blue-600 text-white border-l-4 border-blue-400",saving:"bg-purple-600 text-white border-l-4 border-purple-400"}[a]}`,children:(0,k.jsxs)("div",{className:"flex items-center",children:[(()=>{switch(a){case"success":default:return(0,k.jsx)(c.A,{size:16,className:"mr-2"});case"error":return(0,k.jsx)(d.A,{size:16,className:"mr-2"});case"info":return(0,k.jsx)(u.A,{size:16,className:"mr-2"});case"saving":return(0,k.jsx)(p.A,{size:16,className:"mr-2 animate-spin"})}})(),(0,k.jsx)("span",{className:"text-sm font-medium",children:t}),(0,k.jsx)("button",{onClick:i,className:"ml-4 text-white hover:text-gray-200 transition-colors",children:(0,k.jsx)(m.A,{size:14})})]})})},se=e=>{let{onClick:t,loading:a,disabled:s,children:i,className:r,icon:o,...l}=e;return(0,k.jsx)("button",{onClick:t,disabled:s||a,className:`${r} transform transition-all duration-200 hover:scale-105 active:scale-95 ${s||a?"cursor-not-allowed opacity-50":"hover:shadow-lg"}`,...l,children:(0,k.jsxs)("div",{className:"flex items-center gap-2",children:[a?(0,k.jsx)(p.A,{size:16,className:"animate-spin"}):o?(0,k.jsx)(o,{size:16}):null,i]})})},ie="pgy3_mindmap_data",re={save:(()=>{let e;return function(t,a,s){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];clearTimeout(e),a&&a();e=setTimeout(()=>{try{const e={version:"1.1",timestamp:(new Date).toISOString(),data:t};localStorage.setItem(ie,JSON.stringify(e)),console.log("Mind map data auto-saved to localStorage"),s&&s(!0)}catch(e){if(console.error("Error saving to localStorage:",e),s&&s(!1,e),"QuotaExceededError"===e.name){console.warn("localStorage quota exceeded, clearing old data...");try{localStorage.removeItem(ie)}catch(a){console.error("Error clearing localStorage:",a)}}}},i?1200:800)}})(),load:()=>{try{const e=localStorage.getItem(ie);if(!e)return console.log("No localStorage data found"),null;const t=JSON.parse(e);return"1.1"!==t.version?(console.log("localStorage version mismatch, clearing old data"),localStorage.removeItem(ie),null):(console.log("Mind map data loaded from localStorage",t.timestamp),t.data)}catch(e){console.error("Error loading from localStorage:",e);try{localStorage.removeItem(ie)}catch(t){console.error("Error clearing corrupted localStorage:",t)}return null}},clear:()=>{try{localStorage.removeItem(ie),console.log("localStorage data cleared")}catch(e){console.error("Error clearing localStorage:",e)}},getStorageInfo:()=>{try{const e=localStorage.getItem(ie);if(!e)return null;const t=JSON.parse(e);return{version:t.version,timestamp:t.timestamp,size:new Blob([e]).size}}catch(e){return null}}},oe=e=>{let{edge:t,isOpen:a,onClose:i,onSave:r}=e;const[o,l]=(0,s.useState)((null===t||void 0===t?void 0:t.label)||"");(0,s.useEffect)(()=>{l((null===t||void 0===t?void 0:t.label)||"")},[t]);const n=()=>{r(t.id,o),i()};return a&&t?(0,k.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 backdrop-blur-sm",children:(0,k.jsxs)("div",{className:"bg-white rounded-xl shadow-2xl p-6 max-w-md w-full mx-4 transform transition-all",children:[(0,k.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,k.jsx)("h3",{className:"text-xl font-semibold text-gray-800",children:"Edit Connection Label"}),(0,k.jsx)("button",{onClick:i,className:"text-gray-400 hover:text-gray-600 p-1 transition-colors",children:(0,k.jsx)(m.A,{size:20})})]}),(0,k.jsxs)("div",{className:"mb-6",children:[(0,k.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Connection Label"}),(0,k.jsx)("input",{type:"text",value:o,onChange:e=>l(e.target.value),onKeyPress:e=>{"Enter"===e.key?n():"Escape"===e.key&&i()},placeholder:"Enter a label for this connection...",className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all",autoFocus:!0}),(0,k.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Press Enter to save, Escape to cancel"})]}),(0,k.jsxs)("div",{className:"flex items-center justify-end gap-3",children:[(0,k.jsx)("button",{onClick:i,className:"px-4 py-2 text-gray-600 hover:text-gray-800 border border-gray-300 rounded-lg hover:bg-gray-100 transition-colors",children:"Cancel"}),(0,k.jsxs)("button",{onClick:n,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2",children:[(0,k.jsx)(h.A,{size:16}),"Save Label"]})]})]})}):null},le=()=>{var e,t,a,i,c,d;const{fitView:u,setCenter:m,zoomTo:h,getViewport:C}=(0,l.VH)(),[S,_,A]=(0,l.ck)([]),[T,P,z]=(0,l.fM)([]),[O,M]=(0,s.useState)(0),[L,H]=(0,s.useState)({topics:[],cases:[],tasks:[],literature:[],connections:[]}),[Y,U]=(0,s.useState)(!1),[q,J]=(0,s.useState)(null),[V,K]=(0,s.useState)(!0),[G,te]=(0,s.useState)(0),[ie,le]=(0,s.useState)("Initializing..."),[ce,de]=(0,s.useState)(!0),[ue,pe]=(0,s.useState)(null),[me,he]=(0,s.useState)(!1),[xe,ge]=(0,s.useState)({isOpen:!1,data:null}),[be,ye]=(0,s.useState)({isOpen:!1,data:null}),[ve,fe]=(0,s.useState)({isOpen:!1,data:null}),je=(0,s.useRef)(null),we=(0,s.useRef)(null),Ne=(0,s.useRef)(null),[ke,Ce]=(0,s.useState)(!1),[Se,_e]=(0,s.useState)(!1),[Ae,Te]=(0,s.useState)(!1),[Pe,ze]=(0,s.useState)(null),[Oe,De]=(0,s.useState)(!1),[Ee,$e]=(0,s.useState)({isOpen:!1,edge:null}),[Ie,Me]=(0,s.useState)([]),[Le,Xe]=(0,s.useState)({isOpen:!1,data:null}),[He,Fe]=(0,s.useState)(!1),[Re,Ye]=(0,s.useState)({case:!1,topic:!1,task:!1,literature:!1}),Be=(0,s.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3e3;const s={id:Date.now(),message:e,type:t,duration:a};Me(e=>[...e,s])},[]),Ue=(0,s.useCallback)(e=>{Me(t=>t.filter(t=>t.id!==e))},[]),qe=(0,s.useCallback)(e=>{var t,a,s;const i=xe.isOpen||be.isOpen||ve.isOpen||Le.isOpen,r=Object.values(Re).some(e=>e),o=xe.isOpen&&(null===(t=xe.data)||void 0===t?void 0:t.isTabTransitioning)||be.isOpen&&(null===(a=be.data)||void 0===a?void 0:a.isTabTransitioning)||ve.isOpen&&(null===(s=ve.data)||void 0===s?void 0:s.isTabTransitioning);if(He||i||o||r){console.log("Deferring auto-save during animation, modal interaction, or tab transition");return void setTimeout(()=>qe(e),o||r?2e3:1e3)}re.save(e,()=>De(!0),(e,t)=>{De(!1),e?ze(new Date):(Be("Auto-save failed","error",4e3),console.error("Auto-save error:",t))},He),window.requestIdleCallback?window.requestIdleCallback(()=>{He||Object.values(Re).some(e=>e)||Ge(e)},{timeout:5e3}):setTimeout(()=>{He||Object.values(Re).some(e=>e)||Ge(e)},100)},[Be,He,Re,xe.isOpen,be.isOpen,ve.isOpen,Le.isOpen]);(0,s.useCallback)(e=>{const t=xe.isOpen||be.isOpen||ve.isOpen||Le.isOpen,a=Object.values(Re).some(e=>e);He||t||a||(re.save(e,null,null,He),clearTimeout(window.positionBackendSaveTimeout),window.positionBackendSaveTimeout=setTimeout(()=>{qe(e)},800))},[He,Re,xe.isOpen,be.isOpen,ve.isOpen,Le.isOpen,qe]);(0,s.useEffect)(()=>{xe.isOpen&&xe.data?je.current={...xe.data}:xe.isOpen||(je.current=null)},[xe.isOpen,null===(e=xe.data)||void 0===e?void 0:e.id]),(0,s.useEffect)(()=>{be.isOpen&&be.data?we.current={...be.data}:be.isOpen||(we.current=null)},[be.isOpen,null===(t=be.data)||void 0===t?void 0:t.id]),(0,s.useEffect)(()=>{ve.isOpen&&ve.data?Ne.current={...ve.data}:ve.isOpen||(Ne.current=null)},[ve.isOpen,null===(a=ve.data)||void 0===a?void 0:a.id]);const Je=(0,s.useCallback)(e=>{console.log("Deleting node with full ID:",e);const[t,...a]=e.split("-"),s=a.join("-"),i="literature"===t?"literature":`${t}s`;H(a=>{const r=(a[i]||[]).filter(e=>String(e.id)!==s),o=(a.connections||[]).filter(t=>t.source!==e&&t.target!==e),l={...a,[i]:r,connections:o};return qe(l),Be(`${t.charAt(0).toUpperCase()+t.slice(1)} deleted.`,"success"),l}),_(t=>t.filter(t=>t.id!==e)),P(t=>t.filter(t=>t.source!==e&&t.target!==e))},[H,qe,Be,_,P]),Ve=(0,s.useCallback)(e=>{Fe(!0),Xe({isOpen:!0,data:e}),setTimeout(()=>Fe(!1),700)},[]),We=(0,s.useCallback)(()=>{console.log("syncNodeData called - syncing node colors and labels"),_(e=>{let t=!1;const a=e.map(e=>{const a=e.id.split("-")[0],s=e.id.split("-")[1];let i=e.data.label,r=e.data.color,o=!1;if("case"===a){var l;const t=null===(l=L.cases)||void 0===l?void 0:l.find(e=>String(e.id)===s);if(t){const a=t.primaryDiagnosis||t.primary_diagnosis||t.title||"Untitled Case";a!==e.data.label&&(i=a,o=!0)}}else if("topic"===a){var n;const t=null===(n=L.topics)||void 0===n?void 0:n.find(e=>String(e.id)===s);if(t){const a=t.title||"Untitled Topic",l=t.color||"#3B82F6";a!==e.data.label&&(i=a,o=!0),l!==e.data.color&&(r=l,o=!0,console.log(`Topic ${s}: Color changing from ${e.data.color} to ${l}`))}}else if("task"===a){var c;const t=null===(c=L.tasks)||void 0===c?void 0:c.find(e=>String(e.id)===s);if(t){const a=t.title||"Untitled Task";a!==e.data.label&&(i=a,o=!0)}}else if("literature"===a){var d;const t=null===(d=L.literature)||void 0===d?void 0:d.find(e=>String(e.id)===s);if(t){const a=t.title||"Untitled Literature";a!==e.data.label&&(i=a,o=!0)}}if(o){t=!0;const s=Date.now();return{id:e.id,type:e.type,position:{...e.position},data:{...e.data,label:i,color:r,lastUpdated:s},style:"topic"===a?{backgroundColor:r,color:"white",boxShadow:`0 4px 20px ${r}20`,transition:"all 0.7s cubic-bezier(0.34, 1.56, 0.64, 1), transform 0.3s ease",zIndex:s%1e3}:e.style,key:`${e.id}-${s}`}}return e});return t?(console.log("syncNodeData: Changes detected, updating nodes with forced re-render"),[...a]):(console.log("syncNodeData: No changes needed"),e)})},[L,_]);(0,s.useEffect)(()=>{var e,t,a,s;if(L&&((null===(e=L.cases)||void 0===e?void 0:e.length)>0||(null===(t=L.topics)||void 0===t?void 0:t.length)>0||(null===(a=L.tasks)||void 0===a?void 0:a.length)>0||(null===(s=L.literature)||void 0===s?void 0:s.length)>0)){const e=setTimeout(()=>{console.log("useEffect triggered syncNodeData due to mindMapData change"),We()},50);return 0===S.length&&(console.log("Converting data to React Flow nodes due to data change"),setTimeout(()=>{Ke(L,!1)},100)),()=>clearTimeout(e)}},[L,We,S.length]),(0,s.useEffect)(()=>{O>0&&(console.log("Force update triggered by nodeUpdateTrigger:",O),setTimeout(()=>{We()},100))},[O,We]);const Ke=(0,s.useCallback)(async function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const a=[...e.topics.map(e=>({...e,type:"topic"})),...e.cases.map(e=>({...e,type:"case"})),...e.tasks.map(e=>({...e,type:"task"})),...e.literature.map(e=>({...e,type:"literature"}))];let s;const i=a.some(e=>e.position&&"number"===typeof e.position.x&&"number"===typeof e.position.y);if(a.length>0&&t&&!i)try{const{forceSimulation:t,forceManyBody:i,forceLink:r,forceCenter:o,forceCollide:l}=await Z(),n=a.map((e,t)=>{var a,s;return{id:`${e.type}-${e.id}`,x:(null===(a=e.position)||void 0===a?void 0:a.x)||200*(Math.random()-.5),y:(null===(s=e.position)||void 0===s?void 0:s.y)||200*(Math.random()-.5),type:e.type}}),c=(e.connections||[]).map(e=>({source:e.source,target:e.target,id:e.id})).filter(e=>{const t=new Set(n.map(e=>e.id));return t.has(e.source)&&t.has(e.target)}),d=t(n).force("link",r(c).id(e=>e.id).distance(200).strength(.5)).force("charge",i().strength(-800).distanceMax(400)).force("center",o(window.innerWidth/3,window.innerHeight/2)).force("collision",l().radius(80)).stop();for(let e=0;e<300;e++)d.tick();const u=new Map;n.forEach(e=>{u.set(e.id,{x:e.x,y:e.y})}),s=a.map(e=>{const t=`${e.type}-${e.id}`,a=u.get(t)||{x:0,y:0};return{...e,position:a}})}catch(l){console.warn("Failed to apply initial layout, using fallback positioning:",l),s=a}else s=a;const r=(s||a).map((e,t)=>{const s=`${e.type}-${e.id}`,i="case"===e.type?{...e,chiefComplaint:e.chiefComplaint||e.chief_complaint||"",initialPresentation:e.initialPresentation||e.initial_presentation||"",currentPresentation:e.currentPresentation||e.current_presentation||"",medicationHistory:e.medicationHistory||e.medication_history||"",therapyProgress:e.therapyProgress||e.therapy_progress||"",defensePatterns:e.defensePatterns||e.defense_patterns||"",clinicalReflection:e.clinicalReflection||e.clinical_reflection||""}:e;let r;if(e.position&&"number"===typeof e.position.x&&"number"===typeof e.position.y)r=e.position;else{const e=Math.ceil(Math.sqrt(a.length)),s=250,i=150;r={x:t%e*s+300,y:Math.floor(t/e)*s+i}}return{id:s,type:e.type,position:r,data:{...i,label:e.title||e.label||`Untitled ${e.type}`,color:e.color||"#3B82F6",onDelete:()=>Je(s),onLiteratureClick:"literature"===e.type?Ve:void 0,skipAnimation:ce},style:"topic"===e.type?{backgroundColor:e.color||"#3B82F6"}:void 0}}),o=((e,t)=>{const a=new Set(t);return e.filter(e=>a.has(e.source)&&a.has(e.target)).map(e=>({id:e.id,source:e.source,target:e.target,label:e.label,type:"floating",style:{strokeWidth:2,stroke:"#64748b",opacity:.85},animated:!1,updatable:!0}))})(e.connections||[],r.map(e=>e.id));_(r),P(o)},[_,P,Je,Ve,ce]),Ge=(0,s.useCallback)(async e=>{const t={topics:JSON.parse(JSON.stringify(e.topics||[])),cases:JSON.parse(JSON.stringify(e.cases||[])),tasks:JSON.parse(JSON.stringify(e.tasks||[])),literature:JSON.parse(JSON.stringify(e.literature||[])),connections:JSON.parse(JSON.stringify(e.connections||[]))};try{const e=(new Date).toISOString();t.topics=t.topics.map((t,a)=>{var s,i;return{id:String(t.id||`${Date.now()}-${a}-topic`),title:t.title||"Untitled Topic",description:t.description||"",category:t.category||"Uncategorized",color:t.color||"#3B82F6",position:{x:Number(null===(s=t.position)||void 0===s?void 0:s.x)||0,y:Number(null===(i=t.position)||void 0===i?void 0:i.y)||0},flashcard_count:Number(t.flashcard_count)||0,completed_flashcards:Number(t.completed_flashcards)||0,resources:Array.isArray(t.resources)?t.resources:[],created_at:t.created_at||e,updated_at:e}}),t.cases=t.cases.map((t,a)=>{var s,i;return{id:String(t.id||`${Date.now()}-${a}-case`),case_id:t.case_id||`CASE-${Date.now()}-${a}`,encounter_date:t.encounter_date||e,primary_diagnosis:t.primary_diagnosis||"Unspecified",secondary_diagnoses:Array.isArray(t.secondary_diagnoses)?t.secondary_diagnoses:[],age:void 0!==t.age?Number(t.age):null,gender:t.gender||null,chief_complaint:t.chiefComplaint||t.chief_complaint||"",initial_presentation:t.initialPresentation||t.initial_presentation||"",current_presentation:t.currentPresentation||t.current_presentation||"",medication_history:t.medicationHistory||t.medication_history||"",therapy_progress:t.therapyProgress||t.therapy_progress||"",defense_patterns:t.defensePatterns||t.defense_patterns||"",clinical_reflection:t.clinicalReflection||t.clinical_reflection||"",history_present_illness:t.history_present_illness||null,medical_history:t.medical_history||null,medications:Array.isArray(t.medications)?t.medications:[],mental_status_exam:t.mental_status_exam||null,assessment_plan:t.assessment_plan||null,notes:t.notes||null,status:t.status||"active",linked_topics:Array.isArray(t.linked_topics)?t.linked_topics:[],position:{x:Number(null===(s=t.position)||void 0===s?void 0:s.x)||0,y:Number(null===(i=t.position)||void 0===i?void 0:i.y)||0},created_at:t.created_at||e,updated_at:e}}),t.tasks=t.tasks.map((t,a)=>{var s,i;return{id:String(t.id||`${Date.now()}-${a}-task`),title:t.title||"Untitled Task",description:t.description||null,status:t.status||"pending",priority:t.priority||"medium",due_date:t.due_date||null,linked_case_id:t.linked_case_id||null,linked_topic_id:t.linked_topic_id||null,position:{x:Number(null===(s=t.position)||void 0===s?void 0:s.x)||0,y:Number(null===(i=t.position)||void 0===i?void 0:i.y)||0},created_at:t.created_at||e,updated_at:e}}),t.literature=t.literature.map((t,a)=>{var s,i;return{id:String(t.id||`${Date.now()}-${a}-lit`),title:t.title||"Untitled Literature",authors:t.authors||null,publication:t.publication||null,year:void 0!==t.year?Number(t.year):null,doi:t.doi||null,abstract:t.abstract||null,notes:t.notes||null,pdf_path:t.pdf_path||null,linked_topics:Array.isArray(t.linked_topics)?t.linked_topics:[],position:{x:Number(null===(s=t.position)||void 0===s?void 0:s.x)||0,y:Number(null===(i=t.position)||void 0===i?void 0:i.y)||0},created_at:t.created_at||e,updated_at:e}}),t.connections=t.connections.map((e,t)=>({id:String(e.id||`${Date.now()}-${t}-conn`),source:e.source||"",target:e.target||"",label:e.label||""})),t.connections=t.connections.filter(e=>e.source&&e.target&&"string"===typeof e.source&&"string"===typeof e.target&&e.source.length>0&&e.target.length>0),console.log("Sending cleaned data to backend:",t);const a=await r.A.put(`${ee}/mindmap-data`,t,{headers:{"Content-Type":"application/json"}});console.log("Backend save successful:",a.data)}catch(l){var a,s,i,o;console.error("Failed to save to backend:",(null===(a=l.response)||void 0===a?void 0:a.data)||l.message),422===(null===(s=l.response)||void 0===s?void 0:s.status)&&null!==(i=l.response)&&void 0!==i&&null!==(o=i.data)&&void 0!==o&&o.detail&&(console.error("Validation errors:"),console.error(JSON.stringify(l.response.data.detail,null,2)),console.error("Request data that caused validation error:"),console.error(JSON.stringify(t,null,2)))}},[]),Qe=(0,s.useCallback)(e=>{const t=`conn-${Date.now()}`,a={...e,id:t,type:"floating",style:{strokeWidth:2,stroke:"#64748b",opacity:.85,transition:"none"},data:{__forceUpdate:Date.now()},interactionWidth:20};P(e=>(0,n.rN)(a,e)),H(t=>{const s=[...t.connections,{id:a.id,source:e.source,target:e.target,label:""}],i={...t,connections:s};return qe(i),i})},[P,H,qe]),Ze=(0,s.useCallback)((e,t)=>{J(t),_(e=>e.map(e=>({...e,selected:e.id===t.id})))},[_]),et=(0,s.useCallback)((e,t)=>{const a=t.id.split("-"),s=a[0],i=a.slice(1).join("-");if(("case"!==s||!xe.isOpen)&&("topic"!==s||!be.isOpen)&&("task"!==s||!ve.isOpen)&&("literature"!==s||!Le.isOpen)){if("literature"===s){const e=L.literature.find(e=>String(e.id)===i);return void(e&&Xe({isOpen:!0,data:e}))}if("case"===s){const e=L.cases.find(e=>String(e.id)===i);return void(e&&(Ye(e=>({...e,case:!0})),ge({isOpen:!0,data:e}),setTimeout(()=>{Ye(e=>({...e,case:!1}))},800)))}if("topic"===s){const e=L.topics.find(e=>String(e.id)===i);return void(e&&(Ye(e=>({...e,topic:!0})),ye({isOpen:!0,data:e}),setTimeout(()=>{Ye(e=>({...e,topic:!1}))},800)))}if("task"===s){const e=L.tasks.find(e=>String(e.id)===i);return void(e&&(Ye(e=>({...e,task:!0})),fe({isOpen:!0,data:e}),setTimeout(()=>{Ye(e=>({...e,task:!1}))},800)))}}},[L,xe.isOpen,be.isOpen,ve.isOpen,Le.isOpen]),tt=(0,s.useCallback)((e,t)=>{P(e=>e.filter(e=>e.id!==t.id)),H(e=>{const a=e.connections.filter(e=>e.id!==t.id),s={...e,connections:a};return qe(s),Be("Connection deleted","success"),s})},[P,H,qe,Be]),at=(0,s.useCallback)((e,t)=>{e.preventDefault(),$e({isOpen:!0,edge:t})},[]),st=(0,s.useCallback)((e,t)=>{P(a=>a.map(a=>a.id===e?{...a,label:t}:a)),H(a=>{const s=a.connections.map(a=>a.id===e?{...a,label:t}:a),i={...a,connections:s};return qe(i),i})},[P,H,qe]),it=(0,s.useCallback)((e,t)=>{P(e=>e.map(e=>e.id===t.id?{...e,className:"highlighted"}:e))},[P]),rt=(0,s.useCallback)((e,t)=>{P(e=>e.map(e=>e.id===t.id?{...e,className:""}:e))},[P]),ot=(0,s.useCallback)(async()=>{if(0!==S.length)try{const{forceSimulation:e,forceManyBody:t,forceLink:a,forceCenter:s,forceCollide:i}=await Z(),r=[...T],o=new Set(S.map(e=>e.id)),l=r.filter(e=>o.has(e.source)&&o.has(e.target)),n=l.map(e=>({source:e.source,target:e.target,id:e.id})),c=S.map(e=>({id:e.id,x:e.position.x,y:e.position.y,fx:null,fy:null})),d=e(c).force("link",a(n).id(e=>e.id).distance(200).strength(.5)).force("charge",t().strength(-800).distanceMax(400)).force("center",s(window.innerWidth/3,window.innerHeight/2)).force("collision",i().radius(80)).stop(),p=50,m=400;let h=0;const x=()=>{const e=Math.min(p,m-h);for(let t=0;t<e;t++)d.tick();if(h+=e,h<m)requestAnimationFrame(x);else{const e=c.map(e=>({...S.find(t=>t.id===e.id),position:{x:e.x,y:e.y}}));_(e),P(l),H(t=>{const a={...t};return e.forEach(e=>{var t;const[s,i]=e.id.split("-"),r=null===(t=a["literature"===s?"literature":`${s}s`])||void 0===t?void 0:t.find(e=>String(e.id)===i);r&&(r.position=e.position)}),a}),setTimeout(()=>{u({duration:800,padding:.2})},200)}};requestAnimationFrame(x)}catch(e){console.error("Force layout failed:",e),Be("Layout calculation failed","error")}},[S,T,_,P,H,u,Be]),lt=(0,s.useCallback)(()=>{try{ot(),Be("Nodes realigned successfully","success")}catch(e){console.error("Force layout error:",e),Be("Failed to realign nodes","error")}},[ot,Be]),nt=(0,s.useCallback)(()=>{if(!window.confirm("Are you sure you want to clear the entire mind map?"))return;const e={topics:[],cases:[],tasks:[],literature:[],connections:[]};H(e),_([]),P([]),J(null),ge({isOpen:!1,data:null}),ye({isOpen:!1,data:null}),fe({isOpen:!1,data:null}),Xe({isOpen:!1,data:null}),pe(null),qe(e),Be("Mind map cleared successfully","success")},[_,P,qe,Be]),ct=(0,s.useCallback)(e=>{var t,a,s,i;const r=Date.now(),o=`${e}-${r}`;let l={id:r,label:`New ${e}`};"case"===e&&(l={...l,chiefComplaint:"",initialPresentation:"",currentPresentation:"",medicationHistory:"",therapyProgress:"",defensePatterns:"",clinicalReflection:""});const n=((null===(t=L.topics)||void 0===t?void 0:t.length)||0)+((null===(a=L.cases)||void 0===a?void 0:a.length)||0)+((null===(s=L.tasks)||void 0===s?void 0:s.length)||0)+((null===(i=L.literature)||void 0===i?void 0:i.length)||0),c=Math.ceil(Math.sqrt(n+1)),d={x:n%c*280+400,y:280*Math.floor(n/c)+150},u={id:o,type:e,position:d,data:{...l,onDelete:()=>Je(o)}};H(t=>{const a="literature"===e?"literature":`${e}s`,s={...u.data,position:u.position};delete s.onDelete;const i={...t,[a]:[...t[a]||[],s]};return qe(i),i}),_(e=>e.concat(u)),Be(`${e.charAt(0).toUpperCase()+e.slice(1)} added successfully`,"success")},[L,Je,H,qe,_,Be]),dt=(0,s.useCallback)(e=>{if(A(e),He)return void console.log("Skipping position updates during animation");const t=e.filter(e=>"position"===e.type&&e.position);t.length>0&&(console.log("Processing position changes:",t),H(e=>{const a={...e};return t.forEach(e=>{if(e.position){var t;const[s,i]=e.id.split("-"),r=null===(t=a["literature"===s?"literature":`${s}s`])||void 0===t?void 0:t.find(e=>String(e.id)===i);r&&(r.position={...e.position},console.log(`Updated ${s} ${i} position to:`,e.position))}}),re.save(a,null,null,!1),a}),setTimeout(()=>{qe(L)},500))},[A,H,He,qe,L]),ut=(0,s.useCallback)((e,t)=>{clearTimeout(window.dragSaveTimeout),window.dragSaveTimeout=setTimeout(()=>{H(e=>(qe(e),e))},500)},[qe]),pt=(0,s.useCallback)(async()=>{K(!0),te(10),le("Checking local data...");try{const t=re.load();if(t)return te(30),le("Loading from cache..."),t.connections||(t.connections=[]),H(t),te(60),le("Applying layout..."),await Ke(t,!0),te(90),le("Finalizing..."),K(!1),de(!1),te(100),void setTimeout(async()=>{try{const e=await r.A.get(`${ee}/mindmap-data`);JSON.stringify(e.data)!==JSON.stringify(t)&&(e.data.connections||(e.data.connections=[]),H(e.data),await Ke(e.data),qe(e.data),Be("Data synchronized with server","info"))}catch(e){console.warn("Background sync failed:",e)}},500);te(20),le("Loading from server...");try{const e=await r.A.get(`${ee}/mindmap-data`);e.data.connections||(e.data.connections=[]),te(50),le("Processing data..."),H(e.data),te(80),le("Applying layout..."),await Ke(e.data,!0),qe(e.data),te(100),K(!1),de(!1)}catch(e){console.warn("Backend loading failed, populating with sample data:",e),te(60),le("Loading sample data...");H({topics:[],cases:[],tasks:[],literature:[],connections:[]}),setTimeout(()=>{Q(H,qe,Be)},100),te(100),K(!1),de(!1)}}catch(t){console.error("Error loading mind map:",t),Be("Failed to load mind map","error"),K(!1),de(!1)}},[Be,qe,Ke]);(0,s.useEffect)(()=>{pt()},[]);const mt=(0,s.useCallback)((e,t)=>{if(!e||!e.id||!e.data)return!1;if(!t)return!0;const a=t.toLowerCase().trim();if(!a)return!0;try{const t=e.id.split("-"),s=t.length>0?t[0]:"",i=t.length>1?t[1]:"";let r=!1;if(!r&&e.data.label){r=e.data.label.toLowerCase().includes(a)}if(!r&&s&&(r=s.includes(a)),!r&&"case"===s&&i&&(r=`case-${i}`.toLowerCase().includes(a)),!r)if("case"===s){r=(e.data.primary_diagnosis||e.data.primaryDiagnosis||"").toLowerCase().includes(a)}else if("topic"===s){r=(e.data.title||"").toLowerCase().includes(a)}else if("literature"===s){const t=(e.data.title||"").toLowerCase(),s=(e.data.authors||"").toLowerCase();r=t.includes(a)||s.includes(a)}if(!r&&e.data.category){r=e.data.category.toLowerCase().includes(a)}return r}catch(s){return console.error("Error in nodeMatchesSearch for node:",e.id,s),!1}},[]);if((0,s.useEffect)(()=>{const e=e=>{var t;if("INPUT"!==e.target.tagName&&"TEXTAREA"!==e.target.tagName){if(e.ctrlKey||e.metaKey)switch(e.key){case"n":e.preventDefault(),he(!0);break;case"e":e.preventDefault(),U(!Y);break;case"r":e.preventDefault(),lt();break;case"f":e.preventDefault(),null===(t=document.querySelector('input[type="text"][placeholder*="Search"]'))||void 0===t||t.focus()}"Escape"===e.key&&(J(null),ge({isOpen:!1,data:null}),ye({isOpen:!1,data:null}),fe({isOpen:!1,data:null}),Xe({isOpen:!1,data:null}),he(!1),!xe.isOpen&&!be.isOpen&&!ve.isOpen&&Le.isOpen)}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[lt,xe,be,ve,Le]),(0,s.useEffect)(()=>{(ke&&!Se&&S.length>0||ce&&S.length>0)&&_e(!0)},[ke,Se,S,ce]),(0,s.useEffect)(()=>{if(0===S.length)return;Object.values(Re).some(e=>e)},[ue,S,mt,He,Re]),(0,s.useEffect)(()=>{if(!ke)return;const e=document.getElementById("search-filter-styles")||document.createElement("style");e.id="search-filter-styles",document.getElementById("search-filter-styles")||document.head.appendChild(e);e.textContent="\n      /* Default node styling */\n      .react-flow__node {\n        transition: opacity 0.3s ease, transform 0.3s ease, filter 0.3s ease !important;\n      }\n      \n      /* Search dimmed nodes */\n      .react-flow__node.search-dimmed {\n        opacity: 0.15 !important;\n        filter: grayscale(0.7) !important;\n        transform: scale(0.9) !important;\n      }\n      \n      /* Selected node highlighting */\n      .react-flow__node.search-selected {\n        box-shadow: 0 0 0 2px #10b981, 0 0 20px rgba(16, 185, 129, 0.6) !important;\n        z-index: 1000 !important;\n      }\n      \n      /* Ensure dragging still works */\n      .react-flow__node.search-dimmed {\n        pointer-events: auto !important;\n      }\n    "},[ke]),V)return(0,k.jsx)(B,{message:ie,progress:G});return(0,k.jsxs)("div",{className:"min-h-screen bg-gray-50 flex",children:[(0,k.jsxs)("div",{className:"w-80 bg-gradient-to-b from-slate-800 to-slate-900 text-white p-6 shadow-2xl flex flex-col",children:[(0,k.jsxs)("div",{className:"mb-8",children:[(0,k.jsx)("div",{className:"text-3xl font-bold tracking-wide text-white",children:"PGY-3 HQ"}),(0,k.jsx)("div",{className:"text-sm text-slate-300 mt-2",children:"Psychiatry Resident Dashboard"})]}),(0,k.jsxs)("div",{className:"mb-6",children:[(0,k.jsx)("h3",{className:"text-sm font-semibold text-slate-300 mb-3",children:"Filter by Category"}),(0,k.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,k.jsx)("button",{onClick:()=>pe(null),className:"px-3 py-2 rounded-lg text-xs transition-all "+(null===ue?"bg-teal-600 text-white":"bg-slate-700 text-slate-300 hover:bg-slate-600"),children:"All"}),(0,k.jsxs)("button",{onClick:()=>pe("topic"),className:"px-3 py-2 rounded-lg text-xs transition-all flex items-center gap-1 "+("topic"===ue?"bg-blue-600 text-white":"bg-slate-700 text-slate-300 hover:bg-slate-600"),children:[(0,k.jsx)(x.A,{size:12}),"Topics"]}),(0,k.jsxs)("button",{onClick:()=>pe("case"),className:"px-3 py-2 rounded-lg text-xs transition-all flex items-center gap-1 "+("case"===ue?"bg-indigo-600 text-white":"bg-slate-700 text-slate-300 hover:bg-slate-600"),children:[(0,k.jsx)(g.A,{size:12}),"Cases"]}),(0,k.jsxs)("button",{onClick:()=>pe("task"),className:"px-3 py-2 rounded-lg text-xs transition-all flex items-center gap-1 "+("task"===ue?"bg-amber-600 text-white":"bg-slate-700 text-slate-300 hover:bg-slate-600"),children:[(0,k.jsx)(b.A,{size:12}),"Tasks"]}),(0,k.jsxs)("button",{onClick:()=>pe("literature"),className:"px-3 py-2 rounded-lg text-xs transition-all flex items-center gap-1 "+("literature"===ue?"bg-purple-600 text-white":"bg-slate-700 text-slate-300 hover:bg-slate-600"),children:[(0,k.jsx)(y.A,{size:12}),"Literature"]})]})]}),(0,k.jsx)("div",{className:"mb-4 p-3 bg-slate-700 bg-opacity-50 rounded-lg",children:(0,k.jsx)("div",{className:"flex items-center gap-2 text-xs",children:Oe?(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(p.A,{size:12,className:"animate-spin"}),(0,k.jsx)("span",{className:"text-amber-300",children:"Saving..."})]}):Pe?(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(v.A,{size:12,className:"text-green-400"}),(0,k.jsxs)("span",{className:"text-slate-300",children:["Last saved: ",Pe.toLocaleTimeString()]})]}):(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(f.A,{size:12,className:"text-slate-400"}),(0,k.jsx)("span",{className:"text-slate-400",children:"Auto-save enabled"})]})})}),(0,k.jsxs)("div",{className:"space-y-3 mb-6",children:[(0,k.jsx)(se,{onClick:lt,icon:j.A,className:"w-full bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-md text-sm",children:"Realign Nodes"}),(0,k.jsx)(se,{onClick:()=>Q(H,qe,Be),icon:y.A,className:"w-full bg-emerald-600 hover:bg-emerald-700 text-white px-4 py-2 rounded-md text-sm",children:"Add Sample Literature"}),(0,k.jsxs)("div",{className:"space-y-2",children:[(0,k.jsx)("div",{className:"text-xs font-semibold text-slate-400 uppercase tracking-wide mb-2",children:"Add Nodes"}),(0,k.jsxs)(se,{onClick:()=>ct("topic"),icon:x.A,className:"w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md text-sm flex items-center gap-2",children:[(0,k.jsx)(x.A,{size:16}),"Add Topic"]}),(0,k.jsxs)(se,{onClick:()=>ct("case"),icon:g.A,className:"w-full bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-md text-sm flex items-center gap-2",children:[(0,k.jsx)(g.A,{size:16}),"Add Case"]}),(0,k.jsxs)(se,{onClick:()=>ct("task"),icon:b.A,className:"w-full bg-amber-600 hover:bg-amber-700 text-white px-4 py-2 rounded-md text-sm flex items-center gap-2",children:[(0,k.jsx)(b.A,{size:16}),"Add Task"]}),(0,k.jsxs)(se,{onClick:()=>ct("literature"),icon:y.A,className:"w-full bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-md text-sm flex items-center gap-2",children:[(0,k.jsx)(y.A,{size:16}),"Add Literature"]})]}),(0,k.jsx)(se,{onClick:nt,icon:w.A,className:"w-full bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-md text-sm",children:"Clear All Data"})]}),q&&(0,k.jsxs)("div",{className:"mt-auto p-4 bg-slate-700 bg-opacity-50 rounded-lg",children:[(0,k.jsx)("h3",{className:"text-sm font-semibold text-slate-300 mb-2",children:"Selected Node"}),(0,k.jsxs)("div",{className:"space-y-2",children:[(0,k.jsxs)("div",{className:"flex items-center gap-2",children:["topic"===q.type&&(0,k.jsx)(x.A,{size:14,className:"text-blue-400"}),"case"===q.type&&(0,k.jsx)(g.A,{size:14,className:"text-indigo-400"}),"task"===q.type&&(0,k.jsx)(b.A,{size:14,className:"text-amber-400"}),"literature"===q.type&&(0,k.jsx)(y.A,{size:14,className:"text-purple-400"}),(0,k.jsx)("span",{className:"text-sm text-white font-medium truncate",children:q.data.label})]}),q.data.category&&(0,k.jsxs)("div",{className:"text-xs text-slate-400",children:["Category: ",q.data.category]}),q.data.status&&(0,k.jsxs)("div",{className:"text-xs text-slate-400",children:["Status: ",q.data.status]}),(0,k.jsxs)("button",{onClick:()=>{const[e,t]=q.id.split("-"),a=L["literature"===e?"literature":`${e}s`].find(e=>String(e.id)===t);a&&("case"===e?ge({isOpen:!0,data:a}):"topic"===e?ye({isOpen:!0,data:a}):"task"===e?fe({isOpen:!0,data:a}):"literature"===e&&Ve(a))},className:"w-full mt-2 px-3 py-2 bg-slate-600 hover:bg-slate-500 text-white text-xs rounded-lg transition-colors flex items-center gap-2",children:[(0,k.jsx)(N.A,{size:12}),"View Details"]})]})]}),!q&&(0,k.jsxs)("div",{className:"mt-auto p-3 bg-slate-700 bg-opacity-30 rounded-lg",children:[(0,k.jsx)("h4",{className:"text-xs font-semibold text-slate-300 mb-2",children:"Keyboard Shortcuts"}),(0,k.jsxs)("div",{className:"space-y-1 text-xs text-slate-400",children:[(0,k.jsx)("div",{children:"Ctrl+N - Add Node"}),(0,k.jsx)("div",{children:"Ctrl+E - Toggle Edit Mode"}),(0,k.jsx)("div",{children:"Ctrl+R - Realign Nodes"}),(0,k.jsx)("div",{children:"Esc - Clear Selection"})]})]})]}),(0,k.jsx)("div",{className:"flex-1 relative",children:(0,k.jsx)(ne,{children:(0,k.jsxs)(l.Gc,{nodes:S,edges:T,onNodesChange:dt,onEdgesChange:z,onConnect:Qe,onNodeClick:Ze,onNodeDoubleClick:et,onNodeDragStop:ut,onEdgeDoubleClick:tt,onEdgeContextMenu:at,onEdgeMouseEnter:it,onEdgeMouseLeave:rt,nodeTypes:W,edgeTypes:{floating:X,enhanced:F},connectionLineComponent:R,nodesDraggable:!0,nodesConnectable:!0,elementsSelectable:!0,onInit:e=>{Ce(!0),window.reactFlowInstance=e},onError:(e,t)=>{console.warn("React Flow Error:",e,t),!He||t.includes("dimensions")},fitView:!0,snapToGrid:!1,snapGrid:[15,15],elevateEdgesOnSelect:!1,connectionLineComponent:R,connectionLineStyle:{stroke:"#3b82f6",strokeWidth:3.5,opacity:.9,strokeLinecap:"round",strokeDasharray:"5,3",filter:"drop-shadow(0 0 6px rgba(59, 130, 246, 0.6))",animation:"flowingDash 1s linear infinite"},defaultEdgeOptions:{type:"enhanced",style:{strokeWidth:2.5,stroke:"#64748b",opacity:.9,strokeLinecap:"round",transition:"none"}},className:"bg-gradient-to-br from-blue-50 to-indigo-100",children:[(0,k.jsx)(l.VS,{color:"#aaa",gap:16}),(0,k.jsx)(l.H2,{}),(0,k.jsx)(l.of,{})]})})}),Le.isOpen&&(0,k.jsx)(D,{isOpen:Le.isOpen,onClose:()=>{Fe(!0),Xe({isOpen:!1,data:null}),setTimeout(()=>Fe(!1),500)},onAnimationStart:()=>Fe(!0),onAnimationEnd:()=>Fe(!1),literatureData:Le.data,allNodes:S,connections:L.connections||[],setMindMapData:H,autoSaveMindMapData:qe,addToast:Be}),(0,k.jsx)(o.N,{mode:"wait",children:xe.isOpen&&(0,k.jsx)(E.default,{isOpen:xe.isOpen,data:je.current||xe.data,onClose:()=>{Ye(e=>({...e,case:!0})),ge({isOpen:!1,data:null})},onAnimationStart:()=>{Fe(!0),Ye(e=>({...e,case:!0}))},onAnimationEnd:()=>{Fe(!1),Ye(e=>({...e,case:!1}))},setMindMapData:H,autoSaveMindMapData:qe,addToast:Be},`case-modal-${(null===(i=xe.data)||void 0===i?void 0:i.id)||"default"}`)}),(0,k.jsx)(o.N,{mode:"wait",children:be.isOpen&&(0,k.jsx)($.default,{isOpen:be.isOpen,data:we.current||be.data,onClose:()=>{Ye(e=>({...e,topic:!0})),ye({isOpen:!1,data:null})},onAnimationStart:()=>{Fe(!0),Ye(e=>({...e,topic:!0}))},onAnimationEnd:()=>{Fe(!1),Ye(e=>({...e,topic:!1}))},setMindMapData:H,autoSaveMindMapData:qe,addToast:Be,syncNodeData:We,forceNodeUpdate:()=>M(e=>e+1)},`topic-modal-${(null===(c=be.data)||void 0===c?void 0:c.id)||"default"}`)}),(0,k.jsx)(o.N,{mode:"wait",children:ve.isOpen&&(0,k.jsx)(I.default,{isOpen:ve.isOpen,data:Ne.current||ve.data,onClose:()=>{Ye(e=>({...e,task:!0})),fe({isOpen:!1,data:null})},onAnimationStart:()=>{Fe(!0),Ye(e=>({...e,task:!0}))},onAnimationEnd:()=>{Fe(!1),Ye(e=>({...e,task:!1}))},setMindMapData:H,autoSaveMindMapData:qe,addToast:Be},`task-modal-${(null===(d=ve.data)||void 0===d?void 0:d.id)||"default"}`)}),(0,k.jsx)(oe,{isOpen:Ee.isOpen,edge:Ee.edge,onClose:()=>$e({isOpen:!1,edge:null}),onSave:st}),V&&(0,k.jsx)("div",{className:"absolute inset-0 bg-white bg-opacity-80 flex items-center justify-center z-50",children:(0,k.jsx)(p.A,{size:48,className:"animate-spin text-blue-600"})}),Ie.map(e=>(0,k.jsx)(ae,{message:e.message,type:e.type,duration:e.duration,onClose:()=>Ue(e.id)},e.id))]})};class ne extends s.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(e){return e.message&&e.message.includes("dimensions")?(console.warn("React Flow dimension error caught, recovering..."),{hasError:!1}):{hasError:!0}}componentDidCatch(e,t){e.message&&e.message.includes("dimensions")?setTimeout(()=>{window.reactFlowInstance&&window.reactFlowInstance.fitView()},100):console.error("React Flow Error:",e,t)}render(){return this.state.hasError?(0,k.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,k.jsxs)("div",{className:"text-center",children:[(0,k.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Mind Map Temporarily Unavailable"}),(0,k.jsx)("p",{className:"text-gray-600 mb-4",children:"There was an issue with the mind map. Please refresh the page."}),(0,k.jsx)("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Refresh Page"})]})}):this.props.children}}const ce=()=>(0,k.jsx)(l.Ln,{children:(0,k.jsx)(le,{})});const de=function(){return(0,k.jsx)(ce,{})};i.createRoot(document.getElementById("root")).render((0,k.jsx)(s.StrictMode,{children:(0,k.jsx)(de,{})}))},7173:(e,t,a)=>{a.r(t),a.d(t,{default:()=>S});var s=a(5043),i=a(3546),r=a(6446),o=a(2024),l=a(4596),n=a(4537),c=a(2626),d=a(6382),u=a(2382),p=a(8326),m=a(1680),h=a(8487),x=a(6835),g=a(1360),b=a(8693),y=a(4935),v=a(7118),f=a(614),j=a(579);const w={hidden:{opacity:0,scale:.3,y:50,rotate:-5},visible:{opacity:1,scale:1,y:0,rotate:0,transition:{type:"spring",damping:25,stiffness:300,duration:.6}},exit:{opacity:0,scale:.7,y:30,rotate:-3,transition:{type:"easeInOut",duration:.4}}},N={hidden:{opacity:0,backdropFilter:"blur(0px)"},visible:{opacity:1,backdropFilter:"blur(8px)",transition:{duration:.4,ease:"easeOut"}},exit:{opacity:0,backdropFilter:"blur(0px)",transition:{duration:.3,ease:"easeIn"}}},k={hidden:{opacity:0,y:20,scale:.95},visible:{opacity:1,y:0,scale:1,transition:{type:"easeOut",duration:.3,delay:.1}},exit:{opacity:0,y:-10,scale:1.02,transition:{type:"easeIn",duration:.2}}},C={hidden:{opacity:0,y:20,scale:.95},visible:{opacity:1,y:0,scale:1,transition:{duration:.4,ease:"easeOut"}},edit:{scale:1.02,boxShadow:"0 8px 25px rgba(59, 130, 246, 0.15)",transition:{duration:.3,ease:"easeOut"}},saved:{scale:1,boxShadow:"0 4px 15px rgba(34, 197, 94, 0.15)",transition:{duration:.3,ease:"easeOut"}}},S=e=>{var t,a,S,_;let{isOpen:A,data:T,onClose:P,onAnimationStart:z,onAnimationEnd:O,setMindMapData:D,autoSaveMindMapData:E,addToast:$,syncNodeData:I,forceNodeUpdate:M}=e;const[L,X]=(0,s.useState)(!1),[H,F]=(0,s.useState)(!1),[R,Y]=(0,s.useState)(!1),[B,U]=(0,s.useState)({}),[q,J]=(0,s.useState)(!1),[V,W]=(0,s.useState)(!1),[K,G]=(0,s.useState)("overview"),[Q,Z]=(0,s.useState)(!1),[ee,te]=(0,s.useState)({}),[ae,se]=(0,s.useState)({}),[ie,re]=(0,s.useState)({}),oe=(0,s.useRef)({}),[le,ne]=(0,s.useState)(!1),[ce,de]=(0,s.useState)({}),[ue,pe]=(0,s.useState)(""),[me,he]=(0,s.useState)(!1),xe={"Mood Disorders":{primary:"#ef4444",secondary:"#fca5a5"},"Anxiety Disorders":{primary:"#f59e0b",secondary:"#fbbf24"},"Psychotic Disorders":{primary:"#8b5cf6",secondary:"#c4b5fd"},"Personality Disorders":{primary:"#10b981",secondary:"#6ee7b7"},"Neurodevelopmental Disorders":{primary:"#3b82f6",secondary:"#93c5fd"},"Trauma Related Disorders":{primary:"#dc2626",secondary:"#f87171"},"Substance Use Disorders":{primary:"#059669",secondary:"#34d399"},"Eating Disorders":{primary:"#d946ef",secondary:"#e879f9"},"Sleep Disorders":{primary:"#6366f1",secondary:"#a5b4fc"},"Cognitive Disorders":{primary:"#ea580c",secondary:"#fb923c"},Other:{primary:"#6b7280",secondary:"#9ca3af"}},ge=[{id:"overview",label:"Overview",icon:c.A},{id:"concept",label:"Concept",icon:d.A},{id:"clinical",label:"Clinical Associations",icon:y.A},{id:"treatment",label:"Treatment",icon:x.A},{id:"connections",label:"Connections",icon:h.A}];(0,s.useEffect)(()=>{if(A&&T&&!V){F(!0);const e={...T,category:T.category||"Other",definition:T.definition||"",diagnostic_criteria:T.diagnostic_criteria||[],comorbidities:T.comorbidities||[],differential_diagnoses:T.differential_diagnoses||[],medications:T.medications||[],psychotherapy_modalities:T.psychotherapy_modalities||[],flashcard_count:T.flashcard_count||0,completed_flashcards:T.completed_flashcards||0,last_updated:T.last_updated||(new Date).toISOString()};U(e),W(!0),X(!0),z&&z(),setTimeout(()=>{X(!1),O&&O()},600)}else!A&&V&&(W(!1),re({}),te({}),se({}))},[A,T,V,z,O]),(0,s.useEffect)(()=>{A&&T&&V&&U(e=>({...e,...T,category:T.category||e.category||"Other",definition:T.definition||e.definition||"",diagnostic_criteria:T.diagnostic_criteria||e.diagnostic_criteria||[],comorbidities:T.comorbidities||e.comorbidities||[],differential_diagnoses:T.differential_diagnoses||e.differential_diagnoses||[],medications:T.medications||e.medications||[],psychotherapy_modalities:T.psychotherapy_modalities||e.psychotherapy_modalities||[],flashcard_count:T.flashcard_count||e.flashcard_count||0,completed_flashcards:T.completed_flashcards||e.completed_flashcards||0,last_updated:T.last_updated||e.last_updated||(new Date).toISOString()}))},[T,A,V]);const be=(0,s.useMemo)(()=>{const e=B.flashcard_count||0,t=B.completed_flashcards||0;return e>0?Math.round(t/e*100):0},[B.flashcard_count,B.completed_flashcards]),ye=(0,s.useCallback)(()=>{L||R||(X(!0),Y(!0),z&&z(),F(!1))},[z,L,R]),ve=((0,s.useCallback)(async()=>{if(!q){J(!0);try{const e={...B,last_updated:(new Date).toISOString()};D(t=>{const a=t.topics.map(t=>String(t.id)===String(null===T||void 0===T?void 0:T.id)?{...t,...e}:t),s={...t,topics:a};return E(s),s}),U(e),$("Topic updated successfully","success")}catch(e){console.error("Error saving topic:",e),$("Failed to save topic","error")}finally{J(!1)}}},[null===T||void 0===T?void 0:T.id,B,D,E,$,q]),(0,s.useCallback)(e=>{const t=oe.current[e];t&&re(a=>({...a,[e]:t.scrollTop}))},[])),fe=(0,s.useCallback)(e=>{setTimeout(()=>{const t=oe.current[e],a=ie[e];t&&a&&(t.scrollTop=a)},100)},[ie]),je=(0,s.useCallback)(e=>{e===K||Q||(ve(K),Z(!0),G(e),setTimeout(()=>{Z(!1),fe(e)},300))},[K,Q,ve,fe]),we=(0,s.useCallback)(async e=>{var t;console.log("Category changing to:",e);const a=(null===(t=xe[e])||void 0===t?void 0:t.primary)||xe.Other.primary;console.log("New color for category:",a);const s={...B,category:e,color:a,last_updated:(new Date).toISOString()};U(s),D(t=>{const s=t.topics.map(t=>String(t.id)===String(null===T||void 0===T?void 0:T.id)?{...t,category:e,color:a,last_updated:(new Date).toISOString()}:t),i={...t,topics:s};return console.log("Saving category change to backend:",e,a),E(i),setTimeout(()=>{console.log("Triggering force node update"),M&&M(),I&&I()},200),i}),$(`Category updated to ${e}`,"success")},[null===T||void 0===T?void 0:T.id,B,D,xe,E,$,I,M]),Ne=((0,s.useMemo)(()=>(null!==T&&void 0!==T&&T.id,{cases:[],literature:[]}),[null===T||void 0===T?void 0:T.id]),(0,s.useCallback)(async()=>{if(!q&&window.confirm("Are you sure you want to delete this topic?")){J(!0);try{D(e=>{const t=e.topics.filter(e=>String(e.id)!==String(null===T||void 0===T?void 0:T.id)),a={...e,topics:t};return E(a),a}),$("Topic deleted successfully","success"),ye()}catch(e){console.error("Error deleting topic:",e),$("Failed to delete topic","error")}finally{J(!1)}}},[null===T||void 0===T?void 0:T.id,D,E,$,ye,q]),(0,s.useCallback)(e=>{te(t=>({...t,[e]:!0})),se(t=>({...t,[e]:{...B}}))},[B])),ke=(0,s.useCallback)(e=>{te(t=>({...t,[e]:!1})),se(t=>{const a={...t};return delete a[e],a})},[]),Ce=(0,s.useCallback)(async e=>{if(q)return;const t=ae[e];if(t){J(!0);try{const a={...B,...t,last_updated:(new Date).toISOString()};U(a),D(e=>{const t=e.topics.map(e=>String(e.id)===String(null===T||void 0===T?void 0:T.id)?{...e,...a}:e),s={...e,topics:t};return E(s),s}),te(t=>({...t,[e]:!1})),se(t=>{const a={...t};return delete a[e],a}),$("Section updated successfully","success")}catch(a){console.error("Error saving section:",a),$("Failed to save section","error")}finally{J(!1)}}},[ae,B,null===T||void 0===T?void 0:T.id,D,E,$,q]),Se=(0,s.useCallback)((e,t,a)=>{se(s=>({...s,[e]:{...s[e],[t]:a}}))},[]),_e=((0,s.useCallback)((e,t,a)=>{var s;if(!a.trim())return;const i=(null===(s=ae[e])||void 0===s?void 0:s[t])||B[t]||[];i.includes(a.trim())||Se(e,t,[...i,a.trim()])},[ae,B,Se]),(0,s.useCallback)((e,t,a)=>{var s;const i=(null===(s=ae[e])||void 0===s?void 0:s[t])||B[t]||[];Se(e,t,i.filter(e=>e!==a))},[ae,B,Se]),(0,s.useCallback)((e,t)=>{de(a=>({...a,[e]:t}))},[])),Ae=(0,s.useCallback)(e=>ce[e]||"",[ce]),Te=(0,s.useCallback)(e=>{de(t=>{const a={...t};return delete a[e],a})},[]),Pe=(0,s.useCallback)((e,t)=>{if(!t.trim())return;const a=B[e]||[];if(!a.includes(t.trim())){const s=[...a,t.trim()],i={...B,[e]:s,last_updated:(new Date).toISOString()};U(i),D(e=>{const t=e.topics.map(e=>String(e.id)===String(null===T||void 0===T?void 0:T.id)?{...e,...i}:e),a={...e,topics:t};return E(a),a}),$(`${e} updated successfully`,"success")}},[B,null===T||void 0===T?void 0:T.id,D,E,$]),ze=(0,s.useCallback)((e,t)=>{const a=(B[e]||[]).filter(e=>e!==t),s={...B,[e]:a,last_updated:(new Date).toISOString()};U(s),D(e=>{const t=e.topics.map(e=>String(e.id)===String(null===T||void 0===T?void 0:T.id)?{...e,...s}:e),a={...e,topics:t};return E(a),a}),$(`${e} updated successfully`,"success")},[B,null===T||void 0===T?void 0:T.id,D,E,$]);return A?(0,j.jsx)(i.N,{mode:"wait",onExitComplete:()=>{X(!1),Y(!1),W(!1),P(),O&&O()},children:H&&(0,j.jsx)(r.P.div,{initial:"hidden",animate:"visible",exit:"exit",variants:N,className:"fixed inset-0 bg-black flex items-center justify-center z-50",style:{willChange:"backdrop-filter, opacity",backfaceVisibility:"hidden",transform:"translate3d(0, 0, 0)"},onClick:e=>e.target===e.currentTarget&&ye(),children:(0,j.jsxs)(r.P.div,{initial:"hidden",animate:"visible",exit:"exit",variants:w,className:"bg-white rounded-2xl shadow-2xl max-w-4xl w-full mx-4 max-h-[85vh] overflow-hidden",style:{willChange:"transform, opacity, scale",backfaceVisibility:"hidden"},onClick:e=>e.stopPropagation(),onAnimationStart:()=>{X(!0),z&&z()},onAnimationComplete:()=>{X(!1),O&&O()},children:[(0,j.jsxs)(r.P.div,{initial:"hidden",animate:"visible",exit:"exit",variants:k,className:"bg-gradient-to-br from-slate-900 to-slate-800 text-white px-6 py-4 flex items-center justify-between",children:[(0,j.jsxs)("div",{className:"flex items-center gap-3",children:[(0,j.jsx)(c.A,{size:24}),(0,j.jsx)("h2",{className:"text-xl font-semibold",children:"Topic Details"})]}),(0,j.jsx)("button",{onClick:ye,className:"text-slate-400 hover:text-white transition-colors",children:(0,j.jsx)(f.A,{size:24})})]}),(0,j.jsx)("div",{className:"bg-gradient-to-r from-slate-900 via-slate-800 to-slate-900 border-b border-slate-600",children:(0,j.jsx)("nav",{className:"flex flex-wrap gap-2 px-6 py-4",children:ge.map(e=>{let{id:t,label:a,icon:s}=e;return(0,j.jsxs)(r.P.button,{onClick:()=>je(t),className:"relative flex items-center gap-2 px-4 py-3 rounded-xl font-medium text-sm transition-all duration-300 "+(K===t?"bg-gradient-to-r from-purple-500 to-indigo-600 text-white shadow-lg shadow-purple-500/25":"text-slate-300 hover:text-white hover:bg-slate-700/50 hover:shadow-md"),whileHover:{scale:K===t?1:1.02},whileTap:{scale:.98},disabled:Q,children:[(0,j.jsx)(s,{size:16,className:K===t?"drop-shadow-sm":""}),a,K===t&&(0,j.jsx)(r.P.div,{layoutId:"topicActiveTab",className:"absolute inset-0 bg-gradient-to-r from-purple-400/20 to-indigo-500/20 rounded-xl blur-sm",initial:!1,transition:{duration:.3,ease:"easeOut"}})]},t)})})}),(0,j.jsx)(r.P.div,{className:"flex-1 bg-gradient-to-br from-slate-900 to-slate-800 overflow-hidden",animate:{opacity:Q?.7:1},transition:{duration:.2},children:(0,j.jsxs)(i.N,{mode:"wait",children:["overview"===K&&(0,j.jsxs)(r.P.div,{ref:e=>oe.current.overview=e,initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{duration:.3},className:"h-full overflow-y-auto p-6 space-y-6",children:[(0,j.jsxs)(r.P.div,{variants:C,animate:ee.title?"edit":"visible",className:"bg-slate-800/50 backdrop-blur-sm rounded-xl p-6 border border-slate-700",children:[(0,j.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,j.jsx)("h3",{className:"text-lg font-semibold text-white",children:"Title"}),!ee.title&&(0,j.jsx)(r.P.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:()=>Ne("title"),className:"text-slate-400 hover:text-white transition-colors p-1 rounded",title:"Edit title",children:(0,j.jsx)(l.A,{size:16})})]}),ee.title?(0,j.jsxs)(r.P.div,{className:"space-y-4",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},children:[(0,j.jsx)("input",{type:"text",value:(null===(t=ae.title)||void 0===t?void 0:t.title)||B.title||"",onChange:e=>Se("title","title",e.target.value),className:"w-full text-xl font-bold bg-slate-700 border border-slate-600 rounded-lg px-4 py-3 text-white placeholder-slate-400 focus:ring-2 focus:ring-purple-500 focus:border-purple-500",placeholder:"Topic title..."}),(0,j.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,j.jsx)(r.P.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>ke("title"),className:"px-3 py-2 text-slate-300 hover:text-white border border-slate-600 rounded-lg hover:bg-slate-700 transition-colors text-sm",children:"Cancel"}),(0,j.jsxs)(r.P.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>Ce("title"),disabled:q,className:"px-3 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors text-sm flex items-center gap-2",children:[q?(0,j.jsx)(o.A,{size:14,className:"animate-spin"}):(0,j.jsx)(b.A,{size:14}),"Save"]})]})]}):(0,j.jsx)(r.P.h1,{className:"text-2xl font-bold text-white",whileHover:{scale:1.01},transition:{duration:.2},children:B.title||"Untitled Topic"})]}),(0,j.jsxs)("div",{className:"grid md:grid-cols-2 gap-6",children:[(0,j.jsxs)(r.P.div,{variants:C,initial:"hidden",animate:"visible",className:"bg-slate-800/50 backdrop-blur-sm rounded-xl p-6 border border-slate-700",children:[(0,j.jsx)("label",{className:"block text-sm font-medium text-slate-300 mb-3",children:"Category"}),(0,j.jsx)(r.P.select,{value:B.category||"Other",onChange:e=>we(e.target.value),className:"w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-3 text-white focus:ring-2 focus:ring-purple-500 focus:border-purple-500 hover:bg-slate-650 transition-colors cursor-pointer",whileFocus:{scale:1.02},children:Object.keys(xe).map(e=>(0,j.jsx)("option",{value:e,children:e},e))}),(0,j.jsx)("p",{className:"text-xs text-slate-400 mt-2",children:"Changes are saved automatically and will update the node color"})]}),(0,j.jsxs)(r.P.div,{variants:C,initial:"hidden",animate:"visible",className:"bg-slate-800/50 backdrop-blur-sm rounded-xl p-6 border border-slate-700",children:[(0,j.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,j.jsx)("span",{className:"text-sm font-medium text-slate-300",children:"Flashcard Progress"}),(0,j.jsxs)("span",{className:"text-sm text-slate-400",children:[B.completed_flashcards||0," / ",B.flashcard_count||0]})]}),(0,j.jsx)("div",{className:"w-full bg-slate-700 rounded-full h-3 mb-2",children:(0,j.jsx)(r.P.div,{className:"h-3 rounded-full bg-gradient-to-r from-purple-500 to-indigo-600",initial:{width:0},animate:{width:`${be}%`},transition:{duration:1,ease:"easeOut"}})}),(0,j.jsxs)("div",{className:"text-right",children:[(0,j.jsxs)("span",{className:"text-lg font-bold text-white",children:[be,"%"]}),(0,j.jsx)("span",{className:"text-sm text-slate-400 ml-1",children:"complete"})]})]})]}),(0,j.jsxs)("div",{className:"text-xs text-slate-500 text-right",children:["Last updated: ",B.last_updated?new Date(B.last_updated).toLocaleString():"Never"]})]},"overview"),"concept"===K&&(0,j.jsxs)(r.P.div,{ref:e=>oe.current.concept=e,initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{duration:.3},className:"h-full overflow-y-auto p-6 space-y-6",children:[(0,j.jsxs)(r.P.div,{variants:C,animate:ee.definition?"edit":"visible",className:"bg-slate-800/50 backdrop-blur-sm rounded-xl p-6 border border-slate-700",children:[(0,j.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,j.jsxs)("h3",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[(0,j.jsx)(d.A,{size:20,className:"text-purple-400"}),"Definition"]}),!ee.definition&&(0,j.jsx)(r.P.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:()=>Ne("definition"),className:"text-slate-400 hover:text-white transition-colors p-1 rounded",title:"Edit definition",children:(0,j.jsx)(l.A,{size:16})})]}),ee.definition?(0,j.jsxs)(r.P.div,{className:"space-y-4",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},children:[(0,j.jsx)("textarea",{value:(null===(a=ae.definition)||void 0===a?void 0:a.definition)||B.definition||"",onChange:e=>Se("definition","definition",e.target.value),rows:4,className:"w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-3 text-white placeholder-slate-400 focus:ring-2 focus:ring-purple-500 focus:border-purple-500 resize-none",placeholder:"Enter the definition of this topic..."}),(0,j.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,j.jsx)(r.P.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>ke("definition"),className:"px-3 py-2 text-slate-300 hover:text-white border border-slate-600 rounded-lg hover:bg-slate-700 transition-colors text-sm",children:"Cancel"}),(0,j.jsxs)(r.P.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>Ce("definition"),disabled:q,className:"px-3 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors text-sm flex items-center gap-2",children:[q?(0,j.jsx)(o.A,{size:14,className:"animate-spin"}):(0,j.jsx)(b.A,{size:14}),"Save"]})]})]}):(0,j.jsx)(r.P.div,{className:"text-slate-300 leading-relaxed",whileHover:{scale:1.01},transition:{duration:.2},children:B.definition||(0,j.jsx)("span",{className:"text-slate-500 italic",children:"No definition provided"})})]}),(0,j.jsxs)(r.P.div,{variants:C,animate:ee.diagnostic_criteria?"edit":"visible",className:"bg-slate-800/50 backdrop-blur-sm rounded-xl p-6 border border-slate-700",children:[(0,j.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,j.jsxs)("h3",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[(0,j.jsx)(m.A,{size:20,className:"text-indigo-400"}),"Diagnostic Criteria"]}),(0,j.jsxs)("div",{className:"flex items-center gap-2",children:[!ee.diagnostic_criteria&&(0,j.jsx)(r.P.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:()=>Ne("diagnostic_criteria"),className:"text-slate-400 hover:text-white transition-colors p-1 rounded",title:"Edit diagnostic criteria",children:(0,j.jsx)(l.A,{size:16})}),(0,j.jsx)("button",{onClick:()=>ne(!le),className:"text-slate-400 hover:text-white transition-colors",children:le?(0,j.jsx)(u.A,{size:20}):(0,j.jsx)(p.A,{size:20})})]})]}),(0,j.jsx)(i.N,{children:le&&(0,j.jsx)(r.P.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3},className:"overflow-hidden",children:ee.diagnostic_criteria?(0,j.jsxs)("div",{className:"space-y-4",children:[(0,j.jsx)("textarea",{value:Array.isArray(null===(S=ae.diagnostic_criteria)||void 0===S?void 0:S.diagnostic_criteria)?ae.diagnostic_criteria.diagnostic_criteria.join("\n"):Array.isArray(B.diagnostic_criteria)?B.diagnostic_criteria.join("\n"):B.diagnostic_criteria||"",onChange:e=>Se("diagnostic_criteria","diagnostic_criteria",e.target.value.split("\n").filter(e=>e.trim())),rows:6,className:"w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-3 text-white placeholder-slate-400 focus:ring-2 focus:ring-purple-500 focus:border-purple-500 resize-none",placeholder:"Enter diagnostic criteria (one per line)..."}),(0,j.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,j.jsx)("button",{onClick:()=>ke("diagnostic_criteria"),className:"px-3 py-2 text-slate-300 hover:text-white border border-slate-600 rounded-lg hover:bg-slate-700 transition-colors text-sm",children:"Cancel"}),(0,j.jsxs)(r.P.button,{onClick:()=>Ce("diagnostic_criteria"),disabled:q,className:"px-3 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors text-sm flex items-center gap-2",children:[q?(0,j.jsx)(o.A,{size:14,className:"animate-spin"}):(0,j.jsx)(b.A,{size:14}),"Save"]})]})]}):(0,j.jsx)("div",{className:"space-y-2",children:(B.diagnostic_criteria||[]).length>0?B.diagnostic_criteria.map((e,t)=>(0,j.jsxs)("div",{className:"flex items-start gap-3",children:[(0,j.jsxs)("span",{className:"text-purple-400 font-medium",children:[t+1,"."]}),(0,j.jsx)("span",{className:"text-slate-300",children:e})]},t)):(0,j.jsx)("span",{className:"text-slate-500 italic",children:"No diagnostic criteria provided"})})})})]})]},"concept"),"clinical"===K&&(0,j.jsxs)(r.P.div,{ref:e=>oe.current.clinical=e,initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{duration:.3},className:"h-full overflow-y-auto p-6 space-y-6",children:[(0,j.jsxs)(r.P.div,{variants:C,initial:"hidden",animate:"visible",className:"bg-slate-800/50 backdrop-blur-sm rounded-xl p-6 border border-slate-700",children:[(0,j.jsxs)("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[(0,j.jsx)(v.A,{size:20,className:"text-amber-400"}),"Comorbidities"]}),(0,j.jsx)("div",{className:"space-y-2 mb-4",children:(0,j.jsx)(i.N,{children:(B.comorbidities||[]).map((e,t)=>(0,j.jsxs)(r.P.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},className:"flex items-center justify-between p-3 bg-amber-600/10 rounded-lg border border-amber-600/20 group hover:bg-amber-600/15 transition-colors",children:[(0,j.jsx)("span",{className:"text-amber-300",children:e}),(0,j.jsx)(r.P.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:()=>ze("comorbidities",e),className:"text-amber-400 hover:text-amber-200 opacity-0 group-hover:opacity-100 transition-opacity p-1 rounded",title:"Remove comorbidity",children:(0,j.jsx)(f.A,{size:16})})]},t))})}),(0,j.jsxs)("div",{className:"flex gap-2",children:[(0,j.jsx)("input",{type:"text",value:Ae("comorbidities"),onChange:e=>_e("comorbidities",e.target.value),placeholder:"Add comorbidity...",className:"flex-1 bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-white placeholder-slate-400 focus:ring-2 focus:ring-amber-500 focus:border-amber-500 transition-colors",onKeyPress:e=>{"Enter"===e.key&&Ae("comorbidities").trim()&&(Pe("comorbidities",Ae("comorbidities")),Te("comorbidities"))}}),(0,j.jsxs)(r.P.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>{Ae("comorbidities").trim()&&(Pe("comorbidities",Ae("comorbidities")),Te("comorbidities"))},className:"px-4 py-2 bg-amber-600 text-white rounded-lg hover:bg-amber-700 transition-colors flex items-center gap-2",children:[(0,j.jsx)(g.A,{size:16}),"Add"]})]}),0===(B.comorbidities||[]).length&&(0,j.jsx)("p",{className:"text-slate-500 italic text-center py-4",children:"No comorbidities added yet"})]}),(0,j.jsxs)(r.P.div,{variants:C,initial:"hidden",animate:"visible",className:"bg-slate-800/50 backdrop-blur-sm rounded-xl p-6 border border-slate-700",children:[(0,j.jsxs)("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[(0,j.jsx)(n.A,{size:20,className:"text-cyan-400"}),"Differential Diagnoses"]}),(0,j.jsx)("div",{className:"space-y-2 mb-4",children:(0,j.jsx)(i.N,{children:(B.differential_diagnoses||[]).map((e,t)=>(0,j.jsxs)(r.P.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},className:"flex items-center justify-between p-3 bg-cyan-600/10 rounded-lg border border-cyan-600/20 group hover:bg-cyan-600/15 transition-colors",children:[(0,j.jsx)("span",{className:"text-cyan-300",children:e}),(0,j.jsx)(r.P.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:()=>ze("differential_diagnoses",e),className:"text-cyan-400 hover:text-cyan-200 opacity-0 group-hover:opacity-100 transition-opacity p-1 rounded",title:"Remove differential diagnosis",children:(0,j.jsx)(f.A,{size:16})})]},t))})}),(0,j.jsxs)("div",{className:"flex gap-2",children:[(0,j.jsx)("input",{type:"text",value:Ae("differential_diagnoses"),onChange:e=>_e("differential_diagnoses",e.target.value),placeholder:"Add differential diagnosis...",className:"flex-1 bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-white placeholder-slate-400 focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500 transition-colors",onKeyPress:e=>{"Enter"===e.key&&Ae("differential_diagnoses").trim()&&(Pe("differential_diagnoses",Ae("differential_diagnoses")),Te("differential_diagnoses"))}}),(0,j.jsxs)(r.P.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>{Ae("differential_diagnoses").trim()&&(Pe("differential_diagnoses",Ae("differential_diagnoses")),Te("differential_diagnoses"))},className:"px-4 py-2 bg-cyan-600 text-white rounded-lg hover:bg-cyan-700 transition-colors flex items-center gap-2",children:[(0,j.jsx)(g.A,{size:16}),"Add"]})]}),0===(B.differential_diagnoses||[]).length&&(0,j.jsx)("p",{className:"text-slate-500 italic text-center py-4",children:"No differential diagnoses added yet"})]})]},"clinical"),"treatment"===K&&(0,j.jsxs)(r.P.div,{ref:e=>oe.current.treatment=e,initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{duration:.3},className:"h-full overflow-y-auto p-6 space-y-6",children:[(0,j.jsxs)(r.P.div,{variants:C,initial:"hidden",animate:"visible",className:"bg-slate-800/50 backdrop-blur-sm rounded-xl p-6 border border-slate-700",children:[(0,j.jsxs)("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[(0,j.jsx)(x.A,{size:20,className:"text-green-400"}),"Medications"]}),(0,j.jsx)("div",{className:"space-y-2 mb-4",children:(0,j.jsx)(i.N,{children:(B.medications||[]).map((e,t)=>(0,j.jsxs)(r.P.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},className:"flex items-center justify-between p-3 bg-green-600/10 rounded-lg border border-green-600/20 group hover:bg-green-600/15 transition-colors",children:[(0,j.jsx)("span",{className:"text-green-300",children:e}),(0,j.jsx)(r.P.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:()=>ze("medications",e),className:"text-green-400 hover:text-green-200 opacity-0 group-hover:opacity-100 transition-opacity p-1 rounded",title:"Remove medication",children:(0,j.jsx)(f.A,{size:16})})]},t))})}),(0,j.jsxs)("div",{className:"flex gap-2",children:[(0,j.jsx)("input",{type:"text",value:Ae("medications"),onChange:e=>_e("medications",e.target.value),placeholder:"Add medication...",className:"flex-1 bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-white placeholder-slate-400 focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-colors",onKeyPress:e=>{"Enter"===e.key&&Ae("medications").trim()&&(Pe("medications",Ae("medications")),Te("medications"))}}),(0,j.jsxs)(r.P.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>{Ae("medications").trim()&&(Pe("medications",Ae("medications")),Te("medications"))},className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center gap-2",children:[(0,j.jsx)(g.A,{size:16}),"Add"]})]}),0===(B.medications||[]).length&&(0,j.jsx)("p",{className:"text-slate-500 italic text-center py-4",children:"No medications added yet"})]}),(0,j.jsxs)(r.P.div,{variants:C,animate:ee.psychotherapy_modalities?"edit":"visible",className:"bg-slate-800/50 backdrop-blur-sm rounded-xl p-6 border border-slate-700",children:[(0,j.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,j.jsxs)("h3",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[(0,j.jsx)(d.A,{size:20,className:"text-purple-400"}),"Psychotherapy Modalities"]}),!ee.psychotherapy_modalities&&(0,j.jsx)(r.P.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:()=>Ne("psychotherapy_modalities"),className:"text-slate-400 hover:text-white transition-colors p-1 rounded",title:"Edit psychotherapy modalities",children:(0,j.jsx)(l.A,{size:16})})]}),ee.psychotherapy_modalities?(0,j.jsxs)("div",{className:"space-y-4",children:[(0,j.jsx)("textarea",{value:Array.isArray(null===(_=ae.psychotherapy_modalities)||void 0===_?void 0:_.psychotherapy_modalities)?ae.psychotherapy_modalities.psychotherapy_modalities.join("\n"):Array.isArray(B.psychotherapy_modalities)?B.psychotherapy_modalities.join("\n"):B.psychotherapy_modalities||"",onChange:e=>Se("psychotherapy_modalities","psychotherapy_modalities",e.target.value.split("\n").filter(e=>e.trim())),rows:4,className:"w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-3 text-white placeholder-slate-400 focus:ring-2 focus:ring-purple-500 focus:border-purple-500 resize-none",placeholder:"Enter psychotherapy modalities (one per line)..."}),(0,j.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,j.jsx)("button",{onClick:()=>ke("psychotherapy_modalities"),className:"px-3 py-2 text-slate-300 hover:text-white border border-slate-600 rounded-lg hover:bg-slate-700 transition-colors text-sm",children:"Cancel"}),(0,j.jsxs)(r.P.button,{onClick:()=>Ce("psychotherapy_modalities"),disabled:q,className:"px-3 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors text-sm flex items-center gap-2",children:[q?(0,j.jsx)(o.A,{size:14,className:"animate-spin"}):(0,j.jsx)(b.A,{size:14}),"Save"]})]})]}):(0,j.jsx)("div",{className:"space-y-2",children:(B.psychotherapy_modalities||[]).length>0?B.psychotherapy_modalities.map((e,t)=>(0,j.jsxs)("div",{className:"flex items-center gap-3",children:[(0,j.jsx)("span",{className:"text-purple-400 font-medium",children:"\u2022"}),(0,j.jsx)("span",{className:"text-slate-300",children:e})]},t)):(0,j.jsx)("span",{className:"text-slate-500 italic",children:"No psychotherapy modalities added"})})]})]},"treatment"),"connections"===K&&(0,j.jsx)(r.P.div,{ref:e=>oe.current.connections=e,initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{duration:.3},className:"h-full overflow-y-auto p-6 space-y-6",children:(0,j.jsxs)(r.P.div,{variants:C,initial:"hidden",animate:"visible",className:"bg-slate-800/50 backdrop-blur-sm rounded-xl p-6 border border-slate-700",children:[(0,j.jsxs)("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[(0,j.jsx)(h.A,{size:20,className:"text-blue-400"}),"Connected Nodes"]}),(0,j.jsx)("p",{className:"text-slate-400 text-center py-8",children:"This section will show nodes connected to this topic in the mind map."})]})},"connections")]})})]})},`topic-modal-${(null===T||void 0===T?void 0:T.id)||"default"}`)}):null}},8531:(e,t,a)=>{a.r(t),a.d(t,{default:()=>_});var s=a(5043),i=a(3546),r=a(6446),o=a(2024),l=a(4596),n=a(9917),c=a(7719),d=a(8646),u=a(5088),p=a(1680),m=a(1482),h=a(8487),x=a(9340),g=a(4830),b=a(8693),y=a(3165),v=a(9855),f=a(4919),j=a(614),w=a(579);const N={hidden:{opacity:0,scale:.3,y:50,rotate:-5},visible:{opacity:1,scale:1,y:0,rotate:0,transition:{type:"spring",damping:25,stiffness:300,duration:.6}},exit:{opacity:0,scale:.7,y:30,rotate:-3,transition:{type:"easeInOut",duration:.4}}},k={hidden:{opacity:0,backdropFilter:"blur(0px)"},visible:{opacity:1,backdropFilter:"blur(8px)",transition:{duration:.4,ease:"easeOut"}},exit:{opacity:0,backdropFilter:"blur(0px)",transition:{duration:.3,ease:"easeIn"}}},C={hidden:{opacity:0,y:20,scale:.95},visible:{opacity:1,y:0,scale:1,transition:{type:"easeOut",duration:.3,delay:.1}},exit:{opacity:0,y:-10,scale:1.02,transition:{type:"easeIn",duration:.2}}},S=e=>{var t;let{isOpen:a,data:S,onClose:_,onAnimationStart:A,onAnimationEnd:T,setMindMapData:P,autoSaveMindMapData:z,addToast:O}=e;const[D,E]=(0,s.useState)(!1),[$,I]=(0,s.useState)(!1),[M,L]=(0,s.useState)(!1),[X,H]=(0,s.useState)(!1),[F,R]=(0,s.useState)({}),[Y,B]=(0,s.useState)(!1),[U,q]=(0,s.useState)(!1),[J,V]=(0,s.useState)("overview"),[W,K]=(0,s.useState)(!1);(0,s.useEffect)(()=>{a&&S&&!U?(I(!0),R({...S,status:S.status||"pending",priority:S.priority||"medium"}),q(!0),E(!0),A&&A(),setTimeout(()=>{E(!1),T&&T()},600)):!a&&U&&q(!1)},[a,U,A,T]),(0,s.useEffect)(()=>{!(a&&S&&U)||X||Y||W||D||R({...S,status:S.status||"pending",priority:S.priority||"medium"})},[null===S||void 0===S?void 0:S.id,a,U,X,Y,W,D]);const G=(0,s.useMemo)(()=>({low:{color:"green",label:"Low Priority",icon:m.A},medium:{color:"yellow",label:"Medium Priority",icon:m.A},high:{color:"red",label:"High Priority",icon:m.A},urgent:{color:"purple",label:"Urgent",icon:c.A}}),[]),Q=(0,s.useMemo)(()=>({pending:{color:"gray",label:"Pending",icon:u.A},in_progress:{color:"blue",label:"In Progress",icon:g.A},completed:{color:"green",label:"Completed",icon:n.A},paused:{color:"orange",label:"Paused",icon:x.A}}),[]),Z=(0,s.useMemo)(()=>{if(!F.due_date)return!1;return new Date(F.due_date)<new Date&&"completed"!==F.status},[F.due_date,F.status]),ee=(0,s.useCallback)(()=>{D||M||(E(!0),L(!0),A&&A(),I(!1))},[A,D,M]),te=(0,s.useCallback)(async()=>{if(!Y){B(!0);try{P(e=>{const t=e.tasks.map(e=>String(e.id)===String(null===S||void 0===S?void 0:S.id)?{...e,...F}:e),a={...e,tasks:t};return z(a),a}),H(!1),O("Task updated successfully","success")}catch(e){console.error("Error saving task:",e),O("Failed to save task","error")}finally{B(!1)}}},[null===S||void 0===S?void 0:S.id,F,P,z,O,Y]),ae=(0,s.useCallback)(async()=>{if(!Y&&window.confirm("Are you sure you want to delete this task?")){B(!0);try{P(e=>{const t=e.tasks.filter(e=>String(e.id)!==String(null===S||void 0===S?void 0:S.id)),a={...e,tasks:t};return z(a),a}),O("Task deleted successfully","success"),ee()}catch(e){console.error("Error deleting task:",e),O("Failed to delete task","error")}finally{B(!1)}}},[null===S||void 0===S?void 0:S.id,P,z,O,ee,Y]),se=(0,s.useCallback)(e=>{R(t=>({...t,status:e}))},[]),ie=(0,s.useCallback)((e,t)=>{R(a=>({...a,[e]:t}))},[]),re=function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"text",s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const i=F[t]||"";return X?"textarea"===a?(0,w.jsxs)("div",{className:"space-y-2",children:[(0,w.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:e}),(0,w.jsx)("textarea",{value:i,onChange:e=>ie(t,e.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors",rows:s.rows||3,placeholder:`Enter ${e.toLowerCase()}...`})]}):"select"===a&&s.choices?(0,w.jsxs)("div",{className:"space-y-2",children:[(0,w.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:e}),(0,w.jsxs)("select",{value:i,onChange:e=>ie(t,e.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors",children:[(0,w.jsxs)("option",{value:"",children:["Select ",e.toLowerCase(),"..."]}),s.choices.map(e=>(0,w.jsx)("option",{value:e.value,children:e.label},e.value))]})]}):"date"===a?(0,w.jsxs)("div",{className:"space-y-2",children:[(0,w.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:e}),(0,w.jsx)("input",{type:"date",value:i,onChange:e=>ie(t,e.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors"})]}):(0,w.jsxs)("div",{className:"space-y-2",children:[(0,w.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:e}),(0,w.jsx)("input",{type:a,value:i,onChange:e=>ie(t,"number"===a?Number(e.target.value):e.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors",placeholder:`Enter ${e.toLowerCase()}...`})]}):"textarea"===a?(0,w.jsxs)("div",{className:"space-y-2",children:[(0,w.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:e}),(0,w.jsx)("div",{className:"p-3 bg-gray-50 rounded-lg border min-h-[2.5rem] text-gray-800",children:i||(0,w.jsx)("span",{className:"text-gray-400 italic",children:"Not specified"})})]}):"select"===a?(0,w.jsxs)("div",{className:"space-y-2",children:[(0,w.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:e}),(0,w.jsx)("div",{className:"p-3 bg-gray-50 rounded-lg border text-gray-800",children:i||(0,w.jsx)("span",{className:"text-gray-400 italic",children:"Not specified"})})]}):"date"===a?(0,w.jsxs)("div",{className:"space-y-2",children:[(0,w.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:e}),(0,w.jsx)("div",{className:"p-3 bg-gray-50 rounded-lg border text-gray-800",children:i?new Date(i).toLocaleDateString():(0,w.jsx)("span",{className:"text-gray-400 italic",children:"Not set"})})]}):(0,w.jsxs)("div",{className:"space-y-2",children:[(0,w.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:e}),(0,w.jsx)("div",{className:"p-3 bg-gray-50 rounded-lg border text-gray-800",children:i||(0,w.jsx)("span",{className:"text-gray-400 italic",children:"Not specified"})})]})};return a?(0,w.jsx)(i.N,{mode:"wait",onExitComplete:()=>{E(!1),L(!1),q(!1),_(),T&&T()},children:$&&(0,w.jsx)(r.P.div,{initial:"hidden",animate:"visible",exit:"exit",variants:k,className:"fixed inset-0 bg-black flex items-center justify-center z-50",style:{willChange:"backdrop-filter, opacity",backfaceVisibility:"hidden",transform:"translate3d(0, 0, 0)"},onClick:e=>e.target===e.currentTarget&&ee(),children:(0,w.jsxs)(r.P.div,{initial:"hidden",animate:"visible",exit:"exit",variants:N,className:"bg-white rounded-2xl shadow-2xl max-w-4xl w-full mx-4 max-h-[85vh] overflow-hidden",style:{willChange:"transform, opacity, scale",backfaceVisibility:"hidden"},onClick:e=>e.stopPropagation(),onAnimationStart:()=>{E(!0),A&&A()},onAnimationComplete:()=>{E(!1),T&&T()},children:[(0,w.jsxs)(r.P.div,{initial:"hidden",animate:"visible",exit:"exit",variants:C,className:"bg-gradient-to-br from-slate-900 to-slate-800 text-white px-6 py-4 flex items-center justify-between",children:[(0,w.jsxs)("div",{className:"flex items-center gap-3",children:[(0,w.jsx)(n.A,{size:24}),(0,w.jsx)("h2",{className:"text-xl font-semibold",children:"Task Details"}),Z&&(0,w.jsxs)(r.P.div,{animate:{scale:[1,1.1,1]},transition:{duration:1,repeat:1/0},className:"flex items-center gap-1 px-2 py-1 bg-red-500 rounded-full text-xs font-medium",children:[(0,w.jsx)(c.A,{size:12}),"Overdue"]})]}),(0,w.jsxs)("div",{className:"flex items-center gap-2",children:[!X&&!Y&&(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)("button",{onClick:()=>H(!0),className:"text-white hover:text-gray-200 p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-all",title:"Edit",children:(0,w.jsx)(l.A,{size:20})}),(0,w.jsx)("button",{onClick:ae,className:"text-white hover:text-red-200 p-2 rounded-full hover:bg-red-500 hover:bg-opacity-30 transition-all",title:"Delete",children:(0,w.jsx)(v.A,{size:20})})]}),(0,w.jsx)("button",{onClick:ee,className:"text-white hover:text-gray-200 p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-all",children:(0,w.jsx)(j.A,{size:20})})]})]}),(0,w.jsx)("div",{className:"bg-gradient-to-r from-slate-900 via-slate-800 to-slate-900 border-b border-slate-600",children:(0,w.jsx)("nav",{className:"flex flex-wrap gap-2 px-6 py-4",children:[{key:"overview",label:"Overview",icon:n.A},{key:"progress",label:"Progress",icon:f.A},{key:"connections",label:"Connections",icon:h.A},{key:"details",label:"Details",icon:p.A}].map(e=>{let{key:t,label:a,icon:s}=e;return(0,w.jsxs)(r.P.button,{onClick:()=>{W||(K(!0),V(t),setTimeout(()=>K(!1),300))},className:"relative flex items-center gap-2 px-4 py-3 rounded-xl font-medium text-sm transition-all duration-300 "+(J===t?"bg-gradient-to-r from-emerald-500 to-teal-600 text-white shadow-lg shadow-emerald-500/25":"text-slate-300 hover:text-white hover:bg-slate-700/50 hover:shadow-md"),whileHover:{scale:J===t?1:1.02},whileTap:{scale:.98},initial:!1,animate:{scale:J===t?1.05:1,boxShadow:J===t?"0 8px 25px rgba(16, 185, 129, 0.3), 0 0 20px rgba(20, 184, 166, 0.2)":"0 2px 8px rgba(0, 0, 0, 0.1)"},transition:{duration:.3,ease:"easeOut"},children:[(0,w.jsx)(s,{size:16,className:J===t?"drop-shadow-sm":""}),a,J===t&&(0,w.jsx)(r.P.div,{layoutId:"taskTabGlow",className:"absolute inset-0 bg-gradient-to-r from-emerald-400/20 to-teal-500/20 rounded-xl blur-sm",initial:!1,transition:{type:"spring",bounce:.2,duration:.6}})]},t)})})}),(0,w.jsx)(r.P.div,{className:"relative overflow-hidden bg-gradient-to-br from-slate-50 to-slate-100",layout:"position",layoutRoot:!0,transition:{layout:{duration:.4,ease:"easeInOut"},height:{duration:.4,ease:"easeInOut"}},children:(0,w.jsxs)(i.N,{mode:"wait",initial:!1,onExitComplete:()=>K(!1),children:["overview"===J&&(0,w.jsx)(r.P.div,{initial:{opacity:0,x:-30},animate:{opacity:1,x:0},exit:{opacity:0,x:30},transition:{duration:.4,ease:"easeOut"},layout:"position",layoutId:"tabContent",className:"p-6 overflow-y-auto max-h-[calc(85vh-200px)] scrollbar-thin scrollbar-thumb-slate-400 scrollbar-track-slate-200",children:(0,w.jsxs)("div",{className:"space-y-6",children:[(0,w.jsxs)("div",{className:"bg-white rounded-xl p-6 shadow-lg border border-slate-200",children:[(0,w.jsxs)("h3",{className:"text-lg font-semibold text-slate-800 mb-4 flex items-center gap-2",children:[(0,w.jsx)(y.A,{size:20,className:"text-emerald-600"}),"Task Information"]}),(0,w.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[re("Title","title"),re("Priority","priority","select",{choices:[{value:"low",label:"Low Priority"},{value:"medium",label:"Medium Priority"},{value:"high",label:"High Priority"},{value:"urgent",label:"Urgent"}]})]}),(0,w.jsx)("div",{className:"mt-6",children:re("Description","description","textarea",{rows:4})})]}),(0,w.jsxs)("div",{className:"bg-white rounded-xl p-6 shadow-lg border border-slate-200",children:[(0,w.jsxs)("h3",{className:"text-lg font-semibold text-slate-800 mb-4 flex items-center gap-2",children:[(0,w.jsx)(u.A,{size:20,className:"text-blue-600"}),"Status & Timeline"]}),(0,w.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[re("Status","status","select",{choices:[{value:"pending",label:"Pending"},{value:"in_progress",label:"In Progress"},{value:"completed",label:"Completed"},{value:"paused",label:"Paused"}]}),re("Due Date","due_date","date")]}),(0,w.jsxs)("div",{className:"mt-6",children:[(0,w.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Quick Status Update"}),(0,w.jsx)("div",{className:"flex flex-wrap gap-3",children:Object.entries(Q).map(e=>{let[t,a]=e;const s=a.icon,i=F.status===t;return(0,w.jsxs)(r.P.button,{onClick:()=>se(t),disabled:!X,whileHover:X?{scale:1.05}:{},whileTap:X?{scale:.95}:{},className:"flex items-center gap-2 px-4 py-2 rounded-lg font-medium text-sm transition-all "+(i?`bg-${a.color}-100 text-${a.color}-800 border-2 border-${a.color}-300`:"bg-gray-100 text-gray-600 border-2 border-gray-200 "+(X?"hover:bg-gray-200":"cursor-not-allowed opacity-50")),children:[(0,w.jsx)(s,{size:16}),a.label]},t)})})]})]})]})},"overview"),"progress"===J&&(0,w.jsx)(r.P.div,{initial:{opacity:0,x:-30},animate:{opacity:1,x:0},exit:{opacity:0,x:30},transition:{duration:.4,ease:"easeOut"},layout:"position",layoutId:"tabContent",className:"p-6 overflow-y-auto max-h-[calc(85vh-200px)] scrollbar-thin scrollbar-thumb-slate-400 scrollbar-track-slate-200",children:(0,w.jsxs)("div",{className:"bg-white rounded-xl p-6 shadow-lg border border-slate-200",children:[(0,w.jsxs)("h3",{className:"text-lg font-semibold text-slate-800 mb-6 flex items-center gap-2",children:[(0,w.jsx)(f.A,{size:20,className:"text-blue-600"}),"Task Progress"]}),(0,w.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[(0,w.jsxs)(r.P.div,{whileHover:{scale:1.02},className:"p-4 rounded-lg border-2 "+("completed"===F.status?"bg-green-50 border-green-200":"bg-gray-50 border-gray-200"),children:[(0,w.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,w.jsx)(n.A,{size:20,className:"completed"===F.status?"text-green-600":"text-gray-400"}),(0,w.jsx)("span",{className:"font-medium "+("completed"===F.status?"text-green-800":"text-gray-600"),children:"Completion"})]}),(0,w.jsx)("div",{className:"text-2xl font-bold "+("completed"===F.status?"text-green-700":"text-gray-700"),children:"completed"===F.status?"100%":"0%"})]}),(0,w.jsxs)(r.P.div,{whileHover:{scale:1.02},className:"p-4 rounded-lg border-2 "+(Z?"bg-red-50 border-red-200":"bg-blue-50 border-blue-200"),children:[(0,w.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,w.jsx)(d.A,{size:20,className:Z?"text-red-600":"text-blue-600"}),(0,w.jsx)("span",{className:"font-medium "+(Z?"text-red-800":"text-blue-800"),children:"Due Date"})]}),(0,w.jsx)("div",{className:"text-lg font-bold "+(Z?"text-red-700":"text-blue-700"),children:F.due_date?new Date(F.due_date).toLocaleDateString():"Not set"}),Z&&(0,w.jsx)("div",{className:"text-sm text-red-600 mt-1",children:"Overdue"})]}),(0,w.jsxs)(r.P.div,{whileHover:{scale:1.02},className:"p-4 rounded-lg border-2 "+("urgent"===F.priority||"high"===F.priority?"bg-orange-50 border-orange-200":"bg-gray-50 border-gray-200"),children:[(0,w.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,w.jsx)(m.A,{size:20,className:"urgent"===F.priority||"high"===F.priority?"text-orange-600":"text-gray-600"}),(0,w.jsx)("span",{className:"font-medium "+("urgent"===F.priority||"high"===F.priority?"text-orange-800":"text-gray-800"),children:"Priority"})]}),(0,w.jsx)("div",{className:"text-lg font-bold "+("urgent"===F.priority||"high"===F.priority?"text-orange-700":"text-gray-700"),children:(null===(t=G[F.priority])||void 0===t?void 0:t.label)||"Not set"})]})]})]})},"progress"),"connections"===J&&(0,w.jsx)(r.P.div,{initial:{opacity:0,x:-30},animate:{opacity:1,x:0},exit:{opacity:0,x:30},transition:{duration:.4,ease:"easeOut"},layout:"position",layoutId:"tabContent",className:"p-6 overflow-y-auto max-h-[calc(85vh-200px)] scrollbar-thin scrollbar-thumb-slate-400 scrollbar-track-slate-200",children:(0,w.jsxs)("div",{className:"bg-white rounded-xl p-6 shadow-lg border border-slate-200",children:[(0,w.jsxs)("h3",{className:"text-lg font-semibold text-slate-800 mb-6 flex items-center gap-2",children:[(0,w.jsx)(h.A,{size:20,className:"text-indigo-600"}),"Related Content"]}),(0,w.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[re("Linked Case ID","linked_case_id"),re("Linked Topic ID","linked_topic_id")]}),(0,w.jsxs)("div",{className:"mt-8 text-center py-8 text-gray-500",children:[(0,w.jsx)(h.A,{size:48,className:"mx-auto mb-3 text-gray-300"}),(0,w.jsx)("p",{children:"No connections found"}),(0,w.jsx)("p",{className:"text-sm mt-1",children:"Link this task to cases or topics to create connections"})]})]})},"connections"),"details"===J&&(0,w.jsx)(r.P.div,{initial:{opacity:0,x:-30},animate:{opacity:1,x:0},exit:{opacity:0,x:30},transition:{duration:.4,ease:"easeOut"},layout:"position",layoutId:"tabContent",className:"p-6 overflow-y-auto max-h-[calc(85vh-200px)] scrollbar-thin scrollbar-thumb-slate-400 scrollbar-track-slate-200",children:(0,w.jsxs)("div",{className:"bg-white rounded-xl p-6 shadow-lg border border-slate-200",children:[(0,w.jsxs)("h3",{className:"text-lg font-semibold text-slate-800 mb-6 flex items-center gap-2",children:[(0,w.jsx)(p.A,{size:20,className:"text-gray-600"}),"Additional Details"]}),(0,w.jsxs)("div",{className:"space-y-6",children:[(0,w.jsxs)("div",{className:"text-sm text-gray-600 bg-slate-50 p-4 rounded-lg",children:[(0,w.jsx)("p",{className:"font-medium mb-2",children:"Task Details"}),(0,w.jsxs)("div",{className:"space-y-2",children:[(0,w.jsxs)("p",{children:[(0,w.jsx)("span",{className:"font-medium",children:"Created:"})," ",null!==S&&void 0!==S&&S.created_at?new Date(S.created_at).toLocaleString():"Unknown"]}),(0,w.jsxs)("p",{children:[(0,w.jsx)("span",{className:"font-medium",children:"Last Updated:"})," ",null!==S&&void 0!==S&&S.updated_at?new Date(S.updated_at).toLocaleString():"Unknown"]}),(0,w.jsxs)("p",{children:[(0,w.jsx)("span",{className:"font-medium",children:"Task ID:"})," ",(null===S||void 0===S?void 0:S.id)||"Unknown"]})]})]}),(0,w.jsxs)("div",{className:"p-4 bg-blue-50 rounded-lg border border-blue-200",children:[(0,w.jsx)("h4",{className:"font-medium text-blue-800 mb-2",children:"Task Management Tips"}),(0,w.jsxs)("ul",{className:"text-blue-700 text-sm space-y-1",children:[(0,w.jsx)("li",{children:"\u2022 Break large tasks into smaller, manageable subtasks"}),(0,w.jsx)("li",{children:"\u2022 Set realistic due dates to maintain accountability"}),(0,w.jsx)("li",{children:"\u2022 Link tasks to relevant cases or topics for better organization"}),(0,w.jsx)("li",{children:"\u2022 Update status regularly to track progress"})]})]})]})]})},"details")]})}),X&&(0,w.jsxs)("div",{className:"sticky bottom-0 bg-gray-50 border-t border-gray-200 px-6 py-4 flex items-center justify-between",children:[(0,w.jsx)("div",{className:"text-sm text-gray-500",children:"Changes will be auto-saved"}),(0,w.jsxs)("div",{className:"flex items-center gap-3",children:[(0,w.jsx)("button",{onClick:()=>{H(!1),R({...S})},disabled:Y,className:"px-4 py-2 text-gray-600 hover:text-gray-800 border border-gray-300 rounded-lg hover:bg-gray-100 transition-colors",children:"Cancel"}),(0,w.jsxs)("button",{onClick:te,disabled:Y,className:"px-4 py-2 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 transition-colors flex items-center gap-2",children:[Y?(0,w.jsx)(o.A,{size:16,className:"animate-spin"}):(0,w.jsx)(b.A,{size:16}),Y?"Saving...":"Save Changes"]})]})]})]})},`task-modal-${(null===S||void 0===S?void 0:S.id)||"default"}`)}):null},_=s.memo(S,(e,t)=>{var a,s,i,r;return e.isOpen===t.isOpen&&(null===(a=e.data)||void 0===a?void 0:a.id)===(null===(s=t.data)||void 0===s?void 0:s.id)&&(null===(i=e.data)||void 0===i?void 0:i.updated_at)===(null===(r=t.data)||void 0===r?void 0:r.updated_at)})},9432:(e,t,a)=>{a.r(t),a.d(t,{default:()=>H});var s=a(5043),i=a(3546),r=a(6446),o=a(7118),l=a(1680),n=a(6835),c=a(6382),d=a(5088),u=a(8487),p=a(614),m=a(4596),h=a(8693),x=a(2024),g=a(4537),b=a(8646),y=a(9855),v=a(1360),f=a(2626),j=a(4805),w=a(9968),N=a(8119),k=a(4948),C=a(1015),S=a(7792),_=a(6690),A=a(7352),T=a(7046),P=a(1333),z=a(1725),O=a(579);const D=e=>{let{entry:t,position:a,type:i,isVisible:o,isEditing:l,onEdit:n,onSave:c,onCancel:d}=e;const[u,p]=(0,s.useState)(""),m=(0,s.useRef)(null);(0,s.useEffect)(()=>{l&&p("patient"===i?t.patient_narrative||"":t.clinical_notes||"")},[l,t,i]),(0,s.useEffect)(()=>{const e=e=>{l&&m.current&&!m.current.contains(e.target)&&c(t.id,i,u)};if(l)return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[l,u,t.id,i,c]);const x="patient"===i?"Patient Narrative":"Clinical Notes",g="patient"===i?t.patient_narrative:t.clinical_notes,b="patient"===i?"bg-green-800/95":"bg-blue-800/95",y="patient"===i?"border-green-400":"border-blue-400",v="patient"===i?"shadow-green-400/30":"shadow-blue-400/30",f=l?"ring-2 ring-yellow-400 ring-opacity-60":"",j=l?"opacity-100":"opacity-90";return o?(0,O.jsxs)(r.P.div,{ref:m,initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{duration:.15,ease:"easeOut"},className:`absolute z-50 ${b} ${j} ${f} backdrop-blur-md rounded-lg border-2 ${y} shadow-xl ${v} p-4 w-72 cursor-pointer`,style:{left:a.x,top:a.y,filter:"drop-shadow(0 4px 12px rgba(0,0,0,0.4))"},onClick:e=>{e.stopPropagation(),l||n(t.id,i)},children:[(0,O.jsx)("div",{className:`absolute w-1 h-8 ${"patient"===i?"bg-green-400":"bg-blue-400"} shadow-lg`,style:{[a.anchorSide]:"-2px",[a.anchorPosition]:"16px",boxShadow:"0 0 8px "+("patient"===i?"#34d399":"#60a5fa")}}),(0,O.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,O.jsxs)("h4",{className:"text-sm font-semibold text-white flex items-center gap-2",children:["patient"===i?"\ud83d\udc64":"\ud83e\ude7a"," ",x]}),l&&(0,O.jsx)(r.P.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:e=>{e.stopPropagation(),c(t.id,i,u)},className:"text-green-400 hover:text-green-300 transition-colors p-1 rounded",title:"Save changes",children:(0,O.jsx)(h.A,{size:12})})]}),l?(0,O.jsxs)("div",{className:"space-y-2",children:[(0,O.jsx)("textarea",{value:u,onChange:e=>p(e.target.value),className:"w-full h-20 bg-slate-900 border border-slate-600 rounded px-2 py-1 text-white text-sm placeholder-slate-400 focus:ring-1 focus:ring-blue-400 focus:border-blue-400 resize-none",placeholder:`Enter ${x.toLowerCase()}...`,autoFocus:!0,onClick:e=>e.stopPropagation()}),(0,O.jsx)("div",{className:"text-xs text-slate-400",children:"Click outside to save"})]}):(0,O.jsx)("div",{className:"text-slate-200 text-sm leading-relaxed",children:g?(0,O.jsx)("div",{className:"max-h-16 overflow-y-auto",children:(0,O.jsx)("p",{children:g})}):(0,O.jsxs)("p",{className:"text-slate-400 italic",children:["Click to add ",x.toLowerCase()]})}),!l&&t.timestamp&&(0,O.jsx)("div",{className:"mt-2 pt-1 border-t border-slate-600",children:(0,O.jsx)("span",{className:"text-xs text-slate-400",children:new Date(t.timestamp).toLocaleString()})})]}):null},E=e=>{let{caseId:t,initialEntries:a=[],onEntryUpdate:o,onEntryAdd:l,onEntryDelete:n,className:c="",width:d=800,height:u=600}=e;const p=(0,s.useRef)(null),m=(0,s.useRef)(null),h=(0,s.useRef)([]),x=(0,s.useRef)([]),g=(0,s.useRef)(null),b=(0,s.useRef)(null),[y,f]=(0,s.useState)(null),[E,$]=(0,s.useState)(null),[I,M]=(0,s.useState)(a),[L,X]=(0,s.useState)(null),[H,F]=(0,s.useState)(new Set),R=(0,T.A)(P.A),Y=(0,s.useCallback)(e=>{const t=[...e].sort((e,t)=>new Date(e.timestamp)-new Date(t.timestamp)),a=d/2;return t.map((e,t)=>({...e,id:e.id||`entry-${t}`,title:e.title||`Entry ${t+1}`,type:e.type||"note",orderIndex:t,x:a+(t%2===0?-140:140),y:80+120*t,side:t%2===0?"left":"right",patient_narrative:e.patient_narrative||"",clinical_notes:e.clinical_notes||"",symptoms:e.symptoms||[],data:e,isFirstNode:0===t}))},[d]),B=(0,s.useCallback)(e=>{const t=[];for(let a=0;a<e.length-1;a++)t.push({id:`link-${a}`,source:e[a].id,target:e[a+1].id,insertIndex:a+1});return t},[]),U=(0,s.useCallback)((e,t)=>{if(!e||!e.x||!e.y)return{x:0,y:0};const a="left"===e.side,s=30;let i={};i="patient"===t?a?{x:e.x+s,y:e.y+s,anchorSide:"left",anchorPosition:"top"}:{x:e.x+s,y:e.y-120-s,anchorSide:"left",anchorPosition:"bottom"}:a?{x:e.x-280-s,y:e.y-120-s,anchorSide:"right",anchorPosition:"bottom"}:{x:e.x-280-s,y:e.y+s,anchorSide:"right",anchorPosition:"top"};return i.x=Math.max(20,Math.min(i.x,d-280-20)),i.y=Math.max(20,i.y),i},[d]),q=(0,s.useCallback)((e,t)=>{const a=Y(I);let s=null,i=1/0;return a.forEach((a,r)=>{const o=Math.sqrt((e-a.x)**2+(t-a.y)**2);o<i&&o<100&&(i=o,s={...a,index:r})}),s},[I,Y]),J=(0,s.useCallback)((e,t)=>{const a=[...I],s=a.findIndex(t=>t.id===e);if(-1!==s&&t!==s){const[e]=a.splice(s,1);a.splice(t,0,e),M(a)}},[I]),V=(0,s.useCallback)((e,t,a)=>{const s={id:`entry-${Date.now()}`,title:`Entry ${I.length+1}`,type:"note",content:"",timestamp:(new Date).toISOString(),patient_narrative:"",clinical_notes:"",symptoms:[]};F(e=>new Set([...e,s.id]));const i=[...I];i.splice(e,0,s),M(i),l&&l(s)},[I,l]),W=(0,s.useCallback)(e=>{g.current&&clearTimeout(g.current),f(e)},[]),K=(0,s.useCallback)(()=>{g.current=setTimeout(()=>{f(null)},50)},[]),G=(0,s.useCallback)(()=>{if(!p.current)return;const e=Y(I),t=B(e),a=h.current||[];e.forEach(e=>{const t=a.find(t=>t.id===e.id);t&&!H.has(e.id)&&(e.x=t.x||e.x,e.y=t.y||e.y,e.fx=null,e.fy=null)}),h.current=e,x.current=t,m.current&&m.current.stop();const s=(0,w.A)(e).force("link",(0,N.A)(t).id(e=>e.id).distance(100).strength(.3)).force("charge",(0,k.A)().strength(-200)).force("x",(0,C.A)().strength(.05)).force("y",(0,S.A)().strength(.02)).velocityDecay(.7).alphaDecay(.02);m.current=s;const i=(0,A.A)(p.current).attr("width",d).attr("height",u).attr("viewBox",[0,0,d,u]);i.selectAll("*").remove();const r=i.append("g").attr("class","timeline-links").selectAll("line").data(t).join("line").attr("stroke","#64748b").attr("stroke-opacity",.4).attr("stroke-width",2).attr("stroke-dasharray","5,5").style("cursor","pointer").style("transition","all 0.2s ease").on("mouseenter",(e,t)=>{$(t.id),(0,A.A)(e.target).attr("stroke-opacity",.8).attr("stroke-width",3).style("filter","drop-shadow(0 0 4px #64748b)")}).on("mouseleave",(e,t)=>{$(null),(0,A.A)(e.target).attr("stroke-opacity",.4).attr("stroke-width",2).style("filter","none")}).on("click",(e,t)=>{const a=(t.source.x+t.target.x)/2,s=(t.source.y+t.target.y)/2;V(t.insertIndex,a,s)}),o=i.append("g").attr("class","timeline-nodes").selectAll("circle").data(e).join("circle").attr("r",12).attr("fill",e=>R(e.type)).attr("stroke","#fff").attr("stroke-width",2).style("cursor","pointer").style("transition","none");e.forEach(e=>{if(H.has(e.id)){o.filter(t=>t.id===e.id).attr("r",4).attr("opacity",.5).transition().duration(250).ease(z.Sz).attr("r",12).attr("opacity",1).on("end",()=>{F(t=>{const a=new Set(t);return a.delete(e.id),a})})}});const l=(0,_.A)().on("start",(e,t)=>{e.active||s.alphaTarget(.3).restart(),t.fx=t.x,t.fy=t.y,(0,A.A)(e.sourceEvent.target).attr("r",16).attr("stroke-width",3).style("filter","drop-shadow(0 4px 8px rgba(0,0,0,0.3))")}).on("drag",(e,t)=>{t.fx=e.x,t.fy=e.y}).on("end",(e,t)=>{e.active||s.alphaTarget(0);const a=q(e.x,e.y);a?(t.fx=a.x,t.fy=a.y,J(t.id,a.index)):(t.fx=null,t.fy=null),(0,A.A)(e.sourceEvent.target).attr("r",12).attr("stroke-width",2).style("filter","none")});return o.call(l),o.on("click",(e,t)=>{e.stopPropagation(),t.fx=t.x,t.fy=t.y,X({nodeId:t.id,type:"patient"}),f(t.id),s.restart()}),o.on("mouseenter",(e,t)=>{W(t.id),(0,A.A)(e.target).attr("r",16).style("filter","drop-shadow(0 0 15px rgba(59, 130, 246, 0.5))")}).on("mouseleave",(e,t)=>{K(),(0,A.A)(e.target).attr("r",12).style("filter","none")}),s.on("tick",()=>{r.attr("x1",e=>e.source.x).attr("y1",e=>e.source.y).attr("x2",e=>e.target.x).attr("y2",e=>e.target.y),o.attr("cx",e=>e.x).attr("cy",e=>e.y)}),s},[I,d,u,R,H,Y,B,W,K,q,J,V]);(0,s.useEffect)(()=>{if(I.length>0){I.map(e=>e.id).sort().join(",")===h.current.map(e=>e.id).sort().join(",")&&m.current||G()}return()=>{g.current&&clearTimeout(g.current)}},[I.length,I.map(e=>e.id).join(",")]),(0,s.useEffect)(()=>()=>{m.current&&m.current.stop()},[]);const Q=(0,s.useCallback)(()=>{const e={id:`entry-${Date.now()}`,title:`Entry ${I.length+1}`,type:"note",content:"",timestamp:(new Date).toISOString(),patient_narrative:"",clinical_notes:"",symptoms:[]};F(t=>new Set([...t,e.id]));const t=[...I,e];M(t),l&&l(e)},[I,l]),Z=(0,s.useCallback)(()=>{if(m.current&&h.current){const e=Y(I);h.current.forEach((t,a)=>{t.fx=null,t.fy=null,e[a]&&(t.x=e[a].x,t.y=e[a].y)}),m.current.alpha(1).restart()}},[I,Y]),ee=(0,s.useCallback)((e,t)=>{X({nodeId:e,type:t})},[]),te=(0,s.useCallback)((e,t,a)=>{const s=I.map(s=>s.id===e?{...s,["patient"===t?"patient_narrative":"clinical_notes"]:a}:s);M(s),X(null),o&&o(s)},[I,o]),ae=y?h.current.find(e=>e.id===y):null;return(0,O.jsxs)("div",{className:`relative ${c}`,children:[(0,O.jsxs)("div",{ref:b,className:"relative border border-slate-700 rounded-lg bg-slate-900/50 mx-auto timeline-scroll-container",style:{width:d,height:u,maxHeight:"70vh",overflow:"auto"},children:[(0,O.jsx)("svg",{ref:p,className:"min-h-full",style:{width:`${d}px`,height:`${Math.max(u,120*I.length+160)}px`}}),(0,O.jsx)(i.N,{children:ae&&!L&&(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(D,{entry:ae,position:U(ae,"patient"),type:"patient",isVisible:!0,isEditing:!1,onEdit:ee,onSave:te,onCancel:()=>X(null)}),(0,O.jsx)(D,{entry:ae,position:U(ae,"clinical"),type:"clinical",isVisible:!0,isEditing:!1,onEdit:ee,onSave:te,onCancel:()=>X(null)})]})}),(0,O.jsx)(i.N,{children:L&&ae&&ae.id===L.nodeId&&(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(D,{entry:ae,position:U(ae,"patient"),type:"patient",isVisible:!0,isEditing:"patient"===L.type,onEdit:ee,onSave:te,onCancel:()=>X(null)}),(0,O.jsx)(D,{entry:ae,position:U(ae,"clinical"),type:"clinical",isVisible:!0,isEditing:"clinical"===L.type,onEdit:ee,onSave:te,onCancel:()=>X(null)})]})})]}),(0,O.jsxs)("div",{className:"flex items-center justify-between mt-4",children:[(0,O.jsxs)("div",{className:"flex items-center gap-2",children:[(0,O.jsxs)(r.P.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:Q,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2 text-sm",children:[(0,O.jsx)(v.A,{size:16}),"Add Entry"]}),(0,O.jsxs)(r.P.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:Z,className:"px-4 py-2 bg-slate-700 text-white rounded-lg hover:bg-slate-600 transition-colors flex items-center gap-2 text-sm",children:[(0,O.jsx)(j.A,{size:16}),"Reset Layout"]})]}),(0,O.jsx)("div",{className:"text-xs text-slate-400 flex items-center gap-4",children:(0,O.jsxs)("span",{children:[I.length," ",1===I.length?"entry":"entries"]})})]}),(0,O.jsxs)("div",{className:"mt-2 text-xs text-slate-500 space-y-1",children:[(0,O.jsxs)("p",{children:["\u2022 ",(0,O.jsx)("strong",{children:"Click"})," nodes to edit cards \u2022 ",(0,O.jsx)("strong",{children:"Hover"})," to preview patient/clinical cards \u2022 ",(0,O.jsx)("strong",{children:"Drag"})," to reposition"]}),(0,O.jsxs)("p",{children:["\u2022 ",(0,O.jsx)("strong",{children:"Click connection lines"})," to insert new entries \u2022 Cards auto-save when clicking outside"]})]})]})};E.displayName="AngularTimeline";const $=E,I={hidden:{opacity:0,scale:.3,y:50,rotate:-5},visible:{opacity:1,scale:1,y:0,rotate:0,transition:{type:"spring",damping:25,stiffness:300,duration:.6}},exit:{opacity:0,scale:.7,y:30,rotate:-3,transition:{type:"easeInOut",duration:.4}}},M={hidden:{opacity:0,backdropFilter:"blur(0px)"},visible:{opacity:1,backdropFilter:"blur(8px)",transition:{duration:.4,ease:"easeOut"}},exit:{opacity:0,backdropFilter:"blur(0px)",transition:{duration:.3,ease:"easeIn"}}},L={hidden:{opacity:0,y:20,scale:.95},visible:{opacity:1,y:0,scale:1,transition:{type:"easeOut",duration:.3,delay:.1}},exit:{opacity:0,y:-10,scale:1.02,transition:{type:"easeIn",duration:.2}}},X={hidden:{opacity:0,y:20,scale:.95},visible:{opacity:1,y:0,scale:1,transition:{duration:.4,ease:"easeOut"}},edit:{scale:1.02,boxShadow:"0 8px 25px rgba(59, 130, 246, 0.15)",transition:{duration:.3,ease:"easeOut"}},saved:{scale:1,boxShadow:"0 4px 15px rgba(34, 197, 94, 0.15)",transition:{duration:.3,ease:"easeOut"}}},H=e=>{var t,a,j,w,N,k,C;let{isOpen:S,data:_,onClose:A,onAnimationStart:T,onAnimationEnd:P,setMindMapData:z,autoSaveMindMapData:D,addToast:E}=e;const[H,F]=(0,s.useState)(!1),[R,Y]=(0,s.useState)(!1),[B,U]=(0,s.useState)(!1),[q,J]=(0,s.useState)({}),[V,W]=(0,s.useState)(!1),[K,G]=(0,s.useState)(!1),[Q,Z]=(0,s.useState)("overview"),[ee,te]=(0,s.useState)(!1),[ae,se]=(0,s.useState)({}),[ie,re]=(0,s.useState)({}),[oe,le]=(0,s.useState)({}),ne=(0,s.useRef)({}),[ce,de]=(0,s.useState)({name:"",dosage:"",frequency:"",effect:""}),[ue,pe]=(0,s.useState)(!1);(0,s.useEffect)(()=>{if(S&&_&&!K){Y(!0);const e={..._,narrative_summary:_.narrative_summary||"",medications:_.medications||[],therapeutic_highlights:_.therapeutic_highlights||"",timeline:_.timeline||[],last_updated:_.last_updated||(new Date).toISOString()};J(e),G(!0),F(!0),T&&T(),setTimeout(()=>{F(!1),P&&P()},600)}else!S&&K&&(G(!1),le({}),se({}),re({}))},[S,_,K,T,P]),(0,s.useEffect)(()=>{S&&_&&K&&J(e=>({...e,..._}))},[_,S,K]);const me=(0,s.useCallback)(()=>{H||B||(F(!0),U(!0),T&&T(),Y(!1))},[T,H,B]),he=((0,s.useCallback)(async()=>{if(!V){W(!0);try{const e={...q,last_updated:(new Date).toISOString()};z(t=>{const a=t.cases.map(t=>String(t.id)===String(null===_||void 0===_?void 0:_.id)?{...t,...e}:t),s={...t,cases:a};return D(s),s}),J(e),E("Case updated successfully","success")}catch(e){console.error("Error saving case:",e),E("Failed to save case","error")}finally{W(!1)}}},[null===_||void 0===_?void 0:_.id,q,z,D,E,V]),(0,s.useCallback)(e=>{const t=ne.current[e];t&&le(a=>({...a,[e]:t.scrollTop}))},[])),xe=(0,s.useCallback)(e=>{setTimeout(()=>{const t=ne.current[e],a=oe[e];t&&a&&(t.scrollTop=a)},100)},[oe]),ge=(0,s.useCallback)(e=>{e===Q||ee||(he(Q),te(!0),Z(e),setTimeout(()=>{te(!1),xe(e)},300))},[Q,ee,he,xe]),be=(0,s.useCallback)(e=>{se(t=>({...t,[e]:!t[e]})),ae[e]||re(t=>({...t,[e]:{}}))},[ae]),ye=(0,s.useCallback)((e,t,a)=>{re(s=>({...s,[e]:{...s[e],[t]:a}}))},[]),ve=(0,s.useCallback)(e=>{se(t=>({...t,[e]:!1})),re(t=>{const a={...t};return delete a[e],a})},[]),fe=(0,s.useCallback)(async e=>{if(!V){W(!0);try{const t=ie[e]||{};let a={...q};"basic_info"===e?(t.label&&(a.label=t.label,a.title=t.label),t.primary_diagnosis&&(a.primary_diagnosis=t.primary_diagnosis,a.primaryDiagnosis=t.primary_diagnosis),t.status&&(a.status=t.status)):"chief_complaint"===e?void 0!==t.content&&(a.chief_complaint=t.content,a.chiefComplaint=t.content):"initial_presentation"===e&&void 0!==t.content&&(a.initial_presentation=t.content,a.initialPresentation=t.content),a.last_updated=(new Date).toISOString(),J(a),z(e=>{const t=e.cases.map(e=>String(e.id)===String(null===_||void 0===_?void 0:_.id)?{...e,...a}:e),s={...e,cases:t};return D(s),s}),se(t=>({...t,[e]:!1})),re(t=>{const a={...t};return delete a[e],a}),E("Case information updated successfully","success")}catch(t){console.error("Error saving section:",t),E("Failed to save changes","error")}finally{W(!1)}}},[ie,q,null===_||void 0===_?void 0:_.id,z,D,E,V]),je=((0,s.useCallback)(async()=>{if(!V&&window.confirm("Are you sure you want to delete this case?")){W(!0);try{z(e=>{const t=e.cases.filter(e=>String(e.id)!==String(null===_||void 0===_?void 0:_.id)),a={...e,cases:t};return D(a),a}),E("Case deleted successfully","success"),me()}catch(e){console.error("Error deleting case:",e),E("Failed to delete case","error")}finally{W(!1)}}},[null===_||void 0===_?void 0:_.id,z,D,E,me,V]),(0,s.useCallback)(e=>{se(t=>({...t,[e]:!0})),re(t=>({...t,[e]:{...q}}))},[q])),we=(0,s.useCallback)(e=>{se(t=>({...t,[e]:!1})),re(t=>{const a={...t};return delete a[e],a})},[]),Ne=(0,s.useCallback)(async e=>{if(V)return;const t=ie[e];if(t){W(!0);try{const a={...q,...t,last_updated:(new Date).toISOString()};J(a),z(e=>{const t=e.cases.map(e=>String(e.id)===String(null===_||void 0===_?void 0:_.id)?{...e,...a}:e),s={...e,cases:t};return D(s),s}),se(t=>({...t,[e]:!1})),re(t=>{const a={...t};return delete a[e],a}),E("Section updated successfully","success")}catch(a){console.error("Error saving section:",a),E("Failed to save section","error")}finally{W(!1)}}},[ie,q,null===_||void 0===_?void 0:_.id,z,D,E,V]),ke=(0,s.useCallback)((e,t,a)=>{re(s=>({...s,[e]:{...s[e],[t]:a}}))},[]),Ce=(0,s.useCallback)(()=>{if(!ce.name.trim())return;const e=[...q.medications||[],{id:Date.now(),...ce,dateAdded:(new Date).toISOString()}],t={...q,medications:e,last_updated:(new Date).toISOString()};J(t),z(e=>{const a=e.cases.map(e=>String(e.id)===String(null===_||void 0===_?void 0:_.id)?{...e,...t}:e),s={...e,cases:a};return D(s),s}),de({name:"",dosage:"",frequency:"",effect:""}),pe(!1),E("Medication added successfully","success")},[ce,q,null===_||void 0===_?void 0:_.id,z,D,E]),Se=(0,s.useCallback)(e=>{const t=(q.medications||[]).filter(t=>t.id!==e),a={...q,medications:t,last_updated:(new Date).toISOString()};J(a),z(e=>{const t=e.cases.map(e=>String(e.id)===String(null===_||void 0===_?void 0:_.id)?{...e,...a}:e),s={...e,cases:t};return D(s),s}),E("Medication removed successfully","success")},[q,null===_||void 0===_?void 0:_.id,z,D,E]),_e=(0,s.useMemo)(()=>q.timeline||[],[q.timeline]),Ae=(0,s.useCallback)(async e=>{if(!V){W(!0);try{const t={...q,timeline:e,last_updated:(new Date).toISOString()};return J(t),z(e=>{const a=e.cases.map(e=>String(e.id)===String(null===_||void 0===_?void 0:_.id)?{...e,...t}:e),s={...e,cases:a};return D(s),s}),t}catch(t){console.error("Error updating timeline:",t),E("Failed to update timeline","error")}finally{W(!1)}}},[q,null===_||void 0===_?void 0:_.id,z,D,E,V]),Te=(0,s.useMemo)(()=>(null!==_&&void 0!==_&&_.id,{topics:[],literature:[],cases:[]}),[null===_||void 0===_?void 0:_.id]),Pe=[{id:"overview",label:"Overview",icon:o.A},{id:"narrative",label:"Narrative",icon:l.A},{id:"medications",label:"Medications",icon:n.A},{id:"therapy",label:"Therapy & Insights",icon:c.A},{id:"timeline",label:"Timeline",icon:d.A},{id:"related",label:"Related",icon:u.A}];return S?(0,O.jsx)(i.N,{mode:"wait",onExitComplete:()=>{F(!1),U(!1),G(!1),A(),P&&P()},children:R&&(0,O.jsx)(r.P.div,{initial:"hidden",animate:"visible",exit:"exit",variants:M,className:"fixed inset-0 bg-black flex items-center justify-center z-50",style:{willChange:"backdrop-filter, opacity",backfaceVisibility:"hidden",transform:"translate3d(0, 0, 0)"},onClick:e=>e.target===e.currentTarget&&me(),children:(0,O.jsxs)(r.P.div,{initial:"hidden",animate:"visible",exit:"exit",variants:I,className:"bg-white rounded-2xl shadow-2xl max-w-4xl w-full mx-4 max-h-[85vh] overflow-hidden",style:{willChange:"transform, opacity, scale",backfaceVisibility:"hidden"},onClick:e=>e.stopPropagation(),onAnimationStart:()=>{F(!0),T&&T()},onAnimationComplete:()=>{F(!1),P&&P()},children:[(0,O.jsxs)(r.P.div,{initial:"hidden",animate:"visible",exit:"exit",variants:L,className:"bg-gradient-to-br from-slate-900 to-slate-800 text-white px-6 py-4 flex items-center justify-between",children:[(0,O.jsxs)("div",{className:"flex items-center gap-3",children:[(0,O.jsx)(o.A,{size:24}),(0,O.jsx)("h2",{className:"text-xl font-semibold",children:"Case Details"})]}),(0,O.jsx)("button",{onClick:me,className:"text-slate-400 hover:text-white transition-colors",children:(0,O.jsx)(p.A,{size:24})})]}),(0,O.jsx)("div",{className:"bg-gradient-to-r from-slate-900 via-slate-800 to-slate-900 border-b border-slate-600",children:(0,O.jsx)("nav",{className:"flex flex-wrap gap-2 px-6 py-4",children:Pe.map(e=>{let{id:t,label:a,icon:s}=e;return(0,O.jsxs)(r.P.button,{onClick:()=>ge(t),className:"relative flex items-center gap-2 px-4 py-3 rounded-xl font-medium text-sm transition-all duration-300 "+(Q===t?"bg-gradient-to-r from-blue-500 to-indigo-600 text-white shadow-lg shadow-blue-500/25":"text-slate-300 hover:text-white hover:bg-slate-700/50 hover:shadow-md"),whileHover:{scale:Q===t?1:1.02},whileTap:{scale:.98},disabled:ee,children:[(0,O.jsx)(s,{size:16,className:Q===t?"drop-shadow-sm":""}),a,Q===t&&(0,O.jsx)(r.P.div,{layoutId:"caseActiveTab",className:"absolute inset-0 bg-gradient-to-r from-blue-400/20 to-indigo-500/20 rounded-xl blur-sm",initial:!1,transition:{duration:.3,ease:"easeOut"}})]},t)})})}),(0,O.jsx)(r.P.div,{className:"flex-1 bg-gradient-to-br from-slate-900 to-slate-800 overflow-hidden",animate:{opacity:ee?.7:1},transition:{duration:.2},children:(0,O.jsxs)(i.N,{mode:"wait",children:["overview"===Q&&(0,O.jsxs)(r.P.div,{ref:e=>ne.current.overview=e,initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{duration:.3},className:"h-full overflow-y-auto p-6 space-y-6",children:[(0,O.jsxs)(r.P.div,{variants:X,initial:"hidden",animate:"visible",className:"bg-slate-800/50 backdrop-blur-sm rounded-xl p-6 border border-slate-700",children:[(0,O.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,O.jsx)("h3",{className:"text-lg font-semibold text-white",children:"Case Information"}),(0,O.jsx)(r.P.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>be("basic_info"),className:"text-blue-400 hover:text-blue-300 transition-colors p-2 rounded-lg hover:bg-slate-700/50",title:"Edit case information",children:(0,O.jsx)(m.A,{size:16})})]}),ae.basic_info?(0,O.jsxs)("div",{className:"space-y-4",children:[(0,O.jsxs)("div",{children:[(0,O.jsx)("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Case Title/Label"}),(0,O.jsx)("input",{type:"text",value:(null===(t=ie.basic_info)||void 0===t?void 0:t.label)||q.label||q.title||"",onChange:e=>ye("basic_info","label",e.target.value),className:"w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-white placeholder-slate-400 focus:ring-2 focus:ring-blue-400 focus:border-blue-400",placeholder:"Enter case title/label"})]}),(0,O.jsxs)("div",{children:[(0,O.jsx)("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Primary Diagnosis"}),(0,O.jsx)("input",{type:"text",value:(null===(a=ie.basic_info)||void 0===a?void 0:a.primary_diagnosis)||q.primaryDiagnosis||q.primary_diagnosis||"",onChange:e=>ye("basic_info","primary_diagnosis",e.target.value),className:"w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-white placeholder-slate-400 focus:ring-2 focus:ring-blue-400 focus:border-blue-400",placeholder:"Enter primary diagnosis"})]}),(0,O.jsxs)("div",{children:[(0,O.jsx)("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Status"}),(0,O.jsxs)("select",{value:(null===(j=ie.basic_info)||void 0===j?void 0:j.status)||q.status||"active",onChange:e=>ye("basic_info","status",e.target.value),className:"w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-white focus:ring-2 focus:ring-blue-400 focus:border-blue-400",children:[(0,O.jsx)("option",{value:"active",children:"Active"}),(0,O.jsx)("option",{value:"archived",children:"Archived"}),(0,O.jsx)("option",{value:"follow_up",children:"Follow-up"}),(0,O.jsx)("option",{value:"completed",children:"Completed"})]})]}),(0,O.jsxs)("div",{className:"flex gap-2 justify-end",children:[(0,O.jsx)(r.P.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>ve("basic_info"),className:"px-4 py-2 bg-slate-600 text-white rounded-lg hover:bg-slate-500 transition-colors",children:"Cancel"}),(0,O.jsxs)(r.P.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>fe("basic_info"),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2",children:[(0,O.jsx)(h.A,{size:16}),"Save Changes"]})]})]}):(0,O.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,O.jsxs)("div",{children:[(0,O.jsx)("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Case Title/Label"}),(0,O.jsx)("div",{className:"text-white bg-slate-700/50 rounded-lg p-3",children:q.label||q.title||"Untitled case"})]}),(0,O.jsxs)("div",{children:[(0,O.jsx)("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Primary Diagnosis"}),(0,O.jsx)("div",{className:"text-white bg-slate-700/50 rounded-lg p-3",children:q.primaryDiagnosis||q.primary_diagnosis||"No diagnosis specified"})]}),(0,O.jsxs)("div",{children:[(0,O.jsx)("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Status"}),(0,O.jsx)("div",{className:"text-white bg-slate-700/50 rounded-lg p-3",children:q.status||"Active"})]})]})]}),(0,O.jsxs)(r.P.div,{variants:X,initial:"hidden",animate:"visible",className:"bg-slate-800/50 backdrop-blur-sm rounded-xl p-6 border border-slate-700",children:[(0,O.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,O.jsx)("h4",{className:"text-lg font-semibold text-white",children:"Chief Complaint"}),(0,O.jsx)(r.P.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>be("chief_complaint"),className:"text-blue-400 hover:text-blue-300 transition-colors p-2 rounded-lg hover:bg-slate-700/50",title:"Edit chief complaint",children:(0,O.jsx)(m.A,{size:16})})]}),ae.chief_complaint?(0,O.jsxs)("div",{className:"space-y-4",children:[(0,O.jsx)("textarea",{value:(null===(w=ie.chief_complaint)||void 0===w?void 0:w.content)||q.chiefComplaint||q.chief_complaint||"",onChange:e=>ye("chief_complaint","content",e.target.value),rows:4,className:"w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-white placeholder-slate-400 focus:ring-2 focus:ring-blue-400 focus:border-blue-400",placeholder:"Enter chief complaint..."}),(0,O.jsxs)("div",{className:"flex gap-2 justify-end",children:[(0,O.jsx)(r.P.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>ve("chief_complaint"),className:"px-4 py-2 bg-slate-600 text-white rounded-lg hover:bg-slate-500 transition-colors",children:"Cancel"}),(0,O.jsxs)(r.P.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>fe("chief_complaint"),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2",children:[(0,O.jsx)(h.A,{size:16}),"Save Changes"]})]})]}):(0,O.jsx)("div",{className:"text-slate-300 leading-relaxed bg-slate-700/30 rounded-lg p-4",children:q.chiefComplaint||q.chief_complaint||"No chief complaint documented"})]}),(0,O.jsxs)(r.P.div,{variants:X,initial:"hidden",animate:"visible",className:"bg-slate-800/50 backdrop-blur-sm rounded-xl p-6 border border-slate-700",children:[(0,O.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,O.jsx)("h4",{className:"text-lg font-semibold text-white",children:"Initial Presentation"}),(0,O.jsx)(r.P.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>be("initial_presentation"),className:"text-blue-400 hover:text-blue-300 transition-colors p-2 rounded-lg hover:bg-slate-700/50",title:"Edit initial presentation",children:(0,O.jsx)(m.A,{size:16})})]}),ae.initial_presentation?(0,O.jsxs)("div",{className:"space-y-4",children:[(0,O.jsx)("textarea",{value:(null===(N=ie.initial_presentation)||void 0===N?void 0:N.content)||q.initialPresentation||q.initial_presentation||"",onChange:e=>ye("initial_presentation","content",e.target.value),rows:4,className:"w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-white placeholder-slate-400 focus:ring-2 focus:ring-blue-400 focus:border-blue-400",placeholder:"Enter initial presentation details..."}),(0,O.jsxs)("div",{className:"flex gap-2 justify-end",children:[(0,O.jsx)(r.P.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>ve("initial_presentation"),className:"px-4 py-2 bg-slate-600 text-white rounded-lg hover:bg-slate-500 transition-colors",children:"Cancel"}),(0,O.jsxs)(r.P.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>fe("initial_presentation"),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2",children:[(0,O.jsx)(h.A,{size:16}),"Save Changes"]})]})]}):(0,O.jsx)("div",{className:"text-slate-300 leading-relaxed bg-slate-700/30 rounded-lg p-4",children:q.initialPresentation||q.initial_presentation||"No initial presentation documented"})]}),(0,O.jsxs)("div",{className:"text-xs text-slate-500 text-right",children:["Last updated: ",q.last_updated?new Date(q.last_updated).toLocaleString():"Never"]})]},"overview"),"narrative"===Q&&(0,O.jsx)(r.P.div,{ref:e=>ne.current.narrative=e,initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{duration:.3},className:"h-full overflow-y-auto p-6 space-y-6",children:(0,O.jsxs)(r.P.div,{variants:X,animate:ae.narrative?"edit":"visible",className:"bg-slate-800/50 backdrop-blur-sm rounded-xl p-6 border border-slate-700",children:[(0,O.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,O.jsxs)("h3",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[(0,O.jsx)(l.A,{size:20,className:"text-blue-400"}),"Narrative Summary"]}),!ae.narrative&&(0,O.jsx)(r.P.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:()=>je("narrative"),className:"text-slate-400 hover:text-white transition-colors p-1 rounded",title:"Edit narrative summary",children:(0,O.jsx)(m.A,{size:16})})]}),ae.narrative?(0,O.jsxs)(r.P.div,{className:"space-y-4",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},children:[(0,O.jsx)("textarea",{value:(null===(k=ie.narrative)||void 0===k?void 0:k.narrative_summary)||q.narrative_summary||"",onChange:e=>ke("narrative","narrative_summary",e.target.value),rows:8,className:"w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-3 text-white placeholder-slate-400 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 resize-none",placeholder:"Enter the narrative summary for this case..."}),(0,O.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,O.jsx)(r.P.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>we("narrative"),className:"px-3 py-2 text-slate-300 hover:text-white border border-slate-600 rounded-lg hover:bg-slate-700 transition-colors text-sm",children:"Cancel"}),(0,O.jsxs)(r.P.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>Ne("narrative"),disabled:V,className:"px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm flex items-center gap-2",children:[V?(0,O.jsx)(x.A,{size:14,className:"animate-spin"}):(0,O.jsx)(h.A,{size:14}),"Save"]})]})]}):(0,O.jsx)(r.P.div,{className:"text-slate-300 leading-relaxed cursor-pointer hover:bg-slate-700/20 rounded-lg p-4 transition-colors",whileHover:{scale:1.01},transition:{duration:.2},onClick:()=>je("narrative"),children:q.narrative_summary||(0,O.jsx)("span",{className:"text-slate-500 italic",children:"Click to add narrative summary..."})})]})},"narrative"),"medications"===Q&&(0,O.jsx)(r.P.div,{ref:e=>ne.current.medications=e,initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{duration:.3},className:"h-full overflow-y-auto p-6 space-y-6",children:(0,O.jsxs)(r.P.div,{variants:X,initial:"hidden",animate:"visible",className:"bg-slate-800/50 backdrop-blur-sm rounded-xl p-6 border border-slate-700",children:[(0,O.jsxs)("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[(0,O.jsx)(n.A,{size:20,className:"text-green-400"}),"Current Medications"]}),(0,O.jsx)("div",{className:"space-y-4 mb-6",children:(0,O.jsx)(i.N,{children:(q.medications||[]).map((e,t)=>(0,O.jsx)(r.P.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},className:"bg-green-600/10 border border-green-600/20 rounded-lg p-4 group hover:bg-green-600/15 transition-colors",children:(0,O.jsxs)("div",{className:"flex items-start justify-between",children:[(0,O.jsxs)("div",{className:"flex-1",children:[(0,O.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,O.jsx)("h4",{className:"font-semibold text-green-300",children:e.name}),e.dosage&&(0,O.jsx)("span",{className:"text-xs bg-green-600/20 text-green-300 px-2 py-1 rounded",children:e.dosage})]}),(0,O.jsxs)("div",{className:"space-y-1 text-sm text-slate-300",children:[e.frequency&&(0,O.jsxs)("div",{className:"flex items-center gap-2",children:[(0,O.jsx)(d.A,{size:14,className:"text-green-400"}),(0,O.jsxs)("span",{children:["Frequency: ",e.frequency]})]}),e.effect&&(0,O.jsxs)("div",{className:"flex items-center gap-2",children:[(0,O.jsx)(g.A,{size:14,className:"text-green-400"}),(0,O.jsxs)("span",{children:["Effect: ",e.effect]})]}),e.dateAdded&&(0,O.jsxs)("div",{className:"flex items-center gap-2",children:[(0,O.jsx)(b.A,{size:14,className:"text-green-400"}),(0,O.jsxs)("span",{children:["Added: ",new Date(e.dateAdded).toLocaleDateString()]})]})]})]}),(0,O.jsx)(r.P.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:()=>Se(e.id),className:"text-green-400 hover:text-green-200 opacity-0 group-hover:opacity-100 transition-opacity p-1 rounded",title:"Remove medication",children:(0,O.jsx)(y.A,{size:16})})]})},e.id||t))})}),ue?(0,O.jsxs)(r.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-slate-700/30 rounded-lg p-4 space-y-4",children:[(0,O.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,O.jsxs)("div",{children:[(0,O.jsxs)("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:["Medication Name ",(0,O.jsx)("span",{className:"text-red-400",children:"*"})]}),(0,O.jsx)("input",{type:"text",value:ce.name,onChange:e=>de(t=>({...t,name:e.target.value})),className:"w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-white placeholder-slate-400 focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"Enter medication name"})]}),(0,O.jsxs)("div",{children:[(0,O.jsx)("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Dosage"}),(0,O.jsx)("input",{type:"text",value:ce.dosage,onChange:e=>de(t=>({...t,dosage:e.target.value})),className:"w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-white placeholder-slate-400 focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"e.g., 50mg"})]})]}),(0,O.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,O.jsxs)("div",{children:[(0,O.jsx)("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Frequency"}),(0,O.jsx)("input",{type:"text",value:ce.frequency,onChange:e=>de(t=>({...t,frequency:e.target.value})),className:"w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-white placeholder-slate-400 focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"e.g., Once daily"})]}),(0,O.jsxs)("div",{children:[(0,O.jsx)("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Effect/Notes"}),(0,O.jsx)("input",{type:"text",value:ce.effect,onChange:e=>de(t=>({...t,effect:e.target.value})),className:"w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-white placeholder-slate-400 focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"e.g., Improved mood"})]})]}),(0,O.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,O.jsx)(r.P.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>{pe(!1),de({name:"",dosage:"",frequency:"",effect:""})},className:"px-4 py-2 text-slate-300 hover:text-white border border-slate-600 rounded-lg hover:bg-slate-700 transition-colors",children:"Cancel"}),(0,O.jsxs)(r.P.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:Ce,disabled:!ce.name.trim(),className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[(0,O.jsx)(v.A,{size:16}),"Add Medication"]})]})]}):(0,O.jsxs)(r.P.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>pe(!0),className:"w-full flex items-center justify-center gap-2 p-4 border-2 border-dashed border-green-600/30 rounded-lg text-green-400 hover:border-green-600/50 hover:bg-green-600/5 transition-colors",children:[(0,O.jsx)(v.A,{size:16}),"Add New Medication"]}),0===(q.medications||[]).length&&!ue&&(0,O.jsx)("p",{className:"text-slate-500 italic text-center py-8",children:"No medications documented yet"})]})},"medications"),"therapy"===Q&&(0,O.jsx)(r.P.div,{ref:e=>ne.current.therapy=e,initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{duration:.3},className:"h-full overflow-y-auto p-6 space-y-6",children:(0,O.jsxs)(r.P.div,{variants:X,animate:ae.therapeutic_highlights?"edit":"visible",className:"bg-slate-800/50 backdrop-blur-sm rounded-xl p-6 border border-slate-700",children:[(0,O.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,O.jsxs)("h3",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[(0,O.jsx)(c.A,{size:20,className:"text-purple-400"}),"Therapeutic Highlights"]}),!ae.therapeutic_highlights&&(0,O.jsx)(r.P.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:()=>je("therapeutic_highlights"),className:"text-slate-400 hover:text-white transition-colors p-1 rounded",title:"Edit therapeutic highlights",children:(0,O.jsx)(m.A,{size:16})})]}),ae.therapeutic_highlights?(0,O.jsxs)(r.P.div,{className:"space-y-4",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},children:[(0,O.jsx)("textarea",{value:(null===(C=ie.therapeutic_highlights)||void 0===C?void 0:C.therapeutic_highlights)||q.therapeutic_highlights||"",onChange:e=>ke("therapeutic_highlights","therapeutic_highlights",e.target.value),rows:10,className:"w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-3 text-white placeholder-slate-400 focus:ring-2 focus:ring-purple-500 focus:border-purple-500 resize-none",placeholder:"Enter key therapeutic moments, insights, breakthroughs, or notes on therapy process..."}),(0,O.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,O.jsx)(r.P.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>we("therapeutic_highlights"),className:"px-3 py-2 text-slate-300 hover:text-white border border-slate-600 rounded-lg hover:bg-slate-700 transition-colors text-sm",children:"Cancel"}),(0,O.jsxs)(r.P.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>Ne("therapeutic_highlights"),disabled:V,className:"px-3 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors text-sm flex items-center gap-2",children:[V?(0,O.jsx)(x.A,{size:14,className:"animate-spin"}):(0,O.jsx)(h.A,{size:14}),"Save"]})]})]}):(0,O.jsx)(r.P.div,{className:"text-slate-300 leading-relaxed cursor-pointer hover:bg-slate-700/20 rounded-lg p-4 transition-colors min-h-[200px]",whileHover:{scale:1.01},transition:{duration:.2},onClick:()=>je("therapeutic_highlights"),children:q.therapeutic_highlights?(0,O.jsx)("div",{className:"whitespace-pre-wrap",children:q.therapeutic_highlights}):(0,O.jsx)("span",{className:"text-slate-500 italic",children:"Click to add therapeutic highlights, key moments, insights, breakthroughs, or therapy process notes..."})})]})},"therapy"),"timeline"===Q&&(0,O.jsx)(r.P.div,{ref:e=>ne.current.timeline=e,initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{duration:.3},className:"h-full overflow-hidden",children:(0,O.jsx)($,{caseId:null===_||void 0===_?void 0:_.id,initialEntries:_e,onEntryUpdate:Ae,onEntryAdd:e=>{const t=[..._e,e];Ae(t)},onEntryDelete:e=>{const t=_e.filter(t=>t.id!==e);Ae(t)},width:600,height:400})},"timeline"),"related"===Q&&(0,O.jsx)(r.P.div,{ref:e=>ne.current.related=e,initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{duration:.3},className:"h-full overflow-y-auto p-6 space-y-6",children:(0,O.jsxs)(r.P.div,{variants:X,initial:"hidden",animate:"visible",className:"bg-slate-800/50 backdrop-blur-sm rounded-xl p-6 border border-slate-700",children:[(0,O.jsxs)("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[(0,O.jsx)(u.A,{size:20,className:"text-cyan-400"}),"Connected Nodes"]}),(0,O.jsxs)("div",{className:"mb-6",children:[(0,O.jsxs)("h4",{className:"text-md font-medium text-slate-300 mb-3 flex items-center gap-2",children:[(0,O.jsx)(c.A,{size:16,className:"text-blue-400"}),"Related Topics"]}),Te.topics.length>0?(0,O.jsx)("div",{className:"space-y-2",children:Te.topics.map((e,t)=>(0,O.jsxs)("div",{className:"flex items-center gap-3 p-3 bg-blue-600/10 border border-blue-600/20 rounded-lg",children:[(0,O.jsx)(c.A,{size:16,className:"text-blue-400"}),(0,O.jsx)("span",{className:"text-blue-300",children:e.title})]},t))}):(0,O.jsx)("p",{className:"text-slate-500 italic text-sm",children:"No connected topics"})]}),(0,O.jsxs)("div",{className:"mb-6",children:[(0,O.jsxs)("h4",{className:"text-md font-medium text-slate-300 mb-3 flex items-center gap-2",children:[(0,O.jsx)(f.A,{size:16,className:"text-purple-400"}),"Related Literature"]}),Te.literature.length>0?(0,O.jsx)("div",{className:"space-y-2",children:Te.literature.map((e,t)=>(0,O.jsxs)("div",{className:"flex items-center gap-3 p-3 bg-purple-600/10 border border-purple-600/20 rounded-lg",children:[(0,O.jsx)(f.A,{size:16,className:"text-purple-400"}),(0,O.jsx)("span",{className:"text-purple-300",children:e.title})]},t))}):(0,O.jsx)("p",{className:"text-slate-500 italic text-sm",children:"No connected literature"})]}),(0,O.jsxs)("div",{children:[(0,O.jsxs)("h4",{className:"text-md font-medium text-slate-300 mb-3 flex items-center gap-2",children:[(0,O.jsx)(o.A,{size:16,className:"text-green-400"}),"Related Cases"]}),Te.cases.length>0?(0,O.jsx)("div",{className:"space-y-2",children:Te.cases.map((e,t)=>(0,O.jsxs)("div",{className:"flex items-center gap-3 p-3 bg-green-600/10 border border-green-600/20 rounded-lg",children:[(0,O.jsx)(o.A,{size:16,className:"text-green-400"}),(0,O.jsx)("span",{className:"text-green-300",children:e.title})]},t))}):(0,O.jsx)("p",{className:"text-slate-500 italic text-sm",children:"No connected cases"})]}),(0,O.jsx)("div",{className:"mt-6 p-4 bg-slate-700/20 rounded-lg border border-slate-600",children:(0,O.jsx)("p",{className:"text-slate-400 text-sm italic",children:"Connected nodes will be automatically populated based on mind map relationships and connections created in the graph view."})})]})},"related")]})})]})},`case-modal-${(null===_||void 0===_?void 0:_.id)||"default"}`)}):null}}},t={};function a(s){var i=t[s];if(void 0!==i)return i.exports;var r=t[s]={id:s,loaded:!1,exports:{}};return e[s](r,r.exports,a),r.loaded=!0,r.exports}a.m=e,(()=>{var e=[];a.O=(t,s,i,r)=>{if(!s){var o=1/0;for(d=0;d<e.length;d++){s=e[d][0],i=e[d][1],r=e[d][2];for(var l=!0,n=0;n<s.length;n++)(!1&r||o>=r)&&Object.keys(a.O).every(e=>a.O[e](s[n]))?s.splice(n--,1):(l=!1,r<o&&(o=r));if(l){e.splice(d--,1);var c=i();void 0!==c&&(t=c)}}return t}r=r||0;for(var d=e.length;d>0&&e[d-1][2]>r;d--)e[d]=e[d-1];e[d]=[s,i,r]}})(),(()=>{var e,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__;a.t=function(s,i){if(1&i&&(s=this(s)),8&i)return s;if("object"===typeof s&&s){if(4&i&&s.__esModule)return s;if(16&i&&"function"===typeof s.then)return s}var r=Object.create(null);a.r(r);var o={};e=e||[null,t({}),t([]),t(t)];for(var l=2&i&&s;("object"==typeof l||"function"==typeof l)&&!~e.indexOf(l);l=t(l))Object.getOwnPropertyNames(l).forEach(e=>o[e]=()=>s[e]);return o.default=()=>s,a.d(r,o),r}})(),a.d=(e,t)=>{for(var s in t)a.o(t,s)&&!a.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},a.f={},a.e=e=>Promise.all(Object.keys(a.f).reduce((t,s)=>(a.f[s](e,t),t),[])),a.u=e=>"static/js/"+e+"."+{213:"953ef4c7",261:"de3004f3",524:"7d493d91"}[e]+".chunk.js",a.miniCssF=e=>{},a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={},t="frontend:";a.l=(s,i,r,o)=>{if(e[s])e[s].push(i);else{var l,n;if(void 0!==r)for(var c=document.getElementsByTagName("script"),d=0;d<c.length;d++){var u=c[d];if(u.getAttribute("src")==s||u.getAttribute("data-webpack")==t+r){l=u;break}}l||(n=!0,(l=document.createElement("script")).charset="utf-8",l.timeout=120,a.nc&&l.setAttribute("nonce",a.nc),l.setAttribute("data-webpack",t+r),l.src=s),e[s]=[i];var p=(t,a)=>{l.onerror=l.onload=null,clearTimeout(m);var i=e[s];if(delete e[s],l.parentNode&&l.parentNode.removeChild(l),i&&i.forEach(e=>e(a)),t)return t(a)},m=setTimeout(p.bind(null,void 0,{type:"timeout",target:l}),12e4);l.onerror=p.bind(null,l.onerror),l.onload=p.bind(null,l.onload),n&&document.head.appendChild(l)}}})(),a.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),a.p="/",(()=>{var e={792:0};a.f.j=(t,s)=>{var i=a.o(e,t)?e[t]:void 0;if(0!==i)if(i)s.push(i[2]);else{var r=new Promise((a,s)=>i=e[t]=[a,s]);s.push(i[2]=r);var o=a.p+a.u(t),l=new Error;a.l(o,s=>{if(a.o(e,t)&&(0!==(i=e[t])&&(e[t]=void 0),i)){var r=s&&("load"===s.type?"missing":s.type),o=s&&s.target&&s.target.src;l.message="Loading chunk "+t+" failed.\n("+r+": "+o+")",l.name="ChunkLoadError",l.type=r,l.request=o,i[1](l)}},"chunk-"+t,t)}},a.O.j=t=>0===e[t];var t=(t,s)=>{var i,r,o=s[0],l=s[1],n=s[2],c=0;if(o.some(t=>0!==e[t])){for(i in l)a.o(l,i)&&(a.m[i]=l[i]);if(n)var d=n(a)}for(t&&t(s);c<o.length;c++)r=o[c],a.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return a.O(d)},s=self.webpackChunkfrontend=self.webpackChunkfrontend||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})();var s=a.O(void 0,[967,497,96],()=>a(3005));s=a.O(s)})();
//# sourceMappingURL=main.33a189a2.js.map