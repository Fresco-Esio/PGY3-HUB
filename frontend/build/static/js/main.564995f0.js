(()=>{"use strict";var e={8806:(e,t,s)=>{var a=s(5043),i=s(4391),r=(s(411),s(6213)),o=s(3546),l=s(7845),n=s(7782),c=s(6833),d=s(7819),u=s(7856),p=s(2024),m=s(614),x=s(6382),h=s(9350),g=s(5088),b=s(7118),y=s(8646),v=s(9917),f=s(2626),j=s(5469),N=s(1360),w=s(1680),k=s(8693),C=s(9292),S=s(2054),A=s(1827),O=s(2119),_=s(3528),z=s(4596),P=s(9855),T=s(5087),D=s(579);const E=e=>{let{message:t="Loading..."}=e;return(0,D.jsx)("div",{className:"flex items-center justify-center p-8",children:(0,D.jsxs)("div",{className:"flex flex-col items-center gap-2",children:[(0,D.jsx)(p.A,{className:"w-6 h-6 animate-spin text-blue-600"}),(0,D.jsx)("span",{className:"text-sm text-gray-600",children:t})]})})},I=(0,a.lazy)(()=>Promise.all([s.e(96),s.e(261)]).then(s.bind(s,6261))),M=(0,a.lazy)(()=>Promise.all([s.e(96),s.e(524)]).then(s.bind(s,4524))),$=(0,a.lazy)(()=>Promise.all([s.e(96),s.e(213)]).then(s.bind(s,4213))),L=(e,t)=>s=>(0,D.jsx)(a.Suspense,{fallback:(0,D.jsx)(E,{message:t}),children:(0,D.jsx)(e,{...s})}),X=(L(I,"Loading editor..."),L(M,"Loading templates...")),R=L($,"Loading literature viewer...");var F=s(5440),B=s(780),Y=s(4918),H=s(6099),U=s(3165),J=s(9996),W=s(2382);const V={hidden:{opacity:0,scale:.3,y:50,rotate:-5},visible:{opacity:1,scale:1,y:0,rotate:0,transition:{type:"spring",damping:25,stiffness:300,duration:.6}},exit:{opacity:0,scale:.7,y:30,rotate:-3,transition:{type:"easeInOut",duration:.4}}},G={hidden:{opacity:0,backdropFilter:"blur(0px)"},visible:{opacity:1,backdropFilter:"blur(8px)",transition:{duration:.4,ease:"easeOut"}},exit:{opacity:0,backdropFilter:"blur(0px)",transition:{duration:.3,ease:"easeIn"}}},q={hidden:{opacity:0,y:20,scale:.95},visible:{opacity:1,y:0,scale:1,transition:{type:"easeOut",duration:.3,delay:.1}},exit:{opacity:0,y:-10,scale:1.02,transition:{type:"easeIn",duration:.2}}},K=e=>{let{isOpen:t,data:s,onClose:i,onAnimationStart:r,onAnimationEnd:l,setMindMapData:n,autoSaveMindMapData:c,addToast:u}=e;const[h,v]=(0,a.useState)(!1),[f,j]=(0,a.useState)(!1),[N,C]=(0,a.useState)(!1),[S,A]=(0,a.useState)(!1),[O,_]=(0,a.useState)({}),[T,E]=(0,a.useState)(!1),[I,M]=(0,a.useState)(!1),[$,L]=(0,a.useState)("overview"),[X,R]=(0,a.useState)(!1),[K,Q]=(0,a.useState)(null),Z=(0,a.useRef)(null);(0,a.useEffect)(()=>{t&&s&&!I?(j(!0),_({...s}),M(!0),v(!0),r&&r(),setTimeout(()=>{v(!1),l&&l()},600)):!t&&I&&M(!1)},[t,I,r,l]),(0,a.useEffect)(()=>{!(t&&s&&I)||S||T||X||h||_({...s})},[null===s||void 0===s?void 0:s.id,t,I,S,T,X,h]);const ee=(0,a.useMemo)(()=>[{id:1,date:"2024-01-15",time:"09:30 AM",type:"assessment",title:"Initial Assessment",summary:"Patient presented with symptoms of anxiety and depression.",details:"Comprehensive psychiatric evaluation completed. Patient reports increased anxiety over the past 3 months, difficulty sleeping, and decreased appetite. MSE reveals anxious mood, intact cognition, no psychotic features. PHQ-9 score: 14 (moderate depression). GAD-7 score: 12 (moderate anxiety).",author:"Dr. Smith",isNew:!1},{id:2,date:"2024-01-22",time:"02:15 PM",type:"medication",title:"Medication Adjustment",summary:"Started on Sertraline 50mg daily.",details:"After discussion of treatment options, patient agreed to trial of SSRI. Started Sertraline 50mg daily. Reviewed potential side effects including initial activation, GI upset. Plan to follow up in 2 weeks. Provided crisis resources and encouraged to call if any concerns.",author:"Dr. Smith",isNew:!1},{id:3,date:"2024-02-05",time:"11:00 AM",type:"followup",title:"Follow-up Visit",summary:"Patient reports mild improvement in mood.",details:"Patient tolerated medication well with minimal side effects. Reports improved energy and slightly better sleep. Still experiencing some anxiety symptoms. PHQ-9 score decreased to 10. Continue current medication, discussed therapy referral.",author:"Dr. Smith",isNew:!1},{id:4,date:"2024-02-19",time:"03:45 PM",type:"therapy",title:"Therapy Session",summary:"First CBT session completed.",details:"Initial therapy session with focus on psychoeducation about anxiety and depression. Introduced basic CBT concepts and breathing exercises. Patient engaged well and expressed motivation for therapy. Homework assigned: daily mood tracking and breathing practice.",author:"Sarah Johnson, LCSW",isNew:!0}],[]),te=(0,a.useCallback)(()=>{Z.current&&(Z.current.scrollTop=Z.current.scrollHeight)},[]),se=(0,a.useCallback)(e=>{Q(t=>t===e?null:e)},[]),ae=(0,a.useCallback)(()=>{h||N||(v(!0),C(!0),r&&r(),j(!1))},[r,h,N]),ie=(0,a.useCallback)(async()=>{if(!T){E(!0);try{n(e=>{const t=e.cases.map(e=>String(e.id)===String(null===s||void 0===s?void 0:s.id)?{...e,...O}:e),a={...e,cases:t};return c(a),a}),A(!1),u("Case updated successfully","success")}catch(e){console.error("Error saving case:",e),u("Failed to save case","error")}finally{E(!1)}}},[null===s||void 0===s?void 0:s.id,O,n,c,u,T]),re=(0,a.useCallback)(async()=>{if(!T&&window.confirm("Are you sure you want to delete this case?")){E(!0);try{n(e=>{const t=e.cases.filter(e=>String(e.id)!==String(null===s||void 0===s?void 0:s.id)),a={...e,cases:t};return c(a),a}),u("Case deleted successfully","success"),ae()}catch(e){console.error("Error deleting case:",e),u("Failed to delete case","error")}finally{E(!1)}}},[null===s||void 0===s?void 0:s.id,n,c,u,ae,T]),oe=(0,a.useCallback)((e,t)=>{_(s=>({...s,[e]:t}))},[]),le=function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"text",a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const i=O[t]||"";return S?"textarea"===s?(0,D.jsxs)("div",{className:"space-y-2",children:[(0,D.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:e}),(0,D.jsx)("textarea",{value:i,onChange:e=>oe(t,e.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors",rows:a.rows||3,placeholder:`Enter ${e.toLowerCase()}...`})]}):"select"===s&&a.choices?(0,D.jsxs)("div",{className:"space-y-2",children:[(0,D.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:e}),(0,D.jsxs)("select",{value:i,onChange:e=>oe(t,e.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors",children:[(0,D.jsxs)("option",{value:"",children:["Select ",e.toLowerCase(),"..."]}),a.choices.map(e=>(0,D.jsx)("option",{value:e,children:e},e))]})]}):(0,D.jsxs)("div",{className:"space-y-2",children:[(0,D.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:e}),(0,D.jsx)("input",{type:s,value:i,onChange:e=>oe(t,"number"===s?Number(e.target.value):e.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors",placeholder:`Enter ${e.toLowerCase()}...`})]}):"textarea"===s?(0,D.jsxs)("div",{className:"space-y-2",children:[(0,D.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:e}),(0,D.jsx)("div",{className:"p-3 bg-gray-50 rounded-lg border min-h-[2.5rem] text-gray-800",children:i||(0,D.jsx)("span",{className:"text-gray-400 italic",children:"Not specified"})})]}):(0,D.jsxs)("div",{className:"space-y-2",children:[(0,D.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:e}),(0,D.jsx)("div",{className:"p-3 bg-gray-50 rounded-lg border text-gray-800",children:i||(0,D.jsx)("span",{className:"text-gray-400 italic",children:"Not specified"})})]})};return t?(0,D.jsx)(o.N,{mode:"wait",onExitComplete:()=>{v(!1),C(!1),M(!1),i(),l&&l()},children:f&&(0,D.jsx)(F.P.div,{initial:"hidden",animate:"visible",exit:"exit",variants:G,className:"fixed inset-0 bg-black flex items-center justify-center z-50",style:{willChange:"backdrop-filter, opacity",backfaceVisibility:"hidden",transform:"translate3d(0, 0, 0)"},onClick:e=>e.target===e.currentTarget&&ae(),children:(0,D.jsxs)(F.P.div,{initial:"hidden",animate:"visible",exit:"exit",variants:V,className:"bg-white rounded-2xl shadow-2xl max-w-4xl w-full mx-4 max-h-[85vh] overflow-hidden",style:{willChange:"transform, opacity, scale",backfaceVisibility:"hidden"},onClick:e=>e.stopPropagation(),onAnimationStart:()=>{v(!0),r&&r()},onAnimationComplete:()=>{v(!1),l&&l()},children:[(0,D.jsxs)(F.P.div,{initial:"hidden",animate:"visible",exit:"exit",variants:q,className:"bg-gradient-to-r from-indigo-600 to-blue-600 text-white px-6 py-4 flex items-center justify-between",children:[(0,D.jsxs)("div",{className:"flex items-center gap-3",children:[(0,D.jsx)(b.A,{size:24}),(0,D.jsx)("h2",{className:"text-xl font-semibold",children:"Case Details"})]}),(0,D.jsxs)("div",{className:"flex items-center gap-2",children:[!S&&!T&&(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)("button",{onClick:()=>A(!0),className:"text-white hover:text-gray-200 p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-all",title:"Edit",children:(0,D.jsx)(z.A,{size:20})}),(0,D.jsx)("button",{onClick:re,className:"text-white hover:text-red-200 p-2 rounded-full hover:bg-red-500 hover:bg-opacity-30 transition-all",title:"Delete",children:(0,D.jsx)(P.A,{size:20})})]}),(0,D.jsx)("button",{onClick:ae,className:"text-white hover:text-gray-200 p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-all",children:(0,D.jsx)(m.A,{size:20})})]})]}),(0,D.jsx)("div",{className:"bg-gradient-to-r from-slate-900 via-slate-800 to-slate-900 border-b border-slate-600",children:(0,D.jsx)("nav",{className:"flex flex-wrap gap-2 px-6 py-4",children:[{key:"overview",label:"Overview",icon:b.A},{key:"narrative",label:"Narrative",icon:w.A},{key:"medications",label:"Medications",icon:B.A},{key:"therapy",label:"Therapy",icon:Y.A},{key:"timeline",label:"Timeline",icon:g.A},{key:"insights",label:"Insights",icon:H.A},{key:"related",label:"Related",icon:U.A}].map(e=>{let{key:t,label:s,icon:a}=e;return(0,D.jsxs)(F.P.button,{onClick:()=>{X||(R(!0),L(t),setTimeout(()=>R(!1),300))},className:"relative flex items-center gap-2 px-4 py-3 rounded-xl font-medium text-sm transition-all duration-300 "+($===t?"bg-gradient-to-r from-blue-500 to-indigo-600 text-white shadow-lg shadow-blue-500/25":"text-slate-300 hover:text-white hover:bg-slate-700/50 hover:shadow-md"),whileHover:{scale:$===t?1:1.02},whileTap:{scale:.98},initial:!1,animate:{scale:$===t?1.05:1,boxShadow:$===t?"0 8px 25px rgba(59, 130, 246, 0.3), 0 0 20px rgba(99, 102, 241, 0.2)":"0 2px 8px rgba(0, 0, 0, 0.1)"},transition:{duration:.3,ease:"easeOut"},children:[(0,D.jsx)(a,{size:16,className:$===t?"drop-shadow-sm":""}),s,"timeline"===t&&ee.some(e=>e.isNew)&&(0,D.jsx)("span",{className:"absolute -top-1 -right-1 inline-flex items-center justify-center w-4 h-4 text-xs font-bold text-white bg-red-500 rounded-full animate-pulse",children:"!"}),$===t&&(0,D.jsx)(F.P.div,{layoutId:"tabGlow",className:"absolute inset-0 bg-gradient-to-r from-blue-400/20 to-indigo-500/20 rounded-xl blur-sm",initial:!1,transition:{type:"spring",bounce:.2,duration:.6}})]},t)})})}),(0,D.jsx)(F.P.div,{className:"relative overflow-hidden bg-gradient-to-br from-slate-50 to-slate-100",layout:"position",layoutRoot:!0,transition:{layout:{duration:.4,ease:"easeInOut"},height:{duration:.4,ease:"easeInOut"}},children:(0,D.jsxs)(o.N,{mode:"wait",initial:!1,onExitComplete:()=>R(!1),children:["overview"===$&&(0,D.jsx)(F.P.div,{initial:{opacity:0,x:-30},animate:{opacity:1,x:0},exit:{opacity:0,x:30},transition:{duration:.4,ease:"easeOut"},layout:"position",layoutId:"tabContent",className:"p-6 overflow-y-auto max-h-[calc(85vh-200px)] scrollbar-thin scrollbar-thumb-slate-400 scrollbar-track-slate-200",children:(0,D.jsxs)("div",{className:"space-y-6",children:[(0,D.jsxs)("div",{className:"bg-white rounded-xl p-6 shadow-lg border border-slate-200",children:[(0,D.jsxs)("h3",{className:"text-lg font-semibold text-slate-800 mb-4 flex items-center gap-2",children:[(0,D.jsx)(b.A,{size:20,className:"text-blue-600"}),"Demographics & Basic Info"]}),(0,D.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[le("Case ID","case_id"),le("Primary Diagnosis","primary_diagnosis"),le("Age","age","number"),le("Gender","gender","select",{choices:["Male","Female","Non-binary","Other"]})]})]}),(0,D.jsxs)("div",{className:"bg-white rounded-xl p-6 shadow-lg border border-slate-200",children:[(0,D.jsxs)("h3",{className:"text-lg font-semibold text-slate-800 mb-4 flex items-center gap-2",children:[(0,D.jsx)(d.A,{size:20,className:"text-amber-600"}),"Initial Impressions"]}),(0,D.jsxs)("div",{className:"space-y-4",children:[le("Chief Complaint","chiefComplaint","textarea",{rows:3}),le("Initial Presentation","initialPresentation","textarea",{rows:4})]})]})]})},"overview"),"narrative"===$&&(0,D.jsx)(F.P.div,{initial:{opacity:0,x:-30},animate:{opacity:1,x:0},exit:{opacity:0,x:30},transition:{duration:.4,ease:"easeOut"},layout:"position",layoutId:"tabContent",className:"p-6 overflow-y-auto max-h-[calc(85vh-200px)] scrollbar-thin scrollbar-thumb-slate-400 scrollbar-track-slate-200",children:(0,D.jsxs)("div",{className:"bg-white rounded-xl p-6 shadow-lg border border-slate-200",children:[(0,D.jsxs)("h3",{className:"text-lg font-semibold text-slate-800 mb-4 flex items-center gap-2",children:[(0,D.jsx)(w.A,{size:20,className:"text-green-600"}),"Patient Story & Narrative"]}),(0,D.jsxs)("div",{className:"space-y-6",children:[le("Current Presentation","currentPresentation","textarea",{rows:8}),(0,D.jsx)("div",{className:"text-sm text-slate-600 bg-slate-50 p-4 rounded-lg",children:(0,D.jsx)("p",{className:"italic",children:"Use this space to tell the patient's story in your own words. Include context, progression, and your narrative understanding of their journey."})})]})]})},"narrative"),"timeline"===$&&(0,D.jsxs)(F.P.div,{initial:{opacity:0,x:-30},animate:{opacity:1,x:0},exit:{opacity:0,x:30},transition:{duration:.4,ease:"easeOut"},layout:"position",layoutId:"tabContent",className:"p-6 h-[calc(85vh-200px)]",children:[(0,D.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,D.jsx)("h3",{className:"text-lg font-semibold text-gray-800",children:"Case Timeline"}),(0,D.jsxs)(F.P.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:te,className:"flex items-center gap-2 px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm",children:[(0,D.jsx)(J.A,{size:16}),"Scroll to Latest"]})]}),(0,D.jsxs)("div",{className:"relative",children:[(0,D.jsx)("div",{className:"absolute top-0 left-0 right-0 h-6 bg-gradient-to-b from-white to-transparent z-10 pointer-events-none"}),(0,D.jsx)("div",{ref:Z,className:"max-h-96 overflow-y-auto bg-gradient-to-br from-slate-900 to-slate-800 rounded-xl p-4 space-y-4 scrollbar-thin scrollbar-thumb-slate-600 scrollbar-track-slate-800",style:{scrollbarWidth:"thin",scrollbarColor:"#475569 #1e293b"},children:ee.map((e,t)=>(0,D.jsxs)(F.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{delay:.1*t,duration:.4},className:"relative "+(e.isNew?"animate-pulse":""),children:[t<ee.length-1&&(0,D.jsx)("div",{className:"absolute left-6 top-12 w-0.5 h-16 bg-gradient-to-b from-blue-400 to-purple-500"}),(0,D.jsxs)(F.P.div,{whileHover:{scale:1.02,boxShadow:"0 10px 25px rgba(59, 130, 246, 0.15)"},whileTap:{scale:.98},onClick:()=>se(e.id),className:`relative bg-gradient-to-r from-slate-800 to-slate-700 rounded-lg p-4 cursor-pointer border-l-4 transition-all duration-300 ${"assessment"===e.type?"border-green-400":"medication"===e.type?"border-blue-400":"therapy"===e.type?"border-purple-400":"border-orange-400"} ${e.isNew?"ring-2 ring-blue-400 ring-opacity-50":""}`,children:[(0,D.jsxs)("div",{className:"flex items-start justify-between",children:[(0,D.jsxs)("div",{className:"flex items-start gap-3",children:[(0,D.jsxs)("div",{className:"flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center "+("assessment"===e.type?"bg-green-500":"medication"===e.type?"bg-blue-500":"therapy"===e.type?"bg-purple-500":"bg-orange-500"),children:["assessment"===e.type&&(0,D.jsx)(B.A,{size:16,className:"text-white"}),"medication"===e.type&&(0,D.jsx)(Y.A,{size:16,className:"text-white"}),"therapy"===e.type&&(0,D.jsx)(x.A,{size:16,className:"text-white"}),"followup"===e.type&&(0,D.jsx)(y.A,{size:16,className:"text-white"})]}),(0,D.jsxs)("div",{className:"flex-1",children:[(0,D.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,D.jsx)("h4",{className:"text-white font-semibold text-sm",children:e.title}),e.isNew&&(0,D.jsx)(F.P.span,{animate:{scale:[1,1.2,1],opacity:[.7,1,.7]},transition:{duration:2,repeat:1/0,ease:"easeInOut"},className:"inline-flex items-center px-2 py-1 text-xs font-medium bg-blue-500 text-white rounded-full",children:"New"})]}),(0,D.jsxs)("div",{className:"flex items-center gap-4 text-xs text-slate-300 mb-2",children:[(0,D.jsxs)("span",{className:"flex items-center gap-1",children:[(0,D.jsx)(y.A,{size:12}),e.date]}),(0,D.jsxs)("span",{className:"flex items-center gap-1",children:[(0,D.jsx)(g.A,{size:12}),e.time]}),(0,D.jsxs)("span",{children:["by ",e.author]})]}),(0,D.jsx)("p",{className:"text-slate-200 text-sm",children:e.summary})]})]}),(0,D.jsx)(F.P.div,{animate:{rotate:K===e.id?180:0},transition:{duration:.2},children:(0,D.jsx)(W.A,{size:20,className:"text-slate-400"})})]}),(0,D.jsx)(o.N,{children:K===e.id&&(0,D.jsx)(F.P.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3,ease:"easeInOut"},className:"overflow-hidden",children:(0,D.jsxs)("div",{className:"mt-4 pt-4 border-t border-slate-600",children:[(0,D.jsx)("h5",{className:"text-white font-medium text-sm mb-2",children:"Detailed Notes:"}),(0,D.jsx)("p",{className:"text-slate-300 text-sm leading-relaxed",children:e.details})]})})})]})]},e.id))}),(0,D.jsx)("div",{className:"absolute bottom-0 left-0 right-0 h-6 bg-gradient-to-t from-white to-transparent z-10 pointer-events-none"})]})]},"timeline")]})}),S&&(0,D.jsxs)("div",{className:"sticky bottom-0 bg-gray-50 border-t border-gray-200 px-6 py-4 flex items-center justify-between",children:[(0,D.jsx)("div",{className:"text-sm text-gray-500",children:"Changes will be auto-saved"}),(0,D.jsxs)("div",{className:"flex items-center gap-3",children:[(0,D.jsx)("button",{onClick:()=>{A(!1),_({...s})},disabled:T,className:"px-4 py-2 text-gray-600 hover:text-gray-800 border border-gray-300 rounded-lg hover:bg-gray-100 transition-colors",children:"Cancel"}),(0,D.jsxs)("button",{onClick:ie,disabled:T,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2",children:[T?(0,D.jsx)(p.A,{size:16,className:"animate-spin"}):(0,D.jsx)(k.A,{size:16}),T?"Saving...":"Save Changes"]})]})]})]})},`case-modal-${(null===s||void 0===s?void 0:s.id)||"default"}`)}):null},Q=a.memo(K,(e,t)=>{var s,a,i,r;return e.isOpen===t.isOpen&&(null===(s=e.data)||void 0===s?void 0:s.id)===(null===(a=t.data)||void 0===a?void 0:a.id)&&(null===(i=e.data)||void 0===i?void 0:i.updated_at)===(null===(r=t.data)||void 0===r?void 0:r.updated_at)});var Z=s(4919),ee=s(1161),te=s(8487),se=s(6210),ae=s(5347),ie=s(5258);const re={hidden:{opacity:0,scale:.3,y:50,rotate:-5},visible:{opacity:1,scale:1,y:0,rotate:0,transition:{type:"spring",damping:25,stiffness:300,duration:.6}},exit:{opacity:0,scale:.7,y:30,rotate:-3,transition:{type:"easeInOut",duration:.4}}},oe={hidden:{opacity:0,backdropFilter:"blur(0px)"},visible:{opacity:1,backdropFilter:"blur(8px)",transition:{duration:.4,ease:"easeOut"}},exit:{opacity:0,backdropFilter:"blur(0px)",transition:{duration:.3,ease:"easeIn"}}},le={hidden:{opacity:0,y:20,scale:.95},visible:{opacity:1,y:0,scale:1,transition:{type:"easeOut",duration:.3,delay:.1}},exit:{opacity:0,y:-10,scale:1.02,transition:{type:"easeIn",duration:.2}}},ne=e=>{let{isOpen:t,data:s,onClose:i,onAnimationStart:r,onAnimationEnd:l,setMindMapData:n,autoSaveMindMapData:c,addToast:d}=e;const[u,h]=(0,a.useState)(!1),[b,y]=(0,a.useState)(!1),[v,j]=(0,a.useState)(!1),[C,S]=(0,a.useState)(!1),[A,O]=(0,a.useState)({}),[_,T]=(0,a.useState)(!1),[E,I]=(0,a.useState)(!1),[M,$]=(0,a.useState)("overview"),[L,X]=(0,a.useState)(!1),[R,B]=(0,a.useState)(""),[Y,J]=(0,a.useState)(!1);(0,a.useEffect)(()=>{t&&s&&!E?(y(!0),O({...s,resources:s.resources||[],flashcard_count:s.flashcard_count||0,completed_flashcards:s.completed_flashcards||0}),I(!0),h(!0),r&&r(),setTimeout(()=>{h(!1),l&&l()},600)):!t&&E&&I(!1)},[t,E,r,l]),(0,a.useEffect)(()=>{!(t&&s&&E)||C||_||L||u||O({...s,resources:s.resources||[],flashcard_count:s.flashcard_count||0,completed_flashcards:s.completed_flashcards||0})},[null===s||void 0===s?void 0:s.id,t,E,C,_,L,u]);const W=(0,a.useMemo)(()=>{const e=A.flashcard_count||0,t=A.completed_flashcards||0;return e>0?Math.round(t/e*100):0},[A.flashcard_count,A.completed_flashcards]),V=(0,a.useCallback)(()=>{u||v||(h(!0),j(!0),r&&r(),y(!1))},[r,u,v]),G=(0,a.useCallback)(async()=>{if(!_){T(!0);try{n(e=>{const t=e.topics.map(e=>String(e.id)===String(null===s||void 0===s?void 0:s.id)?{...e,...A}:e),a={...e,topics:t};return c(a),a}),S(!1),d("Topic updated successfully","success")}catch(e){console.error("Error saving topic:",e),d("Failed to save topic","error")}finally{T(!1)}}},[null===s||void 0===s?void 0:s.id,A,n,c,d,_]),q=(0,a.useCallback)(async()=>{if(!_&&window.confirm("Are you sure you want to delete this topic?")){T(!0);try{n(e=>{const t=e.topics.filter(e=>String(e.id)!==String(null===s||void 0===s?void 0:s.id)),a={...e,topics:t};return c(a),a}),d("Topic deleted successfully","success"),V()}catch(e){console.error("Error deleting topic:",e),d("Failed to delete topic","error")}finally{T(!1)}}},[null===s||void 0===s?void 0:s.id,n,c,d,V,_]),K=(0,a.useCallback)((e,t)=>{O(s=>({...s,[e]:t}))},[]),Q=(0,a.useCallback)(()=>{if(!R.trim())return;const e=[...A.resources||[],R.trim()];K("resources",e),B(""),J(!1)},[R,A.resources,K]),ne=(0,a.useCallback)(e=>{const t=A.resources.filter((t,s)=>s!==e);K("resources",t)},[A.resources,K]),ce=function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"text",a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const i=A[t]||"";return C?"textarea"===s?(0,D.jsxs)("div",{className:"space-y-2",children:[(0,D.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:e}),(0,D.jsx)("textarea",{value:i,onChange:e=>K(t,e.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors",rows:a.rows||3,placeholder:`Enter ${e.toLowerCase()}...`})]}):"select"===s&&a.choices?(0,D.jsxs)("div",{className:"space-y-2",children:[(0,D.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:e}),(0,D.jsxs)("select",{value:i,onChange:e=>K(t,e.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors",children:[(0,D.jsxs)("option",{value:"",children:["Select ",e.toLowerCase(),"..."]}),a.choices.map(e=>(0,D.jsx)("option",{value:e,children:e},e))]})]}):(0,D.jsxs)("div",{className:"space-y-2",children:[(0,D.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:e}),(0,D.jsx)("input",{type:s,value:i,onChange:e=>K(t,"number"===s?Number(e.target.value):e.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors",placeholder:`Enter ${e.toLowerCase()}...`})]}):"textarea"===s?(0,D.jsxs)("div",{className:"space-y-2",children:[(0,D.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:e}),(0,D.jsx)("div",{className:"p-3 bg-gray-50 rounded-lg border min-h-[2.5rem] text-gray-800",children:i||(0,D.jsx)("span",{className:"text-gray-400 italic",children:"Not specified"})})]}):(0,D.jsxs)("div",{className:"space-y-2",children:[(0,D.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:e}),(0,D.jsx)("div",{className:"p-3 bg-gray-50 rounded-lg border text-gray-800",children:i||(0,D.jsx)("span",{className:"text-gray-400 italic",children:"Not specified"})})]})};return t?(0,D.jsx)(o.N,{mode:"wait",onExitComplete:()=>{h(!1),j(!1),I(!1),i(),l&&l()},children:b&&(0,D.jsx)(F.P.div,{initial:"hidden",animate:"visible",exit:"exit",variants:oe,className:"fixed inset-0 bg-black flex items-center justify-center z-50",style:{willChange:"backdrop-filter, opacity",backfaceVisibility:"hidden",transform:"translate3d(0, 0, 0)"},onClick:e=>e.target===e.currentTarget&&V(),children:(0,D.jsxs)(F.P.div,{initial:"hidden",animate:"visible",exit:"exit",variants:re,className:"bg-white rounded-2xl shadow-2xl max-w-4xl w-full mx-4 max-h-[85vh] overflow-hidden",style:{willChange:"transform, opacity, scale",backfaceVisibility:"hidden"},onClick:e=>e.stopPropagation(),onAnimationStart:()=>{h(!0),r&&r()},onAnimationComplete:()=>{h(!1),l&&l()},children:[(0,D.jsxs)(F.P.div,{initial:"hidden",animate:"visible",exit:"exit",variants:le,className:"bg-gradient-to-br from-slate-900 to-slate-800 text-white px-6 py-4 flex items-center justify-between",children:[(0,D.jsxs)("div",{className:"flex items-center gap-3",children:[(0,D.jsx)(f.A,{size:24}),(0,D.jsx)("h2",{className:"text-xl font-semibold",children:"Topic Details"})]}),(0,D.jsxs)("div",{className:"flex items-center gap-2",children:[!C&&!_&&(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)("button",{onClick:()=>S(!0),className:"text-white hover:text-gray-200 p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-all",title:"Edit",children:(0,D.jsx)(z.A,{size:20})}),(0,D.jsx)("button",{onClick:q,className:"text-white hover:text-red-200 p-2 rounded-full hover:bg-red-500 hover:bg-opacity-30 transition-all",title:"Delete",children:(0,D.jsx)(P.A,{size:20})})]}),(0,D.jsx)("button",{onClick:V,className:"text-white hover:text-gray-200 p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-all",children:(0,D.jsx)(m.A,{size:20})})]})]}),(0,D.jsx)("div",{className:"bg-gradient-to-r from-slate-900 via-slate-800 to-slate-900 border-b border-slate-600",children:(0,D.jsx)("nav",{className:"flex flex-wrap gap-2 px-6 py-4",children:[{key:"overview",label:"Overview",icon:f.A},{key:"progress",label:"Progress",icon:Z.A},{key:"resources",label:"Resources",icon:w.A},{key:"insights",label:"Insights",icon:ee.A},{key:"connections",label:"Connections",icon:te.A}].map(e=>{let{key:t,label:s,icon:a}=e;return(0,D.jsxs)(F.P.button,{onClick:()=>{L||(X(!0),$(t),setTimeout(()=>X(!1),300))},className:"relative flex items-center gap-2 px-4 py-3 rounded-xl font-medium text-sm transition-all duration-300 "+(M===t?"bg-gradient-to-r from-purple-500 to-indigo-600 text-white shadow-lg shadow-purple-500/25":"text-slate-300 hover:text-white hover:bg-slate-700/50 hover:shadow-md"),whileHover:{scale:M===t?1:1.02},whileTap:{scale:.98},initial:!1,animate:{scale:M===t?1.05:1,boxShadow:M===t?"0 8px 25px rgba(147, 51, 234, 0.3), 0 0 20px rgba(99, 102, 241, 0.2)":"0 2px 8px rgba(0, 0, 0, 0.1)"},transition:{duration:.3,ease:"easeOut"},children:[(0,D.jsx)(a,{size:16,className:M===t?"drop-shadow-sm":""}),s,M===t&&(0,D.jsx)(F.P.div,{layoutId:"topicTabGlow",className:"absolute inset-0 bg-gradient-to-r from-purple-400/20 to-indigo-500/20 rounded-xl blur-sm",initial:!1,transition:{type:"spring",bounce:.2,duration:.6}})]},t)})})}),(0,D.jsx)(F.P.div,{className:"relative overflow-hidden bg-gradient-to-br from-slate-50 to-slate-100",layout:"position",layoutRoot:!0,transition:{layout:{duration:.4,ease:"easeInOut"},height:{duration:.4,ease:"easeInOut"}},children:(0,D.jsxs)(o.N,{mode:"wait",initial:!1,onExitComplete:()=>X(!1),children:["overview"===M&&(0,D.jsx)(F.P.div,{initial:{opacity:0,x:-30},animate:{opacity:1,x:0},exit:{opacity:0,x:30},transition:{duration:.4,ease:"easeOut"},layout:"position",layoutId:"tabContent",className:"p-6 overflow-y-auto max-h-[calc(85vh-200px)] scrollbar-thin scrollbar-thumb-slate-400 scrollbar-track-slate-200",children:(0,D.jsxs)("div",{className:"space-y-6",children:[(0,D.jsxs)("div",{className:"bg-white rounded-xl p-6 shadow-lg border border-slate-200",children:[(0,D.jsxs)("h3",{className:"text-lg font-semibold text-slate-800 mb-4 flex items-center gap-2",children:[(0,D.jsx)(x.A,{size:20,className:"text-purple-600"}),"Topic Information"]}),(0,D.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[ce("Title","title"),ce("Category","category","select",{choices:["Mood Disorders","Anxiety Disorders","Psychotic Disorders","Personality Disorders","Substance Use Disorders","Neurodevelopmental Disorders","Trauma-Related Disorders","Eating Disorders","Sleep Disorders","Neurocognitive Disorders","Other"]})]}),(0,D.jsx)("div",{className:"mt-6",children:ce("Description","description","textarea",{rows:4})})]}),(0,D.jsxs)("div",{className:"bg-white rounded-xl p-6 shadow-lg border border-slate-200",children:[(0,D.jsxs)("h3",{className:"text-lg font-semibold text-slate-800 mb-4 flex items-center gap-2",children:[(0,D.jsx)(U.A,{size:20,className:"text-green-600"}),"Learning Progress"]}),(0,D.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[ce("Total Flashcards","flashcard_count","number"),ce("Completed Flashcards","completed_flashcards","number")]}),(0,D.jsxs)("div",{className:"mt-6",children:[(0,D.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,D.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Progress"}),(0,D.jsxs)("span",{className:"text-sm text-gray-500",children:[W,"%"]})]}),(0,D.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,D.jsx)(F.P.div,{className:"bg-gradient-to-r from-purple-500 to-indigo-600 h-2 rounded-full",initial:{width:0},animate:{width:`${W}%`},transition:{duration:.8,ease:"easeOut"}})})]})]})]})},"overview"),"progress"===M&&(0,D.jsx)(F.P.div,{initial:{opacity:0,x:-30},animate:{opacity:1,x:0},exit:{opacity:0,x:30},transition:{duration:.4,ease:"easeOut"},layout:"position",layoutId:"tabContent",className:"p-6 overflow-y-auto max-h-[calc(85vh-200px)] scrollbar-thin scrollbar-thumb-slate-400 scrollbar-track-slate-200",children:(0,D.jsxs)("div",{className:"bg-white rounded-xl p-6 shadow-lg border border-slate-200",children:[(0,D.jsxs)("h3",{className:"text-lg font-semibold text-slate-800 mb-6 flex items-center gap-2",children:[(0,D.jsx)(Z.A,{size:20,className:"text-blue-600"}),"Learning Analytics"]}),(0,D.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[(0,D.jsxs)(F.P.div,{whileHover:{scale:1.02},className:"bg-gradient-to-br from-green-50 to-emerald-50 p-4 rounded-lg border border-green-200",children:[(0,D.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,D.jsx)(se.A,{size:20,className:"text-green-600"}),(0,D.jsx)("span",{className:"font-medium text-green-800",children:"Completed"})]}),(0,D.jsx)("div",{className:"text-2xl font-bold text-green-700",children:A.completed_flashcards||0}),(0,D.jsx)("div",{className:"text-sm text-green-600",children:"flashcards mastered"})]}),(0,D.jsxs)(F.P.div,{whileHover:{scale:1.02},className:"bg-gradient-to-br from-blue-50 to-indigo-50 p-4 rounded-lg border border-blue-200",children:[(0,D.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,D.jsx)(g.A,{size:20,className:"text-blue-600"}),(0,D.jsx)("span",{className:"font-medium text-blue-800",children:"Remaining"})]}),(0,D.jsx)("div",{className:"text-2xl font-bold text-blue-700",children:Math.max(0,(A.flashcard_count||0)-(A.completed_flashcards||0))}),(0,D.jsx)("div",{className:"text-sm text-blue-600",children:"flashcards to review"})]}),(0,D.jsxs)(F.P.div,{whileHover:{scale:1.02},className:"bg-gradient-to-br from-purple-50 to-violet-50 p-4 rounded-lg border border-purple-200",children:[(0,D.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,D.jsx)(ae.A,{size:20,className:"text-purple-600"}),(0,D.jsx)("span",{className:"font-medium text-purple-800",children:"Progress"})]}),(0,D.jsxs)("div",{className:"text-2xl font-bold text-purple-700",children:[W,"%"]}),(0,D.jsx)("div",{className:"text-sm text-purple-600",children:"completion rate"})]})]}),(0,D.jsxs)("div",{className:"mb-6",children:[(0,D.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,D.jsx)("span",{className:"text-lg font-medium text-gray-800",children:"Overall Progress"}),(0,D.jsxs)("span",{className:"text-sm text-gray-500",children:[A.completed_flashcards||0," / ",A.flashcard_count||0]})]}),(0,D.jsx)("div",{className:"relative",children:(0,D.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-4",children:(0,D.jsx)(F.P.div,{className:"bg-gradient-to-r from-purple-500 via-blue-500 to-indigo-600 h-4 rounded-full flex items-center justify-end pr-2",initial:{width:0},animate:{width:`${W}%`},transition:{duration:1.2,ease:"easeOut"},children:W>10&&(0,D.jsxs)("span",{className:"text-xs font-bold text-white drop-shadow-sm",children:[W,"%"]})})})})]})]})},"progress"),"resources"===M&&(0,D.jsx)(F.P.div,{initial:{opacity:0,x:-30},animate:{opacity:1,x:0},exit:{opacity:0,x:30},transition:{duration:.4,ease:"easeOut"},layout:"position",layoutId:"tabContent",className:"p-6 overflow-y-auto max-h-[calc(85vh-200px)] scrollbar-thin scrollbar-thumb-slate-400 scrollbar-track-slate-200",children:(0,D.jsxs)("div",{className:"bg-white rounded-xl p-6 shadow-lg border border-slate-200",children:[(0,D.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,D.jsxs)("h3",{className:"text-lg font-semibold text-slate-800 flex items-center gap-2",children:[(0,D.jsx)(w.A,{size:20,className:"text-orange-600"}),"Learning Resources"]}),C&&(0,D.jsxs)("button",{onClick:()=>J(!Y),className:"flex items-center gap-2 px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm",children:[(0,D.jsx)(N.A,{size:16}),"Add Resource"]})]}),C&&Y&&(0,D.jsx)(F.P.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"mb-6 p-4 bg-blue-50 rounded-lg border border-blue-200",children:(0,D.jsxs)("div",{className:"flex gap-3",children:[(0,D.jsx)("input",{type:"text",value:R,onChange:e=>B(e.target.value),placeholder:"Enter resource URL or description...",className:"flex-1 p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",onKeyPress:e=>"Enter"===e.key&&Q()}),(0,D.jsx)("button",{onClick:Q,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Add"})]})}),(0,D.jsx)("div",{className:"space-y-3",children:A.resources&&A.resources.length>0?A.resources.map((e,t)=>(0,D.jsxs)(F.P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.1*t},className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg border",children:[(0,D.jsx)("span",{className:"text-gray-700",children:e}),C&&(0,D.jsx)("button",{onClick:()=>ne(t),className:"text-red-500 hover:text-red-700 p-1 rounded",children:(0,D.jsx)(m.A,{size:16})})]},t)):(0,D.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,D.jsx)(w.A,{size:48,className:"mx-auto mb-3 text-gray-300"}),(0,D.jsx)("p",{children:"No resources added yet"}),C&&(0,D.jsx)("p",{className:"text-sm mt-1",children:'Click "Add Resource" to get started'})]})})]})},"resources"),"insights"===M&&(0,D.jsx)(F.P.div,{initial:{opacity:0,x:-30},animate:{opacity:1,x:0},exit:{opacity:0,x:30},transition:{duration:.4,ease:"easeOut"},layout:"position",layoutId:"tabContent",className:"p-6 overflow-y-auto max-h-[calc(85vh-200px)] scrollbar-thin scrollbar-thumb-slate-400 scrollbar-track-slate-200",children:(0,D.jsxs)("div",{className:"bg-white rounded-xl p-6 shadow-lg border border-slate-200",children:[(0,D.jsxs)("h3",{className:"text-lg font-semibold text-slate-800 mb-6 flex items-center gap-2",children:[(0,D.jsx)(ee.A,{size:20,className:"text-yellow-600"}),"Learning Insights"]}),(0,D.jsxs)("div",{className:"space-y-4",children:[(0,D.jsx)(F.P.div,{whileHover:{scale:1.01},className:"p-4 bg-gradient-to-r from-yellow-50 to-amber-50 rounded-lg border border-yellow-200",children:(0,D.jsxs)("div",{className:"flex items-start gap-3",children:[(0,D.jsx)(H.A,{size:20,className:"text-yellow-600 mt-1"}),(0,D.jsxs)("div",{children:[(0,D.jsx)("h4",{className:"font-medium text-yellow-800 mb-1",children:"Study Recommendation"}),(0,D.jsx)("p",{className:"text-yellow-700 text-sm",children:"Based on your progress, consider reviewing foundational concepts before advancing to complex topics."})]})]})}),(0,D.jsx)(F.P.div,{whileHover:{scale:1.01},className:"p-4 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg border border-blue-200",children:(0,D.jsxs)("div",{className:"flex items-start gap-3",children:[(0,D.jsx)(x.A,{size:20,className:"text-blue-600 mt-1"}),(0,D.jsxs)("div",{children:[(0,D.jsx)("h4",{className:"font-medium text-blue-800 mb-1",children:"Learning Pattern"}),(0,D.jsx)("p",{className:"text-blue-700 text-sm",children:"You tend to perform better with visual learning materials. Consider adding more diagrams and charts."})]})]})}),(0,D.jsx)(F.P.div,{whileHover:{scale:1.01},className:"p-4 bg-gradient-to-r from-green-50 to-emerald-50 rounded-lg border border-green-200",children:(0,D.jsxs)("div",{className:"flex items-start gap-3",children:[(0,D.jsx)(U.A,{size:20,className:"text-green-600 mt-1"}),(0,D.jsxs)("div",{children:[(0,D.jsx)("h4",{className:"font-medium text-green-800 mb-1",children:"Next Steps"}),(0,D.jsx)("p",{className:"text-green-700 text-sm",children:"Focus on completing the remaining flashcards to solidify your understanding of this topic."})]})]})})]})]})},"insights"),"connections"===M&&(0,D.jsx)(F.P.div,{initial:{opacity:0,x:-30},animate:{opacity:1,x:0},exit:{opacity:0,x:30},transition:{duration:.4,ease:"easeOut"},layout:"position",layoutId:"tabContent",className:"p-6 overflow-y-auto max-h-[calc(85vh-200px)] scrollbar-thin scrollbar-thumb-slate-400 scrollbar-track-slate-200",children:(0,D.jsxs)("div",{className:"bg-white rounded-xl p-6 shadow-lg border border-slate-200",children:[(0,D.jsxs)("h3",{className:"text-lg font-semibold text-slate-800 mb-6 flex items-center gap-2",children:[(0,D.jsx)(te.A,{size:20,className:"text-indigo-600"}),"Related Content"]}),(0,D.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,D.jsx)(ie.A,{size:48,className:"mx-auto mb-3 text-gray-300"}),(0,D.jsx)("p",{children:"No connections found"}),(0,D.jsx)("p",{className:"text-sm mt-1",children:"Create connections by linking this topic to cases, tasks, or literature"})]})]})},"connections")]})}),C&&(0,D.jsxs)("div",{className:"sticky bottom-0 bg-gray-50 border-t border-gray-200 px-6 py-4 flex items-center justify-between",children:[(0,D.jsx)("div",{className:"text-sm text-gray-500",children:"Changes will be auto-saved"}),(0,D.jsxs)("div",{className:"flex items-center gap-3",children:[(0,D.jsx)("button",{onClick:()=>{S(!1),O({...s}),J(!1)},disabled:_,className:"px-4 py-2 text-gray-600 hover:text-gray-800 border border-gray-300 rounded-lg hover:bg-gray-100 transition-colors",children:"Cancel"}),(0,D.jsxs)("button",{onClick:G,disabled:_,className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors flex items-center gap-2",children:[_?(0,D.jsx)(p.A,{size:16,className:"animate-spin"}):(0,D.jsx)(k.A,{size:16}),_?"Saving...":"Save Changes"]})]})]})]})},`topic-modal-${(null===s||void 0===s?void 0:s.id)||"default"}`)}):null},ce=a.memo(ne,(e,t)=>{var s,a,i,r;return e.isOpen===t.isOpen&&(null===(s=e.data)||void 0===s?void 0:s.id)===(null===(a=t.data)||void 0===a?void 0:a.id)&&(null===(i=e.data)||void 0===i?void 0:i.updated_at)===(null===(r=t.data)||void 0===r?void 0:r.updated_at)});var de=s(1482),ue=s(7719),pe=s(4830),me=s(9340);const xe={hidden:{opacity:0,scale:.3,y:50,rotate:-5},visible:{opacity:1,scale:1,y:0,rotate:0,transition:{type:"spring",damping:25,stiffness:300,duration:.6}},exit:{opacity:0,scale:.7,y:30,rotate:-3,transition:{type:"easeInOut",duration:.4}}},he={hidden:{opacity:0,backdropFilter:"blur(0px)"},visible:{opacity:1,backdropFilter:"blur(8px)",transition:{duration:.4,ease:"easeOut"}},exit:{opacity:0,backdropFilter:"blur(0px)",transition:{duration:.3,ease:"easeIn"}}},ge={hidden:{opacity:0,y:20,scale:.95},visible:{opacity:1,y:0,scale:1,transition:{type:"easeOut",duration:.3,delay:.1}},exit:{opacity:0,y:-10,scale:1.02,transition:{type:"easeIn",duration:.2}}},be=e=>{var t;let{isOpen:s,data:i,onClose:r,onAnimationStart:l,onAnimationEnd:n,setMindMapData:c,autoSaveMindMapData:d,addToast:u}=e;const[x,h]=(0,a.useState)(!1),[b,f]=(0,a.useState)(!1),[j,N]=(0,a.useState)(!1),[C,S]=(0,a.useState)(!1),[A,O]=(0,a.useState)({}),[_,T]=(0,a.useState)(!1),[E,I]=(0,a.useState)(!1),[M,$]=(0,a.useState)("overview"),[L,X]=(0,a.useState)(!1);(0,a.useEffect)(()=>{s&&i&&!E?(f(!0),O({...i,status:i.status||"pending",priority:i.priority||"medium"}),I(!0),h(!0),l&&l(),setTimeout(()=>{h(!1),n&&n()},600)):!s&&E&&I(!1)},[s,E,l,n]),(0,a.useEffect)(()=>{!(s&&i&&E)||C||_||L||x||O({...i,status:i.status||"pending",priority:i.priority||"medium"})},[null===i||void 0===i?void 0:i.id,s,E,C,_,L,x]);const R=(0,a.useMemo)(()=>({low:{color:"green",label:"Low Priority",icon:de.A},medium:{color:"yellow",label:"Medium Priority",icon:de.A},high:{color:"red",label:"High Priority",icon:de.A},urgent:{color:"purple",label:"Urgent",icon:ue.A}}),[]),B=(0,a.useMemo)(()=>({pending:{color:"gray",label:"Pending",icon:g.A},in_progress:{color:"blue",label:"In Progress",icon:pe.A},completed:{color:"green",label:"Completed",icon:v.A},paused:{color:"orange",label:"Paused",icon:me.A}}),[]),Y=(0,a.useMemo)(()=>{if(!A.due_date)return!1;return new Date(A.due_date)<new Date&&"completed"!==A.status},[A.due_date,A.status]),H=(0,a.useCallback)(()=>{x||j||(h(!0),N(!0),l&&l(),f(!1))},[l,x,j]),J=(0,a.useCallback)(async()=>{if(!_){T(!0);try{c(e=>{const t=e.tasks.map(e=>String(e.id)===String(null===i||void 0===i?void 0:i.id)?{...e,...A}:e),s={...e,tasks:t};return d(s),s}),S(!1),u("Task updated successfully","success")}catch(e){console.error("Error saving task:",e),u("Failed to save task","error")}finally{T(!1)}}},[null===i||void 0===i?void 0:i.id,A,c,d,u,_]),W=(0,a.useCallback)(async()=>{if(!_&&window.confirm("Are you sure you want to delete this task?")){T(!0);try{c(e=>{const t=e.tasks.filter(e=>String(e.id)!==String(null===i||void 0===i?void 0:i.id)),s={...e,tasks:t};return d(s),s}),u("Task deleted successfully","success"),H()}catch(e){console.error("Error deleting task:",e),u("Failed to delete task","error")}finally{T(!1)}}},[null===i||void 0===i?void 0:i.id,c,d,u,H,_]),V=(0,a.useCallback)(e=>{O(t=>({...t,status:e}))},[]),G=(0,a.useCallback)((e,t)=>{O(s=>({...s,[e]:t}))},[]),q=function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"text",a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const i=A[t]||"";return C?"textarea"===s?(0,D.jsxs)("div",{className:"space-y-2",children:[(0,D.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:e}),(0,D.jsx)("textarea",{value:i,onChange:e=>G(t,e.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors",rows:a.rows||3,placeholder:`Enter ${e.toLowerCase()}...`})]}):"select"===s&&a.choices?(0,D.jsxs)("div",{className:"space-y-2",children:[(0,D.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:e}),(0,D.jsxs)("select",{value:i,onChange:e=>G(t,e.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors",children:[(0,D.jsxs)("option",{value:"",children:["Select ",e.toLowerCase(),"..."]}),a.choices.map(e=>(0,D.jsx)("option",{value:e.value,children:e.label},e.value))]})]}):"date"===s?(0,D.jsxs)("div",{className:"space-y-2",children:[(0,D.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:e}),(0,D.jsx)("input",{type:"date",value:i,onChange:e=>G(t,e.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors"})]}):(0,D.jsxs)("div",{className:"space-y-2",children:[(0,D.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:e}),(0,D.jsx)("input",{type:s,value:i,onChange:e=>G(t,"number"===s?Number(e.target.value):e.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors",placeholder:`Enter ${e.toLowerCase()}...`})]}):"textarea"===s?(0,D.jsxs)("div",{className:"space-y-2",children:[(0,D.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:e}),(0,D.jsx)("div",{className:"p-3 bg-gray-50 rounded-lg border min-h-[2.5rem] text-gray-800",children:i||(0,D.jsx)("span",{className:"text-gray-400 italic",children:"Not specified"})})]}):"select"===s?(0,D.jsxs)("div",{className:"space-y-2",children:[(0,D.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:e}),(0,D.jsx)("div",{className:"p-3 bg-gray-50 rounded-lg border text-gray-800",children:i||(0,D.jsx)("span",{className:"text-gray-400 italic",children:"Not specified"})})]}):"date"===s?(0,D.jsxs)("div",{className:"space-y-2",children:[(0,D.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:e}),(0,D.jsx)("div",{className:"p-3 bg-gray-50 rounded-lg border text-gray-800",children:i?new Date(i).toLocaleDateString():(0,D.jsx)("span",{className:"text-gray-400 italic",children:"Not set"})})]}):(0,D.jsxs)("div",{className:"space-y-2",children:[(0,D.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:e}),(0,D.jsx)("div",{className:"p-3 bg-gray-50 rounded-lg border text-gray-800",children:i||(0,D.jsx)("span",{className:"text-gray-400 italic",children:"Not specified"})})]})};return s?(0,D.jsx)(o.N,{mode:"wait",onExitComplete:()=>{h(!1),N(!1),I(!1),r(),n&&n()},children:b&&(0,D.jsx)(F.P.div,{initial:"hidden",animate:"visible",exit:"exit",variants:he,className:"fixed inset-0 bg-black flex items-center justify-center z-50",style:{willChange:"backdrop-filter, opacity",backfaceVisibility:"hidden",transform:"translate3d(0, 0, 0)"},onClick:e=>e.target===e.currentTarget&&H(),children:(0,D.jsxs)(F.P.div,{initial:"hidden",animate:"visible",exit:"exit",variants:xe,className:"bg-white rounded-2xl shadow-2xl max-w-4xl w-full mx-4 max-h-[85vh] overflow-hidden",style:{willChange:"transform, opacity, scale",backfaceVisibility:"hidden"},onClick:e=>e.stopPropagation(),onAnimationStart:()=>{h(!0),l&&l()},onAnimationComplete:()=>{h(!1),n&&n()},children:[(0,D.jsxs)(F.P.div,{initial:"hidden",animate:"visible",exit:"exit",variants:ge,className:"bg-gradient-to-br from-slate-900 to-slate-800 text-white px-6 py-4 flex items-center justify-between",children:[(0,D.jsxs)("div",{className:"flex items-center gap-3",children:[(0,D.jsx)(v.A,{size:24}),(0,D.jsx)("h2",{className:"text-xl font-semibold",children:"Task Details"}),Y&&(0,D.jsxs)(F.P.div,{animate:{scale:[1,1.1,1]},transition:{duration:1,repeat:1/0},className:"flex items-center gap-1 px-2 py-1 bg-red-500 rounded-full text-xs font-medium",children:[(0,D.jsx)(ue.A,{size:12}),"Overdue"]})]}),(0,D.jsxs)("div",{className:"flex items-center gap-2",children:[!C&&!_&&(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)("button",{onClick:()=>S(!0),className:"text-white hover:text-gray-200 p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-all",title:"Edit",children:(0,D.jsx)(z.A,{size:20})}),(0,D.jsx)("button",{onClick:W,className:"text-white hover:text-red-200 p-2 rounded-full hover:bg-red-500 hover:bg-opacity-30 transition-all",title:"Delete",children:(0,D.jsx)(P.A,{size:20})})]}),(0,D.jsx)("button",{onClick:H,className:"text-white hover:text-gray-200 p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-all",children:(0,D.jsx)(m.A,{size:20})})]})]}),(0,D.jsx)("div",{className:"bg-gradient-to-r from-slate-900 via-slate-800 to-slate-900 border-b border-slate-600",children:(0,D.jsx)("nav",{className:"flex flex-wrap gap-2 px-6 py-4",children:[{key:"overview",label:"Overview",icon:v.A},{key:"progress",label:"Progress",icon:Z.A},{key:"connections",label:"Connections",icon:te.A},{key:"details",label:"Details",icon:w.A}].map(e=>{let{key:t,label:s,icon:a}=e;return(0,D.jsxs)(F.P.button,{onClick:()=>{L||(X(!0),$(t),setTimeout(()=>X(!1),300))},className:"relative flex items-center gap-2 px-4 py-3 rounded-xl font-medium text-sm transition-all duration-300 "+(M===t?"bg-gradient-to-r from-emerald-500 to-teal-600 text-white shadow-lg shadow-emerald-500/25":"text-slate-300 hover:text-white hover:bg-slate-700/50 hover:shadow-md"),whileHover:{scale:M===t?1:1.02},whileTap:{scale:.98},initial:!1,animate:{scale:M===t?1.05:1,boxShadow:M===t?"0 8px 25px rgba(16, 185, 129, 0.3), 0 0 20px rgba(20, 184, 166, 0.2)":"0 2px 8px rgba(0, 0, 0, 0.1)"},transition:{duration:.3,ease:"easeOut"},children:[(0,D.jsx)(a,{size:16,className:M===t?"drop-shadow-sm":""}),s,M===t&&(0,D.jsx)(F.P.div,{layoutId:"taskTabGlow",className:"absolute inset-0 bg-gradient-to-r from-emerald-400/20 to-teal-500/20 rounded-xl blur-sm",initial:!1,transition:{type:"spring",bounce:.2,duration:.6}})]},t)})})}),(0,D.jsx)(F.P.div,{className:"relative overflow-hidden bg-gradient-to-br from-slate-50 to-slate-100",layout:"position",layoutRoot:!0,transition:{layout:{duration:.4,ease:"easeInOut"},height:{duration:.4,ease:"easeInOut"}},children:(0,D.jsxs)(o.N,{mode:"wait",initial:!1,onExitComplete:()=>X(!1),children:["overview"===M&&(0,D.jsx)(F.P.div,{initial:{opacity:0,x:-30},animate:{opacity:1,x:0},exit:{opacity:0,x:30},transition:{duration:.4,ease:"easeOut"},layout:"position",layoutId:"tabContent",className:"p-6 overflow-y-auto max-h-[calc(85vh-200px)] scrollbar-thin scrollbar-thumb-slate-400 scrollbar-track-slate-200",children:(0,D.jsxs)("div",{className:"space-y-6",children:[(0,D.jsxs)("div",{className:"bg-white rounded-xl p-6 shadow-lg border border-slate-200",children:[(0,D.jsxs)("h3",{className:"text-lg font-semibold text-slate-800 mb-4 flex items-center gap-2",children:[(0,D.jsx)(U.A,{size:20,className:"text-emerald-600"}),"Task Information"]}),(0,D.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[q("Title","title"),q("Priority","priority","select",{choices:[{value:"low",label:"Low Priority"},{value:"medium",label:"Medium Priority"},{value:"high",label:"High Priority"},{value:"urgent",label:"Urgent"}]})]}),(0,D.jsx)("div",{className:"mt-6",children:q("Description","description","textarea",{rows:4})})]}),(0,D.jsxs)("div",{className:"bg-white rounded-xl p-6 shadow-lg border border-slate-200",children:[(0,D.jsxs)("h3",{className:"text-lg font-semibold text-slate-800 mb-4 flex items-center gap-2",children:[(0,D.jsx)(g.A,{size:20,className:"text-blue-600"}),"Status & Timeline"]}),(0,D.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[q("Status","status","select",{choices:[{value:"pending",label:"Pending"},{value:"in_progress",label:"In Progress"},{value:"completed",label:"Completed"},{value:"paused",label:"Paused"}]}),q("Due Date","due_date","date")]}),(0,D.jsxs)("div",{className:"mt-6",children:[(0,D.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Quick Status Update"}),(0,D.jsx)("div",{className:"flex flex-wrap gap-3",children:Object.entries(B).map(e=>{let[t,s]=e;const a=s.icon,i=A.status===t;return(0,D.jsxs)(F.P.button,{onClick:()=>V(t),disabled:!C,whileHover:C?{scale:1.05}:{},whileTap:C?{scale:.95}:{},className:"flex items-center gap-2 px-4 py-2 rounded-lg font-medium text-sm transition-all "+(i?`bg-${s.color}-100 text-${s.color}-800 border-2 border-${s.color}-300`:"bg-gray-100 text-gray-600 border-2 border-gray-200 "+(C?"hover:bg-gray-200":"cursor-not-allowed opacity-50")),children:[(0,D.jsx)(a,{size:16}),s.label]},t)})})]})]})]})},"overview"),"progress"===M&&(0,D.jsx)(F.P.div,{initial:{opacity:0,x:-30},animate:{opacity:1,x:0},exit:{opacity:0,x:30},transition:{duration:.4,ease:"easeOut"},layout:"position",layoutId:"tabContent",className:"p-6 overflow-y-auto max-h-[calc(85vh-200px)] scrollbar-thin scrollbar-thumb-slate-400 scrollbar-track-slate-200",children:(0,D.jsxs)("div",{className:"bg-white rounded-xl p-6 shadow-lg border border-slate-200",children:[(0,D.jsxs)("h3",{className:"text-lg font-semibold text-slate-800 mb-6 flex items-center gap-2",children:[(0,D.jsx)(Z.A,{size:20,className:"text-blue-600"}),"Task Progress"]}),(0,D.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[(0,D.jsxs)(F.P.div,{whileHover:{scale:1.02},className:"p-4 rounded-lg border-2 "+("completed"===A.status?"bg-green-50 border-green-200":"bg-gray-50 border-gray-200"),children:[(0,D.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,D.jsx)(v.A,{size:20,className:"completed"===A.status?"text-green-600":"text-gray-400"}),(0,D.jsx)("span",{className:"font-medium "+("completed"===A.status?"text-green-800":"text-gray-600"),children:"Completion"})]}),(0,D.jsx)("div",{className:"text-2xl font-bold "+("completed"===A.status?"text-green-700":"text-gray-700"),children:"completed"===A.status?"100%":"0%"})]}),(0,D.jsxs)(F.P.div,{whileHover:{scale:1.02},className:"p-4 rounded-lg border-2 "+(Y?"bg-red-50 border-red-200":"bg-blue-50 border-blue-200"),children:[(0,D.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,D.jsx)(y.A,{size:20,className:Y?"text-red-600":"text-blue-600"}),(0,D.jsx)("span",{className:"font-medium "+(Y?"text-red-800":"text-blue-800"),children:"Due Date"})]}),(0,D.jsx)("div",{className:"text-lg font-bold "+(Y?"text-red-700":"text-blue-700"),children:A.due_date?new Date(A.due_date).toLocaleDateString():"Not set"}),Y&&(0,D.jsx)("div",{className:"text-sm text-red-600 mt-1",children:"Overdue"})]}),(0,D.jsxs)(F.P.div,{whileHover:{scale:1.02},className:"p-4 rounded-lg border-2 "+("urgent"===A.priority||"high"===A.priority?"bg-orange-50 border-orange-200":"bg-gray-50 border-gray-200"),children:[(0,D.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,D.jsx)(de.A,{size:20,className:"urgent"===A.priority||"high"===A.priority?"text-orange-600":"text-gray-600"}),(0,D.jsx)("span",{className:"font-medium "+("urgent"===A.priority||"high"===A.priority?"text-orange-800":"text-gray-800"),children:"Priority"})]}),(0,D.jsx)("div",{className:"text-lg font-bold "+("urgent"===A.priority||"high"===A.priority?"text-orange-700":"text-gray-700"),children:(null===(t=R[A.priority])||void 0===t?void 0:t.label)||"Not set"})]})]})]})},"progress"),"connections"===M&&(0,D.jsx)(F.P.div,{initial:{opacity:0,x:-30},animate:{opacity:1,x:0},exit:{opacity:0,x:30},transition:{duration:.4,ease:"easeOut"},layout:"position",layoutId:"tabContent",className:"p-6 overflow-y-auto max-h-[calc(85vh-200px)] scrollbar-thin scrollbar-thumb-slate-400 scrollbar-track-slate-200",children:(0,D.jsxs)("div",{className:"bg-white rounded-xl p-6 shadow-lg border border-slate-200",children:[(0,D.jsxs)("h3",{className:"text-lg font-semibold text-slate-800 mb-6 flex items-center gap-2",children:[(0,D.jsx)(te.A,{size:20,className:"text-indigo-600"}),"Related Content"]}),(0,D.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[q("Linked Case ID","linked_case_id"),q("Linked Topic ID","linked_topic_id")]}),(0,D.jsxs)("div",{className:"mt-8 text-center py-8 text-gray-500",children:[(0,D.jsx)(te.A,{size:48,className:"mx-auto mb-3 text-gray-300"}),(0,D.jsx)("p",{children:"No connections found"}),(0,D.jsx)("p",{className:"text-sm mt-1",children:"Link this task to cases or topics to create connections"})]})]})},"connections"),"details"===M&&(0,D.jsx)(F.P.div,{initial:{opacity:0,x:-30},animate:{opacity:1,x:0},exit:{opacity:0,x:30},transition:{duration:.4,ease:"easeOut"},layout:"position",layoutId:"tabContent",className:"p-6 overflow-y-auto max-h-[calc(85vh-200px)] scrollbar-thin scrollbar-thumb-slate-400 scrollbar-track-slate-200",children:(0,D.jsxs)("div",{className:"bg-white rounded-xl p-6 shadow-lg border border-slate-200",children:[(0,D.jsxs)("h3",{className:"text-lg font-semibold text-slate-800 mb-6 flex items-center gap-2",children:[(0,D.jsx)(w.A,{size:20,className:"text-gray-600"}),"Additional Details"]}),(0,D.jsxs)("div",{className:"space-y-6",children:[(0,D.jsxs)("div",{className:"text-sm text-gray-600 bg-slate-50 p-4 rounded-lg",children:[(0,D.jsx)("p",{className:"font-medium mb-2",children:"Task Details"}),(0,D.jsxs)("div",{className:"space-y-2",children:[(0,D.jsxs)("p",{children:[(0,D.jsx)("span",{className:"font-medium",children:"Created:"})," ",null!==i&&void 0!==i&&i.created_at?new Date(i.created_at).toLocaleString():"Unknown"]}),(0,D.jsxs)("p",{children:[(0,D.jsx)("span",{className:"font-medium",children:"Last Updated:"})," ",null!==i&&void 0!==i&&i.updated_at?new Date(i.updated_at).toLocaleString():"Unknown"]}),(0,D.jsxs)("p",{children:[(0,D.jsx)("span",{className:"font-medium",children:"Task ID:"})," ",(null===i||void 0===i?void 0:i.id)||"Unknown"]})]})]}),(0,D.jsxs)("div",{className:"p-4 bg-blue-50 rounded-lg border border-blue-200",children:[(0,D.jsx)("h4",{className:"font-medium text-blue-800 mb-2",children:"Task Management Tips"}),(0,D.jsxs)("ul",{className:"text-blue-700 text-sm space-y-1",children:[(0,D.jsx)("li",{children:"\u2022 Break large tasks into smaller, manageable subtasks"}),(0,D.jsx)("li",{children:"\u2022 Set realistic due dates to maintain accountability"}),(0,D.jsx)("li",{children:"\u2022 Link tasks to relevant cases or topics for better organization"}),(0,D.jsx)("li",{children:"\u2022 Update status regularly to track progress"})]})]})]})]})},"details")]})}),C&&(0,D.jsxs)("div",{className:"sticky bottom-0 bg-gray-50 border-t border-gray-200 px-6 py-4 flex items-center justify-between",children:[(0,D.jsx)("div",{className:"text-sm text-gray-500",children:"Changes will be auto-saved"}),(0,D.jsxs)("div",{className:"flex items-center gap-3",children:[(0,D.jsx)("button",{onClick:()=>{S(!1),O({...i})},disabled:_,className:"px-4 py-2 text-gray-600 hover:text-gray-800 border border-gray-300 rounded-lg hover:bg-gray-100 transition-colors",children:"Cancel"}),(0,D.jsxs)("button",{onClick:J,disabled:_,className:"px-4 py-2 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 transition-colors flex items-center gap-2",children:[_?(0,D.jsx)(p.A,{size:16,className:"animate-spin"}):(0,D.jsx)(k.A,{size:16}),_?"Saving...":"Save Changes"]})]})]})]})},`task-modal-${(null===i||void 0===i?void 0:i.id)||"default"}`)}):null},ye=a.memo(be,(e,t)=>{var s,a,i,r;return e.isOpen===t.isOpen&&(null===(s=e.data)||void 0===s?void 0:s.id)===(null===(a=t.data)||void 0===a?void 0:a.id)&&(null===(i=e.data)||void 0===i?void 0:i.updated_at)===(null===(r=t.data)||void 0===r?void 0:r.updated_at)});function ve(e,t,s){const{x:a,y:i,width:r,height:o}=e,{x:l,y:n}=t,{x:c,y:d}=s,u=a,p=a+r,m=i,x=i+o,h=c-l,g=d-n;if(Math.abs(h)<.001)return{x:l,y:g>0?x:m,side:g>0?"bottom":"top"};if(Math.abs(g)<.001)return{x:h>0?p:u,y:n,side:h>0?"right":"left"};const b=g/h,y=n-b*l,v=[],f=b*u+y;f>=m&&f<=x&&v.push({x:u,y:f,side:"left",distance:Math.hypot(u-l,f-n)});const j=b*p+y;j>=m&&j<=x&&v.push({x:p,y:j,side:"right",distance:Math.hypot(p-l,j-n)});const N=(m-y)/b;N>=u&&N<=p&&v.push({x:N,y:m,side:"top",distance:Math.hypot(N-l,m-n)});const w=(x-y)/b;w>=u&&w<=p&&v.push({x:w,y:x,side:"bottom",distance:Math.hypot(w-l,x-n)});const k=v.filter(e=>{const t=e.x-l,s=e.y-n;return(h>0&&t>=0||h<0&&t<=0)&&(g>0&&s>=0||g<0&&s<=0)});return k.sort((e,t)=>e.distance-t.distance),k[0]||{x:l,y:n,side:"center"}}const fe=(0,a.memo)(e=>{var t,s,i,r,o,n;let{id:c,source:d,target:u,sourceX:p,sourceY:m,targetX:x,targetY:h,sourcePosition:g,targetPosition:b,style:y={},markerEnd:v,markerStart:f,data:j,...N}=e;const{getNode:w}=(0,l.VH)();let k,C;try{k=w(d),C=w(u)}catch(_){k=null,C=null}const{edgePath:S,labelX:A,labelY:O}=(0,a.useMemo)(()=>{if(null!==j&&void 0!==j&&j.__isAnimating||null!==j&&void 0!==j&&j.__forceUpdate)return{edgePath:`M${p},${m} L${x},${h}`,labelX:(p+x)/2,labelY:(m+h)/2};if(!k||!C)return{edgePath:`M${p},${m} L${x},${h}`,labelX:(p+x)/2,labelY:(m+h)/2};try{var e,t,s,a,i,r,o,l,n,c;const d=Boolean(k.width||(null===(e=k.dimensions)||void 0===e?void 0:e.width)||(null===(t=k.data)||void 0===t?void 0:t.width)||(null===(s=k.style)||void 0===s?void 0:s.width)),u=Boolean(C.width||(null===(a=C.dimensions)||void 0===a?void 0:a.width)||(null===(i=C.data)||void 0===i?void 0:i.width)||(null===(r=C.style)||void 0===r?void 0:r.width));if(!d||!u)return{edgePath:`M${p},${m} L${x},${h}`,labelX:(p+x)/2,labelY:(m+h)/2};const g=e=>{var t,s,a,i;const r="topic"===e.type?180:200,o="topic"===e.type?50:100;return{width:e.width||(null===(t=e.dimensions)||void 0===t?void 0:t.width)||(null===(s=e.data)||void 0===s?void 0:s.width)||r,height:e.height||(null===(a=e.dimensions)||void 0===a?void 0:a.height)||(null===(i=e.data)||void 0===i?void 0:i.height)||o}},b=g(k),y=g(C),v=function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{sourcePosition:a={x:0,y:0},targetPosition:i={x:0,y:0},sourceWidth:r=200,sourceHeight:o=100,targetWidth:l=200,targetHeight:n=100,sourceX:c,sourceY:d,targetX:u,targetY:p,offset:m=0}=s;if(void 0!==c&&void 0!==d&&void 0!==u&&void 0!==p&&(r<=10||l<=10))return{sourceX:c,sourceY:d,targetX:u,targetY:p,sourceSide:"direct",targetSide:"direct"};const x={x:a.x+r/2,y:a.y+o/2},h={x:i.x+l/2,y:i.y+n/2},g={x:a.x,y:a.y,width:r,height:o},b={x:i.x,y:i.y,width:l,height:n},y=ve(g,x,h),v=ve(b,h,x),f=h.x-x.x,j=h.y-x.y,N=Math.sqrt(f*f+j*j);if(N>0){const e=f/N,t=j/N,s=3;y.x-=e*s,y.y-=t*s,v.x+=e*s,v.y+=t*s,m>0&&(y.x+=e*m,y.y+=t*m,v.x-=e*m,v.y-=t*m)}return!!s.debug&&(console.log("Source Node:",e),console.log("Target Node:",t),console.log("Source Intersection:",y),console.log("Target Intersection:",v)),{sourceX:y.x,sourceY:y.y,targetX:v.x,targetY:v.y,sourceSide:y.side,targetSide:v.side}}(k,C,{sourcePosition:{x:(null===(o=k.positionAbsolute)||void 0===o?void 0:o.x)||k.position.x,y:(null===(l=k.positionAbsolute)||void 0===l?void 0:l.y)||k.position.y},targetPosition:{x:(null===(n=C.positionAbsolute)||void 0===n?void 0:n.x)||C.position.x,y:(null===(c=C.positionAbsolute)||void 0===c?void 0:c.y)||C.position.y},sourceX:p,sourceY:m,targetX:x,targetY:h,sourceWidth:b.width,sourceHeight:b.height,targetWidth:y.width,targetHeight:y.height,debug:!1}),{sourceX:f,sourceY:j,targetX:N,targetY:w}=v;return{edgePath:`M ${f},${j} L ${N},${w}`,labelX:(f+N)/2,labelY:(j+w)/2}}catch(_){return console.warn("FloatingEdge calculation error:",_),{edgePath:`M${p},${m} L${x},${h}`,labelX:(p+x)/2,labelY:(m+h)/2}}},[d,u,p,m,x,h,null===j||void 0===j?void 0:j.__forceUpdate,null===j||void 0===j?void 0:j.__isAnimating,null===(t=k)||void 0===t?void 0:t.id,null===(s=C)||void 0===s?void 0:s.id,null===(i=k)||void 0===i?void 0:i.width,null===(r=k)||void 0===r?void 0:r.height,null===(o=C)||void 0===o?void 0:o.width,null===(n=C)||void 0===n?void 0:n.height]);return(0,D.jsx)(l.tE,{id:c,path:S,labelX:A,labelY:O,style:{stroke:"#64748b",strokeWidth:3,strokeLinecap:"round",strokeOpacity:.95,transition:"none",...y},markerEnd:v,markerStart:f})},(e,t)=>{var s,a;return e.sourceX===t.sourceX&&e.sourceY===t.sourceY&&e.targetX===t.targetX&&e.targetY===t.targetY&&e.source===t.source&&e.target===t.target&&(null===(s=e.data)||void 0===s?void 0:s.__forceUpdate)===(null===(a=t.data)||void 0===a?void 0:a.__forceUpdate)}),je=fe,Ne=(0,a.memo)(e=>{let{id:t,source:s,target:a,sourceX:i,sourceY:r,targetX:o,targetY:c,sourcePosition:d,targetPosition:u,style:p={},markerEnd:m,markerStart:x,label:h,sourceHandleId:g,targetHandleId:b,data:y,selected:v,animated:f}=e;const[j,N,w]=(0,n.Fp)({sourceX:i,sourceY:r,sourcePosition:d,targetX:o,targetY:c,targetPosition:u});return(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(l.tE,{id:t,path:j,style:p,markerEnd:m,markerStart:x}),h&&(0,D.jsx)(l.rV,{children:(0,D.jsx)("div",{style:{position:"absolute",transform:`translate(-50%, -50%) translate(${N}px,${w}px)`,fontSize:12,pointerEvents:"all"},className:"nodrag nopan bg-white px-2 py-1 rounded shadow border text-xs",children:h})})]})});Ne.displayName="EnhancedEdge";const we=Ne,ke=e=>{let{fromX:t,fromY:s,toX:a,toY:i,connectionLineStyle:r}=e;const o=`M ${t},${s} L ${a},${i}`,l={stroke:"#3b82f6",strokeWidth:3.5,strokeLinecap:"round",strokeDasharray:"5,3",filter:"drop-shadow(0 0 6px rgba(59, 130, 246, 0.6))",animation:"flowingDash 1s linear infinite",...r};return(0,D.jsxs)("g",{children:[(0,D.jsx)("path",{d:o,fill:"none",style:l}),(0,D.jsx)("path",{d:o,fill:"none",stroke:"transparent",strokeWidth:15,style:{pointerEvents:"stroke"}})]})},Ce=e=>{let{message:t="Loading your mind map...",progress:s=null}=e;return(0,D.jsx)("div",{className:"fixed inset-0 bg-gradient-to-br from-blue-50 to-purple-50 flex items-center justify-center z-50",children:(0,D.jsxs)("div",{className:"text-center",children:[(0,D.jsxs)("div",{className:"relative mb-6",children:[(0,D.jsx)(x.A,{className:"w-16 h-16 text-blue-600 mx-auto animate-pulse"}),(0,D.jsx)(H.A,{className:"w-6 h-6 text-purple-500 absolute -top-2 -right-2 animate-bounce"})]}),(0,D.jsxs)("div",{className:"flex items-center justify-center gap-3 mb-4",children:[(0,D.jsx)(p.A,{className:"w-6 h-6 animate-spin text-blue-600"}),(0,D.jsx)("span",{className:"text-lg font-medium text-gray-700",children:t})]}),null!==s&&(0,D.jsx)("div",{className:"w-64 bg-gray-200 rounded-full h-2 mx-auto mb-2",children:(0,D.jsx)("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300 ease-out",style:{width:`${Math.max(0,Math.min(100,s))}%`}})}),(0,D.jsx)("div",{className:"text-sm text-gray-500 max-w-md mx-auto mt-4",children:(0,D.jsx)("p",{children:"\ud83d\udca1 Tip: Use the force layout button to auto-arrange your nodes"})})]})})};const Se=[{id:1,title:"Efficacy of Cognitive Behavioral Therapy for Depression: A Meta-Analysis",authors:"Smith, J.A., Johnson, B.K., Williams, C.D.",year:"2023",type:"meta-analysis",journal:"Journal of Clinical Psychology",volume:"79",pages:"234-251",doi:"10.1002/jclp.23456",abstract:"This meta-analysis examines the efficacy of cognitive behavioral therapy (CBT) for treating major depressive disorder across 45 randomized controlled trials involving 3,242 participants. Results indicate that CBT shows significant effectiveness with a large effect size (d = 0.85) compared to control conditions. The analysis also reveals that individual CBT may be more effective than group CBT for severe depression cases.",keywords:"cognitive behavioral therapy, depression, meta-analysis, psychotherapy, mental health",notes:"",pdf_url:"https://example.com/sample-cbt-meta-analysis.pdf",position:{x:300,y:100}},{id:2,title:"DSM-5-TR Clinical Cases",authors:"American Psychiatric Association",year:"2022",type:"guideline",journal:"American Psychiatric Publishing",abstract:"A comprehensive collection of clinical cases that illustrate the diagnostic criteria and clinical features of mental disorders as defined in the DSM-5-TR. Each case includes detailed patient presentations, differential diagnoses, and treatment considerations.",keywords:"DSM-5, diagnosis, clinical cases, psychiatric disorders, differential diagnosis",notes:"Essential reference for diagnostic clarity",position:{x:500,y:200}},{id:3,title:"Pharmacological Treatment of Bipolar Disorder: Current Evidence",authors:"Rodriguez, M.L., Chen, K.H., Anderson, P.R.",year:"2023",type:"review",journal:"Bipolar Disorders",volume:"25",pages:"123-145",doi:"10.1111/bdi.13289",abstract:"This comprehensive review examines current evidence for pharmacological treatments of bipolar disorder, including mood stabilizers, antipsychotics, and adjunctive therapies. The review covers efficacy, safety profiles, and treatment-resistant cases.",keywords:"bipolar disorder, pharmacotherapy, mood stabilizers, lithium, antipsychotics",notes:"Important for medication management decisions",position:{x:700,y:150}},{id:4,title:"Mindfulness-Based Interventions for Anxiety Disorders: A Systematic Review",authors:"Taylor, S.M., Brown, A.J., Davis, L.K.",year:"2023",type:"review",journal:"Clinical Psychology Review",volume:"88",pages:"102-118",abstract:"Systematic review of mindfulness-based interventions for treating various anxiety disorders. Analysis of 28 studies shows moderate to large effect sizes for reducing anxiety symptoms, with particular effectiveness for generalized anxiety disorder.",keywords:"mindfulness, anxiety disorders, meditation, systematic review, GAD",notes:"Good evidence for mindfulness approaches",position:{x:400,y:300}},{id:5,title:"Case Study: Treatment-Resistant Schizophrenia with Clozapine",authors:"Wilson, K.R., Martinez, E.S.",year:"2022",type:"case-study",journal:"Schizophrenia Bulletin",volume:"48",pages:"567-572",abstract:"Detailed case study of a 28-year-old male with treatment-resistant schizophrenia who showed significant improvement after clozapine initiation. The case discusses monitoring protocols, side effect management, and long-term outcomes.",keywords:"schizophrenia, clozapine, treatment-resistant, case study, antipsychotics",notes:"Useful for understanding clozapine protocols",position:{x:600,y:400}}],Ae=[{id:"conn-1",source:"literature-1",target:"case-101",label:"Treatment approach"},{id:"conn-2",source:"literature-2",target:"topic-201",label:"Reference guide"},{id:"conn-3",source:"literature-3",target:"case-102",label:"Medication guidance"},{id:"conn-4",source:"literature-4",target:"case-103",label:"Treatment option"},{id:"conn-5",source:"literature-5",target:"case-104",label:"Treatment protocol"}],Oe=(e,t,s)=>{e(e=>{const a=new Set(e.literature.map(e=>e.id)),i=Se.filter(e=>!a.has(e.id));if(0===i.length)return s("Sample literature data already exists","info"),e;const r=new Set(e.cases.map(e=>e.id)),o=new Set(e.topics.map(e=>e.id)),l=[{id:101,label:"Major Depression Case",primary_diagnosis:"Major Depressive Disorder",chief_complaint:"Persistent sadness and loss of interest",secondary_diagnoses:["Anxiety","Insomnia"],position:{x:100,y:100}},{id:102,label:"Bipolar Disorder Case",primary_diagnosis:"Bipolar I Disorder",chief_complaint:"Mood swings and impulsivity",position:{x:200,y:200}},{id:103,label:"Generalized Anxiety Case",primary_diagnosis:"Generalized Anxiety Disorder",chief_complaint:"Excessive worry and restlessness",position:{x:300,y:300}},{id:104,label:"Schizophrenia Case",primary_diagnosis:"Schizophrenia",chief_complaint:"Auditory hallucinations and delusions",position:{x:400,y:400}}].filter(e=>!r.has(e.id)),n=[{id:201,title:"Diagnostic Criteria",category:"Assessment",tags:["DSM-5","diagnosis","criteria"],position:{x:150,y:50}}].filter(e=>!o.has(e.id)),c=new Set(e.connections.map(e=>e.id)),d=Ae.filter(e=>!c.has(e.id)),u={...e,literature:[...e.literature,...i],cases:[...e.cases,...l],topics:[...e.topics,...n],connections:[...e.connections,...d]};return t(u),s(`Added ${i.length} literature items, ${l.length} cases, and ${n.length} topics`,"success"),u})},_e=()=>s.e(497).then(s.bind(s,9930)),ze=`${"https://0d877e72-99c8-407d-9e49-011eb53a336a.preview.emergentagent.com".replace(/\/$/,"")}/api`,Pe=console.error;console.error=function(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];t[0]&&t[0].includes&&t[0].includes("ResizeObserver loop")||Pe(...t)};const Te=e=>{let{message:t,type:s="success",onClose:i,duration:r=3e3}=e;(0,a.useEffect)(()=>{const e=setTimeout(i,r);return()=>clearTimeout(e)},[i,r]);return(0,D.jsx)("div",{className:`fixed top-4 right-4 z-50 px-6 py-3 rounded-lg shadow-lg transition-all duration-500 transform ${{success:"bg-green-600 text-white border-l-4 border-green-400",error:"bg-red-600 text-white border-l-4 border-red-400",info:"bg-blue-600 text-white border-l-4 border-blue-400",saving:"bg-purple-600 text-white border-l-4 border-purple-400"}[s]}`,children:(0,D.jsxs)("div",{className:"flex items-center",children:[(()=>{switch(s){case"success":default:return(0,D.jsx)(c.A,{size:16,className:"mr-2"});case"error":return(0,D.jsx)(d.A,{size:16,className:"mr-2"});case"info":return(0,D.jsx)(u.A,{size:16,className:"mr-2"});case"saving":return(0,D.jsx)(p.A,{size:16,className:"mr-2 animate-spin"})}})(),(0,D.jsx)("span",{className:"text-sm font-medium",children:t}),(0,D.jsx)("button",{onClick:i,className:"ml-4 text-white hover:text-gray-200 transition-colors",children:(0,D.jsx)(m.A,{size:14})})]})})},De=e=>{let{onClick:t,loading:s,disabled:a,children:i,className:r,icon:o,...l}=e;return(0,D.jsx)("button",{onClick:t,disabled:a||s,className:`${r} transform transition-all duration-200 hover:scale-105 active:scale-95 ${a||s?"cursor-not-allowed opacity-50":"hover:shadow-lg"}`,...l,children:(0,D.jsxs)("div",{className:"flex items-center gap-2",children:[s?(0,D.jsx)(p.A,{size:16,className:"animate-spin"}):o?(0,D.jsx)(o,{size:16}):null,i]})})},Ee="pgy3_mindmap_data",Ie={save:(()=>{let e;return function(t,s,a){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];clearTimeout(e),s&&s();e=setTimeout(()=>{try{const e={version:"1.1",timestamp:(new Date).toISOString(),data:t};localStorage.setItem(Ee,JSON.stringify(e)),console.log("Mind map data auto-saved to localStorage"),a&&a(!0)}catch(e){if(console.error("Error saving to localStorage:",e),a&&a(!1,e),"QuotaExceededError"===e.name){console.warn("localStorage quota exceeded, clearing old data...");try{localStorage.removeItem(Ee)}catch(s){console.error("Error clearing localStorage:",s)}}}},i?1200:800)}})(),load:()=>{try{const e=localStorage.getItem(Ee);if(!e)return console.log("No localStorage data found"),null;const t=JSON.parse(e);return"1.1"!==t.version?(console.log("localStorage version mismatch, clearing old data"),localStorage.removeItem(Ee),null):(console.log("Mind map data loaded from localStorage",t.timestamp),t.data)}catch(e){console.error("Error loading from localStorage:",e);try{localStorage.removeItem(Ee)}catch(t){console.error("Error clearing corrupted localStorage:",t)}return null}},clear:()=>{try{localStorage.removeItem(Ee),console.log("localStorage data cleared")}catch(e){console.error("Error clearing localStorage:",e)}},getStorageInfo:()=>{try{const e=localStorage.getItem(Ee);if(!e)return null;const t=JSON.parse(e);return{version:t.version,timestamp:t.timestamp,size:new Blob([e]).size}}catch(e){return null}}},Me={topic:e=>{let{data:t,selected:s}=e;const[i,r]=(0,a.useState)(t.skipAnimation||!1);(0,a.useEffect)(()=>{if(!t.skipAnimation){const e=setTimeout(()=>r(!0),100);return()=>clearTimeout(e)}},[t.skipAnimation]);const o=t.flashcard_count>0?(t.completed_flashcards||0)/t.flashcard_count*100:0;return(0,D.jsxs)("div",{className:`group px-4 py-3 rounded-xl shadow-lg border-2 transition-all duration-700 min-w-[220px] relative hover:shadow-2xl transform hover:scale-105 backdrop-blur-sm ${s?"border-teal-400 shadow-xl scale-105 ring-4 ring-teal-200 animate-pulse":"border-transparent hover:border-teal-300 hover:ring-2 hover:ring-teal-100"} ${i?"opacity-100 scale-100 translate-y-0":"opacity-0 scale-75 translate-y-8"}`,style:{backgroundColor:t.color||"#3B82F6",color:"white",boxShadow:s?`0 0 20px ${t.color||"#3B82F6"}40`:`0 4px 20px ${t.color||"#3B82F6"}20`,transition:"all 0.7s cubic-bezier(0.34, 1.56, 0.64, 1), transform 0.3s ease"},children:[(0,D.jsx)(l.h7,{id:"top",type:"source",position:n.yX.Top,className:"w-3 h-3 !bg-blue-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{left:"50%",transform:"translateX(-50%)",zIndex:2},isConnectable:!0}),(0,D.jsx)(l.h7,{id:"top",type:"target",position:n.yX.Top,className:"w-3 h-3 !bg-blue-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{left:"50%",transform:"translateX(-50%)",zIndex:1},isConnectable:!0}),(0,D.jsx)(l.h7,{id:"right",type:"source",position:n.yX.Right,className:"w-3 h-3 !bg-blue-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{top:"50%",transform:"translateY(-50%)",zIndex:2},isConnectable:!0}),(0,D.jsx)(l.h7,{id:"right",type:"target",position:n.yX.Right,className:"w-3 h-3 !bg-blue-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{top:"50%",transform:"translateY(-50%)",zIndex:1},isConnectable:!0}),(0,D.jsx)(l.h7,{id:"bottom",type:"source",position:n.yX.Bottom,className:"w-3 h-3 !bg-blue-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{left:"50%",transform:"translateX(-50%)",zIndex:2},isConnectable:!0}),(0,D.jsx)(l.h7,{id:"bottom",type:"target",position:n.yX.Bottom,className:"w-3 h-3 !bg-blue-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{left:"50%",transform:"translateX(-50%)",zIndex:1},isConnectable:!0}),(0,D.jsx)(l.h7,{id:"left",type:"source",position:n.yX.Left,className:"w-3 h-3 !bg-blue-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{top:"50%",transform:"translateY(-50%)",zIndex:2},isConnectable:!0}),(0,D.jsx)(l.h7,{id:"left",type:"target",position:n.yX.Left,className:"w-3 h-3 !bg-blue-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{top:"50%",transform:"translateY(-50%)",zIndex:1},isConnectable:!0}),t.priority&&(0,D.jsx)("div",{className:"absolute -top-2 -right-2",children:(0,D.jsx)("div",{className:"w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold border-2 border-white "+("high"===t.priority?"bg-red-500":"medium"===t.priority?"bg-yellow-500":"bg-green-500"),children:"high"===t.priority?"!":"medium"===t.priority?"\u2022":"\u2713"})}),(0,D.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,D.jsxs)("div",{className:"flex items-center gap-1",children:[(0,D.jsx)(x.A,{size:16,className:"drop-shadow-sm"}),t.tags&&t.tags.length>0&&(0,D.jsx)(h.A,{size:12,className:"opacity-75"})]}),(0,D.jsx)("div",{className:"font-semibold text-sm truncate flex-1",children:t.label}),t.onDelete&&(0,D.jsx)("button",{onClick:e=>{e.stopPropagation(),t.onDelete()},className:"ml-auto p-1 hover:bg-white hover:bg-opacity-20 rounded transition-all duration-200 hover:scale-110 opacity-70 hover:opacity-100",children:(0,D.jsx)(m.A,{size:12})})]}),(0,D.jsx)("div",{className:"text-xs opacity-90 mb-2",children:t.category}),t.flashcard_count>0&&(0,D.jsxs)("div",{className:"text-xs mt-2 space-y-1",children:[(0,D.jsxs)("div",{className:"flex justify-between items-center",children:[(0,D.jsxs)("span",{className:"opacity-90",children:[t.completed_flashcards,"/",t.flashcard_count," flashcards"]}),(0,D.jsxs)("span",{className:"font-semibold",children:[Math.round(o),"%"]})]}),(0,D.jsx)("div",{className:"w-full bg-white bg-opacity-20 rounded-full h-2 overflow-hidden",children:(0,D.jsx)("div",{className:"h-full bg-white rounded-full transition-all duration-1000 ease-out",style:{width:`${o}%`}})})]}),t.tags&&t.tags.length>0&&(0,D.jsxs)("div",{className:"flex flex-wrap gap-1 mt-2",children:[t.tags.slice(0,3).map((e,t)=>(0,D.jsx)("span",{className:"px-2 py-1 bg-white bg-opacity-20 rounded-full text-xs",children:e},t)),t.tags.length>3&&(0,D.jsxs)("span",{className:"px-2 py-1 bg-white bg-opacity-20 rounded-full text-xs",children:["+",t.tags.length-3]})]}),t.updated_at&&(0,D.jsx)("div",{className:"absolute bottom-1 right-1 opacity-50",children:(0,D.jsx)(g.A,{size:10})})]})},case:e=>{let{data:t,selected:s}=e;const[i,r]=(0,a.useState)(t.skipAnimation||!1);(0,a.useEffect)(()=>{if(!t.skipAnimation){const e=setTimeout(()=>r(!0),150);return()=>clearTimeout(e)}},[t.skipAnimation]);const o=(e=>{var t,s;const a=(null===(t=e.chief_complaint)||void 0===t?void 0:t.toLowerCase())||"",i=(null===(s=e.diagnosis)||void 0===s?void 0:s.toLowerCase())||"";return["emergency","urgent","crisis","acute","severe"].some(e=>a.includes(e)||i.includes(e))?"high":"normal"})(t);return(0,D.jsxs)("div",{className:`group px-4 py-3 rounded-xl shadow-lg border-2 transition-all duration-600 min-w-[220px] bg-white relative hover:shadow-2xl transform hover:scale-105 ${s?"border-blue-400 shadow-xl scale-105 ring-4 ring-blue-200":"border-gray-200 hover:border-blue-300 hover:ring-2 hover:ring-blue-100"} ${"high"===o?"ring-2 ring-red-300":""} ${i?"opacity-100 scale-100 translate-y-0 rotate-0":"opacity-0 scale-90 translate-y-6 rotate-1"}`,style:{transition:"all 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94), transform 0.3s ease"},children:[(0,D.jsx)(l.h7,{id:"top",type:"source",position:n.yX.Top,className:"w-3 h-3 !bg-blue-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{left:"50%",transform:"translateX(-50%)",zIndex:2},isConnectable:!0}),(0,D.jsx)(l.h7,{id:"top",type:"target",position:n.yX.Top,className:"w-3 h-3 !bg-blue-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{left:"50%",transform:"translateX(-50%)",zIndex:1},isConnectable:!0}),(0,D.jsx)(l.h7,{id:"right",type:"source",position:n.yX.Right,className:"w-3 h-3 !bg-blue-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{top:"50%",transform:"translateY(-50%)",zIndex:2},isConnectable:!0}),(0,D.jsx)(l.h7,{id:"right",type:"target",position:n.yX.Right,className:"w-3 h-3 !bg-blue-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{top:"50%",transform:"translateY(-50%)",zIndex:1},isConnectable:!0}),(0,D.jsx)(l.h7,{id:"bottom",type:"source",position:n.yX.Bottom,className:"w-3 h-3 !bg-blue-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{left:"50%",transform:"translateX(-50%)",zIndex:2},isConnectable:!0}),(0,D.jsx)(l.h7,{id:"bottom",type:"target",position:n.yX.Bottom,className:"w-3 h-3 !bg-blue-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{left:"50%",transform:"translateX(-50%)",zIndex:1},isConnectable:!0}),(0,D.jsx)(l.h7,{id:"left",type:"source",position:n.yX.Left,className:"w-3 h-3 !bg-blue-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{top:"50%",transform:"translateY(-50%)",zIndex:2},isConnectable:!0}),(0,D.jsx)(l.h7,{id:"left",type:"target",position:n.yX.Left,className:"w-3 h-3 !bg-blue-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{top:"50%",transform:"translateY(-50%)",zIndex:1},isConnectable:!0}),"high"===o&&(0,D.jsx)("div",{className:"absolute -top-2 -right-2",children:(0,D.jsx)("div",{className:"w-6 h-6 bg-red-500 rounded-full flex items-center justify-center border-2 border-white animate-pulse",children:(0,D.jsx)(d.A,{size:14,className:"text-white"})})}),(0,D.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,D.jsxs)("div",{className:"flex items-center gap-1",children:[(0,D.jsx)(b.A,{size:16,className:"text-blue-600"}),t.linked_topics&&t.linked_topics.length>0&&(0,D.jsx)("div",{className:"text-xs bg-blue-100 text-blue-600 px-1 rounded",children:t.linked_topics.length})]}),(0,D.jsx)("div",{className:"font-semibold text-sm text-gray-800 truncate flex-1",children:t.label}),t.onDelete&&(0,D.jsx)("button",{onClick:e=>{e.stopPropagation(),t.onDelete()},className:"ml-auto p-1 hover:bg-gray-200 rounded transition-all duration-200 hover:scale-110 opacity-70 hover:opacity-100",children:(0,D.jsx)(m.A,{size:12})})]}),(0,D.jsx)("div",{className:"text-xs text-gray-600 mb-2 truncate",children:t.diagnosis}),(0,D.jsxs)("div",{className:"space-y-1",children:[t.age&&(0,D.jsxs)("div",{className:"text-xs text-blue-600 flex items-center gap-1",children:[(0,D.jsx)(y.A,{size:10}),"Age: ",t.age]}),t.status&&(0,D.jsx)("span",{className:`inline-block px-2 py-1 rounded-full text-xs border ${(e=>{switch(e){case"active":return"bg-green-100 text-green-800 border-green-200";case"archived":return"bg-gray-100 text-gray-800 border-gray-200";case"follow_up":return"bg-yellow-100 text-yellow-800 border-yellow-200";default:return"bg-blue-100 text-blue-800 border-blue-200"}})(t.status)}`,children:t.status})]}),t.tasks_count&&t.tasks_count>0&&(0,D.jsxs)("div",{className:"mt-2 text-xs text-gray-500 flex items-center gap-1",children:[(0,D.jsx)(v.A,{size:10}),t.completed_tasks||0,"/",t.tasks_count," tasks"]}),t.updated_at&&(0,D.jsx)("div",{className:"absolute bottom-1 right-1 opacity-30",children:(0,D.jsx)(g.A,{size:10})})]})},task:e=>{let{data:t,selected:s}=e;const[i,r]=(0,a.useState)(t.skipAnimation||!1);(0,a.useEffect)(()=>{if(!t.skipAnimation){const e=setTimeout(()=>r(!0),200);return()=>clearTimeout(e)}},[t.skipAnimation]);return(0,D.jsxs)("div",{className:`group px-4 py-3 rounded-xl shadow-lg border-2 transition-all duration-500 min-w-[200px] text-white relative hover:shadow-2xl transform hover:scale-105 ${s?"border-yellow-400 shadow-xl scale-105 ring-4 ring-yellow-200":"border-transparent hover:border-yellow-300 hover:ring-2 hover:ring-yellow-100"} ${{pending:"bg-yellow-500",in_progress:"bg-blue-600",completed:"bg-green-700 opacity-60"}[t.status]||"bg-gray-500"} ${i?"opacity-100 scale-100 translate-x-0":"opacity-0 scale-85 -translate-x-4"}`,style:{transition:"all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55), transform 0.3s ease"},children:[(0,D.jsx)(l.h7,{id:"top",type:"source",position:n.yX.Top,className:"w-3 h-3 !bg-blue-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{left:"50%",transform:"translateX(-50%)",zIndex:2},isConnectable:!0}),(0,D.jsx)(l.h7,{id:"top",type:"target",position:n.yX.Top,className:"w-3 h-3 !bg-blue-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{left:"50%",transform:"translateX(-50%)",zIndex:1},isConnectable:!0}),(0,D.jsx)(l.h7,{id:"right",type:"source",position:n.yX.Right,className:"w-3 h-3 !bg-blue-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{top:"50%",transform:"translateY(-50%)",zIndex:2},isConnectable:!0}),(0,D.jsx)(l.h7,{id:"right",type:"target",position:n.yX.Right,className:"w-3 h-3 !bg-blue-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{top:"50%",transform:"translateY(-50%)",zIndex:1},isConnectable:!0}),(0,D.jsx)(l.h7,{id:"bottom",type:"source",position:n.yX.Bottom,className:"w-3 h-3 !bg-blue-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{left:"50%",transform:"translateX(-50%)",zIndex:2},isConnectable:!0}),(0,D.jsx)(l.h7,{id:"bottom",type:"target",position:n.yX.Bottom,className:"w-3 h-3 !bg-blue-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{left:"50%",transform:"translateX(-50%)",zIndex:1},isConnectable:!0}),(0,D.jsx)(l.h7,{id:"left",type:"source",position:n.yX.Left,className:"w-3 h-3 !bg-blue-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{top:"50%",transform:"translateY(-50%)",zIndex:2},isConnectable:!0}),(0,D.jsx)(l.h7,{id:"left",type:"target",position:n.yX.Left,className:"w-3 h-3 !bg-blue-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{top:"50%",transform:"translateY(-50%)",zIndex:1},isConnectable:!0}),(0,D.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,D.jsx)(v.A,{size:16}),(0,D.jsx)("div",{className:"font-semibold text-sm",children:t.label}),t.onDelete&&(0,D.jsx)("button",{onClick:e=>{e.stopPropagation(),t.onDelete()},className:"ml-auto p-1 hover:bg-white hover:bg-opacity-20 rounded transition-all duration-200 hover:scale-110 opacity-70 hover:opacity-100",children:(0,D.jsx)(m.A,{size:12})})]}),(0,D.jsxs)("div",{className:"text-xs opacity-90",children:["Priority: ",t.priority]}),t.due_date&&(0,D.jsxs)("div",{className:"text-xs mt-1 opacity-90",children:["Due: ",new Date(t.due_date).toLocaleDateString()]})]})},literature:e=>{let{data:t,selected:s}=e;const[i,r]=(0,a.useState)(t.skipAnimation||!1);return(0,a.useEffect)(()=>{if(!t.skipAnimation){const e=setTimeout(()=>r(!0),250);return()=>clearTimeout(e)}},[t.skipAnimation]),(0,D.jsxs)("div",{className:`group px-4 py-3 rounded-xl shadow-lg border-2 transition-all duration-650 min-w-[200px] bg-purple-50 relative hover:shadow-2xl transform hover:scale-105 ${s?"border-purple-400 shadow-xl scale-105 ring-4 ring-purple-200":"border-purple-200 hover:border-purple-300 hover:ring-2 hover:ring-purple-100"} ${i?"opacity-100 scale-100 translate-x-0 rotate-0":"opacity-0 scale-95 translate-x-4 -rotate-1"}`,style:{transition:"all 0.65s cubic-bezier(0.175, 0.885, 0.32, 1.275), transform 0.3s ease"},children:[(0,D.jsx)(l.h7,{id:"top",type:"source",position:n.yX.Top,className:"w-3 h-3 !bg-purple-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{left:"50%",transform:"translateX(-50%)",zIndex:2},isConnectable:!0}),(0,D.jsx)(l.h7,{id:"top",type:"target",position:n.yX.Top,className:"w-3 h-3 !bg-purple-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{left:"50%",transform:"translateX(-50%)",zIndex:1},isConnectable:!0}),(0,D.jsx)(l.h7,{id:"right",type:"source",position:n.yX.Right,className:"w-3 h-3 !bg-purple-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{top:"50%",transform:"translateY(-50%)",zIndex:2},isConnectable:!0}),(0,D.jsx)(l.h7,{id:"right",type:"target",position:n.yX.Right,className:"w-3 h-3 !bg-purple-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{top:"50%",transform:"translateY(-50%)",zIndex:1},isConnectable:!0}),(0,D.jsx)(l.h7,{id:"bottom",type:"source",position:n.yX.Bottom,className:"w-3 h-3 !bg-purple-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{left:"50%",transform:"translateX(-50%)",zIndex:2},isConnectable:!0}),(0,D.jsx)(l.h7,{id:"bottom",type:"target",position:n.yX.Bottom,className:"w-3 h-3 !bg-purple-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{left:"50%",transform:"translateX(-50%)",zIndex:1},isConnectable:!0}),(0,D.jsx)(l.h7,{id:"left",type:"source",position:n.yX.Left,className:"w-3 h-3 !bg-purple-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{top:"50%",transform:"translateY(-50%)",zIndex:2},isConnectable:!0}),(0,D.jsx)(l.h7,{id:"left",type:"target",position:n.yX.Left,className:"w-3 h-3 !bg-purple-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{top:"50%",transform:"translateY(-50%)",zIndex:1},isConnectable:!0}),(0,D.jsxs)("div",{className:"flex items-center gap-2 mb-1 cursor-pointer",onClick:e=>{e.stopPropagation(),t.onLiteratureClick&&t.onLiteratureClick(t)},children:[(0,D.jsx)(f.A,{size:16,className:"text-purple-600"}),(0,D.jsx)("div",{className:"font-semibold text-sm text-gray-800",children:t.label}),t.onDelete&&(0,D.jsx)("button",{onClick:e=>{e.stopPropagation(),t.onDelete()},className:"ml-auto p-1 hover:bg-purple-200 rounded transition-all duration-200 hover:scale-110 opacity-70 hover:opacity-100",children:(0,D.jsx)(m.A,{size:12})})]}),(0,D.jsx)("div",{className:"text-xs text-gray-600",children:t.authors}),(0,D.jsx)("div",{className:"text-xs text-purple-600 mt-1",children:t.year})]})}},$e=e=>{let{isOpen:t,onClose:s,onSelect:i,templates:r}=e;const[o,l]=(0,a.useState)(null);if((0,a.useEffect)(()=>{if(!t){const e=setTimeout(()=>l(null),300);return()=>clearTimeout(e)}},[t]),!t)return null;const n=[{type:"topic",label:"Psychiatric Topic",icon:x.A,color:"bg-blue-600",description:"Add a new psychiatric topic or disorder"},{type:"literature",label:"Literature",icon:f.A,color:"bg-purple-600",description:"Add research papers, articles, or references"},{type:"case",label:"Patient Case",icon:b.A,color:"bg-indigo-600",description:"Add a new patient case study"},{type:"task",label:"Task",icon:v.A,color:"bg-amber-600",description:"Add a task or to-do item"}],c=function(){i(o,arguments.length>0&&void 0!==arguments[0]?arguments[0]:null),s()},d=o?(r||[]).filter(e=>e.nodeType===o):[];return(0,D.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 backdrop-blur-sm animate-in fade-in-25 duration-300",children:(0,D.jsxs)("div",{className:"bg-white rounded-xl shadow-2xl p-6 max-w-md w-full mx-4 transform transition-all duration-300 ease-out",children:[(0,D.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,D.jsxs)("div",{className:"flex items-center gap-3",children:[o&&(0,D.jsx)("button",{onClick:()=>l(null),className:"text-gray-400 hover:text-gray-600 p-1 rounded-full hover:bg-gray-100 transition-colors",children:(0,D.jsx)(j.A,{size:20})}),(0,D.jsx)("h3",{className:"text-xl font-semibold text-gray-800",children:o?`Select a ${o} template`:"Add New Node"})]}),(0,D.jsx)("button",{onClick:s,className:"text-gray-400 hover:text-gray-600 p-1",children:(0,D.jsx)(m.A,{size:20})})]}),(0,D.jsxs)("div",{className:"relative overflow-hidden",style:{minHeight:"200px"},children:[(0,D.jsx)("div",{className:"transition-transform duration-300 ease-in-out "+(o?"-translate-x-full opacity-0":"translate-x-0 opacity-100"),children:(0,D.jsx)("div",{className:"space-y-3",children:n.map(e=>{let{type:t,label:s,icon:a,color:i,description:r}=e;return(0,D.jsxs)("button",{onClick:()=>{l(t)},className:"w-full flex items-center gap-4 p-4 rounded-lg border-2 border-gray-200 hover:border-blue-400 hover:bg-blue-50 transition-all text-left",children:[(0,D.jsx)("div",{className:`${i} p-2 rounded-lg text-white`,children:(0,D.jsx)(a,{size:20})}),(0,D.jsxs)("div",{children:[(0,D.jsx)("div",{className:"font-medium text-gray-800",children:s}),(0,D.jsx)("div",{className:"text-sm text-gray-500",children:r})]})]},t)})})}),(0,D.jsx)("div",{className:"absolute top-0 left-0 w-full transition-transform duration-300 ease-in-out "+(o?"translate-x-0 opacity-100":"translate-x-full opacity-0"),children:o&&(0,D.jsxs)("div",{className:"space-y-3",children:[(0,D.jsxs)("button",{onClick:()=>c(null),className:"w-full flex items-center gap-4 p-4 rounded-lg border-2 border-dashed border-gray-300 hover:border-blue-400 hover:bg-blue-50 transition-all text-left",children:[(0,D.jsx)("div",{className:"bg-gray-200 p-2 rounded-lg text-gray-600",children:(0,D.jsx)(N.A,{size:20})}),(0,D.jsxs)("div",{children:[(0,D.jsxs)("div",{className:"font-medium text-gray-800",children:["Create Blank ",o]}),(0,D.jsx)("div",{className:"text-sm text-gray-500",children:"Start with an empty node."})]})]}),d.map(e=>{var t,s,a;return(0,D.jsxs)("button",{onClick:()=>c(e.id),className:"w-full flex items-center gap-4 p-4 rounded-lg border-2 border-gray-200 hover:border-blue-400 hover:bg-blue-50 transition-all text-left",children:[(0,D.jsx)("div",{className:"bg-indigo-100 p-2 rounded-lg text-indigo-600",children:(0,D.jsx)(w.A,{size:20})}),(0,D.jsxs)("div",{children:[(0,D.jsx)("div",{className:"font-medium text-gray-800",children:e.name}),(0,D.jsx)("div",{className:"text-sm text-gray-500 truncate",children:(null===(t=e.data)||void 0===t?void 0:t.description)||(null===(s=e.data)||void 0===s?void 0:s.abstract)||(null===(a=e.data)||void 0===a?void 0:a.assessment_plan)||"No description"})]})]},e.id)}),0===d.length&&(0,D.jsx)("div",{className:"text-center text-sm text-gray-500 py-4",children:"No templates found for this node type."})]})})]})]})})},Le=e=>{let{edge:t,isOpen:s,onClose:i,onSave:r}=e;const[o,l]=(0,a.useState)((null===t||void 0===t?void 0:t.label)||"");(0,a.useEffect)(()=>{l((null===t||void 0===t?void 0:t.label)||"")},[t]);const n=()=>{r(t.id,o),i()};return s&&t?(0,D.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 backdrop-blur-sm",children:(0,D.jsxs)("div",{className:"bg-white rounded-xl shadow-2xl p-6 max-w-md w-full mx-4 transform transition-all",children:[(0,D.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,D.jsx)("h3",{className:"text-xl font-semibold text-gray-800",children:"Edit Connection Label"}),(0,D.jsx)("button",{onClick:i,className:"text-gray-400 hover:text-gray-600 p-1 transition-colors",children:(0,D.jsx)(m.A,{size:20})})]}),(0,D.jsxs)("div",{className:"mb-6",children:[(0,D.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Connection Label"}),(0,D.jsx)("input",{type:"text",value:o,onChange:e=>l(e.target.value),onKeyPress:e=>{"Enter"===e.key?n():"Escape"===e.key&&i()},placeholder:"Enter a label for this connection...",className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all",autoFocus:!0}),(0,D.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Press Enter to save, Escape to cancel"})]}),(0,D.jsxs)("div",{className:"flex items-center justify-end gap-3",children:[(0,D.jsx)("button",{onClick:i,className:"px-4 py-2 text-gray-600 hover:text-gray-800 border border-gray-300 rounded-lg hover:bg-gray-100 transition-colors",children:"Cancel"}),(0,D.jsxs)("button",{onClick:n,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2",children:[(0,D.jsx)(k.A,{size:16}),"Save Label"]})]})]})}):null},Xe=()=>{var e,t,s,i,c,d;const{fitView:u,setCenter:h,zoomTo:g,getViewport:y}=(0,l.VH)(),[j,w,E]=(0,l.ck)([]),[I,M,$]=(0,l.fM)([]),[L,F]=(0,a.useState)({topics:[],cases:[],tasks:[],literature:[],connections:[]}),[B,Y]=(0,a.useState)(!1),[H,U]=(0,a.useState)(null),[J,W]=(0,a.useState)(!0),[V,G]=(0,a.useState)(0),[q,K]=(0,a.useState)("Initializing..."),[Z,ee]=(0,a.useState)(!0),[te,se]=(0,a.useState)(null),[ae,ie]=(0,a.useState)(!1),[re,oe]=(0,a.useState)({isOpen:!1,data:null}),[le,ne]=(0,a.useState)({isOpen:!1,data:null}),[de,ue]=(0,a.useState)({isOpen:!1,data:null}),pe=(0,a.useRef)(null),me=(0,a.useRef)(null),xe=(0,a.useRef)(null),[he,ge]=(0,a.useState)(!1),[be,ve]=(0,a.useState)(!1),[fe,Ne]=(0,a.useState)(!1),[Se,Ae]=(0,a.useState)(null),[Pe,Ee]=(0,a.useState)(!1),[Xe,Fe]=(0,a.useState)({isOpen:!1,edge:null}),[Be,Ye]=(0,a.useState)([]),[He,Ue]=(0,a.useState)({show:!1,progress:0,message:""}),[Je,We]=(0,a.useState)([]),[Ve,Ge]=(0,a.useState)(""),[qe,Ke]=(0,a.useState)(0),[Qe,Ze]=(0,a.useState)(!1),[et,tt]=(0,a.useState)({isOpen:!1,data:null}),[st,at]=(0,a.useState)(!1),[it,rt]=(0,a.useState)({case:!1,topic:!1,task:!1,literature:!1}),[ot,lt]=(0,a.useState)({}),nt=(0,a.useRef)({});(0,a.useEffect)(()=>{0===Object.keys(nt.current).length&&(nt.current={})},[]);const ct=(0,a.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success",s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3e3;const a={id:Date.now(),message:e,type:t,duration:s};We(e=>[...e,a])},[]),dt=(0,a.useCallback)(e=>{We(t=>t.filter(t=>t.id!==e))},[]),ut=(0,a.useCallback)(e=>{var t,s,a;const i=re.isOpen||le.isOpen||de.isOpen||et.isOpen,r=Object.values(it).some(e=>e),o=re.isOpen&&(null===(t=re.data)||void 0===t?void 0:t.isTabTransitioning)||le.isOpen&&(null===(s=le.data)||void 0===s?void 0:s.isTabTransitioning)||de.isOpen&&(null===(a=de.data)||void 0===a?void 0:a.isTabTransitioning);if(st||i||o||r){console.log("Deferring auto-save during animation, modal interaction, or tab transition");return void setTimeout(()=>ut(e),o||r?2e3:1e3)}Ie.save(e,()=>Ee(!0),(e,t)=>{Ee(!1),e?Ae(new Date):(ct("Auto-save failed","error",4e3),console.error("Auto-save error:",t))},st),window.requestIdleCallback?window.requestIdleCallback(()=>{st||Object.values(it).some(e=>e)||gt(e)},{timeout:5e3}):setTimeout(()=>{st||Object.values(it).some(e=>e)||gt(e)},100)},[ct,st,it,re.isOpen,le.isOpen,de.isOpen,et.isOpen]);(0,a.useCallback)(e=>{const t=re.isOpen||le.isOpen||de.isOpen||et.isOpen,s=Object.values(it).some(e=>e);st||t||s||(Ie.save(e,null,null,st),clearTimeout(window.positionBackendSaveTimeout),window.positionBackendSaveTimeout=setTimeout(()=>{ut(e)},800))},[st,it,re.isOpen,le.isOpen,de.isOpen,et.isOpen,ut]);(0,a.useEffect)(()=>{re.isOpen&&re.data?pe.current={...re.data}:re.isOpen||(pe.current=null)},[re.isOpen,null===(e=re.data)||void 0===e?void 0:e.id]),(0,a.useEffect)(()=>{le.isOpen&&le.data?me.current={...le.data}:le.isOpen||(me.current=null)},[le.isOpen,null===(t=le.data)||void 0===t?void 0:t.id]),(0,a.useEffect)(()=>{de.isOpen&&de.data?xe.current={...de.data}:de.isOpen||(xe.current=null)},[de.isOpen,null===(s=de.data)||void 0===s?void 0:s.id]);const pt=(0,a.useCallback)(e=>{console.log("Deleting node with full ID:",e);const[t,...s]=e.split("-"),a=s.join("-"),i="literature"===t?"literature":`${t}s`;F(s=>{const r=(s[i]||[]).filter(e=>String(e.id)!==a),o=(s.connections||[]).filter(t=>t.source!==e&&t.target!==e),l={...s,[i]:r,connections:o};return ut(l),ct(`${t.charAt(0).toUpperCase()+t.slice(1)} deleted.`,"success"),l}),w(t=>t.filter(t=>t.id!==e)),M(t=>t.filter(t=>t.source!==e&&t.target!==e))},[F,ut,ct,w,M]),mt=(0,a.useCallback)(e=>{at(!0),tt({isOpen:!0,data:e}),setTimeout(()=>at(!1),700)},[]),xt=(0,a.useCallback)(()=>{w(e=>e.map(e=>{const t=e.id.split("-")[0],s=e.id.split("-")[1];let a=e.data.label;if("case"===t){var i;const e=null===(i=L.cases)||void 0===i?void 0:i.find(e=>e.id===s);e&&(a=e.primaryDiagnosis||e.primary_diagnosis||e.title||"Untitled Case")}else if("topic"===t){var r;const e=null===(r=L.topics)||void 0===r?void 0:r.find(e=>e.id===s);e&&(a=e.title||"Untitled Topic")}else if("task"===t){var o;const e=null===(o=L.tasks)||void 0===o?void 0:o.find(e=>e.id===s);e&&(a=e.title||"Untitled Task")}else if("literature"===t){var l;const e=null===(l=L.literature)||void 0===l?void 0:l.find(e=>e.id===s);e&&(a=e.title||"Untitled Literature")}return a!==e.data.label?{...e,data:{...e.data,label:a}}:e}))},[L,w]);(0,a.useEffect)(()=>{var e,t,s,a;L&&((null===(e=L.cases)||void 0===e?void 0:e.length)>0||(null===(t=L.topics)||void 0===t?void 0:t.length)>0||(null===(s=L.tasks)||void 0===s?void 0:s.length)>0||(null===(a=L.literature)||void 0===a?void 0:a.length)>0)&&(xt(),0===j.length&&(console.log("Converting data to React Flow nodes due to data change"),setTimeout(()=>{ht(L,!1)},100)))},[L,xt,j.length]);const ht=(0,a.useCallback)(async function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const s=[...e.topics.map(e=>({...e,type:"topic"})),...e.cases.map(e=>({...e,type:"case"})),...e.tasks.map(e=>({...e,type:"task"})),...e.literature.map(e=>({...e,type:"literature"}))];let a;const i=s.some(e=>e.position&&"number"===typeof e.position.x&&"number"===typeof e.position.y);if(s.length>0&&t&&!i)try{const{forceSimulation:t,forceManyBody:i,forceLink:r,forceCenter:o,forceCollide:l}=await _e(),n=s.map((e,t)=>{var s,a;return{id:`${e.type}-${e.id}`,x:(null===(s=e.position)||void 0===s?void 0:s.x)||200*(Math.random()-.5),y:(null===(a=e.position)||void 0===a?void 0:a.y)||200*(Math.random()-.5),type:e.type}}),c=(e.connections||[]).map(e=>({source:e.source,target:e.target,id:e.id})).filter(e=>{const t=new Set(n.map(e=>e.id));return t.has(e.source)&&t.has(e.target)}),d=t(n).force("link",r(c).id(e=>e.id).distance(200).strength(.5)).force("charge",i().strength(-800).distanceMax(400)).force("center",o(window.innerWidth/3,window.innerHeight/2)).force("collision",l().radius(80)).stop();for(let e=0;e<300;e++)d.tick();const u=new Map;n.forEach(e=>{u.set(e.id,{x:e.x,y:e.y})}),a=s.map(e=>{const t=`${e.type}-${e.id}`,s=u.get(t)||{x:0,y:0};return{...e,position:s}})}catch(l){console.warn("Failed to apply initial layout, using fallback positioning:",l),a=s}else a=s;const r=(a||s).map((e,t)=>{const a=`${e.type}-${e.id}`,i="case"===e.type?{...e,chiefComplaint:e.chiefComplaint||e.chief_complaint||"",initialPresentation:e.initialPresentation||e.initial_presentation||"",currentPresentation:e.currentPresentation||e.current_presentation||"",medicationHistory:e.medicationHistory||e.medication_history||"",therapyProgress:e.therapyProgress||e.therapy_progress||"",defensePatterns:e.defensePatterns||e.defense_patterns||"",clinicalReflection:e.clinicalReflection||e.clinical_reflection||""}:e;let r;if(e.position&&"number"===typeof e.position.x&&"number"===typeof e.position.y)r=e.position;else{const e=Math.ceil(Math.sqrt(s.length)),a=250,i=150;r={x:t%e*a+300,y:Math.floor(t/e)*a+i}}return{id:a,type:e.type,position:r,data:{...i,onDelete:()=>pt(a),onLiteratureClick:"literature"===e.type?mt:void 0,skipAnimation:Z}}}),o=((e,t)=>{const s=new Set(t);return e.filter(e=>s.has(e.source)&&s.has(e.target)).map(e=>({id:e.id,source:e.source,target:e.target,label:e.label,type:"floating",style:{strokeWidth:2,stroke:"#64748b",opacity:.85},animated:!1,updatable:!0}))})(e.connections||[],r.map(e=>e.id));w(r),M(o)},[w,M,pt,mt,Z]),gt=(0,a.useCallback)(async e=>{const t={topics:JSON.parse(JSON.stringify(e.topics||[])),cases:JSON.parse(JSON.stringify(e.cases||[])),tasks:JSON.parse(JSON.stringify(e.tasks||[])),literature:JSON.parse(JSON.stringify(e.literature||[])),connections:JSON.parse(JSON.stringify(e.connections||[]))};try{const e=(new Date).toISOString();t.topics=t.topics.map((t,s)=>{var a,i;return{id:String(t.id||`${Date.now()}-${s}-topic`),title:t.title||"Untitled Topic",description:t.description||"",category:t.category||"Uncategorized",color:t.color||"#3B82F6",position:{x:Number(null===(a=t.position)||void 0===a?void 0:a.x)||0,y:Number(null===(i=t.position)||void 0===i?void 0:i.y)||0},flashcard_count:Number(t.flashcard_count)||0,completed_flashcards:Number(t.completed_flashcards)||0,resources:Array.isArray(t.resources)?t.resources:[],created_at:t.created_at||e,updated_at:e}}),t.cases=t.cases.map((t,s)=>{var a,i;return{id:String(t.id||`${Date.now()}-${s}-case`),case_id:t.case_id||`CASE-${Date.now()}-${s}`,encounter_date:t.encounter_date||e,primary_diagnosis:t.primary_diagnosis||"Unspecified",secondary_diagnoses:Array.isArray(t.secondary_diagnoses)?t.secondary_diagnoses:[],age:void 0!==t.age?Number(t.age):null,gender:t.gender||null,chief_complaint:t.chiefComplaint||t.chief_complaint||"",initial_presentation:t.initialPresentation||t.initial_presentation||"",current_presentation:t.currentPresentation||t.current_presentation||"",medication_history:t.medicationHistory||t.medication_history||"",therapy_progress:t.therapyProgress||t.therapy_progress||"",defense_patterns:t.defensePatterns||t.defense_patterns||"",clinical_reflection:t.clinicalReflection||t.clinical_reflection||"",history_present_illness:t.history_present_illness||null,medical_history:t.medical_history||null,medications:Array.isArray(t.medications)?t.medications:[],mental_status_exam:t.mental_status_exam||null,assessment_plan:t.assessment_plan||null,notes:t.notes||null,status:t.status||"active",linked_topics:Array.isArray(t.linked_topics)?t.linked_topics:[],position:{x:Number(null===(a=t.position)||void 0===a?void 0:a.x)||0,y:Number(null===(i=t.position)||void 0===i?void 0:i.y)||0},created_at:t.created_at||e,updated_at:e}}),t.tasks=t.tasks.map((t,s)=>{var a,i;return{id:String(t.id||`${Date.now()}-${s}-task`),title:t.title||"Untitled Task",description:t.description||null,status:t.status||"pending",priority:t.priority||"medium",due_date:t.due_date||null,linked_case_id:t.linked_case_id||null,linked_topic_id:t.linked_topic_id||null,position:{x:Number(null===(a=t.position)||void 0===a?void 0:a.x)||0,y:Number(null===(i=t.position)||void 0===i?void 0:i.y)||0},created_at:t.created_at||e,updated_at:e}}),t.literature=t.literature.map((t,s)=>{var a,i;return{id:String(t.id||`${Date.now()}-${s}-lit`),title:t.title||"Untitled Literature",authors:t.authors||null,publication:t.publication||null,year:void 0!==t.year?Number(t.year):null,doi:t.doi||null,abstract:t.abstract||null,notes:t.notes||null,pdf_path:t.pdf_path||null,linked_topics:Array.isArray(t.linked_topics)?t.linked_topics:[],position:{x:Number(null===(a=t.position)||void 0===a?void 0:a.x)||0,y:Number(null===(i=t.position)||void 0===i?void 0:i.y)||0},created_at:t.created_at||e,updated_at:e}}),t.connections=t.connections.map((e,t)=>({id:String(e.id||`${Date.now()}-${t}-conn`),source:e.source||"",target:e.target||"",label:e.label||""})),t.connections=t.connections.filter(e=>e.source&&e.target&&"string"===typeof e.source&&"string"===typeof e.target&&e.source.length>0&&e.target.length>0),console.log("Sending cleaned data to backend:",t);const s=await r.A.put(`${ze}/mindmap-data`,t,{headers:{"Content-Type":"application/json"}});console.log("Backend save successful:",s.data)}catch(l){var s,a,i,o;console.error("Failed to save to backend:",(null===(s=l.response)||void 0===s?void 0:s.data)||l.message),422===(null===(a=l.response)||void 0===a?void 0:a.status)&&null!==(i=l.response)&&void 0!==i&&null!==(o=i.data)&&void 0!==o&&o.detail&&(console.error("Validation errors:"),console.error(JSON.stringify(l.response.data.detail,null,2)),console.error("Request data that caused validation error:"),console.error(JSON.stringify(t,null,2)))}},[]),bt=(0,a.useCallback)(e=>{const t=`conn-${Date.now()}`,s={...e,id:t,type:"floating",style:{strokeWidth:2,stroke:"#64748b",opacity:.85,transition:"none"},data:{__forceUpdate:Date.now()},interactionWidth:20};M(e=>(0,n.rN)(s,e)),F(t=>{const a=[...t.connections,{id:s.id,source:e.source,target:e.target,label:""}],i={...t,connections:a};return ut(i),i})},[M,F,ut]),yt=(0,a.useCallback)((e,t)=>{U(t),w(e=>e.map(e=>({...e,selected:e.id===t.id})))},[w]),vt=(0,a.useCallback)((e,t)=>{const[s,a]=t.id.split("-");if(("case"!==s||!re.isOpen)&&("topic"!==s||!le.isOpen)&&("task"!==s||!de.isOpen)&&("literature"!==s||!et.isOpen)){if("literature"===s){const e=L.literature.find(e=>String(e.id)===a);return void(e&&tt({isOpen:!0,data:e}))}if("case"===s){const e=L.cases.find(e=>String(e.id)===a);return void(e&&(rt(e=>({...e,case:!0})),oe({isOpen:!0,data:e}),setTimeout(()=>{rt(e=>({...e,case:!1}))},800)))}if("topic"===s){const e=L.topics.find(e=>String(e.id)===a);return void(e&&(rt(e=>({...e,topic:!0})),ne({isOpen:!0,data:e}),setTimeout(()=>{rt(e=>({...e,topic:!1}))},800)))}if("task"===s){const e=L.tasks.find(e=>String(e.id)===a);return void(e&&(rt(e=>({...e,task:!0})),ue({isOpen:!0,data:e}),setTimeout(()=>{rt(e=>({...e,task:!1}))},800)))}}},[L,re.isOpen,le.isOpen,de.isOpen,et.isOpen]),ft=(0,a.useCallback)((e,t)=>{M(e=>e.filter(e=>e.id!==t.id)),F(e=>{const s=e.connections.filter(e=>e.id!==t.id),a={...e,connections:s};return ut(a),ct("Connection deleted","success"),a})},[M,F,ut,ct]),jt=(0,a.useCallback)((e,t)=>{e.preventDefault(),Fe({isOpen:!0,edge:t})},[]),Nt=(0,a.useCallback)((e,t)=>{M(s=>s.map(s=>s.id===e?{...s,label:t}:s)),F(s=>{const a=s.connections.map(s=>s.id===e?{...s,label:t}:s),i={...s,connections:a};return ut(i),i})},[M,F,ut]),wt=(0,a.useCallback)((e,t)=>{M(e=>e.map(e=>e.id===t.id?{...e,className:"highlighted"}:e))},[M]),kt=(0,a.useCallback)((e,t)=>{M(e=>e.map(e=>e.id===t.id?{...e,className:""}:e))},[M]),Ct=(0,a.useCallback)(async()=>{if(0!==j.length)try{const{forceSimulation:e,forceManyBody:t,forceLink:s,forceCenter:a,forceCollide:i}=await _e(),r=[...I],o=new Set(j.map(e=>e.id)),l=r.filter(e=>o.has(e.source)&&o.has(e.target)),n=l.map(e=>({source:e.source,target:e.target,id:e.id})),c=j.map(e=>({id:e.id,x:e.position.x,y:e.position.y,fx:null,fy:null})),d=e(c).force("link",s(n).id(e=>e.id).distance(200).strength(.5)).force("charge",t().strength(-800).distanceMax(400)).force("center",a(window.innerWidth/3,window.innerHeight/2)).force("collision",i().radius(80)).stop(),p=50,m=400;let x=0;const h=()=>{const e=Math.min(p,m-x);for(let t=0;t<e;t++)d.tick();if(x+=e,x<m)requestAnimationFrame(h);else{const e=c.map(e=>({...j.find(t=>t.id===e.id),position:{x:e.x,y:e.y}}));w(e),M(l),F(t=>{const s={...t};return e.forEach(e=>{var t;const[a,i]=e.id.split("-"),r=null===(t=s["literature"===a?"literature":`${a}s`])||void 0===t?void 0:t.find(e=>String(e.id)===i);r&&(r.position=e.position)}),s}),setTimeout(()=>{u({duration:800,padding:.2})},200)}};requestAnimationFrame(h)}catch(e){console.error("Force layout failed:",e),ct("Layout calculation failed","error")}},[j,I,w,M,F,u,ct]),St=(0,a.useCallback)(()=>{try{Ct(),ct("Nodes realigned successfully","success")}catch(e){console.error("Force layout error:",e),ct("Failed to realign nodes","error")}},[Ct,ct]),At=(0,a.useCallback)(()=>{if(!window.confirm("Are you sure you want to clear the entire mind map?"))return;const e={topics:[],cases:[],tasks:[],literature:[],connections:[]};F(e),w([]),M([]),U(null),oe({isOpen:!1,data:null}),ne({isOpen:!1,data:null}),ue({isOpen:!1,data:null}),tt({isOpen:!1,data:null}),se(null),ut(e),ct("Mind map cleared successfully","success")},[w,M,ut,ct]),Ot=(0,a.useCallback)(e=>{if(E(e),st)return void console.log("Skipping position updates during animation");const t=e.filter(e=>"remove"===e.type);t.length>0&&lt(e=>{const s={...e};return t.forEach(e=>{delete s[e.id]}),s});const s=e.filter(e=>"position"===e.type&&e.position);s.length>0&&(console.log("Processing position changes:",s),F(e=>{const t={...e};return s.forEach(e=>{if(e.position){var s;const[a,i]=e.id.split("-"),r=null===(s=t["literature"===a?"literature":`${a}s`])||void 0===s?void 0:s.find(e=>String(e.id)===i);r&&(r.position={...e.position},console.log(`Updated ${a} ${i} position to:`,e.position))}}),Ie.save(t,null,null,!1),t}),setTimeout(()=>{ut(L)},500))},[E,F,st,lt,ut,L]),_t=(0,a.useCallback)((e,t)=>{clearTimeout(window.dragSaveTimeout),window.dragSaveTimeout=setTimeout(()=>{F(e=>(ut(e),e))},500)},[ut]),zt=(0,a.useCallback)(async()=>{W(!0),G(10),K("Checking local data...");try{const t=Ie.load();if(t)return G(30),K("Loading from cache..."),t.connections||(t.connections=[]),F(t),G(60),K("Applying layout..."),await ht(t,!0),G(90),K("Finalizing..."),W(!1),ee(!1),G(100),void setTimeout(async()=>{try{const e=await r.A.get(`${ze}/mindmap-data`);JSON.stringify(e.data)!==JSON.stringify(t)&&(e.data.connections||(e.data.connections=[]),F(e.data),await ht(e.data),ut(e.data),ct("Data synchronized with server","info"))}catch(e){console.warn("Background sync failed:",e)}},500);G(20),K("Loading from server...");try{const e=await r.A.get(`${ze}/mindmap-data`);e.data.connections||(e.data.connections=[]),G(50),K("Processing data..."),F(e.data),G(80),K("Applying layout..."),await ht(e.data,!0),ut(e.data),G(100),W(!1),ee(!1)}catch(e){console.warn("Backend loading failed, populating with sample data:",e),G(60),K("Loading sample data...");F({topics:[],cases:[],tasks:[],literature:[],connections:[]}),setTimeout(()=>{Oe(F,ut,ct)},100),G(100),W(!1),ee(!1)}}catch(t){console.error("Error loading mind map:",t),ct("Failed to load mind map","error"),W(!1),ee(!1)}},[ct,ut,ht]);(0,a.useEffect)(()=>{zt(),Ye([{id:"template1",name:"Schizophrenia Workup",nodeType:"case",data:{primary_diagnosis:"Schizophrenia",chief_complaint:"Auditory hallucinations"}},{id:"template2",name:"MDD Follow-up",nodeType:"case",data:{primary_diagnosis:"Major Depressive Disorder",status:"follow_up"}},{id:"template3",name:"CBT for Anxiety",nodeType:"topic",data:{title:"CBT for Anxiety",category:"Anxiety Disorders"}}])},[]);const Pt=(0,a.useCallback)((e,t)=>{if(!e||!e.id||!e.data)return!1;if(!t)return!0;const s=t.toLowerCase().trim();if(!s)return!0;try{const t=e.id.split("-"),a=t.length>0?t[0]:"",i=t.length>1?t[1]:"";let r=!1;if(!r&&e.data.label){r=e.data.label.toLowerCase().includes(s)}if(!r&&a&&(r=a.includes(s)),!r&&"case"===a&&i&&(r=`case-${i}`.toLowerCase().includes(s)),!r)if("case"===a){r=(e.data.primary_diagnosis||e.data.primaryDiagnosis||"").toLowerCase().includes(s)}else if("topic"===a){r=(e.data.title||"").toLowerCase().includes(s)}else if("literature"===a){const t=(e.data.title||"").toLowerCase(),a=(e.data.authors||"").toLowerCase();r=t.includes(s)||a.includes(s)}if(!r&&e.data.category){r=e.data.category.toLowerCase().includes(s)}return r}catch(a){return console.error("Error in nodeMatchesSearch for node:",e.id,a),!1}},[]),Tt=(0,a.useCallback)(()=>{if(console.log("Clearing search and resetting visibility"),Ge(""),se(null),j.length>0){const e={};for(let t=0;t<j.length;t++)e[j[t].id]=!0;nt.current={...e},lt(e)}},[j]);if((0,a.useEffect)(()=>{const e=e=>{var t;if("INPUT"!==e.target.tagName&&"TEXTAREA"!==e.target.tagName){if(e.ctrlKey||e.metaKey)switch(e.key){case"n":e.preventDefault(),ie(!0);break;case"e":e.preventDefault(),Y(!B);break;case"r":e.preventDefault(),St();break;case"f":e.preventDefault(),null===(t=document.querySelector('input[type="text"][placeholder*="Search"]'))||void 0===t||t.focus()}"Escape"===e.key&&(U(null),oe({isOpen:!1,data:null}),ne({isOpen:!1,data:null}),ue({isOpen:!1,data:null}),tt({isOpen:!1,data:null}),ie(!1),Ze(!1),re.isOpen||le.isOpen||de.isOpen||et.isOpen||ae||Qe||Tt())}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[B,St,Tt,re,le,de,et,ae,Qe]),(0,a.useEffect)(()=>{(he&&!be&&j.length>0||Z&&j.length>0)&&ve(!0)},[he,be,j,Z]),(0,a.useEffect)(()=>{if(0===j.length)return;const e=Object.values(it).some(e=>e);if(st||e)return;const t={};let s=0;j.forEach(e=>{let a=!0;te&&!e.id.startsWith(te)&&(a=!1),a&&Ve.trim()&&(a=Pt(e,Ve)),a&&s++,t[e.id]=a}),lt(t),Ke(s),nt.current=t},[te,Ve,j,Pt,st,it]),(0,a.useEffect)(()=>{if(!he)return;const e=document.getElementById("search-filter-styles")||document.createElement("style");e.id="search-filter-styles",document.getElementById("search-filter-styles")||document.head.appendChild(e);e.textContent="\n      /* Default node styling */\n      .react-flow__node {\n        transition: opacity 0.3s ease, transform 0.3s ease, filter 0.3s ease !important;\n      }\n      \n      /* Search dimmed nodes */\n      .react-flow__node.search-dimmed {\n        opacity: 0.15 !important;\n        filter: grayscale(0.7) !important;\n        transform: scale(0.9) !important;\n      }\n      \n      /* Selected node highlighting */\n      .react-flow__node.search-selected {\n        box-shadow: 0 0 0 2px #10b981, 0 0 20px rgba(16, 185, 129, 0.6) !important;\n        z-index: 1000 !important;\n      }\n      \n      /* Ensure dragging still works */\n      .react-flow__node.search-dimmed {\n        pointer-events: auto !important;\n      }\n    "},[he]),(0,a.useEffect)(()=>{if(!he)return;const e=nt.current,t=null===H||void 0===H?void 0:H.id;w(s=>s.map(s=>{const a=!1!==e[s.id],i=t===s.id;let r=s.className||"";return r=r.replace(/\s*(search-dimmed|search-selected)\s*/g," ").trim(),a||(r+=" search-dimmed"),i&&(r+=" search-selected"),s.className!==r.trim()?{...s,className:r.trim(),position:s.position,type:s.type,data:s.data}:s}))},[H,ot,he]),(0,a.useEffect)(()=>{if(0===j.length)return;const e=setTimeout(()=>{const e={...nt.current},t=new Set(j.map(e=>e.id)),s=new Set(Object.keys(e)),a=j.some(e=>!s.has(e.id)),i=Array.from(s).some(e=>!t.has(e));if(a||i){console.log("Initializing node visibility - nodes added or removed");const t={};for(let a=0;a<j.length;a++){const i=j[a].id;t[i]=!s.has(i)||e[i]}nt.current={...t},setTimeout(()=>{lt(t)},0)}},0);return()=>clearTimeout(e)},[j]),J)return(0,D.jsx)(Ce,{message:q,progress:V});return(0,D.jsxs)("div",{className:"min-h-screen bg-gray-50 flex",children:[(0,D.jsxs)("div",{className:"w-80 bg-gradient-to-b from-slate-800 to-slate-900 text-white p-6 shadow-2xl flex flex-col",children:[(0,D.jsxs)("div",{className:"mb-8",children:[(0,D.jsx)("div",{className:"text-3xl font-bold tracking-wide text-white",children:"PGY-3 HQ"}),(0,D.jsx)("div",{className:"text-sm text-slate-300 mt-2",children:"Psychiatry Resident Dashboard"})]}),(0,D.jsxs)("div",{className:"mb-6",children:[(0,D.jsxs)("div",{className:"relative",children:[(0,D.jsx)(C.A,{size:18,className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400"}),(0,D.jsx)("input",{type:"text",placeholder:"Search by title, diagnosis, case ID, category...",value:Ve,onChange:e=>Ge(e.target.value),onKeyDown:e=>{"Escape"===e.key&&Tt()},className:"w-full pl-10 pr-12 py-2 bg-slate-700 bg-opacity-50 border border-slate-600 rounded-lg text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-teal-400 focus:border-teal-400 transition-all duration-200"}),Ve&&(0,D.jsx)("button",{onClick:Tt,className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-slate-400 hover:text-white transition-colors",title:"Clear search",children:(0,D.jsx)(m.A,{size:16})})]}),Ve&&(0,D.jsx)("div",{className:"mt-2 text-xs text-slate-400",children:(0,D.jsxs)("div",{className:"space-y-1",children:[(0,D.jsxs)("div",{className:"flex items-center justify-between",children:[(0,D.jsx)("span",{children:"\u2713 Searching: titles, diagnoses, case IDs, categories"}),(0,D.jsxs)("span",{className:"bg-slate-600 px-2 py-1 rounded text-xs",children:[qe," ",1===qe?"result":"results"]})]}),(0,D.jsx)("div",{children:'\u2713 Try: "mood disorders", "case-123", "anxiety", "bipolar"'}),(0,D.jsx)("div",{className:"text-slate-500",children:"Press Esc to clear search"})]})}),!Ve&&(0,D.jsxs)("div",{className:"mt-2 space-y-2",children:[(0,D.jsx)("div",{className:"text-xs text-slate-500",children:'Search examples: "depression", "CASE-101", "mood disorders"'}),(0,D.jsx)("div",{className:"flex flex-wrap gap-1",children:["depression","anxiety","bipolar","psychosis","mood disorders","case"].map(e=>(0,D.jsx)("button",{onClick:()=>Ge(e),className:"px-2 py-1 bg-slate-700 hover:bg-slate-600 text-xs text-slate-300 rounded transition-colors",children:e},e))})]})]}),(0,D.jsxs)("div",{className:"mb-6",children:[(0,D.jsx)("h3",{className:"text-sm font-semibold text-slate-300 mb-3",children:"Filter by Category"}),(0,D.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,D.jsx)("button",{onClick:()=>se(null),className:"px-3 py-2 rounded-lg text-xs transition-all "+(null===te?"bg-teal-600 text-white":"bg-slate-700 text-slate-300 hover:bg-slate-600"),children:"All"}),(0,D.jsxs)("button",{onClick:()=>se("topic"),className:"px-3 py-2 rounded-lg text-xs transition-all flex items-center gap-1 "+("topic"===te?"bg-blue-600 text-white":"bg-slate-700 text-slate-300 hover:bg-slate-600"),children:[(0,D.jsx)(x.A,{size:12}),"Topics"]}),(0,D.jsxs)("button",{onClick:()=>se("case"),className:"px-3 py-2 rounded-lg text-xs transition-all flex items-center gap-1 "+("case"===te?"bg-indigo-600 text-white":"bg-slate-700 text-slate-300 hover:bg-slate-600"),children:[(0,D.jsx)(b.A,{size:12}),"Cases"]}),(0,D.jsxs)("button",{onClick:()=>se("task"),className:"px-3 py-2 rounded-lg text-xs transition-all flex items-center gap-1 "+("task"===te?"bg-amber-600 text-white":"bg-slate-700 text-slate-300 hover:bg-slate-600"),children:[(0,D.jsx)(v.A,{size:12}),"Tasks"]}),(0,D.jsxs)("button",{onClick:()=>se("literature"),className:"px-3 py-2 rounded-lg text-xs transition-all flex items-center gap-1 "+("literature"===te?"bg-purple-600 text-white":"bg-slate-700 text-slate-300 hover:bg-slate-600"),children:[(0,D.jsx)(f.A,{size:12}),"Literature"]})]})]}),(0,D.jsx)("div",{className:"mb-4 p-3 bg-slate-700 bg-opacity-50 rounded-lg",children:(0,D.jsx)("div",{className:"flex items-center gap-2 text-xs",children:Pe?(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(p.A,{size:12,className:"animate-spin"}),(0,D.jsx)("span",{className:"text-amber-300",children:"Saving..."})]}):Se?(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(S.A,{size:12,className:"text-green-400"}),(0,D.jsxs)("span",{className:"text-slate-300",children:["Last saved: ",Se.toLocaleTimeString()]})]}):(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(A.A,{size:12,className:"text-slate-400"}),(0,D.jsx)("span",{className:"text-slate-400",children:"Auto-save enabled"})]})})}),(0,D.jsxs)("div",{className:"space-y-3 mb-6",children:[(0,D.jsx)(De,{onClick:St,icon:O.A,className:"w-full bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-md text-sm",children:"Realign Nodes"}),(0,D.jsx)(De,{onClick:()=>Ze(!0),icon:_.A,className:"w-full bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-md text-sm",children:"Manage Templates"}),(0,D.jsx)(De,{onClick:()=>Oe(F,ut,ct),icon:f.A,className:"w-full bg-emerald-600 hover:bg-emerald-700 text-white px-4 py-2 rounded-md text-sm",children:"Add Sample Literature"}),(0,D.jsx)(De,{onClick:()=>Y(!B),icon:B?k.A:z.A,className:"w-full px-4 py-2 rounded-md text-sm "+(B?"bg-teal-600":"bg-slate-600"),children:B?"Exit Edit Mode":"Edit Mind Map"}),(0,D.jsx)(De,{onClick:()=>ie(!0),icon:N.A,className:"w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md text-sm",children:"Add New Node"}),(0,D.jsx)(De,{onClick:At,icon:P.A,className:"w-full bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-md text-sm",children:"Clear All Data"})]}),H&&(0,D.jsxs)("div",{className:"mt-auto p-4 bg-slate-700 bg-opacity-50 rounded-lg",children:[(0,D.jsx)("h3",{className:"text-sm font-semibold text-slate-300 mb-2",children:"Selected Node"}),(0,D.jsxs)("div",{className:"space-y-2",children:[(0,D.jsxs)("div",{className:"flex items-center gap-2",children:["topic"===H.type&&(0,D.jsx)(x.A,{size:14,className:"text-blue-400"}),"case"===H.type&&(0,D.jsx)(b.A,{size:14,className:"text-indigo-400"}),"task"===H.type&&(0,D.jsx)(v.A,{size:14,className:"text-amber-400"}),"literature"===H.type&&(0,D.jsx)(f.A,{size:14,className:"text-purple-400"}),(0,D.jsx)("span",{className:"text-sm text-white font-medium truncate",children:H.data.label})]}),H.data.category&&(0,D.jsxs)("div",{className:"text-xs text-slate-400",children:["Category: ",H.data.category]}),H.data.status&&(0,D.jsxs)("div",{className:"text-xs text-slate-400",children:["Status: ",H.data.status]}),(0,D.jsxs)("button",{onClick:()=>{const[e,t]=H.id.split("-"),s=L["literature"===e?"literature":`${e}s`].find(e=>String(e.id)===t);s&&("case"===e?oe({isOpen:!0,data:s}):"topic"===e?ne({isOpen:!0,data:s}):"task"===e?ue({isOpen:!0,data:s}):"literature"===e&&mt(s))},className:"w-full mt-2 px-3 py-2 bg-slate-600 hover:bg-slate-500 text-white text-xs rounded-lg transition-colors flex items-center gap-2",children:[(0,D.jsx)(T.A,{size:12}),"View Details"]})]})]}),!H&&(0,D.jsxs)("div",{className:"mt-auto p-3 bg-slate-700 bg-opacity-30 rounded-lg",children:[(0,D.jsx)("h4",{className:"text-xs font-semibold text-slate-300 mb-2",children:"Keyboard Shortcuts"}),(0,D.jsxs)("div",{className:"space-y-1 text-xs text-slate-400",children:[(0,D.jsx)("div",{children:"Ctrl+N - Add Node"}),(0,D.jsx)("div",{children:"Ctrl+E - Toggle Edit Mode"}),(0,D.jsx)("div",{children:"Ctrl+R - Realign Nodes"}),(0,D.jsx)("div",{children:"Esc - Clear Selection"})]})]})]}),(0,D.jsx)("div",{className:"flex-1 relative",children:(0,D.jsx)(Re,{children:(0,D.jsxs)(l.Gc,{nodes:j,edges:I,onNodesChange:Ot,onEdgesChange:$,onConnect:bt,onNodeClick:yt,onNodeDoubleClick:vt,onNodeDragStop:_t,onEdgeDoubleClick:ft,onEdgeContextMenu:jt,onEdgeMouseEnter:wt,onEdgeMouseLeave:kt,nodeTypes:Me,edgeTypes:{floating:je,enhanced:we},nodesDraggable:!0,nodesConnectable:B,elementsSelectable:!0,onInit:e=>{ge(!0),window.reactFlowInstance=e},onError:(e,t)=>{console.warn("React Flow Error:",e,t),!st||t.includes("dimensions")},fitView:!0,snapToGrid:!1,snapGrid:[15,15],elevateEdgesOnSelect:!1,connectionLineComponent:ke,connectionLineStyle:{stroke:"#3b82f6",strokeWidth:3.5,opacity:.9,strokeLinecap:"round",strokeDasharray:"5,3",filter:"drop-shadow(0 0 6px rgba(59, 130, 246, 0.6))",animation:"flowingDash 1s linear infinite"},defaultEdgeOptions:{type:"enhanced",style:{strokeWidth:2.5,stroke:"#64748b",opacity:.9,strokeLinecap:"round",transition:"none"}},className:"bg-gradient-to-br from-blue-50 to-indigo-100",children:[(0,D.jsx)(l.VS,{color:"#aaa",gap:16}),(0,D.jsx)(l.H2,{}),(0,D.jsx)(l.of,{})]})})}),Qe&&(0,D.jsx)(X,{isOpen:Qe,onClose:()=>Ze(!1),templates:Be,setTemplates:Ye}),et.isOpen&&(0,D.jsx)(R,{isOpen:et.isOpen,onClose:()=>{at(!0),tt({isOpen:!1,data:null}),setTimeout(()=>at(!1),500)},onAnimationStart:()=>at(!0),onAnimationEnd:()=>at(!1),literatureData:et.data,allNodes:j,connections:L.connections||[],setMindMapData:F,autoSaveMindMapData:ut,addToast:ct}),ae&&(0,D.jsx)($e,{isOpen:ae,onClose:()=>ie(!1),onSelect:(e,t)=>{var s,a,i,r;ie(!1);const o=Date.now(),l=`${e}-${o}`;let n={id:o,label:`New ${e}`};"case"===e&&(n={...n,chiefComplaint:"",initialPresentation:"",currentPresentation:"",medicationHistory:"",therapyProgress:"",defensePatterns:"",clinicalReflection:""});const c=((null===(s=L.topics)||void 0===s?void 0:s.length)||0)+((null===(a=L.cases)||void 0===a?void 0:a.length)||0)+((null===(i=L.tasks)||void 0===i?void 0:i.length)||0)+((null===(r=L.literature)||void 0===r?void 0:r.length)||0),d=Math.ceil(Math.sqrt(c+1)),u={x:c%d*280+400,y:280*Math.floor(c/d)+150},p={id:l,type:e,position:u,data:{...n,onDelete:()=>pt(l)}};F(t=>{const s="literature"===e?"literature":`${e}s`,a={...p.data,position:p.position};delete a.onDelete;const i={...t,[s]:[...t[s]||[],a]};return ut(i),i}),w(e=>e.concat(p))},templates:Be}),(0,D.jsx)(o.N,{mode:"wait",children:re.isOpen&&(0,D.jsx)(Q,{isOpen:re.isOpen,data:pe.current||re.data,onClose:()=>{rt(e=>({...e,case:!0})),oe({isOpen:!1,data:null})},onAnimationStart:()=>{at(!0),rt(e=>({...e,case:!0}))},onAnimationEnd:()=>{at(!1),rt(e=>({...e,case:!1}))},setMindMapData:F,autoSaveMindMapData:ut,addToast:ct},`case-modal-${(null===(i=re.data)||void 0===i?void 0:i.id)||"default"}`)}),(0,D.jsx)(o.N,{mode:"wait",children:le.isOpen&&(0,D.jsx)(ce,{isOpen:le.isOpen,data:me.current||le.data,onClose:()=>{rt(e=>({...e,topic:!0})),ne({isOpen:!1,data:null})},onAnimationStart:()=>{at(!0),rt(e=>({...e,topic:!0}))},onAnimationEnd:()=>{at(!1),rt(e=>({...e,topic:!1}))},setMindMapData:F,autoSaveMindMapData:ut,addToast:ct},`topic-modal-${(null===(c=le.data)||void 0===c?void 0:c.id)||"default"}`)}),(0,D.jsx)(o.N,{mode:"wait",children:de.isOpen&&(0,D.jsx)(ye,{isOpen:de.isOpen,data:xe.current||de.data,onClose:()=>{rt(e=>({...e,task:!0})),ue({isOpen:!1,data:null})},onAnimationStart:()=>{at(!0),rt(e=>({...e,task:!0}))},onAnimationEnd:()=>{at(!1),rt(e=>({...e,task:!1}))},setMindMapData:F,autoSaveMindMapData:ut,addToast:ct},`task-modal-${(null===(d=de.data)||void 0===d?void 0:d.id)||"default"}`)}),(0,D.jsx)(Le,{isOpen:Xe.isOpen,edge:Xe.edge,onClose:()=>Fe({isOpen:!1,edge:null}),onSave:Nt}),J&&(0,D.jsx)("div",{className:"absolute inset-0 bg-white bg-opacity-80 flex items-center justify-center z-50",children:(0,D.jsx)(p.A,{size:48,className:"animate-spin text-blue-600"})}),Je.map(e=>(0,D.jsx)(Te,{message:e.message,type:e.type,duration:e.duration,onClose:()=>dt(e.id)},e.id))]})};class Re extends a.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(e){return e.message&&e.message.includes("dimensions")?(console.warn("React Flow dimension error caught, recovering..."),{hasError:!1}):{hasError:!0}}componentDidCatch(e,t){e.message&&e.message.includes("dimensions")?setTimeout(()=>{window.reactFlowInstance&&window.reactFlowInstance.fitView()},100):console.error("React Flow Error:",e,t)}render(){return this.state.hasError?(0,D.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,D.jsxs)("div",{className:"text-center",children:[(0,D.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Mind Map Temporarily Unavailable"}),(0,D.jsx)("p",{className:"text-gray-600 mb-4",children:"There was an issue with the mind map. Please refresh the page."}),(0,D.jsx)("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Refresh Page"})]})}):this.props.children}}const Fe=()=>(0,D.jsx)(l.Ln,{children:(0,D.jsx)(Xe,{})});const Be=function(){return(0,D.jsx)(Fe,{})};i.createRoot(document.getElementById("root")).render((0,D.jsx)(a.StrictMode,{children:(0,D.jsx)(Be,{})}))}},t={};function s(a){var i=t[a];if(void 0!==i)return i.exports;var r=t[a]={id:a,loaded:!1,exports:{}};return e[a](r,r.exports,s),r.loaded=!0,r.exports}s.m=e,(()=>{var e=[];s.O=(t,a,i,r)=>{if(!a){var o=1/0;for(d=0;d<e.length;d++){a=e[d][0],i=e[d][1],r=e[d][2];for(var l=!0,n=0;n<a.length;n++)(!1&r||o>=r)&&Object.keys(s.O).every(e=>s.O[e](a[n]))?a.splice(n--,1):(l=!1,r<o&&(o=r));if(l){e.splice(d--,1);var c=i();void 0!==c&&(t=c)}}return t}r=r||0;for(var d=e.length;d>0&&e[d-1][2]>r;d--)e[d]=e[d-1];e[d]=[a,i,r]}})(),(()=>{var e,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__;s.t=function(a,i){if(1&i&&(a=this(a)),8&i)return a;if("object"===typeof a&&a){if(4&i&&a.__esModule)return a;if(16&i&&"function"===typeof a.then)return a}var r=Object.create(null);s.r(r);var o={};e=e||[null,t({}),t([]),t(t)];for(var l=2&i&&a;("object"==typeof l||"function"==typeof l)&&!~e.indexOf(l);l=t(l))Object.getOwnPropertyNames(l).forEach(e=>o[e]=()=>a[e]);return o.default=()=>a,s.d(r,o),r}})(),s.d=(e,t)=>{for(var a in t)s.o(t,a)&&!s.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},s.f={},s.e=e=>Promise.all(Object.keys(s.f).reduce((t,a)=>(s.f[a](e,t),t),[])),s.u=e=>"static/js/"+e+"."+{213:"c0413f75",261:"de3004f3",524:"c4c81a9f"}[e]+".chunk.js",s.miniCssF=e=>{},s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={},t="frontend:";s.l=(a,i,r,o)=>{if(e[a])e[a].push(i);else{var l,n;if(void 0!==r)for(var c=document.getElementsByTagName("script"),d=0;d<c.length;d++){var u=c[d];if(u.getAttribute("src")==a||u.getAttribute("data-webpack")==t+r){l=u;break}}l||(n=!0,(l=document.createElement("script")).charset="utf-8",l.timeout=120,s.nc&&l.setAttribute("nonce",s.nc),l.setAttribute("data-webpack",t+r),l.src=a),e[a]=[i];var p=(t,s)=>{l.onerror=l.onload=null,clearTimeout(m);var i=e[a];if(delete e[a],l.parentNode&&l.parentNode.removeChild(l),i&&i.forEach(e=>e(s)),t)return t(s)},m=setTimeout(p.bind(null,void 0,{type:"timeout",target:l}),12e4);l.onerror=p.bind(null,l.onerror),l.onload=p.bind(null,l.onload),n&&document.head.appendChild(l)}}})(),s.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),s.p="/",(()=>{var e={792:0};s.f.j=(t,a)=>{var i=s.o(e,t)?e[t]:void 0;if(0!==i)if(i)a.push(i[2]);else{var r=new Promise((s,a)=>i=e[t]=[s,a]);a.push(i[2]=r);var o=s.p+s.u(t),l=new Error;s.l(o,a=>{if(s.o(e,t)&&(0!==(i=e[t])&&(e[t]=void 0),i)){var r=a&&("load"===a.type?"missing":a.type),o=a&&a.target&&a.target.src;l.message="Loading chunk "+t+" failed.\n("+r+": "+o+")",l.name="ChunkLoadError",l.type=r,l.request=o,i[1](l)}},"chunk-"+t,t)}},s.O.j=t=>0===e[t];var t=(t,a)=>{var i,r,o=a[0],l=a[1],n=a[2],c=0;if(o.some(t=>0!==e[t])){for(i in l)s.o(l,i)&&(s.m[i]=l[i]);if(n)var d=n(s)}for(t&&t(a);c<o.length;c++)r=o[c],s.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return s.O(d)},a=self.webpackChunkfrontend=self.webpackChunkfrontend||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))})();var a=s.O(void 0,[967,497,96],()=>s(8806));a=s.O(a)})();
//# sourceMappingURL=main.564995f0.js.map