(()=>{"use strict";var e={964:(e,t,a)=>{var i=a(5043),s=a(4391),n=(a(411),a(6213)),r=a(3546);const o=[{id:"entry-001",timestamp:"2024-01-14T10:00:00Z",date:"2024-01-14",title:"Initial Assessment",type:"patient",patientData:{chiefComplaint:"Feeling increasingly anxious and unable to concentrate at work",currentStatus:"First visit - seeking help for anxiety symptoms",notes:"Patient reports 3-month history of generalized anxiety, sleep disturbances, and difficulty focusing. No prior psychiatric treatment."},clinicalData:{chiefComplaint:"Generalized Anxiety Disorder assessment",currentStatus:"Initial diagnostic evaluation completed",notes:"GAD-7 score: 14 (moderate anxiety). Recommended CBT and consider medication. No suicidal ideation. Good insight and motivation for treatment."}},{id:"entry-002",timestamp:"2024-01-31T14:00:00Z",date:"2024-01-31",title:"Follow-up Visit",type:"clinical",patientData:{chiefComplaint:"Some improvement in sleep, but still feeling very anxious during work meetings",currentStatus:"Two weeks on sertraline 50mg, attending weekly therapy",notes:"Medication side effects minimal. Using breathing techniques learned in therapy with some success. Still avoiding certain social situations."},clinicalData:{chiefComplaint:"Medication response evaluation",currentStatus:"Partial response to initial treatment",notes:"GAD-7 score: 11 (mild-moderate). Continue sertraline, increase to 75mg. Therapy showing good engagement. Consider exposure exercises."}},{id:"entry-003",timestamp:"2024-02-14T11:00:00Z",date:"2024-02-14",title:"Therapy Session",type:"patient",patientData:{chiefComplaint:"Had a panic attack at work last week, but handled it better than before",currentStatus:"Learning coping strategies, medication helping with baseline anxiety",notes:"Successfully used grounding techniques during panic attack. Feeling more confident about managing symptoms. Sleep much improved."},clinicalData:{chiefComplaint:"Panic episode management and progress review",currentStatus:"Good therapeutic progress with CBT techniques",notes:"Patient demonstrating skill acquisition in anxiety management. Panic attack was brief and well-managed. Continue current treatment plan."}},{id:"entry-004",timestamp:"2024-02-29T16:00:00Z",date:"2024-02-29",title:"Medication Review",type:"clinical",patientData:{chiefComplaint:"Feeling much more stable, anxiety is manageable most days",currentStatus:"Sertraline 75mg working well, regular therapy sessions",notes:"Returned to normal work performance. Able to participate in meetings without significant anxiety. Relationship with partner improving."},clinicalData:{chiefComplaint:"Treatment response assessment",currentStatus:"Good response to combined therapy and medication",notes:"GAD-7 score: 6 (mild). Significant improvement achieved. Plan to continue current dose, transition to bi-weekly therapy sessions."}},{id:"entry-005",timestamp:"2024-03-14T13:00:00Z",date:"2024-03-14",title:"Relapse Prevention",type:"patient",patientData:{chiefComplaint:"Doing well overall, want to focus on preventing future episodes",currentStatus:"Stable on current treatment, learning long-term management",notes:"Confident in ability to manage anxiety symptoms. Interested in gradually reducing therapy frequency while maintaining medication."},clinicalData:{chiefComplaint:"Maintenance and relapse prevention planning",currentStatus:"Treatment goals largely achieved, planning maintenance phase",notes:"Excellent treatment response. Develop relapse prevention plan, continue medication, monthly check-ins. Consider therapy as needed basis."}}];var l=a(8270),d=a(579);const c=()=>{const e=(0,i.useRef)(null);return(0,i.useEffect)(()=>{e.current&&l.os.to(e.current,{duration:2,x:200,rotation:360,backgroundColor:"blue",repeat:-1,yoyo:!0})},[]),(0,d.jsxs)("div",{className:"p-8",children:[(0,d.jsx)("h1",{className:"text-2xl font-bold mb-4",children:"GSAP Test"}),(0,d.jsx)("div",{ref:e,className:"w-16 h-16 bg-red-500 rounded"}),(0,d.jsx)("p",{className:"mt-4",children:"If GSAP is working, you should see the red box animating."})]})};var u=a(6446),p=a(5088),m=a(7118),x=a(4537),h=a(614),g=a(2667);const b={hidden:{opacity:0,backdropFilter:"blur(0px)"},visible:{opacity:.75,backdropFilter:"blur(4px)",transition:{duration:.3,ease:"easeOut"}},exit:{opacity:0,backdropFilter:"blur(0px)",transition:{duration:.2,ease:"easeIn"}}},f={hidden:{opacity:0,scale:.3,y:50,rotate:-5},visible:{opacity:1,scale:1,y:0,rotate:0,transition:{type:"spring",stiffness:300,damping:25,duration:.5}},exit:{opacity:0,scale:.8,y:-20,transition:{duration:.2,ease:"easeIn"}}},y=e=>{let{isOpen:t,onClose:a,title:s="Patient Timeline",data:n=o,onNodeClick:l,onNodeHover:c}=e;const[y,v]=(0,i.useState)(!1),w=(0,i.useCallback)(()=>{y||(v(!0),setTimeout(()=>{v(!1),a()},200))},[a,y]),j=(0,i.useCallback)(e=>{console.log("Timeline node clicked:",e),null===l||void 0===l||l(e)},[l]),N=(0,i.useCallback)((e,t)=>{console.log("Timeline node hover:",e.id,t),null===c||void 0===c||c(e,t)},[c]);return t?(0,d.jsx)(r.N,{mode:"wait",onExitComplete:()=>{v(!1)},children:t&&(0,d.jsx)(u.P.div,{initial:"hidden",animate:"visible",exit:"exit",variants:b,className:"fixed inset-0 bg-black flex items-center justify-center z-50 p-4",style:{willChange:"backdrop-filter, opacity",backfaceVisibility:"hidden",transform:"translate3d(0, 0, 0)"},onClick:e=>e.target===e.currentTarget&&w(),children:(0,d.jsxs)(u.P.div,{initial:"hidden",animate:"visible",exit:"exit",variants:f,className:"bg-white rounded-2xl shadow-2xl w-full max-w-6xl max-h-[90vh] overflow-hidden",style:{willChange:"transform, opacity, scale",backfaceVisibility:"hidden"},onClick:e=>e.stopPropagation(),children:[(0,d.jsx)("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border-b border-gray-200 p-6",children:(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,d.jsx)("div",{className:"p-2 bg-blue-100 rounded-lg",children:(0,d.jsx)(p.A,{className:"h-6 w-6 text-blue-600"})}),(0,d.jsxs)("div",{children:[(0,d.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:s}),(0,d.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"Interactive patient timeline with drag-and-drop nodes"})]})]}),(0,d.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,d.jsxs)("div",{className:"flex items-center space-x-2 text-sm text-gray-500",children:[(0,d.jsx)(m.A,{className:"h-4 w-4"}),(0,d.jsxs)("span",{children:[n.length," nodes"]})]}),(0,d.jsxs)("div",{className:"flex items-center space-x-2 text-sm text-gray-500",children:[(0,d.jsx)(x.A,{className:"h-4 w-4"}),(0,d.jsx)("span",{children:"Interactive"})]}),(0,d.jsx)(u.P.button,{onClick:w,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",whileHover:{scale:1.1},whileTap:{scale:.9},children:(0,d.jsx)(h.A,{className:"h-5 w-5 text-gray-500"})})]})]})}),(0,d.jsx)("div",{className:"relative",style:{height:"calc(90vh - 120px)"},children:(0,d.jsx)(g.A,{data:n,onNodeClick:j,onNodeHover:N})}),(0,d.jsx)("div",{className:"bg-gray-50 border-t border-gray-200 px-6 py-4",children:(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsxs)("div",{className:"text-sm text-gray-600",children:[(0,d.jsx)("span",{className:"font-medium",children:"Instructions:"})," Drag nodes to reposition \u2022 Hover for details \u2022 Click to edit"]}),(0,d.jsx)("div",{className:"text-xs text-gray-500",children:"Timeline Modal \u2022 Interactive Mode"})]})})]},"timeline-modal-content")},"timeline-modal-backdrop")}):null},v=()=>{const[e,t]=(0,i.useState)(!0),[a,s]=(0,i.useState)(!1),[n,r]=(0,i.useState)(!1);(0,i.useEffect)(()=>{const e=setTimeout(()=>{t(!1)},500);return()=>clearTimeout(e)},[]);return e?(0,d.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-gray-100",children:(0,d.jsx)("div",{className:"text-lg text-gray-600",children:"Loading timeline test..."})}):(0,d.jsxs)("div",{className:"min-h-screen bg-gray-100",children:[(0,d.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,d.jsxs)("div",{className:"mb-8",children:[(0,d.jsx)("h1",{className:"text-3xl font-bold text-gray-800 mb-2",children:"Interactive Patient Timeline"}),(0,d.jsx)("p",{className:"text-gray-600",children:"Test timeline components in modal and standalone formats"}),(0,d.jsxs)("div",{className:"mt-4 space-x-4",children:[(0,d.jsx)("button",{onClick:()=>r(!0),className:"px-6 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 shadow-md hover:shadow-lg transition-all duration-200",children:"Open Timeline Modal"}),(0,d.jsx)("button",{onClick:()=>s(!a),className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600",children:a?"Hide Simple GSAP Test":"Show Simple GSAP Test"})]})]}),a&&(0,d.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-6 mb-8",children:[(0,d.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Simple GSAP Test"}),(0,d.jsx)(c,{})]}),(0,d.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,d.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Timeline Features"}),(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,d.jsxs)("div",{className:"space-y-2",children:[(0,d.jsx)("h3",{className:"font-semibold text-gray-800",children:"Modal Interface"}),(0,d.jsxs)("ul",{className:"text-sm text-gray-600 space-y-1",children:[(0,d.jsx)("li",{children:"\u2022 Timeline contained within a professional modal"}),(0,d.jsx)("li",{children:"\u2022 Matches existing mind map modal styling"}),(0,d.jsx)("li",{children:"\u2022 Proper backdrop blur and animations"}),(0,d.jsx)("li",{children:"\u2022 Responsive sizing with scroll containment"})]})]}),(0,d.jsxs)("div",{className:"space-y-2",children:[(0,d.jsx)("h3",{className:"font-semibold text-gray-800",children:"Interaction"}),(0,d.jsxs)("ul",{className:"text-sm text-gray-600 space-y-1",children:[(0,d.jsx)("li",{children:"\u2022 Drag nodes with instant 1:1 mouse tracking"}),(0,d.jsx)("li",{children:"\u2022 Hover over nodes to see patient/clinical cards"}),(0,d.jsx)("li",{children:"\u2022 Click nodes to edit both cards simultaneously"}),(0,d.jsx)("li",{children:"\u2022 Add new nodes with smooth animations"})]})]})]})]})]}),(0,d.jsx)(y,{isOpen:n,onClose:()=>r(!1),title:"Patient Timeline - Interactive Mode",data:o,onNodeClick:e=>{console.log("Node clicked:",e)},onNodeHover:(e,t)=>{console.log("Node hover:",e.id,t)}})]})};var w=a(7845),j=a(7782),N=a(6833),k=a(7819),C=a(7856),S=a(2024),_=a(8693),T=a(6382),A=a(9917),D=a(2626),z=a(2054),P=a(1827),O=a(2119),$=a(9855),E=a(5087);const I=e=>{let{message:t="Loading..."}=e;return(0,d.jsx)("div",{className:"flex items-center justify-center p-8",children:(0,d.jsxs)("div",{className:"flex flex-col items-center gap-2",children:[(0,d.jsx)(S.A,{className:"w-6 h-6 animate-spin text-blue-600"}),(0,d.jsx)("span",{className:"text-sm text-gray-600",children:t})]})})},M=(0,i.lazy)(()=>Promise.all([a.e(96),a.e(261)]).then(a.bind(a,6261))),L=(0,i.lazy)(()=>a.e(524).then(a.bind(a,4524))),X=(0,i.lazy)(()=>Promise.all([a.e(96),a.e(213)]).then(a.bind(a,4213))),H=(0,i.lazy)(()=>Promise.resolve().then(a.bind(a,9e3))),F=(0,i.lazy)(()=>Promise.resolve().then(a.bind(a,7173))),R=(0,i.lazy)(()=>Promise.resolve().then(a.bind(a,8531))),B=(e,t)=>a=>(0,d.jsx)(i.Suspense,{fallback:(0,d.jsx)(I,{message:t}),children:(0,d.jsx)(e,{...a})}),Y=(B(M,"Loading editor..."),B(L,"Loading templates..."),B(X,"Loading literature viewer..."));B(H,"Loading case details..."),B(F,"Loading topic details..."),B(R,"Loading task details...");var U=a(9e3),W=a(7173),G=a(8531);function q(e,t,a){const{x:i,y:s,width:n,height:r}=e,{x:o,y:l}=t,{x:d,y:c}=a,u=i,p=i+n,m=s,x=s+r,h=d-o,g=c-l;if(Math.abs(h)<.001)return{x:o,y:g>0?x:m,side:g>0?"bottom":"top"};if(Math.abs(g)<.001)return{x:h>0?p:u,y:l,side:h>0?"right":"left"};const b=g/h,f=l-b*o,y=[],v=b*u+f;v>=m&&v<=x&&y.push({x:u,y:v,side:"left",distance:Math.hypot(u-o,v-l)});const w=b*p+f;w>=m&&w<=x&&y.push({x:p,y:w,side:"right",distance:Math.hypot(p-o,w-l)});const j=(m-f)/b;j>=u&&j<=p&&y.push({x:j,y:m,side:"top",distance:Math.hypot(j-o,m-l)});const N=(x-f)/b;N>=u&&N<=p&&y.push({x:N,y:x,side:"bottom",distance:Math.hypot(N-o,x-l)});const k=y.filter(e=>{const t=e.x-o,a=e.y-l;return(h>0&&t>=0||h<0&&t<=0)&&(g>0&&a>=0||g<0&&a<=0)});return k.sort((e,t)=>e.distance-t.distance),k[0]||{x:o,y:l,side:"center"}}const V=(0,i.memo)(e=>{var t,a,s,n,r,o;let{id:l,source:c,target:u,sourceX:p,sourceY:m,targetX:x,targetY:h,sourcePosition:g,targetPosition:b,style:f={},markerEnd:y,markerStart:v,data:j,...N}=e;const{getNode:k}=(0,w.VH)();let C,S;try{C=k(c),S=k(u)}catch(z){C=null,S=null}const{edgePath:_,labelX:T,labelY:A}=(0,i.useMemo)(()=>{if(null!==j&&void 0!==j&&j.__isAnimating||null!==j&&void 0!==j&&j.__forceUpdate)return{edgePath:`M${p},${m} L${x},${h}`,labelX:(p+x)/2,labelY:(m+h)/2};if(!C||!S)return{edgePath:`M${p},${m} L${x},${h}`,labelX:(p+x)/2,labelY:(m+h)/2};try{var e,t,a,i,s,n,r,o,l,d;const c=Boolean(C.width||(null===(e=C.dimensions)||void 0===e?void 0:e.width)||(null===(t=C.data)||void 0===t?void 0:t.width)||(null===(a=C.style)||void 0===a?void 0:a.width)),u=Boolean(S.width||(null===(i=S.dimensions)||void 0===i?void 0:i.width)||(null===(s=S.data)||void 0===s?void 0:s.width)||(null===(n=S.style)||void 0===n?void 0:n.width));if(!c||!u)return{edgePath:`M${p},${m} L${x},${h}`,labelX:(p+x)/2,labelY:(m+h)/2};const g=e=>{var t,a,i,s;const n="topic"===e.type?180:200,r="topic"===e.type?50:100;return{width:e.width||(null===(t=e.dimensions)||void 0===t?void 0:t.width)||(null===(a=e.data)||void 0===a?void 0:a.width)||n,height:e.height||(null===(i=e.dimensions)||void 0===i?void 0:i.height)||(null===(s=e.data)||void 0===s?void 0:s.height)||r}},b=g(C),f=g(S),y=function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{sourcePosition:i={x:0,y:0},targetPosition:s={x:0,y:0},sourceWidth:n=200,sourceHeight:r=100,targetWidth:o=200,targetHeight:l=100,sourceX:d,sourceY:c,targetX:u,targetY:p,offset:m=0}=a;if(void 0!==d&&void 0!==c&&void 0!==u&&void 0!==p&&(n<=10||o<=10))return{sourceX:d,sourceY:c,targetX:u,targetY:p,sourceSide:"direct",targetSide:"direct"};const x={x:i.x+n/2,y:i.y+r/2},h={x:s.x+o/2,y:s.y+l/2},g={x:i.x,y:i.y,width:n,height:r},b={x:s.x,y:s.y,width:o,height:l},f=q(g,x,h),y=q(b,h,x),v=h.x-x.x,w=h.y-x.y,j=Math.sqrt(v*v+w*w);if(j>0){const e=v/j,t=w/j,a=3;f.x-=e*a,f.y-=t*a,y.x+=e*a,y.y+=t*a,m>0&&(f.x+=e*m,f.y+=t*m,y.x-=e*m,y.y-=t*m)}return!!a.debug&&(console.log("Source Node:",e),console.log("Target Node:",t),console.log("Source Intersection:",f),console.log("Target Intersection:",y)),{sourceX:f.x,sourceY:f.y,targetX:y.x,targetY:y.y,sourceSide:f.side,targetSide:y.side}}(C,S,{sourcePosition:{x:(null===(r=C.positionAbsolute)||void 0===r?void 0:r.x)||C.position.x,y:(null===(o=C.positionAbsolute)||void 0===o?void 0:o.y)||C.position.y},targetPosition:{x:(null===(l=S.positionAbsolute)||void 0===l?void 0:l.x)||S.position.x,y:(null===(d=S.positionAbsolute)||void 0===d?void 0:d.y)||S.position.y},sourceX:p,sourceY:m,targetX:x,targetY:h,sourceWidth:b.width,sourceHeight:b.height,targetWidth:f.width,targetHeight:f.height,debug:!1}),{sourceX:v,sourceY:w,targetX:j,targetY:N}=y;return{edgePath:`M ${v},${w} L ${j},${N}`,labelX:(v+j)/2,labelY:(w+N)/2}}catch(z){return console.warn("FloatingEdge calculation error:",z),{edgePath:`M${p},${m} L${x},${h}`,labelX:(p+x)/2,labelY:(m+h)/2}}},[c,u,p,m,x,h,null===j||void 0===j?void 0:j.__forceUpdate,null===j||void 0===j?void 0:j.__isAnimating,null===(t=C)||void 0===t?void 0:t.id,null===(a=S)||void 0===a?void 0:a.id,null===(s=C)||void 0===s?void 0:s.width,null===(n=C)||void 0===n?void 0:n.height,null===(r=S)||void 0===r?void 0:r.width,null===(o=S)||void 0===o?void 0:o.height]),D=((e,t)=>{const a={stroke:"#64748b",strokeWidth:3,strokeLinecap:"round",strokeOpacity:.95,filter:"drop-shadow(0 1px 2px rgba(0,0,0,0.1))",transition:"none"};if(!e||!t)return a;const i=e.type,s=t.type;return"case"===i&&"topic"===s?{...a,stroke:"url(#case-to-topic-gradient)",strokeWidth:3.5,strokeDasharray:""}:"topic"===i&&"literature"===s?{...a,stroke:"url(#topic-to-literature-gradient)",strokeWidth:3,strokeDasharray:""}:"topic"===i&&"task"===s?{...a,stroke:"url(#topic-to-task-gradient)",strokeWidth:3,strokeDasharray:"8,4"}:{...a,...f}})(C,S);return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)("defs",{children:[(0,d.jsxs)("linearGradient",{id:"case-to-topic-gradient",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[(0,d.jsx)("stop",{offset:"0%",stopColor:"#3b82f6"}),(0,d.jsx)("stop",{offset:"100%",stopColor:"#8b5cf6"})]}),(0,d.jsxs)("linearGradient",{id:"topic-to-literature-gradient",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[(0,d.jsx)("stop",{offset:"0%",stopColor:"#8b5cf6"}),(0,d.jsx)("stop",{offset:"100%",stopColor:"#d946ef"})]}),(0,d.jsxs)("linearGradient",{id:"topic-to-task-gradient",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[(0,d.jsx)("stop",{offset:"0%",stopColor:"#8b5cf6"}),(0,d.jsx)("stop",{offset:"100%",stopColor:"#f59e0b"})]})]}),selected&&(0,d.jsx)(w.tE,{path:_,style:{stroke:"rgba(255, 255, 255, 0.6)",strokeWidth:8,strokeLinecap:"round",strokeOpacity:.5,filter:"blur(4px)",transition:"none"}}),(0,d.jsx)(w.tE,{id:l,path:_,labelX:T,labelY:A,style:D,markerEnd:y,markerStart:v})]})},(e,t)=>{var a,i;return e.sourceX===t.sourceX&&e.sourceY===t.sourceY&&e.targetX===t.targetX&&e.targetY===t.targetY&&e.source===t.source&&e.target===t.target&&(null===(a=e.data)||void 0===a?void 0:a.__forceUpdate)===(null===(i=t.data)||void 0===i?void 0:i.__forceUpdate)}),J=V,K=(0,i.memo)(e=>{let{id:t,source:a,target:i,sourceX:s,sourceY:n,targetX:r,targetY:o,sourcePosition:l,targetPosition:c,style:u={},markerEnd:p,markerStart:m,label:x,sourceHandleId:h,targetHandleId:g,data:b,selected:f,animated:y}=e;const[v,N,k]=(0,j.Fp)({sourceX:s,sourceY:n,sourcePosition:l,targetX:r,targetY:o,targetPosition:c});return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)("defs",{children:[(0,d.jsxs)("linearGradient",{id:"case-to-topic-gradient",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[(0,d.jsx)("stop",{offset:"0%",stopColor:"#3b82f6"}),(0,d.jsx)("stop",{offset:"100%",stopColor:"#8b5cf6"})]}),(0,d.jsxs)("linearGradient",{id:"topic-to-literature-gradient",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[(0,d.jsx)("stop",{offset:"0%",stopColor:"#8b5cf6"}),(0,d.jsx)("stop",{offset:"100%",stopColor:"#d946ef"})]}),(0,d.jsxs)("linearGradient",{id:"topic-to-task-gradient",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[(0,d.jsx)("stop",{offset:"0%",stopColor:"#8b5cf6"}),(0,d.jsx)("stop",{offset:"100%",stopColor:"#f59e0b"})]})]}),f&&(0,d.jsx)(w.tE,{path:v,style:{stroke:"rgba(255, 255, 255, 0.6)",strokeWidth:8,strokeLinecap:"round",strokeOpacity:.5,filter:"blur(4px)"}}),(0,d.jsx)(w.tE,{id:t,path:v,style:((e,t,a)=>{const i={stroke:"#64748b",strokeWidth:3,strokeLinecap:"round",strokeOpacity:.95,filter:"drop-shadow(0 1px 2px rgba(0,0,0,0.1))"},s=(null===e||void 0===e?void 0:e.split("_")[0])||"",n=(null===t||void 0===t?void 0:t.split("_")[0])||"";return"case"===s&&"topic"===n?{...i,stroke:"url(#case-to-topic-gradient)",strokeWidth:3.5,strokeDasharray:""}:"topic"===s&&"literature"===n?{...i,stroke:"url(#topic-to-literature-gradient)",strokeWidth:3,strokeDasharray:""}:"topic"===s&&"task"===n?{...i,stroke:"url(#topic-to-task-gradient)",strokeWidth:3,strokeDasharray:"8,4"}:{...i,...a?{strokeWidth:4,filter:"drop-shadow(0 2px 4px rgba(0,0,0,0.2))"}:{},...u}})(a,i,f),markerEnd:p,markerStart:m}),x&&(0,d.jsx)(w.rV,{children:(0,d.jsx)("div",{style:{position:"absolute",transform:`translate(-50%, -50%) translate(${N}px,${k}px)`,fontSize:12,pointerEvents:"all",backdropFilter:"blur(4px)",transition:"all 0.3s ease"},className:"nodrag nopan px-2.5 py-1 rounded-full shadow-md text-xs font-medium\n              "+(f?"bg-indigo-100 text-indigo-700 ring-2 ring-indigo-200":"bg-white/90 text-gray-700"),children:x})})]})});K.displayName="EnhancedEdge";const Z=K,Q=e=>{let{fromX:t,fromY:a,toX:i,toY:s,connectionLineStyle:n}=e;const r=`M ${t},${a} L ${i},${s}`,o={stroke:"#3b82f6",strokeWidth:3.5,strokeLinecap:"round",strokeDasharray:"5,3",filter:"drop-shadow(0 0 6px rgba(59, 130, 246, 0.6))",animation:"flowingDash 1s linear infinite",...n};return(0,d.jsxs)("g",{children:[(0,d.jsx)("path",{d:r,fill:"none",style:o}),(0,d.jsx)("path",{d:r,fill:"none",stroke:"transparent",strokeWidth:15,style:{pointerEvents:"stroke"}})]})};var ee=a(6099);const te=e=>{let{message:t="Loading your mind map...",progress:a=null}=e;return(0,d.jsx)("div",{className:"fixed inset-0 bg-gradient-to-br from-blue-50 to-purple-50 flex items-center justify-center z-50",children:(0,d.jsxs)("div",{className:"text-center",children:[(0,d.jsxs)("div",{className:"relative mb-6",children:[(0,d.jsx)(T.A,{className:"w-16 h-16 text-blue-600 mx-auto animate-pulse"}),(0,d.jsx)(ee.A,{className:"w-6 h-6 text-purple-500 absolute -top-2 -right-2 animate-bounce"})]}),(0,d.jsxs)("div",{className:"flex items-center justify-center gap-3 mb-4",children:[(0,d.jsx)(S.A,{className:"w-6 h-6 animate-spin text-blue-600"}),(0,d.jsx)("span",{className:"text-lg font-medium text-gray-700",children:t})]}),null!==a&&(0,d.jsx)("div",{className:"w-64 bg-gray-200 rounded-full h-2 mx-auto mb-2",children:(0,d.jsx)("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300 ease-out",style:{width:`${Math.max(0,Math.min(100,a))}%`}})}),(0,d.jsx)("div",{className:"text-sm text-gray-500 max-w-md mx-auto mt-4",children:(0,d.jsx)("p",{children:"\ud83d\udca1 Tip: Use the force layout button to auto-arrange your nodes"})})]})})};var ae=a(9350);const ie=e=>{let{data:t,selected:a}=e;const[s,n]=(0,i.useState)(t.skipAnimation||!1),[r,o]=(0,i.useState)(!1);(0,i.useEffect)(()=>{if(!t.skipAnimation){const e=setTimeout(()=>n(!0),100);return()=>clearTimeout(e)}},[t.skipAnimation]);const l=t.flashcard_count>0?(t.completed_flashcards||0)/t.flashcard_count*100:0,c=t.color||"#3B82F6",u=(e=>({"#3B82F6":"#6366F1","#10B981":"#059669","#8B5CF6":"#7C3AED","#EC4899":"#DB2777","#F59E0B":"#D97706","#6B7280":"#4B5563","#EF4444":"#DC2626"}[e]||"#6366F1"))(c);return(0,d.jsxs)("div",{className:`group transition-all duration-700 relative transform \n        ${a?"scale-110":r?"scale-105":"scale-100"}\n        ${s?"opacity-100 translate-y-0":"opacity-0 scale-75 translate-y-8"}`,style:{width:"160px",height:"160px",borderRadius:"50%",background:`radial-gradient(circle at 30% 30%, ${c} 0%, ${u} 100%)`,color:"white",boxShadow:a?`0 0 30px 5px ${c}80, 0 8px 32px rgba(0,0,0,0.4), inset 0 -3px 8px rgba(255,255,255,0.2)`:r?`0 10px 30px -5px ${c}60, 0 8px 16px rgba(0,0,0,0.2), inset 0 -3px 8px rgba(255,255,255,0.2)`:`0 8px 25px -5px ${c}40, 0 4px 12px rgba(0,0,0,0.1), inset 0 -3px 8px rgba(255,255,255,0.1)`,transition:"all 0.7s cubic-bezier(0.34, 1.56, 0.64, 1), transform 0.3s ease, box-shadow 0.4s ease",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",padding:"1rem"},onMouseEnter:()=>o(!0),onMouseLeave:()=>o(!1),children:[(0,d.jsx)(w.h7,{id:"top",type:"source",position:j.yX.Top,className:"w-3 h-3 rounded-full transition-all duration-300 hover:scale-150 cursor-pointer \n          "+(a||r?"opacity-100":"opacity-0"),style:{left:"50%",transform:"translateX(-50%) translateY(-50%)",zIndex:2,border:"2px solid white",background:c,boxShadow:`0 0 10px 2px ${c}80`},isConnectable:!0}),(0,d.jsx)(w.h7,{id:"top",type:"target",position:j.yX.Top,className:"w-3 h-3 rounded-full transition-all duration-300 hover:scale-150 cursor-pointer \n          "+(a||r?"opacity-100":"opacity-0"),style:{left:"50%",transform:"translateX(-50%) translateY(-50%)",zIndex:1,border:"2px solid white",background:u,boxShadow:`0 0 10px 2px ${u}80`},isConnectable:!0}),(0,d.jsx)(w.h7,{id:"right",type:"source",position:j.yX.Right,className:"w-3 h-3 rounded-full transition-all duration-300 hover:scale-150 cursor-pointer \n          "+(a||r?"opacity-100":"opacity-0"),style:{top:"50%",transform:"translateY(-50%) translateX(50%)",zIndex:2,border:"2px solid white",background:c,boxShadow:`0 0 10px 2px ${c}80`},isConnectable:!0}),(0,d.jsx)(w.h7,{id:"right",type:"target",position:j.yX.Right,className:"w-3 h-3 rounded-full transition-all duration-300 hover:scale-150 cursor-pointer \n          "+(a||r?"opacity-100":"opacity-0"),style:{top:"50%",transform:"translateY(-50%) translateX(50%)",zIndex:1,border:"2px solid white",background:u,boxShadow:`0 0 10px 2px ${u}80`},isConnectable:!0}),(0,d.jsx)(w.h7,{id:"bottom",type:"source",position:j.yX.Bottom,className:"w-3 h-3 rounded-full transition-all duration-300 hover:scale-150 cursor-pointer \n          "+(a||r?"opacity-100":"opacity-0"),style:{left:"50%",transform:"translateX(-50%) translateY(50%)",zIndex:2,border:"2px solid white",background:c,boxShadow:`0 0 10px 2px ${c}80`},isConnectable:!0}),(0,d.jsx)(w.h7,{id:"bottom",type:"target",position:j.yX.Bottom,className:"w-3 h-3 rounded-full transition-all duration-300 hover:scale-150 cursor-pointer \n          "+(a||r?"opacity-100":"opacity-0"),style:{left:"50%",transform:"translateX(-50%) translateY(50%)",zIndex:1,border:"2px solid white",background:u,boxShadow:`0 0 10px 2px ${u}80`},isConnectable:!0}),(0,d.jsx)(w.h7,{id:"left",type:"source",position:j.yX.Left,className:"w-3 h-3 rounded-full transition-all duration-300 hover:scale-150 cursor-pointer \n          "+(a||r?"opacity-100":"opacity-0"),style:{top:"50%",transform:"translateY(-50%) translateX(-50%)",zIndex:2,border:"2px solid white",background:c,boxShadow:`0 0 10px 2px ${c}80`},isConnectable:!0}),(0,d.jsx)(w.h7,{id:"left",type:"target",position:j.yX.Left,className:"w-3 h-3 rounded-full transition-all duration-300 hover:scale-150 cursor-pointer \n          "+(a||r?"opacity-100":"opacity-0"),style:{top:"50%",transform:"translateY(-50%) translateX(-50%)",zIndex:1,border:"2px solid white",background:u,boxShadow:`0 0 10px 2px ${u}80`},isConnectable:!0}),(a||r)&&(0,d.jsx)("div",{className:"absolute inset-0 rounded-full pointer-events-none "+(a?"animate-pulse-subtle":""),style:{boxShadow:`0 0 0 3px rgba(255, 255, 255, ${a?"0.5":"0.3"})`,animation:a?"pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite":"none"}}),t.priority&&(0,d.jsx)("div",{className:"absolute -top-2 -right-2 z-10",children:(0,d.jsx)("div",{className:"w-7 h-7 rounded-full flex items-center justify-center text-xs font-bold border-2 border-white shadow-lg "+("high"===t.priority?"bg-gradient-to-br from-red-400 to-red-600":"medium"===t.priority?"bg-gradient-to-br from-amber-400 to-amber-600":"bg-gradient-to-br from-emerald-400 to-emerald-600"),children:"high"===t.priority?"!":"medium"===t.priority?"\u2022":"\u2713"})}),(0,d.jsx)("div",{className:"mb-2 relative",children:(0,d.jsx)("div",{className:"p-2 rounded-full bg-white/20 shadow-inner mb-1",children:(0,d.jsx)(T.A,{size:28,className:"drop-shadow-lg"})})}),(0,d.jsx)("div",{className:"font-semibold text-lg text-center mb-1 px-1",children:t.label}),(0,d.jsx)("div",{className:"text-xs opacity-90 text-center mb-2 px-1",children:t.category}),t.onDelete&&(0,d.jsx)("button",{onClick:e=>{e.preventDefault();const a=setTimeout(()=>{e.stopPropagation(),t.onDelete()},300);e.currentTarget.deleteTimeout=a},onDoubleClick:e=>{e.currentTarget.deleteTimeout&&(clearTimeout(e.currentTarget.deleteTimeout),e.currentTarget.deleteTimeout=null)},className:"absolute -bottom-1 -right-1 p-1.5 bg-white/30 hover:bg-white/50 rounded-full  transition-all duration-200 hover:scale-110 opacity-70 hover:opacity-100 backdrop-blur-sm",children:(0,d.jsx)(h.A,{size:14,className:"drop-shadow-sm"})}),t.flashcard_count>0&&(0,d.jsxs)("div",{className:"relative w-12 h-12 mx-auto mt-1",children:[(0,d.jsxs)("svg",{className:"w-full h-full",viewBox:"0 0 36 36",children:[(0,d.jsx)("circle",{cx:"18",cy:"18",r:"16",fill:"none",className:"stroke-white/30",strokeWidth:"3"}),(0,d.jsx)("circle",{cx:"18",cy:"18",r:"16",fill:"none",className:"stroke-white",strokeWidth:"3",strokeDasharray:100.5*l/100+" 100",strokeDashoffset:"25",strokeLinecap:"round",transform:"rotate(-90 18 18)"}),(0,d.jsxs)("text",{x:"18",y:"20",textAnchor:"middle",fontSize:"10",fill:"white",fontWeight:"bold",children:[Math.round(l),"%"]})]}),t.tags&&t.tags.length>0&&(0,d.jsxs)("div",{className:"absolute -bottom-1 -right-1 w-6 h-6 bg-white/30 backdrop-blur-sm rounded-full  flex items-center justify-center shadow-sm",children:[(0,d.jsx)(ae.A,{size:10}),(0,d.jsx)("span",{className:"text-[8px] font-bold ml-0.5",children:t.tags.length})]})]}),t.updated_at&&(0,d.jsx)("div",{className:"absolute -bottom-1 -left-1 w-5 h-5 rounded-full flex items-center justify-center bg-white/20 backdrop-blur-sm",children:(0,d.jsx)(p.A,{size:10,className:"opacity-80"})})]})};var se=a(8646);const ne={topic:ie,case:e=>{let{data:t,selected:a}=e;const[s,n]=(0,i.useState)(t.skipAnimation||!1),[r,o]=(0,i.useState)(!1);(0,i.useEffect)(()=>{if(!t.skipAnimation){const e=setTimeout(()=>n(!0),150);return()=>clearTimeout(e)}},[t.skipAnimation]);const l=e=>{switch(e){case"active":return"text-emerald-500";case"archived":return"text-slate-500";case"follow_up":return"text-amber-500";default:return"text-sky-500"}},c=(e=>{var t,a;const i=(null===(t=e.chief_complaint)||void 0===t?void 0:t.toLowerCase())||"",s=(null===(a=e.diagnosis)||void 0===a?void 0:a.toLowerCase())||"";return["emergency","urgent","crisis","acute","severe"].some(e=>i.includes(e)||s.includes(e))?"high":"normal"})(t),u=(e=>{switch(e){case"active":return"from-emerald-300 to-teal-500";case"archived":return"from-slate-300 to-slate-500";case"follow_up":return"from-amber-300 to-orange-500";default:return"from-sky-300 to-indigo-500"}})(t.status);return(0,d.jsxs)("div",{className:`group px-4 py-3 rounded-lg shadow-xl transition-all duration-600 min-w-[220px] relative transform \n        ${a?"scale-105":r?"scale-[1.03]":"scale-100"} ${s?"opacity-100 translate-y-0 rotate-0":"opacity-0 translate-y-6 rotate-1"}`,style:{transition:"all 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94), transform 0.3s ease",background:"linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%)",boxShadow:a?"0 10px 25px -5px rgba(59, 130, 246, 0.4), 0 8px 10px -6px rgba(59, 130, 246, 0.3)":r?"0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1)":"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)"},onMouseEnter:()=>o(!0),onMouseLeave:()=>o(!1),children:[(0,d.jsx)("div",{className:`absolute top-0 left-0 w-full h-1.5 bg-gradient-to-r ${u} rounded-t-lg`}),(0,d.jsx)(w.h7,{id:"top",type:"source",position:j.yX.Top,className:`w-3 h-3 rounded-full transition-all duration-300 transform hover:scale-150 cursor-pointer \n          ${a||r?"opacity-100":"opacity-0"}\n          shadow-md bg-gradient-to-br from-blue-400 to-indigo-600`,style:{left:"50%",transform:"translateX(-50%) translateY(-50%)",zIndex:2,border:"2px solid white"},isConnectable:!0}),(0,d.jsx)(w.h7,{id:"top",type:"target",position:j.yX.Top,className:`w-3 h-3 rounded-full transition-all duration-300 transform hover:scale-150 cursor-pointer \n          ${a||r?"opacity-100":"opacity-0"}\n          shadow-md bg-gradient-to-br from-violet-400 to-purple-600`,style:{left:"50%",transform:"translateX(-50%) translateY(-50%)",zIndex:1,border:"2px solid white"},isConnectable:!0}),(0,d.jsx)(w.h7,{id:"right",type:"source",position:j.yX.Right,className:`w-3 h-3 rounded-full transition-all duration-300 transform hover:scale-150 cursor-pointer \n          ${a||r?"opacity-100":"opacity-0"}\n          shadow-md bg-gradient-to-br from-blue-400 to-indigo-600`,style:{top:"50%",transform:"translateY(-50%) translateX(50%)",zIndex:2,border:"2px solid white"},isConnectable:!0}),(0,d.jsx)(w.h7,{id:"right",type:"target",position:j.yX.Right,className:`w-3 h-3 rounded-full transition-all duration-300 transform hover:scale-150 cursor-pointer \n          ${a||r?"opacity-100":"opacity-0"}\n          shadow-md bg-gradient-to-br from-violet-400 to-purple-600`,style:{top:"50%",transform:"translateY(-50%) translateX(50%)",zIndex:1,border:"2px solid white"},isConnectable:!0}),(0,d.jsx)(w.h7,{id:"bottom",type:"source",position:j.yX.Bottom,className:`w-3 h-3 rounded-full transition-all duration-300 transform hover:scale-150 cursor-pointer \n          ${a||r?"opacity-100":"opacity-0"}\n          shadow-md bg-gradient-to-br from-blue-400 to-indigo-600`,style:{left:"50%",transform:"translateX(-50%) translateY(50%)",zIndex:2,border:"2px solid white"},isConnectable:!0}),(0,d.jsx)(w.h7,{id:"bottom",type:"target",position:j.yX.Bottom,className:`w-3 h-3 rounded-full transition-all duration-300 transform hover:scale-150 cursor-pointer \n          ${a||r?"opacity-100":"opacity-0"}\n          shadow-md bg-gradient-to-br from-violet-400 to-purple-600`,style:{left:"50%",transform:"translateX(-50%) translateY(50%)",zIndex:1,border:"2px solid white"},isConnectable:!0}),(0,d.jsx)(w.h7,{id:"left",type:"source",position:j.yX.Left,className:`w-3 h-3 rounded-full transition-all duration-300 transform hover:scale-150 cursor-pointer \n          ${a||r?"opacity-100":"opacity-0"}\n          shadow-md bg-gradient-to-br from-blue-400 to-indigo-600`,style:{top:"50%",transform:"translateY(-50%) translateX(-50%)",zIndex:2,border:"2px solid white"},isConnectable:!0}),(0,d.jsx)(w.h7,{id:"left",type:"target",position:j.yX.Left,className:`w-3 h-3 rounded-full transition-all duration-300 transform hover:scale-150 cursor-pointer \n          ${a||r?"opacity-100":"opacity-0"}\n          shadow-md bg-gradient-to-br from-violet-400 to-purple-600`,style:{top:"50%",transform:"translateY(-50%) translateX(-50%)",zIndex:1,border:"2px solid white"},isConnectable:!0}),(a||r)&&(0,d.jsx)("div",{className:"absolute inset-0 rounded-lg pointer-events-none "+(a?"animate-pulse-subtle":""),style:{boxShadow:`0 0 0 2px rgba(59, 130, 246, ${a?"0.5":"0.3"})`,animation:a?"pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite":"none"}}),"high"===c&&(0,d.jsx)("div",{className:"absolute -top-2 -right-2 z-10",children:(0,d.jsx)("div",{className:"w-6 h-6 bg-gradient-to-br from-red-400 to-pink-600 rounded-full flex items-center justify-center border-2 border-white animate-pulse shadow-md",children:(0,d.jsx)(k.A,{size:14,className:"text-white drop-shadow-sm"})})}),(0,d.jsxs)("div",{className:"flex items-center gap-2 mt-4 mb-2 relative",children:[(0,d.jsxs)("div",{className:"flex items-center gap-1",children:[(0,d.jsx)("div",{className:`p-1 rounded-full bg-gradient-to-r ${u} shadow-inner`,children:(0,d.jsx)(m.A,{size:16,className:"text-white drop-shadow-sm"})}),t.linked_topics&&t.linked_topics.length>0&&(0,d.jsx)("div",{className:"text-xs bg-white/80 backdrop-blur-sm text-gray-700 px-2 py-0.5 rounded-full shadow-sm font-medium",children:t.linked_topics.length})]}),(0,d.jsx)("div",{className:"font-semibold text-sm text-gray-800 truncate flex-1",children:t.label}),t.onDelete&&(0,d.jsx)("button",{onClick:e=>{e.preventDefault();const a=setTimeout(()=>{e.stopPropagation(),t.onDelete()},300);e.currentTarget.deleteTimeout=a},onDoubleClick:e=>{e.currentTarget.deleteTimeout&&(clearTimeout(e.currentTarget.deleteTimeout),e.currentTarget.deleteTimeout=null)},className:"ml-auto p-1.5 hover:bg-red-50 rounded-full transition-all duration-200 hover:scale-110 opacity-70 hover:opacity-100 hover:text-red-500",children:(0,d.jsx)(h.A,{size:14,className:"drop-shadow-sm"})})]}),(0,d.jsx)("div",{className:"text-xs text-gray-600 mb-3 font-medium truncate backdrop-blur-sm bg-white/50 rounded px-2 py-1",children:t.diagnosis}),(0,d.jsxs)("div",{className:"space-y-2",children:[t.age&&(0,d.jsxs)("div",{className:"text-xs font-medium flex items-center gap-1.5",children:[(0,d.jsx)(se.A,{size:12,className:l(t.status)}),(0,d.jsxs)("span",{children:["Age: ",(0,d.jsx)("span",{className:"font-semibold",children:t.age})]})]}),t.status&&(0,d.jsx)("span",{className:`inline-block px-2.5 py-1 rounded-full text-xs font-medium shadow-sm bg-white/70 backdrop-blur-sm ${l(t.status)}`,children:t.status.replace("_"," ")})]}),t.tasks_count&&t.tasks_count>0&&(0,d.jsxs)("div",{className:"mt-3 mb-1",children:[(0,d.jsxs)("div",{className:"flex justify-between items-center text-xs mb-1",children:[(0,d.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,d.jsx)(A.A,{size:12,className:l(t.status)}),(0,d.jsxs)("span",{className:"font-medium",children:[t.completed_tasks||0,"/",t.tasks_count," tasks"]})]}),(0,d.jsxs)("span",{className:"font-semibold",children:[Math.round((t.completed_tasks||0)/t.tasks_count*100),"%"]})]}),(0,d.jsx)("div",{className:"w-full h-1.5 bg-gray-200 rounded-full overflow-hidden",children:(0,d.jsx)("div",{className:`h-full transition-all duration-1000 bg-gradient-to-r ${u}`,style:{width:(t.completed_tasks||0)/t.tasks_count*100+"%"}})})]}),t.updated_at&&(0,d.jsxs)("div",{className:"absolute bottom-1.5 right-1.5 opacity-60 flex items-center gap-1 text-[10px] text-gray-500 font-medium",children:[(0,d.jsx)(p.A,{size:10}),(0,d.jsx)("span",{children:"updated"})]})]})},task:e=>{let{data:t,selected:a}=e;const[s,n]=(0,i.useState)(t.skipAnimation||!1),[r,o]=(0,i.useState)(!1);(0,i.useEffect)(()=>{if(!t.skipAnimation){const e=setTimeout(()=>n(!0),200);return()=>clearTimeout(e)}},[t.skipAnimation]);(e=>{switch(e){case"pending":return"from-amber-400 to-amber-600";case"in_progress":return"from-sky-400 to-blue-600";case"completed":return"from-emerald-400 to-green-600";default:;}})(t.status);return(0,d.jsxs)("div",{className:`group px-6 py-3 rounded-full shadow-xl transition-all duration-500 text-white relative transform \n        ${a?"scale-105":r?"scale-[1.02]":"scale-100"} \n        ${s?"opacity-100 translate-x-0":"opacity-0 scale-85 -translate-x-4"}`,style:{background:`linear-gradient(135deg, ${"completed"===t.status?"rgba(16, 185, 129, 0.85)":"rgba(59, 130, 246, 0.95)"} 0%, ${"completed"===t.status?"rgba(5, 150, 105, 0.95)":"rgba(99, 102, 241, 0.98)"} 100%)`,boxShadow:a?"0 10px 25px -5px rgba(99, 102, 241, 0.5), 0 8px 10px -6px rgba(99, 102, 241, 0.5)":r?"0 10px 25px -5px rgba(99, 102, 241, 0.3), 0 8px 10px -6px rgba(99, 102, 241, 0.3)":"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1)",transition:"all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55), transform 0.3s ease, box-shadow 0.3s ease",backdropFilter:"blur(8px)",minWidth:"240px",maxWidth:"300px"},onMouseEnter:()=>o(!0),onMouseLeave:()=>o(!1),children:[(0,d.jsx)("div",{className:`absolute left-0 top-0 bottom-0 w-2 rounded-l-full bg-gradient-to-b ${(e=>{switch(null===e||void 0===e?void 0:e.toLowerCase()){case"high":return"from-red-400 to-red-600";case"medium":return"from-orange-400 to-orange-600";case"low":return"from-emerald-400 to-emerald-600";default:return"from-gray-400 to-gray-600"}})(t.priority)}`}),(0,d.jsx)(w.h7,{id:"top",type:"source",position:j.yX.Top,className:"w-3 h-3 rounded-full transition-all duration-300 hover:scale-150 cursor-pointer \n          "+(a||r?"opacity-100":"opacity-0"),style:{left:"50%",transform:"translateX(-50%) translateY(-50%)",zIndex:2,border:"2px solid white",background:"rgb(99, 102, 241)",boxShadow:"0 0 8px 2px rgba(99, 102, 241, 0.7)"},isConnectable:!0}),(0,d.jsx)(w.h7,{id:"top",type:"target",position:j.yX.Top,className:"w-3 h-3 rounded-full transition-all duration-300 hover:scale-150 cursor-pointer \n          "+(a||r?"opacity-100":"opacity-0"),style:{left:"50%",transform:"translateX(-50%) translateY(-50%)",zIndex:1,border:"2px solid white",background:"rgb(124, 58, 237)",boxShadow:"0 0 8px 2px rgba(124, 58, 237, 0.7)"},isConnectable:!0}),(0,d.jsx)(w.h7,{id:"right",type:"source",position:j.yX.Right,className:"w-3 h-3 rounded-full transition-all duration-300 hover:scale-150 cursor-pointer \n          "+(a||r?"opacity-100":"opacity-0"),style:{top:"50%",transform:"translateY(-50%) translateX(50%)",zIndex:2,border:"2px solid white",background:"rgb(99, 102, 241)",boxShadow:"0 0 8px 2px rgba(99, 102, 241, 0.7)"},isConnectable:!0}),(0,d.jsx)(w.h7,{id:"right",type:"target",position:j.yX.Right,className:"w-3 h-3 rounded-full transition-all duration-300 hover:scale-150 cursor-pointer \n          "+(a||r?"opacity-100":"opacity-0"),style:{top:"50%",transform:"translateY(-50%) translateX(50%)",zIndex:1,border:"2px solid white",background:"rgb(124, 58, 237)",boxShadow:"0 0 8px 2px rgba(124, 58, 237, 0.7)"},isConnectable:!0}),(0,d.jsx)(w.h7,{id:"bottom",type:"source",position:j.yX.Bottom,className:"w-3 h-3 rounded-full transition-all duration-300 hover:scale-150 cursor-pointer \n          "+(a||r?"opacity-100":"opacity-0"),style:{left:"50%",transform:"translateX(-50%) translateY(50%)",zIndex:2,border:"2px solid white",background:"rgb(99, 102, 241)",boxShadow:"0 0 8px 2px rgba(99, 102, 241, 0.7)"},isConnectable:!0}),(0,d.jsx)(w.h7,{id:"bottom",type:"target",position:j.yX.Bottom,className:"w-3 h-3 rounded-full transition-all duration-300 hover:scale-150 cursor-pointer \n          "+(a||r?"opacity-100":"opacity-0"),style:{left:"50%",transform:"translateX(-50%) translateY(50%)",zIndex:1,border:"2px solid white",background:"rgb(124, 58, 237)",boxShadow:"0 0 8px 2px rgba(124, 58, 237, 0.7)"},isConnectable:!0}),(0,d.jsx)(w.h7,{id:"left",type:"source",position:j.yX.Left,className:"w-3 h-3 rounded-full transition-all duration-300 hover:scale-150 cursor-pointer \n          "+(a||r?"opacity-100":"opacity-0"),style:{top:"50%",left:"10px",transform:"translateY(-50%) translateX(-50%)",zIndex:2,border:"2px solid white",background:"rgb(99, 102, 241)",boxShadow:"0 0 8px 2px rgba(99, 102, 241, 0.7)"},isConnectable:!0}),(0,d.jsx)(w.h7,{id:"left",type:"target",position:j.yX.Left,className:"w-3 h-3 rounded-full transition-all duration-300 hover:scale-150 cursor-pointer \n          "+(a||r?"opacity-100":"opacity-0"),style:{top:"50%",left:"10px",transform:"translateY(-50%) translateX(-50%)",zIndex:1,border:"2px solid white",background:"rgb(124, 58, 237)",boxShadow:"0 0 8px 2px rgba(124, 58, 237, 0.7)"},isConnectable:!0}),(a||r)&&(0,d.jsx)("div",{className:"absolute inset-0 rounded-full pointer-events-none "+(a?"animate-pulse-subtle":""),style:{boxShadow:`0 0 0 2px rgba(255, 255, 255, ${a?"0.5":"0.3"})`,animation:a?"pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite":"none"}}),(0,d.jsxs)("div",{className:"flex items-center",children:[(0,d.jsx)("div",{className:"flex-shrink-0 mr-3",children:(0,d.jsx)("div",{className:"p-1 rounded-full bg-white/20 shadow-inner "+("completed"===t.status?"bg-white/40":""),children:(0,d.jsx)(A.A,{size:18,className:"drop-shadow-sm"})})}),(0,d.jsxs)("div",{className:"flex-grow min-w-0",children:[(0,d.jsx)("div",{className:"font-semibold text-sm truncate",children:t.label}),(0,d.jsx)("div",{className:"flex items-center gap-2 text-xs mt-0.5",children:t.due_date&&(0,d.jsxs)("div",{className:"flex items-center gap-1 bg-white/20 px-2 py-0.5 rounded-full",children:[(0,d.jsx)(p.A,{size:10}),(0,d.jsx)("span",{children:new Date(t.due_date).toLocaleDateString()})]})})]}),t.onDelete&&(0,d.jsx)("button",{onClick:e=>{e.preventDefault();const a=setTimeout(()=>{e.stopPropagation(),t.onDelete()},300);e.currentTarget.deleteTimeout=a},onDoubleClick:e=>{e.currentTarget.deleteTimeout&&(clearTimeout(e.currentTarget.deleteTimeout),e.currentTarget.deleteTimeout=null)},className:"ml-2 p-1.5 hover:bg-white/20 rounded-full transition-all duration-200 hover:scale-110 opacity-70 hover:opacity-100",children:(0,d.jsx)(h.A,{size:14,className:"drop-shadow-sm"})})]})]})},literature:e=>{let{data:t,selected:a}=e;const[s,n]=(0,i.useState)(t.skipAnimation||!1),[r,o]=(0,i.useState)(!1);return(0,i.useEffect)(()=>{if(!t.skipAnimation){const e=setTimeout(()=>n(!0),250);return()=>clearTimeout(e)}},[t.skipAnimation]),(0,d.jsxs)("div",{className:`group transition-all duration-650 relative transform \n        ${a?"scale-105":r?"scale-[1.02]":"scale-100"}\n        ${s?"opacity-100 translate-x-0 rotate-0":"opacity-0 scale-95 translate-x-4 -rotate-1"}`,style:{width:"130px",height:"180px",background:"linear-gradient(135deg, #f3e8ff 0%, #ddd6fe 100%)",borderRadius:"8px",boxShadow:a?"0 10px 30px -5px rgba(139, 92, 246, 0.5), 0 8px 10px -6px rgba(139, 92, 246, 0.4)":r?"0 10px 25px -5px rgba(139, 92, 246, 0.3), 0 8px 10px -6px rgba(139, 92, 246, 0.2)":"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.05)",transition:"all 0.65s cubic-bezier(0.175, 0.885, 0.32, 1.275), transform 0.3s ease, box-shadow 0.3s ease",borderTop:"8px solid",borderImage:"linear-gradient(to right, #8b5cf6, #6d28d9) 1",display:"flex",flexDirection:"column",justifyContent:"space-between",overflow:"hidden",transform:r&&!a?"rotate(1deg)":"rotate(0deg)"},onMouseEnter:()=>o(!0),onMouseLeave:()=>o(!1),children:[(0,d.jsx)(w.h7,{id:"top",type:"source",position:j.yX.Top,className:"w-3 h-3 rounded-full transition-all duration-300 hover:scale-150 cursor-pointer \n          "+(a||r?"opacity-100":"opacity-0"),style:{left:"50%",transform:"translateX(-50%) translateY(-50%)",zIndex:2,border:"2px solid white",background:"rgb(139, 92, 246)",boxShadow:"0 0 8px 2px rgba(139, 92, 246, 0.7)"},isConnectable:!0}),(0,d.jsx)(w.h7,{id:"top",type:"target",position:j.yX.Top,className:"w-3 h-3 rounded-full transition-all duration-300 hover:scale-150 cursor-pointer \n          "+(a||r?"opacity-100":"opacity-0"),style:{left:"50%",transform:"translateX(-50%) translateY(-50%)",zIndex:1,border:"2px solid white",background:"rgb(109, 40, 217)",boxShadow:"0 0 8px 2px rgba(109, 40, 217, 0.7)"},isConnectable:!0}),(0,d.jsx)(w.h7,{id:"right",type:"source",position:j.yX.Right,className:"w-3 h-3 rounded-full transition-all duration-300 hover:scale-150 cursor-pointer \n          "+(a||r?"opacity-100":"opacity-0"),style:{top:"50%",transform:"translateY(-50%) translateX(50%)",zIndex:2,border:"2px solid white",background:"rgb(139, 92, 246)",boxShadow:"0 0 8px 2px rgba(139, 92, 246, 0.7)"},isConnectable:!0}),(0,d.jsx)(w.h7,{id:"right",type:"target",position:j.yX.Right,className:"w-3 h-3 rounded-full transition-all duration-300 hover:scale-150 cursor-pointer \n          "+(a||r?"opacity-100":"opacity-0"),style:{top:"50%",transform:"translateY(-50%) translateX(50%)",zIndex:1,border:"2px solid white",background:"rgb(109, 40, 217)",boxShadow:"0 0 8px 2px rgba(109, 40, 217, 0.7)"},isConnectable:!0}),(0,d.jsx)(w.h7,{id:"bottom",type:"source",position:j.yX.Bottom,className:"w-3 h-3 rounded-full transition-all duration-300 hover:scale-150 cursor-pointer \n          "+(a||r?"opacity-100":"opacity-0"),style:{left:"50%",transform:"translateX(-50%) translateY(50%)",zIndex:2,border:"2px solid white",background:"rgb(139, 92, 246)",boxShadow:"0 0 8px 2px rgba(139, 92, 246, 0.7)"},isConnectable:!0}),(0,d.jsx)(w.h7,{id:"bottom",type:"target",position:j.yX.Bottom,className:"w-3 h-3 rounded-full transition-all duration-300 hover:scale-150 cursor-pointer \n          "+(a||r?"opacity-100":"opacity-0"),style:{left:"50%",transform:"translateX(-50%) translateY(50%)",zIndex:1,border:"2px solid white",background:"rgb(109, 40, 217)",boxShadow:"0 0 8px 2px rgba(109, 40, 217, 0.7)"},isConnectable:!0}),(0,d.jsx)(w.h7,{id:"left",type:"source",position:j.yX.Left,className:"w-3 h-3 rounded-full transition-all duration-300 hover:scale-150 cursor-pointer \n          "+(a||r?"opacity-100":"opacity-0"),style:{top:"50%",transform:"translateY(-50%) translateX(-50%)",zIndex:2,border:"2px solid white",background:"rgb(139, 92, 246)",boxShadow:"0 0 8px 2px rgba(139, 92, 246, 0.7)"},isConnectable:!0}),(0,d.jsx)(w.h7,{id:"left",type:"target",position:j.yX.Left,className:"w-3 h-3 rounded-full transition-all duration-300 hover:scale-150 cursor-pointer \n          "+(a||r?"opacity-100":"opacity-0"),style:{top:"50%",transform:"translateY(-50%) translateX(-50%)",zIndex:1,border:"2px solid white",background:"rgb(109, 40, 217)",boxShadow:"0 0 8px 2px rgba(109, 40, 217, 0.7)"},isConnectable:!0}),(a||r)&&(0,d.jsx)("div",{className:"absolute inset-0 rounded-lg pointer-events-none "+(a?"animate-pulse-subtle":""),style:{boxShadow:`0 0 0 2px rgba(139, 92, 246, ${a?"0.5":"0.3"})`,animation:a?"pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite":"none"}}),(0,d.jsxs)("div",{className:"flex flex-col h-full",children:[(0,d.jsxs)("div",{className:"px-3 pt-3 pb-2 cursor-pointer",onClick:e=>{e.preventDefault();const a=setTimeout(()=>{e.stopPropagation(),t.onLiteratureClick&&t.onLiteratureClick(t)},300);e.currentTarget.clickTimeout=a},onDoubleClick:e=>{e.currentTarget.clickTimeout&&(clearTimeout(e.currentTarget.clickTimeout),e.currentTarget.clickTimeout=null)},children:[(0,d.jsx)("div",{className:"flex justify-center mb-2",children:(0,d.jsx)("div",{className:"p-1.5 rounded-full bg-purple-100 shadow-inner",children:(0,d.jsx)(D.A,{size:20,className:"text-purple-600"})})}),(0,d.jsx)("div",{className:"text-center font-semibold text-sm text-gray-800 line-clamp-3 mb-1",children:t.label})]}),(0,d.jsxs)("div",{className:"px-3 flex-grow flex flex-col justify-end",children:[(0,d.jsx)("div",{className:"text-xs text-center text-gray-600 mb-1 line-clamp-2",children:t.authors}),(0,d.jsxs)("div",{className:"flex items-center justify-center text-xs text-purple-700 font-medium mt-1 mb-3",children:[(0,d.jsx)(se.A,{size:10,className:"mr-1"}),t.year]})]}),t.onDelete&&(0,d.jsx)("button",{onClick:e=>{e.preventDefault();const a=setTimeout(()=>{e.stopPropagation(),t.onDelete()},300);e.currentTarget.deleteTimeout=a},onDoubleClick:e=>{e.currentTarget.deleteTimeout&&(clearTimeout(e.currentTarget.deleteTimeout),e.currentTarget.deleteTimeout=null)},className:"absolute top-0.5 right-0.5 p-1 hover:bg-purple-200 rounded-full transition-all duration-200 hover:scale-110 opacity-70 hover:opacity-100",children:(0,d.jsx)(h.A,{size:12,className:"text-purple-700"})})]})]})}};const re=[{id:1,title:"Efficacy of Cognitive Behavioral Therapy for Depression: A Meta-Analysis",authors:"Smith, J.A., Johnson, B.K., Williams, C.D.",year:"2023",type:"meta-analysis",journal:"Journal of Clinical Psychology",volume:"79",pages:"234-251",doi:"10.1002/jclp.23456",abstract:"This meta-analysis examines the efficacy of cognitive behavioral therapy (CBT) for treating major depressive disorder across 45 randomized controlled trials involving 3,242 participants. Results indicate that CBT shows significant effectiveness with a large effect size (d = 0.85) compared to control conditions. The analysis also reveals that individual CBT may be more effective than group CBT for severe depression cases.",keywords:"cognitive behavioral therapy, depression, meta-analysis, psychotherapy, mental health",notes:"",pdf_url:"https://example.com/sample-cbt-meta-analysis.pdf",position:{x:300,y:100}},{id:2,title:"DSM-5-TR Clinical Cases",authors:"American Psychiatric Association",year:"2022",type:"guideline",journal:"American Psychiatric Publishing",abstract:"A comprehensive collection of clinical cases that illustrate the diagnostic criteria and clinical features of mental disorders as defined in the DSM-5-TR. Each case includes detailed patient presentations, differential diagnoses, and treatment considerations.",keywords:"DSM-5, diagnosis, clinical cases, psychiatric disorders, differential diagnosis",notes:"Essential reference for diagnostic clarity",position:{x:500,y:200}},{id:3,title:"Pharmacological Treatment of Bipolar Disorder: Current Evidence",authors:"Rodriguez, M.L., Chen, K.H., Anderson, P.R.",year:"2023",type:"review",journal:"Bipolar Disorders",volume:"25",pages:"123-145",doi:"10.1111/bdi.13289",abstract:"This comprehensive review examines current evidence for pharmacological treatments of bipolar disorder, including mood stabilizers, antipsychotics, and adjunctive therapies. The review covers efficacy, safety profiles, and treatment-resistant cases.",keywords:"bipolar disorder, pharmacotherapy, mood stabilizers, lithium, antipsychotics",notes:"Important for medication management decisions",position:{x:700,y:150}},{id:4,title:"Mindfulness-Based Interventions for Anxiety Disorders: A Systematic Review",authors:"Taylor, S.M., Brown, A.J., Davis, L.K.",year:"2023",type:"review",journal:"Clinical Psychology Review",volume:"88",pages:"102-118",abstract:"Systematic review of mindfulness-based interventions for treating various anxiety disorders. Analysis of 28 studies shows moderate to large effect sizes for reducing anxiety symptoms, with particular effectiveness for generalized anxiety disorder.",keywords:"mindfulness, anxiety disorders, meditation, systematic review, GAD",notes:"Good evidence for mindfulness approaches",position:{x:400,y:300}},{id:5,title:"Case Study: Treatment-Resistant Schizophrenia with Clozapine",authors:"Wilson, K.R., Martinez, E.S.",year:"2022",type:"case-study",journal:"Schizophrenia Bulletin",volume:"48",pages:"567-572",abstract:"Detailed case study of a 28-year-old male with treatment-resistant schizophrenia who showed significant improvement after clozapine initiation. The case discusses monitoring protocols, side effect management, and long-term outcomes.",keywords:"schizophrenia, clozapine, treatment-resistant, case study, antipsychotics",notes:"Useful for understanding clozapine protocols",position:{x:600,y:400}}],oe=[{id:"conn-1",source:"literature-1",target:"case-101",label:"Treatment approach"},{id:"conn-2",source:"literature-2",target:"topic-201",label:"Reference guide"},{id:"conn-3",source:"literature-3",target:"case-102",label:"Medication guidance"},{id:"conn-4",source:"literature-4",target:"case-103",label:"Treatment option"},{id:"conn-5",source:"literature-5",target:"case-104",label:"Treatment protocol"}],le=(e,t,a)=>{e(e=>{const i=new Set(e.literature.map(e=>e.id)),s=re.filter(e=>!i.has(e.id));if(0===s.length)return a("Sample literature data already exists","info"),e;const n=new Set(e.cases.map(e=>e.id)),r=new Set(e.topics.map(e=>e.id)),o=[{id:101,label:"Major Depression Case",primary_diagnosis:"Major Depressive Disorder",chief_complaint:"Persistent sadness and loss of interest",secondary_diagnoses:["Anxiety","Insomnia"],position:{x:100,y:100}},{id:102,label:"Bipolar Disorder Case",primary_diagnosis:"Bipolar I Disorder",chief_complaint:"Mood swings and impulsivity",position:{x:200,y:200}},{id:103,label:"Generalized Anxiety Case",primary_diagnosis:"Generalized Anxiety Disorder",chief_complaint:"Excessive worry and restlessness",position:{x:300,y:300}},{id:104,label:"Schizophrenia Case",primary_diagnosis:"Schizophrenia",chief_complaint:"Auditory hallucinations and delusions",position:{x:400,y:400}}].filter(e=>!n.has(e.id)),l=[{id:201,title:"Diagnostic Criteria",category:"Assessment",tags:["DSM-5","diagnosis","criteria"],position:{x:150,y:50}}].filter(e=>!r.has(e.id)),d=new Set(e.connections.map(e=>e.id)),c=oe.filter(e=>!d.has(e.id)),u={...e,literature:[...e.literature,...s],cases:[...e.cases,...o],topics:[...e.topics,...l],connections:[...e.connections,...c]};return t(u),a(`Added ${s.length} literature items, ${o.length} cases, and ${l.length} topics`,"success"),u})},de=()=>a.e(497).then(a.bind(a,9930)),ce=`${"https://336d4c80-d84e-4815-a915-e2ffd980488a.preview.emergentagent.com".replace(/\/$/,"")}/api`,ue=console.error;console.error=function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];t[0]&&t[0].includes&&t[0].includes("ResizeObserver loop")||ue(...t)};const pe=e=>{let{message:t,type:a="success",onClose:s,duration:n=3e3}=e;(0,i.useEffect)(()=>{const e=setTimeout(s,n);return()=>clearTimeout(e)},[s,n]);return(0,d.jsx)("div",{className:`fixed top-4 right-4 z-50 px-6 py-3 rounded-lg shadow-lg transition-all duration-500 transform ${{success:"bg-green-600 text-white border-l-4 border-green-400",error:"bg-red-600 text-white border-l-4 border-red-400",info:"bg-blue-600 text-white border-l-4 border-blue-400",saving:"bg-purple-600 text-white border-l-4 border-purple-400"}[a]}`,children:(0,d.jsxs)("div",{className:"flex items-center",children:[(()=>{switch(a){case"success":default:return(0,d.jsx)(N.A,{size:16,className:"mr-2"});case"error":return(0,d.jsx)(k.A,{size:16,className:"mr-2"});case"info":return(0,d.jsx)(C.A,{size:16,className:"mr-2"});case"saving":return(0,d.jsx)(S.A,{size:16,className:"mr-2 animate-spin"})}})(),(0,d.jsx)("span",{className:"text-sm font-medium",children:t}),(0,d.jsx)("button",{onClick:s,className:"ml-4 text-white hover:text-gray-200 transition-colors",children:(0,d.jsx)(h.A,{size:14})})]})})},me=e=>{let{onClick:t,loading:a,disabled:i,children:s,className:n,icon:r,...o}=e;return(0,d.jsx)("button",{onClick:t,disabled:i||a,className:`${n} transform transition-all duration-200 hover:scale-105 active:scale-95 ${i||a?"cursor-not-allowed opacity-50":"hover:shadow-lg"}`,...o,children:(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[a?(0,d.jsx)(S.A,{size:16,className:"animate-spin"}):r?(0,d.jsx)(r,{size:16}):null,s]})})},xe="pgy3_mindmap_data",he={save:(()=>{let e;return function(t,a,i){let s=arguments.length>3&&void 0!==arguments[3]&&arguments[3];clearTimeout(e),a&&a();e=setTimeout(()=>{try{const e={version:"1.1",timestamp:(new Date).toISOString(),data:t};localStorage.setItem(xe,JSON.stringify(e)),console.log("Mind map data auto-saved to localStorage"),i&&i(!0)}catch(e){if(console.error("Error saving to localStorage:",e),i&&i(!1,e),"QuotaExceededError"===e.name){console.warn("localStorage quota exceeded, clearing old data...");try{localStorage.removeItem(xe)}catch(a){console.error("Error clearing localStorage:",a)}}}},s?1200:800)}})(),load:()=>{try{const e=localStorage.getItem(xe);if(!e)return console.log("No localStorage data found"),null;const t=JSON.parse(e);return"1.1"!==t.version?(console.log("localStorage version mismatch, clearing old data"),localStorage.removeItem(xe),null):(console.log("Mind map data loaded from localStorage",t.timestamp),t.data)}catch(e){console.error("Error loading from localStorage:",e);try{localStorage.removeItem(xe)}catch(t){console.error("Error clearing corrupted localStorage:",t)}return null}},clear:()=>{try{localStorage.removeItem(xe),console.log("localStorage data cleared")}catch(e){console.error("Error clearing localStorage:",e)}},getStorageInfo:()=>{try{const e=localStorage.getItem(xe);if(!e)return null;const t=JSON.parse(e);return{version:t.version,timestamp:t.timestamp,size:new Blob([e]).size}}catch(e){return null}}},ge=e=>{let{edge:t,isOpen:a,onClose:s,onSave:n}=e;const[r,o]=(0,i.useState)((null===t||void 0===t?void 0:t.label)||"");(0,i.useEffect)(()=>{o((null===t||void 0===t?void 0:t.label)||"")},[t]);const l=()=>{n(t.id,r),s()};return a&&t?(0,d.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 backdrop-blur-sm",children:(0,d.jsxs)("div",{className:"bg-white rounded-xl shadow-2xl p-6 max-w-md w-full mx-4 transform transition-all",children:[(0,d.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,d.jsx)("h3",{className:"text-xl font-semibold text-gray-800",children:"Edit Connection Label"}),(0,d.jsx)("button",{onClick:s,className:"text-gray-400 hover:text-gray-600 p-1 transition-colors",children:(0,d.jsx)(h.A,{size:20})})]}),(0,d.jsxs)("div",{className:"mb-6",children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Connection Label"}),(0,d.jsx)("input",{type:"text",value:r,onChange:e=>o(e.target.value),onKeyPress:e=>{"Enter"===e.key?l():"Escape"===e.key&&s()},placeholder:"Enter a label for this connection...",className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all",autoFocus:!0}),(0,d.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Press Enter to save, Escape to cancel"})]}),(0,d.jsxs)("div",{className:"flex items-center justify-end gap-3",children:[(0,d.jsx)("button",{onClick:s,className:"px-4 py-2 text-gray-600 hover:text-gray-800 border border-gray-300 rounded-lg hover:bg-gray-100 transition-colors",children:"Cancel"}),(0,d.jsxs)("button",{onClick:l,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2",children:[(0,d.jsx)(_.A,{size:16}),"Save Label"]})]})]})}):null},be=()=>{var e,t,a,s,o,l;const{fitView:c,setCenter:u,zoomTo:p,getViewport:x}=(0,w.VH)(),[h,g,b]=(0,w.ck)([]),[f,y,v]=(0,w.fM)([]),[N,k]=(0,i.useState)(0),[C,_]=(0,i.useState)({topics:[],cases:[],tasks:[],literature:[],connections:[]}),[I,M]=(0,i.useState)(!1),[L,X]=(0,i.useState)(null),[H,F]=(0,i.useState)(!0),[R,B]=(0,i.useState)(0),[q,V]=(0,i.useState)("Initializing..."),[K,ee]=(0,i.useState)(!0),[ae,ie]=(0,i.useState)(null),[se,re]=(0,i.useState)(!1),[oe,ue]=(0,i.useState)({isOpen:!1,data:null}),[xe,be]=(0,i.useState)({isOpen:!1,data:null}),[ye,ve]=(0,i.useState)({isOpen:!1,data:null}),we=(0,i.useRef)(null),je=(0,i.useRef)(null),Ne=(0,i.useRef)(null),[ke,Ce]=(0,i.useState)(!1),[Se,_e]=(0,i.useState)(!1),[Te,Ae]=(0,i.useState)(!1),[De,ze]=(0,i.useState)(null),[Pe,Oe]=(0,i.useState)(!1),[$e,Ee]=(0,i.useState)({isOpen:!1,edge:null}),[Ie,Me]=(0,i.useState)([]),[Le,Xe]=(0,i.useState)({isOpen:!1,data:null}),[He,Fe]=(0,i.useState)(!1),[Re,Be]=(0,i.useState)({case:!1,topic:!1,task:!1,literature:!1}),Ye=(0,i.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3e3;const i={id:Date.now(),message:e,type:t,duration:a};Me(e=>[...e,i])},[]),Ue=(0,i.useCallback)(e=>{Me(t=>t.filter(t=>t.id!==e))},[]),We=(0,i.useCallback)(e=>{var t,a,i;const s=oe.isOpen||xe.isOpen||ye.isOpen||Le.isOpen,n=Object.values(Re).some(e=>e),r=oe.isOpen&&(null===(t=oe.data)||void 0===t?void 0:t.isTabTransitioning)||xe.isOpen&&(null===(a=xe.data)||void 0===a?void 0:a.isTabTransitioning)||ye.isOpen&&(null===(i=ye.data)||void 0===i?void 0:i.isTabTransitioning);if(He||s||r||n){console.log("Deferring auto-save during animation, modal interaction, or tab transition");return void setTimeout(()=>We(e),r||n?2e3:1e3)}he.save(e,()=>Oe(!0),(e,t)=>{Oe(!1),e?ze(new Date):(Ye("Auto-save failed","error",4e3),console.error("Auto-save error:",t))},He),window.requestIdleCallback?window.requestIdleCallback(()=>{He||Object.values(Re).some(e=>e)||Ke(e)},{timeout:5e3}):setTimeout(()=>{He||Object.values(Re).some(e=>e)||Ke(e)},100)},[Ye,He,Re,oe.isOpen,xe.isOpen,ye.isOpen,Le.isOpen]);(0,i.useCallback)(e=>{const t=oe.isOpen||xe.isOpen||ye.isOpen||Le.isOpen,a=Object.values(Re).some(e=>e);He||t||a||(he.save(e,null,null,He),clearTimeout(window.positionBackendSaveTimeout),window.positionBackendSaveTimeout=setTimeout(()=>{We(e)},800))},[He,Re,oe.isOpen,xe.isOpen,ye.isOpen,Le.isOpen,We]);(0,i.useEffect)(()=>{oe.isOpen&&oe.data?we.current={...oe.data}:oe.isOpen||(we.current=null)},[oe.isOpen,null===(e=oe.data)||void 0===e?void 0:e.id]),(0,i.useEffect)(()=>{xe.isOpen&&xe.data?je.current={...xe.data}:xe.isOpen||(je.current=null)},[xe.isOpen,null===(t=xe.data)||void 0===t?void 0:t.id]),(0,i.useEffect)(()=>{ye.isOpen&&ye.data?Ne.current={...ye.data}:ye.isOpen||(Ne.current=null)},[ye.isOpen,null===(a=ye.data)||void 0===a?void 0:a.id]);const Ge=(0,i.useCallback)(e=>{console.log("Deleting node with full ID:",e);const[t,...a]=e.split("-"),i=a.join("-"),s="literature"===t?"literature":`${t}s`;_(a=>{const n=(a[s]||[]).filter(e=>String(e.id)!==i),r=(a.connections||[]).filter(t=>t.source!==e&&t.target!==e),o={...a,[s]:n,connections:r};return We(o),Ye(`${t.charAt(0).toUpperCase()+t.slice(1)} deleted.`,"success"),o}),g(t=>t.filter(t=>t.id!==e)),y(t=>t.filter(t=>t.source!==e&&t.target!==e))},[_,We,Ye,g,y]),qe=(0,i.useCallback)(e=>{Fe(!0),Xe({isOpen:!0,data:e}),setTimeout(()=>Fe(!1),700)},[]),Ve=(0,i.useCallback)(()=>{console.log("syncNodeData called - syncing node colors and labels"),g(e=>{let t=!1;const a=e.map(e=>{const a=e.id.split("-")[0],i=e.id.split("-")[1];let s=e.data.label,n=e.data.color,r=!1;if("case"===a){var o;const t=null===(o=C.cases)||void 0===o?void 0:o.find(e=>String(e.id)===i);if(t){const a=t.primaryDiagnosis||t.primary_diagnosis||t.title||"Untitled Case";a!==e.data.label&&(s=a,r=!0)}}else if("topic"===a){var l;const t=null===(l=C.topics)||void 0===l?void 0:l.find(e=>String(e.id)===i);if(t){const a=t.title||"Untitled Topic",o=t.color||"#3B82F6";a!==e.data.label&&(s=a,r=!0),o!==e.data.color&&(n=o,r=!0,console.log(`Topic ${i}: Color changing from ${e.data.color} to ${o}`))}}else if("task"===a){var d;const t=null===(d=C.tasks)||void 0===d?void 0:d.find(e=>String(e.id)===i);if(t){const a=t.title||"Untitled Task";a!==e.data.label&&(s=a,r=!0)}}else if("literature"===a){var c;const t=null===(c=C.literature)||void 0===c?void 0:c.find(e=>String(e.id)===i);if(t){const a=t.title||"Untitled Literature";a!==e.data.label&&(s=a,r=!0)}}if(r){t=!0;const i=Date.now();return{id:e.id,type:e.type,position:{...e.position},data:{...e.data,label:s,color:n,lastUpdated:i},style:"topic"===a?{backgroundColor:n,color:"white",boxShadow:`0 4px 20px ${n}20`,transition:"all 0.7s cubic-bezier(0.34, 1.56, 0.64, 1), transform 0.3s ease",zIndex:i%1e3}:e.style,key:`${e.id}-${i}`}}return e});return t?(console.log("syncNodeData: Changes detected, updating nodes with forced re-render"),[...a]):(console.log("syncNodeData: No changes needed"),e)})},[C,g]);(0,i.useEffect)(()=>{var e,t,a,i;if(C&&((null===(e=C.cases)||void 0===e?void 0:e.length)>0||(null===(t=C.topics)||void 0===t?void 0:t.length)>0||(null===(a=C.tasks)||void 0===a?void 0:a.length)>0||(null===(i=C.literature)||void 0===i?void 0:i.length)>0)){const e=setTimeout(()=>{console.log("useEffect triggered syncNodeData due to mindMapData change"),Ve()},50);return 0===h.length&&(console.log("Converting data to React Flow nodes due to data change"),setTimeout(()=>{Je(C,!1)},100)),()=>clearTimeout(e)}},[C,Ve,h.length]),(0,i.useEffect)(()=>{N>0&&(console.log("Force update triggered by nodeUpdateTrigger:",N),setTimeout(()=>{Ve()},100))},[N,Ve]);const Je=(0,i.useCallback)(async function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const a=[...e.topics.map(e=>({...e,type:"topic"})),...e.cases.map(e=>({...e,type:"case"})),...e.tasks.map(e=>({...e,type:"task"})),...e.literature.map(e=>({...e,type:"literature"}))];let i;const s=a.some(e=>e.position&&"number"===typeof e.position.x&&"number"===typeof e.position.y);if(a.length>0&&t&&!s)try{const{forceSimulation:t,forceManyBody:s,forceLink:n,forceCenter:r,forceCollide:o}=await de(),l=a.map((e,t)=>{var a,i;return{id:`${e.type}-${e.id}`,x:(null===(a=e.position)||void 0===a?void 0:a.x)||200*(Math.random()-.5),y:(null===(i=e.position)||void 0===i?void 0:i.y)||200*(Math.random()-.5),type:e.type}}),d=(e.connections||[]).map(e=>({source:e.source,target:e.target,id:e.id})).filter(e=>{const t=new Set(l.map(e=>e.id));return t.has(e.source)&&t.has(e.target)}),c=t(l).force("link",n(d).id(e=>e.id).distance(200).strength(.5)).force("charge",s().strength(-800).distanceMax(400)).force("center",r(window.innerWidth/3,window.innerHeight/2)).force("collision",o().radius(80)).stop();for(let e=0;e<300;e++)c.tick();const u=new Map;l.forEach(e=>{u.set(e.id,{x:e.x,y:e.y})}),i=a.map(e=>{const t=`${e.type}-${e.id}`,a=u.get(t)||{x:0,y:0};return{...e,position:a}})}catch(o){console.warn("Failed to apply initial layout, using fallback positioning:",o),i=a}else i=a;const n=(i||a).map((e,t)=>{const i=`${e.type}-${e.id}`,s="case"===e.type?{...e,chiefComplaint:e.chiefComplaint||e.chief_complaint||"",initialPresentation:e.initialPresentation||e.initial_presentation||"",currentPresentation:e.currentPresentation||e.current_presentation||"",medicationHistory:e.medicationHistory||e.medication_history||"",therapyProgress:e.therapyProgress||e.therapy_progress||"",defensePatterns:e.defensePatterns||e.defense_patterns||"",clinicalReflection:e.clinicalReflection||e.clinical_reflection||""}:e;let n;if(e.position&&"number"===typeof e.position.x&&"number"===typeof e.position.y)n=e.position;else{const e=Math.ceil(Math.sqrt(a.length)),i=250,s=150;n={x:t%e*i+300,y:Math.floor(t/e)*i+s}}return{id:i,type:e.type,position:n,data:{...s,label:e.title||e.label||`Untitled ${e.type}`,color:e.color||"#3B82F6",onDelete:()=>Ge(i),onLiteratureClick:"literature"===e.type?qe:void 0,skipAnimation:K},style:"topic"===e.type?{backgroundColor:e.color||"#3B82F6"}:void 0}}),r=((e,t)=>{const a=new Set(t);return e.filter(e=>a.has(e.source)&&a.has(e.target)).map(e=>({id:e.id,source:e.source,target:e.target,label:e.label,type:"floating",style:{strokeWidth:2,stroke:"#64748b",opacity:.85},animated:!1,updatable:!0}))})(e.connections||[],n.map(e=>e.id));g(n),y(r)},[g,y,Ge,qe,K]),Ke=(0,i.useCallback)(async e=>{const t={topics:JSON.parse(JSON.stringify(e.topics||[])),cases:JSON.parse(JSON.stringify(e.cases||[])),tasks:JSON.parse(JSON.stringify(e.tasks||[])),literature:JSON.parse(JSON.stringify(e.literature||[])),connections:JSON.parse(JSON.stringify(e.connections||[]))};try{const e=(new Date).toISOString();t.topics=t.topics.map((t,a)=>{var i,s;return{id:String(t.id||`${Date.now()}-${a}-topic`),title:t.title||"Untitled Topic",description:t.description||"",category:t.category||"Uncategorized",color:t.color||"#3B82F6",position:{x:Number(null===(i=t.position)||void 0===i?void 0:i.x)||0,y:Number(null===(s=t.position)||void 0===s?void 0:s.y)||0},flashcard_count:Number(t.flashcard_count)||0,completed_flashcards:Number(t.completed_flashcards)||0,resources:Array.isArray(t.resources)?t.resources:[],created_at:t.created_at||e,updated_at:e}}),t.cases=t.cases.map((t,a)=>{var i,s;return{id:String(t.id||`${Date.now()}-${a}-case`),case_id:t.case_id||`CASE-${Date.now()}-${a}`,encounter_date:t.encounter_date||e,primary_diagnosis:t.primary_diagnosis||"Unspecified",secondary_diagnoses:Array.isArray(t.secondary_diagnoses)?t.secondary_diagnoses:[],age:void 0!==t.age?Number(t.age):null,gender:t.gender||null,chief_complaint:t.chiefComplaint||t.chief_complaint||"",initial_presentation:t.initialPresentation||t.initial_presentation||"",current_presentation:t.currentPresentation||t.current_presentation||"",medication_history:t.medicationHistory||t.medication_history||"",therapy_progress:t.therapyProgress||t.therapy_progress||"",defense_patterns:t.defensePatterns||t.defense_patterns||"",clinical_reflection:t.clinicalReflection||t.clinical_reflection||"",history_present_illness:t.history_present_illness||null,medical_history:t.medical_history||null,medications:Array.isArray(t.medications)?t.medications:[],mental_status_exam:t.mental_status_exam||null,assessment_plan:t.assessment_plan||null,notes:t.notes||null,status:t.status||"active",linked_topics:Array.isArray(t.linked_topics)?t.linked_topics:[],position:{x:Number(null===(i=t.position)||void 0===i?void 0:i.x)||0,y:Number(null===(s=t.position)||void 0===s?void 0:s.y)||0},created_at:t.created_at||e,updated_at:e}}),t.tasks=t.tasks.map((t,a)=>{var i,s;return{id:String(t.id||`${Date.now()}-${a}-task`),title:t.title||"Untitled Task",description:t.description||null,status:t.status||"pending",priority:t.priority||"medium",due_date:t.due_date||null,linked_case_id:t.linked_case_id||null,linked_topic_id:t.linked_topic_id||null,position:{x:Number(null===(i=t.position)||void 0===i?void 0:i.x)||0,y:Number(null===(s=t.position)||void 0===s?void 0:s.y)||0},created_at:t.created_at||e,updated_at:e}}),t.literature=t.literature.map((t,a)=>{var i,s;return{id:String(t.id||`${Date.now()}-${a}-lit`),title:t.title||"Untitled Literature",authors:t.authors||null,publication:t.publication||null,year:void 0!==t.year?Number(t.year):null,doi:t.doi||null,abstract:t.abstract||null,notes:t.notes||null,pdf_path:t.pdf_path||null,linked_topics:Array.isArray(t.linked_topics)?t.linked_topics:[],position:{x:Number(null===(i=t.position)||void 0===i?void 0:i.x)||0,y:Number(null===(s=t.position)||void 0===s?void 0:s.y)||0},created_at:t.created_at||e,updated_at:e}}),t.connections=t.connections.map((e,t)=>({id:String(e.id||`${Date.now()}-${t}-conn`),source:e.source||"",target:e.target||"",label:e.label||""})),t.connections=t.connections.filter(e=>e.source&&e.target&&"string"===typeof e.source&&"string"===typeof e.target&&e.source.length>0&&e.target.length>0),console.log("Sending cleaned data to backend:",t);const a=await n.A.put(`${ce}/mindmap-data`,t,{headers:{"Content-Type":"application/json"}});console.log("Backend save successful:",a.data)}catch(o){var a,i,s,r;console.error("Failed to save to backend:",(null===(a=o.response)||void 0===a?void 0:a.data)||o.message),422===(null===(i=o.response)||void 0===i?void 0:i.status)&&null!==(s=o.response)&&void 0!==s&&null!==(r=s.data)&&void 0!==r&&r.detail&&(console.error("Validation errors:"),console.error(JSON.stringify(o.response.data.detail,null,2)),console.error("Request data that caused validation error:"),console.error(JSON.stringify(t,null,2)))}},[]),Ze=(0,i.useCallback)(e=>{const t=`conn-${Date.now()}`,a={...e,id:t,type:"floating",style:{strokeWidth:2,stroke:"#64748b",opacity:.85,transition:"none"},data:{__forceUpdate:Date.now()},interactionWidth:20};y(e=>(0,j.rN)(a,e)),_(t=>{const i=[...t.connections,{id:a.id,source:e.source,target:e.target,label:""}],s={...t,connections:i};return We(s),s})},[y,_,We]),Qe=(0,i.useCallback)((e,t)=>{X(t),g(e=>e.map(e=>({...e,selected:e.id===t.id})))},[g]),et=(0,i.useCallback)((e,t)=>{const a=t.id.split("-"),i=a[0],s=a.slice(1).join("-");if(("case"!==i||!oe.isOpen)&&("topic"!==i||!xe.isOpen)&&("task"!==i||!ye.isOpen)&&("literature"!==i||!Le.isOpen)){if("literature"===i){const e=C.literature.find(e=>String(e.id)===s);return void(e&&Xe({isOpen:!0,data:e}))}if("case"===i){const e=C.cases.find(e=>String(e.id)===s);return void(e&&(Be(e=>({...e,case:!0})),ue({isOpen:!0,data:e}),setTimeout(()=>{Be(e=>({...e,case:!1}))},800)))}if("topic"===i){const e=C.topics.find(e=>String(e.id)===s);return void(e&&(Be(e=>({...e,topic:!0})),be({isOpen:!0,data:e}),setTimeout(()=>{Be(e=>({...e,topic:!1}))},800)))}if("task"===i){const e=C.tasks.find(e=>String(e.id)===s);return void(e&&(Be(e=>({...e,task:!0})),ve({isOpen:!0,data:e}),setTimeout(()=>{Be(e=>({...e,task:!1}))},800)))}}},[C,oe.isOpen,xe.isOpen,ye.isOpen,Le.isOpen]),tt=(0,i.useCallback)((e,t)=>{y(e=>e.filter(e=>e.id!==t.id)),_(e=>{const a=e.connections.filter(e=>e.id!==t.id),i={...e,connections:a};return We(i),Ye("Connection deleted","success"),i})},[y,_,We,Ye]),at=(0,i.useCallback)((e,t)=>{e.preventDefault(),Ee({isOpen:!0,edge:t})},[]),it=(0,i.useCallback)((e,t)=>{y(a=>a.map(a=>a.id===e?{...a,label:t}:a)),_(a=>{const i=a.connections.map(a=>a.id===e?{...a,label:t}:a),s={...a,connections:i};return We(s),s})},[y,_,We]),st=(0,i.useCallback)((e,t)=>{y(e=>e.map(e=>e.id===t.id?{...e,className:"highlighted"}:e))},[y]),nt=(0,i.useCallback)((e,t)=>{y(e=>e.map(e=>e.id===t.id?{...e,className:""}:e))},[y]),rt=(0,i.useCallback)(async()=>{if(0!==h.length)try{const{forceSimulation:e,forceManyBody:t,forceLink:a,forceCenter:i,forceCollide:s}=await de(),n=[...f],r=new Set(h.map(e=>e.id)),o=n.filter(e=>r.has(e.source)&&r.has(e.target)),l=o.map(e=>({source:e.source,target:e.target,id:e.id})),d=h.map(e=>({id:e.id,x:e.position.x,y:e.position.y,fx:null,fy:null})),u=e(d).force("link",a(l).id(e=>e.id).distance(200).strength(.5)).force("charge",t().strength(-800).distanceMax(400)).force("center",i(window.innerWidth/3,window.innerHeight/2)).force("collision",s().radius(80)).stop(),p=50,m=400;let x=0;const b=()=>{const e=Math.min(p,m-x);for(let t=0;t<e;t++)u.tick();if(x+=e,x<m)requestAnimationFrame(b);else{const e=d.map(e=>({...h.find(t=>t.id===e.id),position:{x:e.x,y:e.y}}));g(e),y(o),_(t=>{const a={...t};return e.forEach(e=>{var t;const[i,s]=e.id.split("-"),n=null===(t=a["literature"===i?"literature":`${i}s`])||void 0===t?void 0:t.find(e=>String(e.id)===s);n&&(n.position=e.position)}),a}),setTimeout(()=>{c({duration:800,padding:.2})},200)}};requestAnimationFrame(b)}catch(e){console.error("Force layout failed:",e),Ye("Layout calculation failed","error")}},[h,f,g,y,_,c,Ye]),ot=(0,i.useCallback)(()=>{try{rt(),Ye("Nodes realigned successfully","success")}catch(e){console.error("Force layout error:",e),Ye("Failed to realign nodes","error")}},[rt,Ye]),lt=(0,i.useCallback)(()=>{if(!window.confirm("Are you sure you want to clear the entire mind map?"))return;const e={topics:[],cases:[],tasks:[],literature:[],connections:[]};_(e),g([]),y([]),X(null),ue({isOpen:!1,data:null}),be({isOpen:!1,data:null}),ve({isOpen:!1,data:null}),Xe({isOpen:!1,data:null}),ie(null),We(e),Ye("Mind map cleared successfully","success")},[g,y,We,Ye]),dt=(0,i.useCallback)(e=>{var t,a,i,s;const n=Date.now(),r=`${e}-${n}`;let o={id:n,label:`New ${e}`};"case"===e&&(o={...o,chiefComplaint:"",initialPresentation:"",currentPresentation:"",medicationHistory:"",therapyProgress:"",defensePatterns:"",clinicalReflection:""});const l=((null===(t=C.topics)||void 0===t?void 0:t.length)||0)+((null===(a=C.cases)||void 0===a?void 0:a.length)||0)+((null===(i=C.tasks)||void 0===i?void 0:i.length)||0)+((null===(s=C.literature)||void 0===s?void 0:s.length)||0),d=Math.ceil(Math.sqrt(l+1)),c={x:l%d*280+400,y:280*Math.floor(l/d)+150},u={id:r,type:e,position:c,data:{...o,onDelete:()=>Ge(r)}};_(t=>{const a="literature"===e?"literature":`${e}s`,i={...u.data,position:u.position};delete i.onDelete;const s={...t,[a]:[...t[a]||[],i]};return We(s),s}),g(e=>e.concat(u)),Ye(`${e.charAt(0).toUpperCase()+e.slice(1)} added successfully`,"success")},[C,Ge,_,We,g,Ye]),ct=(0,i.useCallback)(e=>{if(b(e),He)return void console.log("Skipping position updates during animation");const t=e.filter(e=>"position"===e.type&&e.position);t.length>0&&(console.log("Processing position changes:",t),_(e=>{const a={...e};return t.forEach(e=>{if(e.position){var t;const[i,s]=e.id.split("-"),n=null===(t=a["literature"===i?"literature":`${i}s`])||void 0===t?void 0:t.find(e=>String(e.id)===s);n&&(n.position={...e.position},console.log(`Updated ${i} ${s} position to:`,e.position))}}),he.save(a,null,null,!1),a}),setTimeout(()=>{We(C)},500))},[b,_,He,We,C]),ut=(0,i.useCallback)((e,t)=>{clearTimeout(window.dragSaveTimeout),window.dragSaveTimeout=setTimeout(()=>{_(e=>(We(e),e))},500)},[We]),pt=(0,i.useCallback)(async()=>{F(!0),B(10),V("Checking local data...");try{const t=he.load();if(t)return B(30),V("Loading from cache..."),t.connections||(t.connections=[]),_(t),B(60),V("Applying layout..."),await Je(t,!0),B(90),V("Finalizing..."),F(!1),ee(!1),B(100),void setTimeout(async()=>{try{const e=await n.A.get(`${ce}/mindmap-data`);JSON.stringify(e.data)!==JSON.stringify(t)&&(e.data.connections||(e.data.connections=[]),_(e.data),await Je(e.data),We(e.data),Ye("Data synchronized with server","info"))}catch(e){console.warn("Background sync failed:",e)}},500);B(20),V("Loading from server...");try{const e=await n.A.get(`${ce}/mindmap-data`);e.data.connections||(e.data.connections=[]),B(50),V("Processing data..."),_(e.data),B(80),V("Applying layout..."),await Je(e.data,!0),We(e.data),B(100),F(!1),ee(!1)}catch(e){console.warn("Backend loading failed, populating with sample data:",e),B(60),V("Loading sample data...");_({topics:[],cases:[],tasks:[],literature:[],connections:[]}),setTimeout(()=>{le(_,We,Ye)},100),B(100),F(!1),ee(!1)}}catch(t){console.error("Error loading mind map:",t),Ye("Failed to load mind map","error"),F(!1),ee(!1)}},[Ye,We,Je]);(0,i.useEffect)(()=>{pt()},[]);const mt=(0,i.useCallback)((e,t)=>{if(!e||!e.id||!e.data)return!1;if(!t)return!0;const a=t.toLowerCase().trim();if(!a)return!0;try{const t=e.id.split("-"),i=t.length>0?t[0]:"",s=t.length>1?t[1]:"";let n=!1;if(!n&&e.data.label){n=e.data.label.toLowerCase().includes(a)}if(!n&&i&&(n=i.includes(a)),!n&&"case"===i&&s&&(n=`case-${s}`.toLowerCase().includes(a)),!n)if("case"===i){n=(e.data.primary_diagnosis||e.data.primaryDiagnosis||"").toLowerCase().includes(a)}else if("topic"===i){n=(e.data.title||"").toLowerCase().includes(a)}else if("literature"===i){const t=(e.data.title||"").toLowerCase(),i=(e.data.authors||"").toLowerCase();n=t.includes(a)||i.includes(a)}if(!n&&e.data.category){n=e.data.category.toLowerCase().includes(a)}return n}catch(i){return console.error("Error in nodeMatchesSearch for node:",e.id,i),!1}},[]);if((0,i.useEffect)(()=>{const e=e=>{var t;if("INPUT"!==e.target.tagName&&"TEXTAREA"!==e.target.tagName){if(e.ctrlKey||e.metaKey)switch(e.key){case"n":e.preventDefault(),re(!0);break;case"e":e.preventDefault(),M(!I);break;case"r":e.preventDefault(),ot();break;case"f":e.preventDefault(),null===(t=document.querySelector('input[type="text"][placeholder*="Search"]'))||void 0===t||t.focus()}"Escape"===e.key&&(X(null),ue({isOpen:!1,data:null}),be({isOpen:!1,data:null}),ve({isOpen:!1,data:null}),Xe({isOpen:!1,data:null}),re(!1),!oe.isOpen&&!xe.isOpen&&!ye.isOpen&&Le.isOpen)}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[ot,oe,xe,ye,Le]),(0,i.useEffect)(()=>{(ke&&!Se&&h.length>0||K&&h.length>0)&&_e(!0)},[ke,Se,h,K]),(0,i.useEffect)(()=>{if(0===h.length)return;Object.values(Re).some(e=>e)},[ae,h,mt,He,Re]),(0,i.useEffect)(()=>{if(!ke)return;const e=document.getElementById("search-filter-styles")||document.createElement("style");e.id="search-filter-styles",document.getElementById("search-filter-styles")||document.head.appendChild(e);e.textContent="\n      /* Default node styling */\n      .react-flow__node {\n        transition: opacity 0.3s ease, transform 0.3s ease, filter 0.3s ease !important;\n      }\n      \n      /* Search dimmed nodes */\n      .react-flow__node.search-dimmed {\n        opacity: 0.15 !important;\n        filter: grayscale(0.7) !important;\n        transform: scale(0.9) !important;\n      }\n      \n      /* Selected node highlighting */\n      .react-flow__node.search-selected {\n        box-shadow: 0 0 0 2px #10b981, 0 0 20px rgba(16, 185, 129, 0.6) !important;\n        z-index: 1000 !important;\n      }\n      \n      /* Ensure dragging still works */\n      .react-flow__node.search-dimmed {\n        pointer-events: auto !important;\n      }\n    "},[ke]),H)return(0,d.jsx)(te,{message:q,progress:R});return(0,d.jsxs)("div",{className:"min-h-screen bg-gray-50 flex",children:[(0,d.jsxs)("div",{className:"w-80 bg-gradient-to-b from-slate-800 to-slate-900 text-white p-6 shadow-2xl flex flex-col",children:[(0,d.jsxs)("div",{className:"mb-8",children:[(0,d.jsx)("div",{className:"text-3xl font-bold tracking-wide text-white",children:"PGY-3 HQ"}),(0,d.jsx)("div",{className:"text-sm text-slate-300 mt-2",children:"Psychiatry Resident Dashboard"})]}),(0,d.jsxs)("div",{className:"mb-6",children:[(0,d.jsx)("h3",{className:"text-sm font-semibold text-slate-300 mb-3",children:"Filter by Category"}),(0,d.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,d.jsx)("button",{onClick:()=>ie(null),className:"px-3 py-2 rounded-lg text-xs transition-all "+(null===ae?"bg-teal-600 text-white":"bg-slate-700 text-slate-300 hover:bg-slate-600"),children:"All"}),(0,d.jsxs)("button",{onClick:()=>ie("topic"),className:"px-3 py-2 rounded-lg text-xs transition-all flex items-center gap-1 "+("topic"===ae?"bg-blue-600 text-white":"bg-slate-700 text-slate-300 hover:bg-slate-600"),children:[(0,d.jsx)(T.A,{size:12}),"Topics"]}),(0,d.jsxs)("button",{onClick:()=>ie("case"),className:"px-3 py-2 rounded-lg text-xs transition-all flex items-center gap-1 "+("case"===ae?"bg-indigo-600 text-white":"bg-slate-700 text-slate-300 hover:bg-slate-600"),children:[(0,d.jsx)(m.A,{size:12}),"Cases"]}),(0,d.jsxs)("button",{onClick:()=>ie("task"),className:"px-3 py-2 rounded-lg text-xs transition-all flex items-center gap-1 "+("task"===ae?"bg-amber-600 text-white":"bg-slate-700 text-slate-300 hover:bg-slate-600"),children:[(0,d.jsx)(A.A,{size:12}),"Tasks"]}),(0,d.jsxs)("button",{onClick:()=>ie("literature"),className:"px-3 py-2 rounded-lg text-xs transition-all flex items-center gap-1 "+("literature"===ae?"bg-purple-600 text-white":"bg-slate-700 text-slate-300 hover:bg-slate-600"),children:[(0,d.jsx)(D.A,{size:12}),"Literature"]})]})]}),(0,d.jsx)("div",{className:"mb-4 p-3 bg-slate-700 bg-opacity-50 rounded-lg",children:(0,d.jsx)("div",{className:"flex items-center gap-2 text-xs",children:Pe?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(S.A,{size:12,className:"animate-spin"}),(0,d.jsx)("span",{className:"text-amber-300",children:"Saving..."})]}):De?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(z.A,{size:12,className:"text-green-400"}),(0,d.jsxs)("span",{className:"text-slate-300",children:["Last saved: ",De.toLocaleTimeString()]})]}):(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(P.A,{size:12,className:"text-slate-400"}),(0,d.jsx)("span",{className:"text-slate-400",children:"Auto-save enabled"})]})})}),(0,d.jsxs)("div",{className:"space-y-3 mb-6",children:[(0,d.jsx)(me,{onClick:ot,icon:O.A,className:"w-full bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-md text-sm",children:"Realign Nodes"}),(0,d.jsx)(me,{onClick:()=>le(_,We,Ye),icon:D.A,className:"w-full bg-emerald-600 hover:bg-emerald-700 text-white px-4 py-2 rounded-md text-sm",children:"Add Sample Literature"}),(0,d.jsxs)("div",{className:"space-y-2",children:[(0,d.jsx)("div",{className:"text-xs font-semibold text-slate-400 uppercase tracking-wide mb-2",children:"Add Nodes"}),(0,d.jsxs)(me,{onClick:()=>dt("topic"),icon:T.A,className:"w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md text-sm flex items-center gap-2",children:[(0,d.jsx)(T.A,{size:16}),"Add Topic"]}),(0,d.jsxs)(me,{onClick:()=>dt("case"),icon:m.A,className:"w-full bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-md text-sm flex items-center gap-2",children:[(0,d.jsx)(m.A,{size:16}),"Add Case"]}),(0,d.jsxs)(me,{onClick:()=>dt("task"),icon:A.A,className:"w-full bg-amber-600 hover:bg-amber-700 text-white px-4 py-2 rounded-md text-sm flex items-center gap-2",children:[(0,d.jsx)(A.A,{size:16}),"Add Task"]}),(0,d.jsxs)(me,{onClick:()=>dt("literature"),icon:D.A,className:"w-full bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-md text-sm flex items-center gap-2",children:[(0,d.jsx)(D.A,{size:16}),"Add Literature"]})]}),(0,d.jsx)(me,{onClick:lt,icon:$.A,className:"w-full bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-md text-sm",children:"Clear All Data"})]}),L&&(0,d.jsxs)("div",{className:"mt-auto p-4 bg-slate-700 bg-opacity-50 rounded-lg",children:[(0,d.jsx)("h3",{className:"text-sm font-semibold text-slate-300 mb-2",children:"Selected Node"}),(0,d.jsxs)("div",{className:"space-y-2",children:[(0,d.jsxs)("div",{className:"flex items-center gap-2",children:["topic"===L.type&&(0,d.jsx)(T.A,{size:14,className:"text-blue-400"}),"case"===L.type&&(0,d.jsx)(m.A,{size:14,className:"text-indigo-400"}),"task"===L.type&&(0,d.jsx)(A.A,{size:14,className:"text-amber-400"}),"literature"===L.type&&(0,d.jsx)(D.A,{size:14,className:"text-purple-400"}),(0,d.jsx)("span",{className:"text-sm text-white font-medium truncate",children:L.data.label})]}),L.data.category&&(0,d.jsxs)("div",{className:"text-xs text-slate-400",children:["Category: ",L.data.category]}),L.data.status&&(0,d.jsxs)("div",{className:"text-xs text-slate-400",children:["Status: ",L.data.status]}),(0,d.jsxs)("button",{onClick:()=>{const[e,t]=L.id.split("-"),a=C["literature"===e?"literature":`${e}s`].find(e=>String(e.id)===t);a&&("case"===e?ue({isOpen:!0,data:a}):"topic"===e?be({isOpen:!0,data:a}):"task"===e?ve({isOpen:!0,data:a}):"literature"===e&&qe(a))},className:"w-full mt-2 px-3 py-2 bg-slate-600 hover:bg-slate-500 text-white text-xs rounded-lg transition-colors flex items-center gap-2",children:[(0,d.jsx)(E.A,{size:12}),"View Details"]})]})]}),!L&&(0,d.jsxs)("div",{className:"mt-auto p-3 bg-slate-700 bg-opacity-30 rounded-lg",children:[(0,d.jsx)("h4",{className:"text-xs font-semibold text-slate-300 mb-2",children:"Keyboard Shortcuts"}),(0,d.jsxs)("div",{className:"space-y-1 text-xs text-slate-400",children:[(0,d.jsx)("div",{children:"Ctrl+N - Add Node"}),(0,d.jsx)("div",{children:"Ctrl+E - Toggle Edit Mode"}),(0,d.jsx)("div",{children:"Ctrl+R - Realign Nodes"}),(0,d.jsx)("div",{children:"Esc - Clear Selection"})]})]})]}),(0,d.jsx)("div",{className:"flex-1 relative",children:(0,d.jsx)(fe,{children:(0,d.jsxs)(w.Gc,{nodes:h,edges:f,onNodesChange:ct,onEdgesChange:v,onConnect:Ze,onNodeClick:Qe,onNodeDoubleClick:et,onNodeDragStop:ut,onEdgeDoubleClick:tt,onEdgeContextMenu:at,onEdgeMouseEnter:st,onEdgeMouseLeave:nt,nodeTypes:ne,edgeTypes:{floating:J,enhanced:Z},connectionLineComponent:Q,nodesDraggable:!0,nodesConnectable:!0,elementsSelectable:!0,onInit:e=>{Ce(!0),window.reactFlowInstance=e},onError:(e,t)=>{console.warn("React Flow Error:",e,t),!He||t.includes("dimensions")},fitView:!0,snapToGrid:!1,snapGrid:[15,15],elevateEdgesOnSelect:!1,connectionLineStyle:{stroke:"#3b82f6",strokeWidth:3.5,opacity:.9,strokeLinecap:"round",strokeDasharray:"5,3",filter:"drop-shadow(0 0 6px rgba(59, 130, 246, 0.6))",animation:"flowingDash 1s linear infinite"},defaultEdgeOptions:{type:"enhanced",style:{strokeWidth:2.5,stroke:"#64748b",opacity:.9,strokeLinecap:"round",transition:"none"}},className:"bg-gradient-to-br from-blue-50 to-indigo-100",children:[(0,d.jsx)(w.VS,{color:"#aaa",gap:16}),(0,d.jsx)(w.H2,{}),(0,d.jsx)(w.of,{})]})})}),Le.isOpen&&(0,d.jsx)(Y,{isOpen:Le.isOpen,onClose:()=>{Fe(!0),Xe({isOpen:!1,data:null}),setTimeout(()=>Fe(!1),500)},onAnimationStart:()=>Fe(!0),onAnimationEnd:()=>Fe(!1),literatureData:Le.data,allNodes:h,connections:C.connections||[],setMindMapData:_,autoSaveMindMapData:We,addToast:Ye}),(0,d.jsx)(r.N,{mode:"wait",children:oe.isOpen&&(0,d.jsx)(U.default,{isOpen:oe.isOpen,data:we.current||oe.data,onClose:()=>{Be(e=>({...e,case:!0})),ue({isOpen:!1,data:null})},onAnimationStart:()=>{Fe(!0),Be(e=>({...e,case:!0}))},onAnimationEnd:()=>{Fe(!1),Be(e=>({...e,case:!1}))},setMindMapData:_,autoSaveMindMapData:We,addToast:Ye},`case-modal-${(null===(s=oe.data)||void 0===s?void 0:s.id)||"default"}`)}),(0,d.jsx)(r.N,{mode:"wait",children:xe.isOpen&&(0,d.jsx)(W.default,{isOpen:xe.isOpen,data:je.current||xe.data,onClose:()=>{Be(e=>({...e,topic:!0})),be({isOpen:!1,data:null})},onAnimationStart:()=>{Fe(!0),Be(e=>({...e,topic:!0}))},onAnimationEnd:()=>{Fe(!1),Be(e=>({...e,topic:!1}))},setMindMapData:_,autoSaveMindMapData:We,addToast:Ye,syncNodeData:Ve,forceNodeUpdate:()=>k(e=>e+1)},`topic-modal-${(null===(o=xe.data)||void 0===o?void 0:o.id)||"default"}`)}),(0,d.jsx)(r.N,{mode:"wait",children:ye.isOpen&&(0,d.jsx)(G.default,{isOpen:ye.isOpen,data:Ne.current||ye.data,onClose:()=>{Be(e=>({...e,task:!0})),ve({isOpen:!1,data:null})},onAnimationStart:()=>{Fe(!0),Be(e=>({...e,task:!0}))},onAnimationEnd:()=>{Fe(!1),Be(e=>({...e,task:!1}))},setMindMapData:_,autoSaveMindMapData:We,addToast:Ye},`task-modal-${(null===(l=ye.data)||void 0===l?void 0:l.id)||"default"}`)}),(0,d.jsx)(ge,{isOpen:$e.isOpen,edge:$e.edge,onClose:()=>Ee({isOpen:!1,edge:null}),onSave:it}),H&&(0,d.jsx)("div",{className:"absolute inset-0 bg-white bg-opacity-80 flex items-center justify-center z-50",children:(0,d.jsx)(S.A,{size:48,className:"animate-spin text-blue-600"})}),Ie.map(e=>(0,d.jsx)(pe,{message:e.message,type:e.type,duration:e.duration,onClose:()=>Ue(e.id)},e.id))]})};class fe extends i.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(e){return e.message&&e.message.includes("dimensions")?(console.warn("React Flow dimension error caught, recovering..."),{hasError:!1}):{hasError:!0}}componentDidCatch(e,t){e.message&&e.message.includes("dimensions")?setTimeout(()=>{window.reactFlowInstance&&window.reactFlowInstance.fitView()},100):console.error("React Flow Error:",e,t)}render(){return this.state.hasError?(0,d.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,d.jsxs)("div",{className:"text-center",children:[(0,d.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Mind Map Temporarily Unavailable"}),(0,d.jsx)("p",{className:"text-gray-600 mb-4",children:"There was an issue with the mind map. Please refresh the page."}),(0,d.jsx)("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Refresh Page"})]})}):this.props.children}}const ye=()=>(0,d.jsx)(w.Ln,{children:(0,d.jsx)(be,{})});const ve=function(){return"true"===new URLSearchParams(window.location.search).get("timeline-test")?(0,d.jsx)(v,{}):(0,d.jsx)(ye,{})};s.createRoot(document.getElementById("root")).render((0,d.jsx)(i.StrictMode,{children:(0,d.jsx)(ve,{})}))},2667:(e,t,a)=>{a.d(t,{A:()=>l});var i=a(5043),s=a(3546),n=a(6446),r=a(8270),o=a(579);const l=e=>{let{data:t,onNodeClick:a,onNodeHover:l,onDataChange:d,caseId:c,autoSaveMindMapData:u,setMindMapData:p}=e;const[m,x]=(0,i.useState)([]),[h,g]=(0,i.useState)(null),[b,f]=(0,i.useState)({}),[y,v]=(0,i.useState)({}),[w,j]=(0,i.useState)(!1),[N,k]=(0,i.useState)(!1),[C,S]=(0,i.useState)(!1),[_,T]=(0,i.useState)(null),[A,D]=(0,i.useState)(0),z=(0,i.useRef)(null),P=(0,i.useRef)({}),O=(0,i.useRef)({}),$=(0,i.useRef)({isDragging:!1,draggedNodeId:null}),E=(0,i.useRef)(null),I=(0,i.useRef)(null),M=((0,i.useRef)({}),200),L=800,X=400,H=320,F=200,R="elastic.out(1, 0.4)",B=(0,i.useCallback)(e=>{console.log("scrollToNode called with nodeId:",e);const t=m.find(t=>t.id===e);if(console.log("Found node:",t),t&&E.current){const e=E.current,a=t.y-e.clientHeight/2;console.log("Scrolling to Y position:",a),e.scrollTo({top:Math.max(0,a),behavior:"smooth"})}else console.log("Node or scroll container not found")},[m]),Y=(0,i.useCallback)(()=>{console.log("scrollToTop clicked"),console.log("scrollContainerRef.current:",E.current),E.current?(console.log("Scrolling to top"),E.current.scrollTo({top:0,behavior:"smooth"})):console.log("scrollContainerRef is null")},[]),U=(0,i.useCallback)(()=>{console.log("scrollToBottom clicked"),console.log("scrollContainerRef.current:",E.current),E.current?(console.log("Scrolling to bottom, scrollHeight:",E.current.scrollHeight),E.current.scrollTo({top:E.current.scrollHeight,behavior:"smooth"})):console.log("scrollContainerRef is null")},[]),W=(0,i.useCallback)(()=>{if(console.log("scrollToLatestNode clicked"),m.length>0){const e=m[m.length-1];console.log("Latest node:",e),setTimeout(()=>B(e.id),100)}else console.log("No nodes available")},[m,B]),G=(0,i.useCallback)(()=>{if(E.current){const e=E.current,{scrollTop:t,scrollHeight:a,clientHeight:i}=(e.scrollHeight,e),s=a-i,n=s>0?Math.round(t/s*100):0;D(Math.min(100,Math.max(0,n)))}},[]),q=(0,i.useMemo)(()=>{if(0===m.length)return 600;const e=m.map(e=>e.y||0).filter(e=>e>0),t=e.length>0?Math.max(...e):0,a=200*m.length+200,i=t+300;return Math.max(600,a,i)},[m]);(0,i.useEffect)(()=>{G()},[q]),(0,i.useEffect)(()=>{const e=E.current;if(!e)return;const t=()=>{const{scrollTop:t,scrollHeight:a,clientHeight:i}=e,s=a-i,n=s>0?Math.round(t/s*100):0;D(Math.min(100,Math.max(0,n)))};return t(),e.addEventListener("scroll",t,{passive:!0}),()=>{e.removeEventListener("scroll",t)}},[q]);const V=(0,i.useRef)({}),J=(0,i.useCallback)(async function(){if(!C||arguments.length>0&&void 0!==arguments[0]&&arguments[0]){S(!0);try{const e=m.map((e,t)=>{var a,i,s,n,r,o,l,d,u,p;return{id:e.id||`timeline-${c}-${Date.now()}-${t}`,title:e.title||`Timeline Entry ${t+1}`,type:"timeline_entry",timestamp:e.date||(new Date).toISOString(),date:e.date||(new Date).toISOString(),orderIndex:t,patient_narrative:(null===(a=y[e.id])||void 0===a?void 0:a.patient)||(null===(i=e.patientData)||void 0===i?void 0:i.notes)||e.patient_narrative||"",clinical_notes:(null===(s=y[e.id])||void 0===s?void 0:s.clinical)||(null===(n=e.clinicalData)||void 0===n?void 0:n.notes)||e.clinical_notes||"",content:(null===(r=y[e.id])||void 0===r?void 0:r.patient)||(null===(o=y[e.id])||void 0===o?void 0:o.clinical)||e.content||"",patientData:{...e.patientData,notes:(null===(l=y[e.id])||void 0===l?void 0:l.patient)||(null===(d=e.patientData)||void 0===d?void 0:d.notes)||""},clinicalData:{...e.clinicalData,notes:(null===(u=y[e.id])||void 0===u?void 0:u.clinical)||(null===(p=e.clinicalData)||void 0===p?void 0:p.notes)||""},symptoms:e.symptoms||[],x:e.x||X,y:e.y||100+t*M,created_at:e.created_at||(new Date).toISOString(),updated_at:(new Date).toISOString()}});if(console.log(`Saving timeline data for case ${c}:`,e),c&&p&&u)p(t=>{const a=t.cases.map(t=>String(t.id)===String(c)?{...t,timeline:e,last_updated:(new Date).toISOString()}:t),i={...t,cases:a};return u(i),i});else{const e={nodes:m.map(e=>{var t,a,i,s;return{...e,patientData:{...e.patientData,notes:(null===(t=y[e.id])||void 0===t?void 0:t.patient)||(null===(a=e.patientData)||void 0===a?void 0:a.notes)||""},clinicalData:{...e.clinicalData,notes:(null===(i=y[e.id])||void 0===i?void 0:i.clinical)||(null===(s=e.clinicalData)||void 0===s?void 0:s.notes)||""}}}),cardTexts:y,timestamp:(new Date).toISOString(),version:"1.0"};localStorage.setItem("timeline-data",JSON.stringify(e))}d&&await d(e),T(new Date),console.log("Timeline data saved successfully")}catch(e){console.error("Failed to save timeline data:",e)}finally{S(!1)}}},[m,y,C,d,c,p,u]),K=(0,i.useCallback)(()=>{I.current&&clearTimeout(I.current),I.current=setTimeout(()=>{J()},800)},[J]);(0,i.useEffect)(()=>{if(!(()=>{try{if(console.log(`Loading timeline data for case ${c}:`,t),c&&t&&Array.isArray(t)){console.log(`Loading ${t.length} timeline entries from case integration for case ${c}`);const e=t.map((e,t)=>{const a=e.id||`timeline-${c}-${Date.now()}-${t}`,i=100+t*M;return v(t=>{var i,s;return{...t,[a]:{patient:e.patient_narrative||(null===(i=e.patientData)||void 0===i?void 0:i.notes)||"",clinical:e.clinical_notes||(null===(s=e.clinicalData)||void 0===s?void 0:s.notes)||""}}}),V.current[a]={x:e.x||X,y:e.y||i,index:t},{id:a,title:e.title||`Timeline Entry ${t+1}`,date:e.timestamp||e.date||(new Date).toISOString(),type:e.type||"timeline_entry",patient_narrative:e.patient_narrative||"",clinical_notes:e.clinical_notes||"",content:e.content||e.patient_narrative||e.clinical_notes||"",patientData:{notes:e.patient_narrative||"",...e.patientData},clinicalData:{notes:e.clinical_notes||"",...e.clinicalData},symptoms:e.symptoms||[],x:e.x||X,y:e.y||i,originalY:i,orderIndex:void 0!==e.orderIndex?e.orderIndex:t,created_at:e.created_at||(new Date).toISOString(),updated_at:e.updated_at||(new Date).toISOString()}});if(e.length>0)return x(e),console.log(`Successfully loaded ${e.length} timeline nodes for case ${c}`),!0}if(!c){const e=localStorage.getItem("timeline-data");if(e){const t=JSON.parse(e);if(console.log("Loading saved timeline data from localStorage:",t),t.nodes&&t.nodes.length>0&&0===m.length)return x(t.nodes),t.cardTexts&&v(t.cardTexts),t.nodes.forEach((e,t)=>{V.current[e.id]={x:e.x||X,y:e.y||100+t*M,index:t}}),T(new Date(t.timestamp)),!0}}return console.log(`No existing timeline data found for case ${c||"standalone"}, initializing empty timeline`),!1}catch(e){return console.error("Failed to load timeline data:",e),!1}})()&&t&&t.length>0&&0===m.length&&!c){const e=t.map((e,t)=>{const a=100+t*M,i=e.id;return V.current[i]={x:X,y:a,index:t},v(t=>{var a,s,n,r;return{...t,[i]:{patient:(null===(a=e.patientData)||void 0===a?void 0:a.notes)||(null===(s=e.patientData)||void 0===s?void 0:s.chiefComplaint)||"",clinical:(null===(n=e.clinicalData)||void 0===n?void 0:n.notes)||(null===(r=e.clinicalData)||void 0===r?void 0:r.chiefComplaint)||""}}}),{...e,x:X,y:a,originalY:a}});x(e)}},[t,c]);const Z=(0,i.useCallback)((e,t)=>{var a;const i=null===(a=V.current[e])||void 0===a?void 0:a.index;if(void 0===i)return;const s=[];if(i>0){const a=m[i-1];a&&s.push({id:`connection-${e}-prev`,sourceNode:a,targetNode:{...a,x:t.x,y:t.y}})}if(i<m.length-1){const a=m[i+1];a&&s.push({id:`connection-${e}-next`,sourceNode:{...a,x:t.x,y:t.y},targetNode:a})}s.forEach(e=>{const t=O.current[e.id];if(t){const a=e.sourceNode.x,i=e.sourceNode.y,s=e.targetNode.x,n=e.targetNode.y,o=`M ${a} ${i} C ${a} ${(i+n)/2}, ${s} ${(i+n)/2}, ${s} ${n}`;r.os.to(t,{attr:{d:o},duration:.3,ease:R})}})},[m]),Q=(0,i.useCallback)((e,t)=>{var a;e.preventDefault(),$.current.isDragging=!0,$.current.draggedNodeId=t,j(!0);const i=P.current[t];if(!i)return;if(!(null===(a=z.current)||void 0===a?void 0:a.getBoundingClientRect()))return;const s=V.current[t];if(!s)return;e.clientX,e.clientY,s.x,s.y;const n=e=>{var a;const s=null===(a=z.current)||void 0===a?void 0:a.getBoundingClientRect();if(!s)return;const n=e.clientX-s.left,r=e.clientY-s.top,o=Math.max(50,Math.min(750,n)),l=Math.max(50,r);i.style.left=o-30+"px",i.style.top=l-30+"px",i.style.transform="",x(e=>e.map(e=>e.id===t?{...e,x:o,y:l}:e)),Z(t,{x:o,y:l})},o=e=>{var a;$.current.isDragging=!1,$.current.draggedNodeId=null,j(!1);[`connection-${t}-prev`,`connection-${t}-next`].forEach(e=>{const t=O.current[e];t&&r.os.fromTo(t,{rotation:-1},{rotation:0,duration:.3,ease:"sine.out"})});const i=null===(a=z.current)||void 0===a?void 0:a.getBoundingClientRect();if(!i)return;const s=Math.max(50,Math.min(750,e.clientX-i.left)),l=Math.max(50,e.clientY-i.top);x(e=>e.map(e=>e.id===t?{...e,x:s,y:l}:e)),V.current[t].x=s,V.current[t].y=l,K(),setTimeout(()=>G(),50),document.removeEventListener("mousemove",n),document.removeEventListener("mouseup",o),setTimeout(()=>{$.current.isDragging=!1},10)};document.addEventListener("mousemove",n),document.addEventListener("mouseup",o)},[q,Z,K]),ee=(0,i.useCallback)(e=>{if(!$.current.isDragging){if(E.current){const t=E.current,a=e.y-t.clientHeight/2;t.scrollTo({top:Math.max(0,a),behavior:"smooth"})}g(null),f({[e.id]:{patient:!0,clinical:!0}}),null===a||void 0===a||a(e)}},[a]),te=(0,i.useCallback)((e,t)=>{$.current.isDragging||(t?(f({}),g(e)):g(null),null===l||void 0===l||l(e,t))},[l]),ae=(0,i.useCallback)((e,t,a)=>{v(i=>({...i,[e]:{...i[e],[t]:a}})),K()},[K]),ie=(0,i.useCallback)((e,t)=>{f(t=>({...t,[e]:{patient:!1,clinical:!1}}))},[]),se=(0,i.useCallback)(e=>{var t,a;const i=(null===h||void 0===h?void 0:h.id)===e,s=(null===(t=b[e])||void 0===t?void 0:t.patient)||(null===(a=b[e])||void 0===a?void 0:a.clinical);return console.log(`Cards visibility check for ${e}:`,{isHovered:i,isEditing:s,editingState:b[e]}),i||s},[h,b]),ne=(0,i.useCallback)(()=>{if(N)return;k(!0);const e=`node-${Date.now()}`,t=m.length,a=100+t*M,i={id:e,date:(new Date).toISOString(),patientData:{chiefComplaint:"",notes:""},clinicalData:{chiefComplaint:"",notes:""},x:X,y:a,originalY:a};V.current[e]={x:X,y:a,index:t},v(t=>({...t,[e]:{patient:"",clinical:""}})),x(e=>{const t=[...e,i];return t.forEach((e,t)=>{V.current[e.id]&&(V.current[e.id].index=t)}),t}),setTimeout(()=>{const t=document.querySelector(`[data-node-id="${e}"]`);t&&E.current&&t.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"}),k(!1),K()},800)},[m.length,N,K]),re=(0,i.useCallback)(()=>{x(e=>e.map((e,t)=>{const a=100+t*M,i={...e,x:X,y:a,originalY:a};V.current[e.id]&&(V.current[e.id].x=X,V.current[e.id].y=a,V.current[e.id].index=t);[`connection-${e.id}-prev`,`connection-${e.id}-next`].forEach(e=>{const t=O.current[e];t&&r.os.to(t,{attr:{d:""},duration:.3,ease:R})});const s=document.querySelector(`[data-node-id="${e.id}"]`);s&&(s.style.left="370px",s.style.top=a-30+"px",s.style.transform="");const n=document.querySelector(`[data-patient-card="${e.id}"]`),o=document.querySelector(`[data-clinical-card="${e.id}"]`);return n&&(n.style.left="-120px",n.style.top=a-60+"px",n.style.transform=""),o&&(o.style.left="600px",o.style.top=a-60+"px",o.style.transform=""),i})),K()},[K]),oe=(0,i.useCallback)(()=>{J(!0)},[J]);return(0,i.useEffect)(()=>()=>{I.current&&clearTimeout(I.current)},[]),(0,o.jsxs)("div",{className:"relative w-full h-full",children:[(0,o.jsx)("style",{children:"\n  .timeline-scrollbar::-webkit-scrollbar {\n    width: 12px;\n    height: 12px;\n  }\n  \n  .timeline-scrollbar::-webkit-scrollbar-track {\n    background: rgba(30, 41, 59, 0.3);\n    border-radius: 6px;\n    margin: 4px;\n  }\n  \n  .timeline-scrollbar::-webkit-scrollbar-thumb {\n    background: linear-gradient(45deg, rgba(59, 130, 246, 0.6), rgba(99, 102, 241, 0.8));\n    border-radius: 6px;\n    border: 2px solid rgba(30, 41, 59, 0.3);\n    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n  }\n  \n  .timeline-scrollbar::-webkit-scrollbar-thumb:hover {\n    background: linear-gradient(45deg, rgba(59, 130, 246, 0.8), rgba(99, 102, 241, 1));\n    border-color: rgba(59, 130, 246, 0.3);\n    transform: scale(1.1);\n    box-shadow: 0 0 10px rgba(59, 130, 246, 0.4);\n  }\n  \n  .timeline-scrollbar::-webkit-scrollbar-thumb:active {\n    background: linear-gradient(45deg, rgba(37, 99, 235, 0.9), rgba(79, 70, 229, 1));\n    transform: scale(1.05);\n  }\n  \n  .timeline-scrollbar::-webkit-scrollbar-corner {\n    background: rgba(30, 41, 59, 0.3);\n    border-radius: 6px;\n  }\n  \n  .timeline-scrollbar {\n    scrollbar-width: thin;\n    scrollbar-color: rgba(59, 130, 246, 0.5) rgba(30, 41, 59, 0.3);\n    scroll-behavior: smooth;\n    animation: scrollbar-glow 3s ease-in-out infinite alternate;\n  }\n  \n  @keyframes scrollbar-glow {\n    from {\n      scrollbar-color: rgba(59, 130, 246, 0.4) rgba(30, 41, 59, 0.3);\n    }\n    to {\n      scrollbar-color: rgba(59, 130, 246, 0.7) rgba(30, 41, 59, 0.4);\n    }\n  }\n  \n  /* Smooth scrolling enhancement */\n  .timeline-scrollbar {\n    scroll-padding-top: 20px;\n    scroll-padding-bottom: 20px;\n  }\n\n  /* Custom animations for the timeline components */\n  @keyframes shimmer {\n    0% { transform: translateX(-100%); }\n    100% { transform: translateX(100%); }\n  }\n  \n  @keyframes shimmerReverse {\n    0% { transform: translateX(100%); }\n    100% { transform: translateX(-100%); }\n  }\n  \n  @keyframes pulse {\n    0%, 100% { opacity: 0.6; }\n    50% { opacity: 0.2; }\n  }\n"}),(0,o.jsxs)("div",{className:"absolute top-4 right-4 flex gap-2 z-40",children:[(0,o.jsxs)(n.P.button,{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white px-3 py-2 rounded-lg shadow-lg flex items-center gap-2 transition-all hover:shadow-blue-300/30",onClick:Y,whileHover:{scale:1.05},whileTap:{scale:.95},initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{delay:1.8,duration:.5},title:"Scroll to Top",children:[(0,o.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 10l7-7m0 0l7 7m-7-7v18"})}),"Top"]}),(0,o.jsxs)(n.P.button,{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white px-3 py-2 rounded-lg shadow-lg flex items-center gap-2 transition-all hover:shadow-blue-300/30",onClick:U,whileHover:{scale:1.05},whileTap:{scale:.95},initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{delay:2,duration:.5},title:"Scroll to Bottom",children:[(0,o.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 14l-7 7m0 0l-7-7m7 7V4"})}),"Bottom"]}),(0,o.jsxs)(n.P.button,{className:"bg-gradient-to-r from-indigo-600 to-purple-600 text-white px-3 py-2 rounded-lg shadow-lg flex items-center gap-2 transition-all hover:shadow-indigo-300/30",onClick:W,whileHover:{scale:1.05},whileTap:{scale:.95},initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{delay:2.2,duration:.5},title:"Go to Latest Entry",children:[(0,o.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})}),"Latest"]}),(0,o.jsxs)(n.P.button,{className:(C?"bg-gradient-to-r from-green-500 to-emerald-600 cursor-not-allowed":"bg-gradient-to-r from-green-500 to-emerald-600 hover:shadow-green-300/30")+" text-white px-4 py-2 rounded-lg shadow-lg flex items-center gap-2 transition-all",onClick:oe,disabled:C,whileHover:C?{}:{scale:1.05},whileTap:C?{}:{scale:.95},initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{delay:1.4,duration:.5},children:[C?(0,o.jsx)("svg",{className:"w-4 h-4 animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})}):(0,o.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"})}),C?"Saving...":"Save"]}),(0,o.jsxs)(n.P.button,{className:"bg-gradient-to-r from-gray-600 to-slate-700 text-white px-4 py-2 rounded-lg shadow-lg flex items-center gap-2 transition-all hover:shadow-gray-400/20",onClick:re,whileHover:{scale:1.05},whileTap:{scale:.95},initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{delay:1.2,duration:.5},children:[(0,o.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Reset Layout"]}),(0,o.jsxs)(n.P.button,{className:"bg-gradient-to-r from-blue-500 to-blue-700 text-white px-4 py-2 rounded-lg shadow-lg flex items-center gap-2 transition-all hover:shadow-blue-400/30",onClick:ne,disabled:N,whileHover:{scale:1.05},whileTap:{scale:.95},initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{delay:1,duration:.5},children:[(0,o.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),N?"Adding...":"Add Node"]})]}),(0,o.jsx)("div",{ref:E,className:"timeline-scrollbar relative w-full overflow-y-auto",style:{height:"80vh",maxHeight:"600px"},onClick:e=>{const t=e.target.closest(".timeline-card"),a=e.target.closest(".timeline-node"),i=e.target.closest("button");t||a||i||f({})},children:(0,o.jsx)("div",{className:"relative w-full",style:{height:Math.max((q||600)+200,window.innerHeight||600),minHeight:"100vh"},children:(0,o.jsxs)("div",{ref:z,className:"relative mx-auto",style:{width:L,height:(q||600)+200},children:[(0,o.jsxs)("svg",{className:"absolute inset-0 pointer-events-none",style:{zIndex:1},width:L,height:q+200,viewBox:`0 0 800 ${q+200}`,children:[(0,o.jsx)("path",{d:`M 400 50 ${m.map(e=>`L ${e.x} ${e.y}`).join(" ")}`,stroke:"url(#timelineGradient)",strokeWidth:"2",fill:"none",strokeDasharray:"5,5"}),(0,o.jsxs)("defs",{children:[(0,o.jsxs)("linearGradient",{id:"timelineGradient",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[(0,o.jsx)("stop",{offset:"0%",stopColor:"#93C5FD"}),(0,o.jsx)("stop",{offset:"100%",stopColor:"#C4B5FD"})]}),(0,o.jsxs)("linearGradient",{id:"connectionGradient",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[(0,o.jsx)("stop",{offset:"0%",stopColor:"#3B82F6"}),(0,o.jsx)("stop",{offset:"100%",stopColor:"#8B5CF6"})]}),(0,o.jsxs)("filter",{id:"glow",x:"-20%",y:"-20%",width:"140%",height:"140%",children:[(0,o.jsx)("feGaussianBlur",{stdDeviation:"3",result:"blur"}),(0,o.jsx)("feComposite",{in:"SourceGraphic",in2:"blur",operator:"over"})]})]}),m.map((e,t)=>{if(0===t)return null;const a=m[t-1],i=a.x,s=a.y,r=e.x,l=e.y,d=`M ${i} ${s} C ${i} ${(s+l)/2}, ${r} ${(s+l)/2}, ${r} ${l}`,c=`connection-${a.id}-next`,u=`connection-${e.id}-prev`,p=`connection-${a.id}-${e.id}`;return(0,o.jsx)(n.P.path,{ref:e=>{O.current[c]=e,O.current[u]=e},d:d,stroke:"url(#connectionGradient)",strokeWidth:"3",fill:"none",strokeLinecap:"round",strokeOpacity:"0.8",filter:"url(#glow)",style:{transformOrigin:"center"},initial:{opacity:1,pathLength:0},animate:{opacity:1,pathLength:1},transition:{duration:.8,delay:Math.min(.5,.1*t)}},p)})]}),(0,o.jsxs)(n.P.div,{className:"absolute text-center",style:{left:250,top:10,width:300},initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{delay:.5,duration:.6},children:[(0,o.jsx)("h2",{className:"text-xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Patient Timeline"}),(0,o.jsx)("p",{className:"text-sm text-gray-600",children:"Instant 1:1 drag \u2022 Hover for cards \u2022 Click to edit"})]}),m.map((e,t)=>{var a,i,r,l,d,c,u,p,m,x,v,w,j;return(0,o.jsxs)("div",{children:[(0,o.jsxs)(n.P.div,{ref:t=>P.current[e.id]=t,"data-node-id":e.id,className:"timeline-node absolute cursor-grab active:cursor-grabbing transform-gpu "+((null===h||void 0===h?void 0:h.id)===e.id?"ring-[5px] ring-purple-200/40 shadow-xl scale-110":"shadow-md hover:shadow-lg hover:scale-105"),style:{left:e.x-30,top:e.y-30,width:60,height:60,borderRadius:"50%",background:(null===h||void 0===h?void 0:h.id)===e.id?"linear-gradient(135deg, #8B5CF6, #6366F1, #4F46E5)":"linear-gradient(135deg, #3B82F6, #6366F1, #4F46E5)",boxShadow:(null===h||void 0===h?void 0:h.id)===e.id?"0 0 20px rgba(139, 92, 246, 0.6), inset 0 0 10px rgba(255, 255, 255, 0.2)":"0 0 15px rgba(59, 130, 246, 0.5), inset 0 0 8px rgba(255, 255, 255, 0.2)",border:"3px solid rgba(255, 255, 255, 0.9)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:10,transition:$.current.isDragging?"none":"all 0.2s cubic-bezier(0.4, 0, 0.2, 1), transform 0.15s ease-out",willChange:$.current.isDragging?"transform":"auto"},initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},transition:{type:"spring",stiffness:200,damping:20,delay:.1*t},onMouseDown:t=>{const a=t.currentTarget;a.style.transform="scale(0.95)",setTimeout(()=>{"scale(0.95)"===a.style.transform&&(a.style.transform="")},100),Q(t,e.id)},onClick:t=>{t.stopPropagation(),setTimeout(()=>{$.current.isDragging||ee(e)},20)},onMouseEnter:t=>{$.current.isDragging||te(e,!0)},onMouseLeave:t=>{$.current.isDragging||te(e,!1)},children:[(0,o.jsxs)("div",{className:"w-full h-full rounded-full bg-gradient-to-b from-white/40 to-white/10 flex items-center justify-center relative overflow-hidden backdrop-blur-[1px]",children:[(0,o.jsx)("div",{className:"absolute inset-1 rounded-full bg-white/10 backdrop-blur-[2px]"}),(0,o.jsx)("div",{className:"z-10 text-white drop-shadow-lg relative",children:e.symptoms&&e.symptoms.length>0?(0,o.jsxs)("svg",{className:"w-6 h-6 filter drop-shadow-md",fill:"currentColor",viewBox:"0 0 20 20",children:[(0,o.jsx)("path",{d:"M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"}),(0,o.jsx)("path",{fillRule:"evenodd",d:"M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5z",clipRule:"evenodd"})]}):null!==(a=e.patientData)&&void 0!==a&&a.notes?(0,o.jsx)("svg",{className:"w-6 h-6 filter drop-shadow-md",fill:"currentColor",viewBox:"0 0 20 20",children:(0,o.jsx)("path",{fillRule:"evenodd",d:"M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z",clipRule:"evenodd"})}):(0,o.jsx)("svg",{className:"w-6 h-6 filter drop-shadow-md",fill:"currentColor",viewBox:"0 0 20 20",children:(0,o.jsx)("path",{fillRule:"evenodd",d:"M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z",clipRule:"evenodd"})})}),(0,o.jsx)("div",{className:"absolute inset-0 rounded-full bg-gradient-to-r from-white/30 to-blue-300/30",style:{animation:(null===h||void 0===h?void 0:h.id)===e.id?"pulse 1.8s cubic-bezier(0.4, 0, 0.6, 1) infinite":"pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite",opacity:(null===h||void 0===h?void 0:h.id)===e.id?.8:.4}}),(null===h||void 0===h?void 0:h.id)===e.id&&(0,o.jsx)("div",{className:"absolute inset-[-5px] rounded-full bg-purple-300/20",style:{animation:"pulse 2.2s cubic-bezier(0.4, 0, 0.6, 1) infinite 0.5s"}})]}),(0,o.jsx)("div",{className:`absolute text-xs font-medium whitespace-nowrap transition-all duration-200 ease-out ${(null===h||void 0===h?void 0:h.id)===e.id?"translate-x-2 bg-gradient-to-r from-blue-600 to-purple-600 text-white shadow-md":"bg-white/90 text-gray-700"} px-2 py-1 rounded-md shadow-sm`,style:{left:70,top:"50%",transform:(null===h||void 0===h?void 0:h.id)===e.id?"translateY(-50%) translateX(8px) scale(1.05)":"translateY(-50%)",borderLeft:(null===h||void 0===h?void 0:h.id)===e.id?"3px solid rgba(255, 255, 255, 0.7)":"none"},children:(()=>{const t=new Date(e.date);return`${t.toLocaleDateString(void 0,{month:"short",day:"numeric"})} \xb7 ${t.toLocaleTimeString(void 0,{hour:"2-digit",minute:"2-digit"})}`})()})]}),(0,o.jsx)(s.N,{children:se(e.id)&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(n.P.div,{"data-patient-card":e.id,className:"timeline-card absolute bg-white rounded-lg shadow-xl z-20 backdrop-blur-sm",style:{left:e.x-F-H,top:e.y-60,width:H,borderRadius:"0.75rem",borderLeft:"4px solid transparent",borderImage:"linear-gradient(to bottom, #3B82F6, #8B5CF6) 1",boxShadow:"0 10px 25px -5px rgba(30, 58, 138, 0.3), 0 8px 10px -6px rgba(67, 56, 202, 0.25)",padding:"16px",background:"linear-gradient(to bottom right, rgba(30, 41, 59, 0.85), rgba(15, 23, 42, 0.9))"},initial:{opacity:0,scale:.8,x:20},animate:{opacity:1,scale:1,x:0},exit:{opacity:0,scale:.8,x:20},transition:{type:"spring",stiffness:300,damping:25},children:[(0,o.jsxs)("div",{className:"flex items-center mb-3",children:[(0,o.jsx)("div",{className:"w-3 h-3 bg-gradient-to-r from-blue-400 to-indigo-500 rounded-full mr-2 shadow-sm"}),(0,o.jsx)("h4",{className:"font-semibold bg-gradient-to-r from-blue-300 to-indigo-300 bg-clip-text text-transparent",children:"Patient Narrative"}),(null===(i=b[e.id])||void 0===i?void 0:i.patient)&&(0,o.jsx)("div",{className:"ml-auto text-xs font-medium px-2 py-0.5 rounded-full bg-blue-900/50 text-blue-200 shadow-inner border border-blue-700/30",children:"Editing"})]}),null!==(r=b[e.id])&&void 0!==r&&r.patient?(0,o.jsx)("textarea",{className:"w-full h-24 p-3 border-2 border-blue-700/50 rounded-lg resize-none text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-600 shadow-inner bg-slate-800/70 backdrop-blur-sm transition-all text-blue-100",value:(null===(l=y[e.id])||void 0===l?void 0:l.patient)||"",onChange:t=>ae(e.id,"patient",t.target.value),onBlur:t=>{ie(e.id,"patient")},placeholder:"Enter patient narrative...",style:{boxShadow:"inset 0 2px 4px 0 rgba(29, 78, 216, 0.2)"}}):(0,o.jsx)("div",{className:"text-sm text-blue-100 min-h-[60px] p-3 border-2 border-transparent hover:border-blue-700/40 rounded-lg cursor-text hover:bg-slate-800/50 transition-all",onClick:t=>{t.stopPropagation(),g(null),f({[e.id]:{patient:!0,clinical:!0}})},style:{backgroundImage:null!==(d=y[e.id])&&void 0!==d&&d.patient?"linear-gradient(to bottom right, rgba(30, 58, 138, 0.3), rgba(30, 64, 175, 0.15))":"none",boxShadow:null!==(c=y[e.id])&&void 0!==c&&c.patient?"inset 0 1px 2px 0 rgba(29, 78, 216, 0.15)":"none"},children:(null===(u=y[e.id])||void 0===u?void 0:u.patient)||(0,o.jsx)("span",{className:"text-blue-300 italic",children:"Click to add patient narrative..."})}),(0,o.jsxs)("div",{className:"absolute",style:{width:180,height:2,right:-180,top:50,zIndex:0,overflow:"hidden"},children:[(0,o.jsx)("div",{className:"h-full w-full bg-gradient-to-r from-blue-300 via-indigo-400 to-blue-500",style:{animation:(null===h||void 0===h?void 0:h.id)===e.id?"shimmer 1.5s linear infinite":"none"}}),(0,o.jsx)("style",{jsx:!0,children:"\n                        @keyframes shimmer {\n                          0% { transform: translateX(-100%); }\n                          100% { transform: translateX(100%); }\n                        }\n                      "})]})]}),(0,o.jsxs)(n.P.div,{"data-clinical-card":e.id,className:"timeline-card absolute bg-white rounded-lg shadow-xl z-20 backdrop-blur-sm",style:{left:e.x+F,top:e.y-60,width:H,borderRadius:"0.75rem",borderLeft:"4px solid transparent",borderImage:"linear-gradient(to bottom, #8B5CF6, #6366F1) 1",boxShadow:"0 10px 25px -5px rgba(91, 33, 182, 0.3), 0 8px 10px -6px rgba(76, 29, 149, 0.25)",padding:"16px",background:"linear-gradient(to bottom right, rgba(30, 41, 59, 0.85), rgba(15, 23, 42, 0.9))"},initial:{opacity:0,scale:.8,x:-20},animate:{opacity:1,scale:1,x:0},exit:{opacity:0,scale:.8,x:-20},transition:{type:"spring",stiffness:300,damping:25,delay:.1},children:[(0,o.jsxs)("div",{className:"flex items-center mb-3",children:[(0,o.jsx)("div",{className:"w-3 h-3 bg-gradient-to-r from-purple-400 to-indigo-500 rounded-full mr-2 shadow-sm"}),(0,o.jsx)("h4",{className:"font-semibold bg-gradient-to-r from-purple-300 to-indigo-300 bg-clip-text text-transparent",children:"Clinical Impression"}),(null===(p=b[e.id])||void 0===p?void 0:p.clinical)&&(0,o.jsx)("div",{className:"ml-auto text-xs font-medium px-2 py-0.5 rounded-full bg-purple-900/50 text-purple-200 shadow-inner border border-purple-700/30",children:"Editing"})]}),null!==(m=b[e.id])&&void 0!==m&&m.clinical?(0,o.jsx)("textarea",{className:"w-full h-24 p-3 border-2 border-purple-700/50 rounded-lg resize-none text-sm focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-600 shadow-inner bg-slate-800/70 backdrop-blur-sm transition-all text-purple-100",value:(null===(x=y[e.id])||void 0===x?void 0:x.clinical)||"",onChange:t=>ae(e.id,"clinical",t.target.value),onBlur:t=>{ie(e.id,"clinical")},placeholder:"Enter clinical impression...",style:{boxShadow:"inset 0 2px 4px 0 rgba(126, 34, 206, 0.2)"}}):(0,o.jsx)("div",{className:"text-sm text-purple-100 min-h-[60px] p-3 border-2 border-transparent hover:border-purple-700/40 rounded-lg cursor-text hover:bg-slate-800/50 transition-all",onClick:t=>{t.stopPropagation(),g(null),f({[e.id]:{patient:!0,clinical:!0}})},style:{backgroundImage:null!==(v=y[e.id])&&void 0!==v&&v.clinical?"linear-gradient(to bottom right, rgba(88, 28, 135, 0.3), rgba(76, 29, 149, 0.15))":"none",boxShadow:null!==(w=y[e.id])&&void 0!==w&&w.clinical?"inset 0 1px 2px 0 rgba(126, 34, 206, 0.15)":"none"},children:(null===(j=y[e.id])||void 0===j?void 0:j.clinical)||(0,o.jsx)("span",{className:"text-purple-300 italic",children:"Click to add clinical impression..."})}),(0,o.jsxs)("div",{className:"absolute",style:{width:180,height:2,left:-180,top:50,zIndex:0,overflow:"hidden"},children:[(0,o.jsx)("div",{className:"h-full w-full bg-gradient-to-r from-purple-300 via-indigo-400 to-purple-500",style:{animation:(null===h||void 0===h?void 0:h.id)===e.id?"shimmerReverse 1.5s linear infinite":"none"}}),(0,o.jsx)("style",{jsx:!0,children:"\n                        @keyframes shimmerReverse {\n                          0% { transform: translateX(100%); }\n                          100% { transform: translateX(-100%); }\n                        }\n                      "})]})]})]})})]},e.id)}),(0,o.jsx)("div",{className:"absolute bottom-4 left-1/2 transform -translate-x-1/2 z-40",children:(0,o.jsxs)(n.P.div,{className:"bg-slate-800 bg-opacity-90 rounded-full px-4 py-2 flex items-center gap-3 shadow-lg border border-slate-600",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:2.5,duration:.5},children:[(0,o.jsxs)("span",{className:"text-sm text-blue-300",children:[m.length," ",1===m.length?"entry":"entries"]}),(0,o.jsx)("div",{className:"w-px h-4 bg-slate-600"}),(0,o.jsxs)("div",{className:"flex items-center gap-2",children:[(0,o.jsx)("div",{className:"w-16 h-1 bg-slate-600 rounded-full overflow-hidden",children:(0,o.jsx)("div",{className:"h-full bg-blue-400 rounded-full transition-all duration-300 ease-out",style:{width:`${A}%`}})}),(0,o.jsxs)("span",{className:"text-xs text-slate-400 min-w-[3rem] text-center",children:[A,"%"]})]}),(0,o.jsx)("div",{className:"w-px h-4 bg-slate-600"}),(0,o.jsx)("span",{className:"text-xs text-slate-400",children:"Click nodes to center"})]})})]})})})]})}},7173:(e,t,a)=>{a.r(t),a.d(t,{default:()=>S});var i=a(5043),s=a(3546),n=a(6446),r=a(2024),o=a(4596),l=a(4537),d=a(2626),c=a(6382),u=a(2382),p=a(8326),m=a(1680),x=a(8487),h=a(6835),g=a(1360),b=a(8693),f=a(4935),y=a(7118),v=a(614),w=a(579);const j={hidden:{opacity:0,scale:.3,y:50,rotate:-5},visible:{opacity:1,scale:1,y:0,rotate:0,transition:{type:"spring",damping:25,stiffness:300,duration:.6}},exit:{opacity:0,scale:.7,y:30,rotate:-3,transition:{type:"easeInOut",duration:.4}}},N={hidden:{opacity:0,backdropFilter:"blur(0px)"},visible:{opacity:1,backdropFilter:"blur(8px)",transition:{duration:.4,ease:"easeOut"}},exit:{opacity:0,backdropFilter:"blur(0px)",transition:{duration:.3,ease:"easeIn"}}},k={hidden:{opacity:0,y:20,scale:.95},visible:{opacity:1,y:0,scale:1,transition:{type:"easeOut",duration:.3,delay:.1}},exit:{opacity:0,y:-10,scale:1.02,transition:{type:"easeIn",duration:.2}}},C={hidden:{opacity:0,y:20,scale:.95},visible:{opacity:1,y:0,scale:1,transition:{duration:.4,ease:"easeOut"}},edit:{scale:1.02,boxShadow:"0 8px 25px rgba(59, 130, 246, 0.15)",transition:{duration:.3,ease:"easeOut"}},saved:{scale:1,boxShadow:"0 4px 15px rgba(34, 197, 94, 0.15)",transition:{duration:.3,ease:"easeOut"}}},S=e=>{var t,a,S,_;let{isOpen:T,data:A,onClose:D,onAnimationStart:z,onAnimationEnd:P,setMindMapData:O,autoSaveMindMapData:$,addToast:E,syncNodeData:I,forceNodeUpdate:M}=e;const[L,X]=(0,i.useState)(!1),[H,F]=(0,i.useState)(!1),[R,B]=(0,i.useState)(!1),[Y,U]=(0,i.useState)({}),[W,G]=(0,i.useState)(!1),[q,V]=(0,i.useState)(!1),[J,K]=(0,i.useState)("overview"),[Z,Q]=(0,i.useState)(!1),[ee,te]=(0,i.useState)({}),[ae,ie]=(0,i.useState)({}),[se,ne]=(0,i.useState)({}),re=(0,i.useRef)({}),[oe,le]=(0,i.useState)(!1),[de,ce]=(0,i.useState)({}),[ue,pe]=(0,i.useState)(""),[me,xe]=(0,i.useState)(!1),he={"Mood Disorders":{primary:"#ef4444",secondary:"#fca5a5"},"Anxiety Disorders":{primary:"#f59e0b",secondary:"#fbbf24"},"Psychotic Disorders":{primary:"#8b5cf6",secondary:"#c4b5fd"},"Personality Disorders":{primary:"#10b981",secondary:"#6ee7b7"},"Neurodevelopmental Disorders":{primary:"#3b82f6",secondary:"#93c5fd"},"Trauma Related Disorders":{primary:"#dc2626",secondary:"#f87171"},"Substance Use Disorders":{primary:"#059669",secondary:"#34d399"},"Eating Disorders":{primary:"#d946ef",secondary:"#e879f9"},"Sleep Disorders":{primary:"#6366f1",secondary:"#a5b4fc"},"Cognitive Disorders":{primary:"#ea580c",secondary:"#fb923c"},Other:{primary:"#6b7280",secondary:"#9ca3af"}},ge=[{id:"overview",label:"Overview",icon:d.A},{id:"concept",label:"Concept",icon:c.A},{id:"clinical",label:"Clinical Associations",icon:f.A},{id:"treatment",label:"Treatment",icon:h.A},{id:"connections",label:"Connections",icon:x.A}];(0,i.useEffect)(()=>{if(T&&A&&!q){F(!0);const e={...A,category:A.category||"Other",definition:A.definition||"",diagnostic_criteria:A.diagnostic_criteria||[],comorbidities:A.comorbidities||[],differential_diagnoses:A.differential_diagnoses||[],medications:A.medications||[],psychotherapy_modalities:A.psychotherapy_modalities||[],flashcard_count:A.flashcard_count||0,completed_flashcards:A.completed_flashcards||0,last_updated:A.last_updated||(new Date).toISOString()};U(e),V(!0),X(!0),z&&z(),setTimeout(()=>{X(!1),P&&P()},600)}else!T&&q&&(V(!1),ne({}),te({}),ie({}))},[T,A,q,z,P]),(0,i.useEffect)(()=>{T&&A&&q&&U(e=>({...e,...A,category:A.category||e.category||"Other",definition:A.definition||e.definition||"",diagnostic_criteria:A.diagnostic_criteria||e.diagnostic_criteria||[],comorbidities:A.comorbidities||e.comorbidities||[],differential_diagnoses:A.differential_diagnoses||e.differential_diagnoses||[],medications:A.medications||e.medications||[],psychotherapy_modalities:A.psychotherapy_modalities||e.psychotherapy_modalities||[],flashcard_count:A.flashcard_count||e.flashcard_count||0,completed_flashcards:A.completed_flashcards||e.completed_flashcards||0,last_updated:A.last_updated||e.last_updated||(new Date).toISOString()}))},[A,T,q]);const be=(0,i.useMemo)(()=>{const e=Y.flashcard_count||0,t=Y.completed_flashcards||0;return e>0?Math.round(t/e*100):0},[Y.flashcard_count,Y.completed_flashcards]),fe=(0,i.useCallback)(()=>{L||R||(X(!0),B(!0),z&&z(),F(!1))},[z,L,R]),ye=((0,i.useCallback)(async()=>{if(!W){G(!0);try{const e={...Y,last_updated:(new Date).toISOString()};O(t=>{const a=t.topics.map(t=>String(t.id)===String(null===A||void 0===A?void 0:A.id)?{...t,...e}:t),i={...t,topics:a};return $(i),i}),U(e),E("Topic updated successfully","success")}catch(e){console.error("Error saving topic:",e),E("Failed to save topic","error")}finally{G(!1)}}},[null===A||void 0===A?void 0:A.id,Y,O,$,E,W]),(0,i.useCallback)(e=>{const t=re.current[e];t&&ne(a=>({...a,[e]:t.scrollTop}))},[])),ve=(0,i.useCallback)(e=>{setTimeout(()=>{const t=re.current[e],a=se[e];t&&a&&(t.scrollTop=a)},100)},[se]),we=(0,i.useCallback)(e=>{e===J||Z||(ye(J),Q(!0),K(e),setTimeout(()=>{Q(!1),ve(e)},300))},[J,Z,ye,ve]),je=(0,i.useCallback)(async e=>{var t;console.log("Category changing to:",e);const a=(null===(t=he[e])||void 0===t?void 0:t.primary)||he.Other.primary;console.log("New color for category:",a);const i={...Y,category:e,color:a,last_updated:(new Date).toISOString()};U(i),O(t=>{const i=t.topics.map(t=>String(t.id)===String(null===A||void 0===A?void 0:A.id)?{...t,category:e,color:a,last_updated:(new Date).toISOString()}:t),s={...t,topics:i};return console.log("Saving category change to backend:",e,a),$(s),setTimeout(()=>{console.log("Triggering force node update"),M&&M(),I&&I()},200),s}),E(`Category updated to ${e}`,"success")},[null===A||void 0===A?void 0:A.id,Y,O,he,$,E,I,M]),Ne=((0,i.useMemo)(()=>(null!==A&&void 0!==A&&A.id,{cases:[],literature:[]}),[null===A||void 0===A?void 0:A.id]),(0,i.useCallback)(async()=>{if(!W&&window.confirm("Are you sure you want to delete this topic?")){G(!0);try{O(e=>{const t=e.topics.filter(e=>String(e.id)!==String(null===A||void 0===A?void 0:A.id)),a={...e,topics:t};return $(a),a}),E("Topic deleted successfully","success"),fe()}catch(e){console.error("Error deleting topic:",e),E("Failed to delete topic","error")}finally{G(!1)}}},[null===A||void 0===A?void 0:A.id,O,$,E,fe,W]),(0,i.useCallback)(e=>{te(t=>({...t,[e]:!0})),ie(t=>({...t,[e]:{...Y}}))},[Y])),ke=(0,i.useCallback)(e=>{te(t=>({...t,[e]:!1})),ie(t=>{const a={...t};return delete a[e],a})},[]),Ce=(0,i.useCallback)(async e=>{if(W)return;const t=ae[e];if(t){G(!0);try{const a={...Y,...t,last_updated:(new Date).toISOString()};U(a),O(e=>{const t=e.topics.map(e=>String(e.id)===String(null===A||void 0===A?void 0:A.id)?{...e,...a}:e),i={...e,topics:t};return $(i),i}),te(t=>({...t,[e]:!1})),ie(t=>{const a={...t};return delete a[e],a}),E("Section updated successfully","success")}catch(a){console.error("Error saving section:",a),E("Failed to save section","error")}finally{G(!1)}}},[ae,Y,null===A||void 0===A?void 0:A.id,O,$,E,W]),Se=(0,i.useCallback)((e,t,a)=>{ie(i=>({...i,[e]:{...i[e],[t]:a}}))},[]),_e=((0,i.useCallback)((e,t,a)=>{var i;if(!a.trim())return;const s=(null===(i=ae[e])||void 0===i?void 0:i[t])||Y[t]||[];s.includes(a.trim())||Se(e,t,[...s,a.trim()])},[ae,Y,Se]),(0,i.useCallback)((e,t,a)=>{var i;const s=(null===(i=ae[e])||void 0===i?void 0:i[t])||Y[t]||[];Se(e,t,s.filter(e=>e!==a))},[ae,Y,Se]),(0,i.useCallback)((e,t)=>{ce(a=>({...a,[e]:t}))},[])),Te=(0,i.useCallback)(e=>de[e]||"",[de]),Ae=(0,i.useCallback)(e=>{ce(t=>{const a={...t};return delete a[e],a})},[]),De=(0,i.useCallback)((e,t)=>{if(!t.trim())return;const a=Y[e]||[];if(!a.includes(t.trim())){const i=[...a,t.trim()],s={...Y,[e]:i,last_updated:(new Date).toISOString()};U(s),O(e=>{const t=e.topics.map(e=>String(e.id)===String(null===A||void 0===A?void 0:A.id)?{...e,...s}:e),a={...e,topics:t};return $(a),a}),E(`${e} updated successfully`,"success")}},[Y,null===A||void 0===A?void 0:A.id,O,$,E]),ze=(0,i.useCallback)((e,t)=>{const a=(Y[e]||[]).filter(e=>e!==t),i={...Y,[e]:a,last_updated:(new Date).toISOString()};U(i),O(e=>{const t=e.topics.map(e=>String(e.id)===String(null===A||void 0===A?void 0:A.id)?{...e,...i}:e),a={...e,topics:t};return $(a),a}),E(`${e} updated successfully`,"success")},[Y,null===A||void 0===A?void 0:A.id,O,$,E]);return T?(0,w.jsx)(s.N,{mode:"wait",onExitComplete:()=>{X(!1),B(!1),V(!1),D(),P&&P()},children:H&&(0,w.jsx)(n.P.div,{initial:"hidden",animate:"visible",exit:"exit",variants:N,className:"fixed inset-0 bg-black flex items-center justify-center z-50",style:{willChange:"backdrop-filter, opacity",backfaceVisibility:"hidden",transform:"translate3d(0, 0, 0)"},onClick:e=>e.target===e.currentTarget&&fe(),children:(0,w.jsxs)(n.P.div,{initial:"hidden",animate:"visible",exit:"exit",variants:j,className:"bg-white rounded-2xl shadow-2xl max-w-4xl w-full mx-4 max-h-[85vh] overflow-hidden",style:{willChange:"transform, opacity, scale",backfaceVisibility:"hidden"},onClick:e=>e.stopPropagation(),onAnimationStart:()=>{X(!0),z&&z()},onAnimationComplete:()=>{X(!1),P&&P()},children:[(0,w.jsxs)(n.P.div,{initial:"hidden",animate:"visible",exit:"exit",variants:k,className:"bg-gradient-to-br from-slate-900 to-slate-800 text-white px-6 py-4 flex items-center justify-between",children:[(0,w.jsxs)("div",{className:"flex items-center gap-3",children:[(0,w.jsx)(d.A,{size:24}),(0,w.jsx)("h2",{className:"text-xl font-semibold",children:"Topic Details"})]}),(0,w.jsx)("button",{onClick:fe,className:"text-slate-400 hover:text-white transition-colors",children:(0,w.jsx)(v.A,{size:24})})]}),(0,w.jsx)("div",{className:"bg-gradient-to-r from-slate-900 via-slate-800 to-slate-900 border-b border-slate-600",children:(0,w.jsx)("nav",{className:"flex flex-wrap gap-2 px-6 py-4",children:ge.map(e=>{let{id:t,label:a,icon:i}=e;return(0,w.jsxs)(n.P.button,{onClick:()=>we(t),className:"relative flex items-center gap-2 px-4 py-3 rounded-xl font-medium text-sm transition-all duration-300 "+(J===t?"bg-gradient-to-r from-purple-500 to-indigo-600 text-white shadow-lg shadow-purple-500/25":"text-slate-300 hover:text-white hover:bg-slate-700/50 hover:shadow-md"),whileHover:{scale:J===t?1:1.02},whileTap:{scale:.98},disabled:Z,children:[(0,w.jsx)(i,{size:16,className:J===t?"drop-shadow-sm":""}),a,J===t&&(0,w.jsx)(n.P.div,{layoutId:"topicActiveTab",className:"absolute inset-0 bg-gradient-to-r from-purple-400/20 to-indigo-500/20 rounded-xl blur-sm",initial:!1,transition:{duration:.3,ease:"easeOut"}})]},t)})})}),(0,w.jsx)(n.P.div,{className:"flex-1 bg-gradient-to-br from-slate-900 to-slate-800 overflow-hidden",animate:{opacity:Z?.7:1},transition:{duration:.2},children:(0,w.jsxs)(s.N,{mode:"wait",children:["overview"===J&&(0,w.jsxs)(n.P.div,{ref:e=>re.current.overview=e,initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{duration:.3},className:"h-full overflow-y-auto p-6 space-y-6",children:[(0,w.jsxs)(n.P.div,{variants:C,animate:ee.title?"edit":"visible",className:"bg-slate-800/50 backdrop-blur-sm rounded-xl p-6 border border-slate-700",children:[(0,w.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,w.jsx)("h3",{className:"text-lg font-semibold text-white",children:"Title"}),!ee.title&&(0,w.jsx)(n.P.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:()=>Ne("title"),className:"text-slate-400 hover:text-white transition-colors p-1 rounded",title:"Edit title",children:(0,w.jsx)(o.A,{size:16})})]}),ee.title?(0,w.jsxs)(n.P.div,{className:"space-y-4",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},children:[(0,w.jsx)("input",{type:"text",value:(null===(t=ae.title)||void 0===t?void 0:t.title)||Y.title||"",onChange:e=>Se("title","title",e.target.value),className:"w-full text-xl font-bold bg-slate-700 border border-slate-600 rounded-lg px-4 py-3 text-white placeholder-slate-400 focus:ring-2 focus:ring-purple-500 focus:border-purple-500",placeholder:"Topic title..."}),(0,w.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,w.jsx)(n.P.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>ke("title"),className:"px-3 py-2 text-slate-300 hover:text-white border border-slate-600 rounded-lg hover:bg-slate-700 transition-colors text-sm",children:"Cancel"}),(0,w.jsxs)(n.P.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>Ce("title"),disabled:W,className:"px-3 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors text-sm flex items-center gap-2",children:[W?(0,w.jsx)(r.A,{size:14,className:"animate-spin"}):(0,w.jsx)(b.A,{size:14}),"Save"]})]})]}):(0,w.jsx)(n.P.h1,{className:"text-2xl font-bold text-white",whileHover:{scale:1.01},transition:{duration:.2},children:Y.title||"Untitled Topic"})]}),(0,w.jsxs)("div",{className:"grid md:grid-cols-2 gap-6",children:[(0,w.jsxs)(n.P.div,{variants:C,initial:"hidden",animate:"visible",className:"bg-slate-800/50 backdrop-blur-sm rounded-xl p-6 border border-slate-700",children:[(0,w.jsx)("label",{className:"block text-sm font-medium text-slate-300 mb-3",children:"Category"}),(0,w.jsx)(n.P.select,{value:Y.category||"Other",onChange:e=>je(e.target.value),className:"w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-3 text-white focus:ring-2 focus:ring-purple-500 focus:border-purple-500 hover:bg-slate-650 transition-colors cursor-pointer",whileFocus:{scale:1.02},children:Object.keys(he).map(e=>(0,w.jsx)("option",{value:e,children:e},e))}),(0,w.jsx)("p",{className:"text-xs text-slate-400 mt-2",children:"Changes are saved automatically and will update the node color"})]}),(0,w.jsxs)(n.P.div,{variants:C,initial:"hidden",animate:"visible",className:"bg-slate-800/50 backdrop-blur-sm rounded-xl p-6 border border-slate-700",children:[(0,w.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,w.jsx)("span",{className:"text-sm font-medium text-slate-300",children:"Flashcard Progress"}),(0,w.jsxs)("span",{className:"text-sm text-slate-400",children:[Y.completed_flashcards||0," / ",Y.flashcard_count||0]})]}),(0,w.jsx)("div",{className:"w-full bg-slate-700 rounded-full h-3 mb-2",children:(0,w.jsx)(n.P.div,{className:"h-3 rounded-full bg-gradient-to-r from-purple-500 to-indigo-600",initial:{width:0},animate:{width:`${be}%`},transition:{duration:1,ease:"easeOut"}})}),(0,w.jsxs)("div",{className:"text-right",children:[(0,w.jsxs)("span",{className:"text-lg font-bold text-white",children:[be,"%"]}),(0,w.jsx)("span",{className:"text-sm text-slate-400 ml-1",children:"complete"})]})]})]}),(0,w.jsxs)("div",{className:"text-xs text-slate-500 text-right",children:["Last updated: ",Y.last_updated?new Date(Y.last_updated).toLocaleString():"Never"]})]},"overview"),"concept"===J&&(0,w.jsxs)(n.P.div,{ref:e=>re.current.concept=e,initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{duration:.3},className:"h-full overflow-y-auto p-6 space-y-6",children:[(0,w.jsxs)(n.P.div,{variants:C,animate:ee.definition?"edit":"visible",className:"bg-slate-800/50 backdrop-blur-sm rounded-xl p-6 border border-slate-700",children:[(0,w.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,w.jsxs)("h3",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[(0,w.jsx)(c.A,{size:20,className:"text-purple-400"}),"Definition"]}),!ee.definition&&(0,w.jsx)(n.P.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:()=>Ne("definition"),className:"text-slate-400 hover:text-white transition-colors p-1 rounded",title:"Edit definition",children:(0,w.jsx)(o.A,{size:16})})]}),ee.definition?(0,w.jsxs)(n.P.div,{className:"space-y-4",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},children:[(0,w.jsx)("textarea",{value:(null===(a=ae.definition)||void 0===a?void 0:a.definition)||Y.definition||"",onChange:e=>Se("definition","definition",e.target.value),rows:4,className:"w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-3 text-white placeholder-slate-400 focus:ring-2 focus:ring-purple-500 focus:border-purple-500 resize-none",placeholder:"Enter the definition of this topic..."}),(0,w.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,w.jsx)(n.P.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>ke("definition"),className:"px-3 py-2 text-slate-300 hover:text-white border border-slate-600 rounded-lg hover:bg-slate-700 transition-colors text-sm",children:"Cancel"}),(0,w.jsxs)(n.P.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>Ce("definition"),disabled:W,className:"px-3 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors text-sm flex items-center gap-2",children:[W?(0,w.jsx)(r.A,{size:14,className:"animate-spin"}):(0,w.jsx)(b.A,{size:14}),"Save"]})]})]}):(0,w.jsx)(n.P.div,{className:"text-slate-300 leading-relaxed",whileHover:{scale:1.01},transition:{duration:.2},children:Y.definition||(0,w.jsx)("span",{className:"text-slate-500 italic",children:"No definition provided"})})]}),(0,w.jsxs)(n.P.div,{variants:C,animate:ee.diagnostic_criteria?"edit":"visible",className:"bg-slate-800/50 backdrop-blur-sm rounded-xl p-6 border border-slate-700",children:[(0,w.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,w.jsxs)("h3",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[(0,w.jsx)(m.A,{size:20,className:"text-indigo-400"}),"Diagnostic Criteria"]}),(0,w.jsxs)("div",{className:"flex items-center gap-2",children:[!ee.diagnostic_criteria&&(0,w.jsx)(n.P.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:()=>Ne("diagnostic_criteria"),className:"text-slate-400 hover:text-white transition-colors p-1 rounded",title:"Edit diagnostic criteria",children:(0,w.jsx)(o.A,{size:16})}),(0,w.jsx)("button",{onClick:()=>le(!oe),className:"text-slate-400 hover:text-white transition-colors",children:oe?(0,w.jsx)(u.A,{size:20}):(0,w.jsx)(p.A,{size:20})})]})]}),(0,w.jsx)(s.N,{children:oe&&(0,w.jsx)(n.P.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3},className:"overflow-hidden",children:ee.diagnostic_criteria?(0,w.jsxs)("div",{className:"space-y-4",children:[(0,w.jsx)("textarea",{value:Array.isArray(null===(S=ae.diagnostic_criteria)||void 0===S?void 0:S.diagnostic_criteria)?ae.diagnostic_criteria.diagnostic_criteria.join("\n"):Array.isArray(Y.diagnostic_criteria)?Y.diagnostic_criteria.join("\n"):Y.diagnostic_criteria||"",onChange:e=>Se("diagnostic_criteria","diagnostic_criteria",e.target.value.split("\n").filter(e=>e.trim())),rows:6,className:"w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-3 text-white placeholder-slate-400 focus:ring-2 focus:ring-purple-500 focus:border-purple-500 resize-none",placeholder:"Enter diagnostic criteria (one per line)..."}),(0,w.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,w.jsx)("button",{onClick:()=>ke("diagnostic_criteria"),className:"px-3 py-2 text-slate-300 hover:text-white border border-slate-600 rounded-lg hover:bg-slate-700 transition-colors text-sm",children:"Cancel"}),(0,w.jsxs)(n.P.button,{onClick:()=>Ce("diagnostic_criteria"),disabled:W,className:"px-3 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors text-sm flex items-center gap-2",children:[W?(0,w.jsx)(r.A,{size:14,className:"animate-spin"}):(0,w.jsx)(b.A,{size:14}),"Save"]})]})]}):(0,w.jsx)("div",{className:"space-y-2",children:(Y.diagnostic_criteria||[]).length>0?Y.diagnostic_criteria.map((e,t)=>(0,w.jsxs)("div",{className:"flex items-start gap-3",children:[(0,w.jsxs)("span",{className:"text-purple-400 font-medium",children:[t+1,"."]}),(0,w.jsx)("span",{className:"text-slate-300",children:e})]},t)):(0,w.jsx)("span",{className:"text-slate-500 italic",children:"No diagnostic criteria provided"})})})})]})]},"concept"),"clinical"===J&&(0,w.jsxs)(n.P.div,{ref:e=>re.current.clinical=e,initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{duration:.3},className:"h-full overflow-y-auto p-6 space-y-6",children:[(0,w.jsxs)(n.P.div,{variants:C,initial:"hidden",animate:"visible",className:"bg-slate-800/50 backdrop-blur-sm rounded-xl p-6 border border-slate-700",children:[(0,w.jsxs)("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[(0,w.jsx)(y.A,{size:20,className:"text-amber-400"}),"Comorbidities"]}),(0,w.jsx)("div",{className:"space-y-2 mb-4",children:(0,w.jsx)(s.N,{children:(Y.comorbidities||[]).map((e,t)=>(0,w.jsxs)(n.P.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},className:"flex items-center justify-between p-3 bg-amber-600/10 rounded-lg border border-amber-600/20 group hover:bg-amber-600/15 transition-colors",children:[(0,w.jsx)("span",{className:"text-amber-300",children:e}),(0,w.jsx)(n.P.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:()=>ze("comorbidities",e),className:"text-amber-400 hover:text-amber-200 opacity-0 group-hover:opacity-100 transition-opacity p-1 rounded",title:"Remove comorbidity",children:(0,w.jsx)(v.A,{size:16})})]},t))})}),(0,w.jsxs)("div",{className:"flex gap-2",children:[(0,w.jsx)("input",{type:"text",value:Te("comorbidities"),onChange:e=>_e("comorbidities",e.target.value),placeholder:"Add comorbidity...",className:"flex-1 bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-white placeholder-slate-400 focus:ring-2 focus:ring-amber-500 focus:border-amber-500 transition-colors",onKeyPress:e=>{"Enter"===e.key&&Te("comorbidities").trim()&&(De("comorbidities",Te("comorbidities")),Ae("comorbidities"))}}),(0,w.jsxs)(n.P.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>{Te("comorbidities").trim()&&(De("comorbidities",Te("comorbidities")),Ae("comorbidities"))},className:"px-4 py-2 bg-amber-600 text-white rounded-lg hover:bg-amber-700 transition-colors flex items-center gap-2",children:[(0,w.jsx)(g.A,{size:16}),"Add"]})]}),0===(Y.comorbidities||[]).length&&(0,w.jsx)("p",{className:"text-slate-500 italic text-center py-4",children:"No comorbidities added yet"})]}),(0,w.jsxs)(n.P.div,{variants:C,initial:"hidden",animate:"visible",className:"bg-slate-800/50 backdrop-blur-sm rounded-xl p-6 border border-slate-700",children:[(0,w.jsxs)("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[(0,w.jsx)(l.A,{size:20,className:"text-cyan-400"}),"Differential Diagnoses"]}),(0,w.jsx)("div",{className:"space-y-2 mb-4",children:(0,w.jsx)(s.N,{children:(Y.differential_diagnoses||[]).map((e,t)=>(0,w.jsxs)(n.P.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},className:"flex items-center justify-between p-3 bg-cyan-600/10 rounded-lg border border-cyan-600/20 group hover:bg-cyan-600/15 transition-colors",children:[(0,w.jsx)("span",{className:"text-cyan-300",children:e}),(0,w.jsx)(n.P.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:()=>ze("differential_diagnoses",e),className:"text-cyan-400 hover:text-cyan-200 opacity-0 group-hover:opacity-100 transition-opacity p-1 rounded",title:"Remove differential diagnosis",children:(0,w.jsx)(v.A,{size:16})})]},t))})}),(0,w.jsxs)("div",{className:"flex gap-2",children:[(0,w.jsx)("input",{type:"text",value:Te("differential_diagnoses"),onChange:e=>_e("differential_diagnoses",e.target.value),placeholder:"Add differential diagnosis...",className:"flex-1 bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-white placeholder-slate-400 focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500 transition-colors",onKeyPress:e=>{"Enter"===e.key&&Te("differential_diagnoses").trim()&&(De("differential_diagnoses",Te("differential_diagnoses")),Ae("differential_diagnoses"))}}),(0,w.jsxs)(n.P.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>{Te("differential_diagnoses").trim()&&(De("differential_diagnoses",Te("differential_diagnoses")),Ae("differential_diagnoses"))},className:"px-4 py-2 bg-cyan-600 text-white rounded-lg hover:bg-cyan-700 transition-colors flex items-center gap-2",children:[(0,w.jsx)(g.A,{size:16}),"Add"]})]}),0===(Y.differential_diagnoses||[]).length&&(0,w.jsx)("p",{className:"text-slate-500 italic text-center py-4",children:"No differential diagnoses added yet"})]})]},"clinical"),"treatment"===J&&(0,w.jsxs)(n.P.div,{ref:e=>re.current.treatment=e,initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{duration:.3},className:"h-full overflow-y-auto p-6 space-y-6",children:[(0,w.jsxs)(n.P.div,{variants:C,initial:"hidden",animate:"visible",className:"bg-slate-800/50 backdrop-blur-sm rounded-xl p-6 border border-slate-700",children:[(0,w.jsxs)("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[(0,w.jsx)(h.A,{size:20,className:"text-green-400"}),"Medications"]}),(0,w.jsx)("div",{className:"space-y-2 mb-4",children:(0,w.jsx)(s.N,{children:(Y.medications||[]).map((e,t)=>(0,w.jsxs)(n.P.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},className:"flex items-center justify-between p-3 bg-green-600/10 rounded-lg border border-green-600/20 group hover:bg-green-600/15 transition-colors",children:[(0,w.jsx)("span",{className:"text-green-300",children:e}),(0,w.jsx)(n.P.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:()=>ze("medications",e),className:"text-green-400 hover:text-green-200 opacity-0 group-hover:opacity-100 transition-opacity p-1 rounded",title:"Remove medication",children:(0,w.jsx)(v.A,{size:16})})]},t))})}),(0,w.jsxs)("div",{className:"flex gap-2",children:[(0,w.jsx)("input",{type:"text",value:Te("medications"),onChange:e=>_e("medications",e.target.value),placeholder:"Add medication...",className:"flex-1 bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-white placeholder-slate-400 focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-colors",onKeyPress:e=>{"Enter"===e.key&&Te("medications").trim()&&(De("medications",Te("medications")),Ae("medications"))}}),(0,w.jsxs)(n.P.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>{Te("medications").trim()&&(De("medications",Te("medications")),Ae("medications"))},className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center gap-2",children:[(0,w.jsx)(g.A,{size:16}),"Add"]})]}),0===(Y.medications||[]).length&&(0,w.jsx)("p",{className:"text-slate-500 italic text-center py-4",children:"No medications added yet"})]}),(0,w.jsxs)(n.P.div,{variants:C,animate:ee.psychotherapy_modalities?"edit":"visible",className:"bg-slate-800/50 backdrop-blur-sm rounded-xl p-6 border border-slate-700",children:[(0,w.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,w.jsxs)("h3",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[(0,w.jsx)(c.A,{size:20,className:"text-purple-400"}),"Psychotherapy Modalities"]}),!ee.psychotherapy_modalities&&(0,w.jsx)(n.P.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:()=>Ne("psychotherapy_modalities"),className:"text-slate-400 hover:text-white transition-colors p-1 rounded",title:"Edit psychotherapy modalities",children:(0,w.jsx)(o.A,{size:16})})]}),ee.psychotherapy_modalities?(0,w.jsxs)("div",{className:"space-y-4",children:[(0,w.jsx)("textarea",{value:Array.isArray(null===(_=ae.psychotherapy_modalities)||void 0===_?void 0:_.psychotherapy_modalities)?ae.psychotherapy_modalities.psychotherapy_modalities.join("\n"):Array.isArray(Y.psychotherapy_modalities)?Y.psychotherapy_modalities.join("\n"):Y.psychotherapy_modalities||"",onChange:e=>Se("psychotherapy_modalities","psychotherapy_modalities",e.target.value.split("\n").filter(e=>e.trim())),rows:4,className:"w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-3 text-white placeholder-slate-400 focus:ring-2 focus:ring-purple-500 focus:border-purple-500 resize-none",placeholder:"Enter psychotherapy modalities (one per line)..."}),(0,w.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,w.jsx)("button",{onClick:()=>ke("psychotherapy_modalities"),className:"px-3 py-2 text-slate-300 hover:text-white border border-slate-600 rounded-lg hover:bg-slate-700 transition-colors text-sm",children:"Cancel"}),(0,w.jsxs)(n.P.button,{onClick:()=>Ce("psychotherapy_modalities"),disabled:W,className:"px-3 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors text-sm flex items-center gap-2",children:[W?(0,w.jsx)(r.A,{size:14,className:"animate-spin"}):(0,w.jsx)(b.A,{size:14}),"Save"]})]})]}):(0,w.jsx)("div",{className:"space-y-2",children:(Y.psychotherapy_modalities||[]).length>0?Y.psychotherapy_modalities.map((e,t)=>(0,w.jsxs)("div",{className:"flex items-center gap-3",children:[(0,w.jsx)("span",{className:"text-purple-400 font-medium",children:"\u2022"}),(0,w.jsx)("span",{className:"text-slate-300",children:e})]},t)):(0,w.jsx)("span",{className:"text-slate-500 italic",children:"No psychotherapy modalities added"})})]})]},"treatment"),"connections"===J&&(0,w.jsx)(n.P.div,{ref:e=>re.current.connections=e,initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{duration:.3},className:"h-full overflow-y-auto p-6 space-y-6",children:(0,w.jsxs)(n.P.div,{variants:C,initial:"hidden",animate:"visible",className:"bg-slate-800/50 backdrop-blur-sm rounded-xl p-6 border border-slate-700",children:[(0,w.jsxs)("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[(0,w.jsx)(x.A,{size:20,className:"text-blue-400"}),"Connected Nodes"]}),(0,w.jsx)("p",{className:"text-slate-400 text-center py-8",children:"This section will show nodes connected to this topic in the mind map."})]})},"connections")]})})]})},`topic-modal-${(null===A||void 0===A?void 0:A.id)||"default"}`)}):null}},8531:(e,t,a)=>{a.r(t),a.d(t,{default:()=>_});var i=a(5043),s=a(3546),n=a(6446),r=a(2024),o=a(4596),l=a(9917),d=a(7719),c=a(8646),u=a(5088),p=a(1680),m=a(1482),x=a(8487),h=a(9340),g=a(4830),b=a(8693),f=a(3165),y=a(9855),v=a(4919),w=a(614),j=a(579);const N={hidden:{opacity:0,scale:.3,y:50,rotate:-5},visible:{opacity:1,scale:1,y:0,rotate:0,transition:{type:"spring",damping:25,stiffness:300,duration:.6}},exit:{opacity:0,scale:.7,y:30,rotate:-3,transition:{type:"easeInOut",duration:.4}}},k={hidden:{opacity:0,backdropFilter:"blur(0px)"},visible:{opacity:1,backdropFilter:"blur(8px)",transition:{duration:.4,ease:"easeOut"}},exit:{opacity:0,backdropFilter:"blur(0px)",transition:{duration:.3,ease:"easeIn"}}},C={hidden:{opacity:0,y:20,scale:.95},visible:{opacity:1,y:0,scale:1,transition:{type:"easeOut",duration:.3,delay:.1}},exit:{opacity:0,y:-10,scale:1.02,transition:{type:"easeIn",duration:.2}}},S=e=>{var t;let{isOpen:a,data:S,onClose:_,onAnimationStart:T,onAnimationEnd:A,setMindMapData:D,autoSaveMindMapData:z,addToast:P}=e;const[O,$]=(0,i.useState)(!1),[E,I]=(0,i.useState)(!1),[M,L]=(0,i.useState)(!1),[X,H]=(0,i.useState)(!1),[F,R]=(0,i.useState)({}),[B,Y]=(0,i.useState)(!1),[U,W]=(0,i.useState)(!1),[G,q]=(0,i.useState)("overview"),[V,J]=(0,i.useState)(!1);(0,i.useEffect)(()=>{a&&S&&!U?(I(!0),R({...S,status:S.status||"pending",priority:S.priority||"medium"}),W(!0),$(!0),T&&T(),setTimeout(()=>{$(!1),A&&A()},600)):!a&&U&&W(!1)},[a,U,T,A]),(0,i.useEffect)(()=>{!(a&&S&&U)||X||B||V||O||R({...S,status:S.status||"pending",priority:S.priority||"medium"})},[null===S||void 0===S?void 0:S.id,a,U,X,B,V,O]);const K=(0,i.useMemo)(()=>({low:{color:"green",label:"Low Priority",icon:m.A},medium:{color:"yellow",label:"Medium Priority",icon:m.A},high:{color:"red",label:"High Priority",icon:m.A},urgent:{color:"purple",label:"Urgent",icon:d.A}}),[]),Z=(0,i.useMemo)(()=>({pending:{color:"gray",label:"Pending",icon:u.A},in_progress:{color:"blue",label:"In Progress",icon:g.A},completed:{color:"green",label:"Completed",icon:l.A},paused:{color:"orange",label:"Paused",icon:h.A}}),[]),Q=(0,i.useMemo)(()=>{if(!F.due_date)return!1;return new Date(F.due_date)<new Date&&"completed"!==F.status},[F.due_date,F.status]),ee=(0,i.useCallback)(()=>{O||M||($(!0),L(!0),T&&T(),I(!1))},[T,O,M]),te=(0,i.useCallback)(async()=>{if(!B){Y(!0);try{D(e=>{const t=e.tasks.map(e=>String(e.id)===String(null===S||void 0===S?void 0:S.id)?{...e,...F}:e),a={...e,tasks:t};return z(a),a}),H(!1),P("Task updated successfully","success")}catch(e){console.error("Error saving task:",e),P("Failed to save task","error")}finally{Y(!1)}}},[null===S||void 0===S?void 0:S.id,F,D,z,P,B]),ae=(0,i.useCallback)(async()=>{if(!B&&window.confirm("Are you sure you want to delete this task?")){Y(!0);try{D(e=>{const t=e.tasks.filter(e=>String(e.id)!==String(null===S||void 0===S?void 0:S.id)),a={...e,tasks:t};return z(a),a}),P("Task deleted successfully","success"),ee()}catch(e){console.error("Error deleting task:",e),P("Failed to delete task","error")}finally{Y(!1)}}},[null===S||void 0===S?void 0:S.id,D,z,P,ee,B]),ie=(0,i.useCallback)(e=>{R(t=>({...t,status:e}))},[]),se=(0,i.useCallback)((e,t)=>{R(a=>({...a,[e]:t}))},[]),ne=function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"text",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const s=F[t]||"";return X?"textarea"===a?(0,j.jsxs)("div",{className:"space-y-2",children:[(0,j.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:e}),(0,j.jsx)("textarea",{value:s,onChange:e=>se(t,e.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors",rows:i.rows||3,placeholder:`Enter ${e.toLowerCase()}...`})]}):"select"===a&&i.choices?(0,j.jsxs)("div",{className:"space-y-2",children:[(0,j.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:e}),(0,j.jsxs)("select",{value:s,onChange:e=>se(t,e.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors",children:[(0,j.jsxs)("option",{value:"",children:["Select ",e.toLowerCase(),"..."]}),i.choices.map(e=>(0,j.jsx)("option",{value:e.value,children:e.label},e.value))]})]}):"date"===a?(0,j.jsxs)("div",{className:"space-y-2",children:[(0,j.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:e}),(0,j.jsx)("input",{type:"date",value:s,onChange:e=>se(t,e.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors"})]}):(0,j.jsxs)("div",{className:"space-y-2",children:[(0,j.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:e}),(0,j.jsx)("input",{type:a,value:s,onChange:e=>se(t,"number"===a?Number(e.target.value):e.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors",placeholder:`Enter ${e.toLowerCase()}...`})]}):"textarea"===a?(0,j.jsxs)("div",{className:"space-y-2",children:[(0,j.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:e}),(0,j.jsx)("div",{className:"p-3 bg-gray-50 rounded-lg border min-h-[2.5rem] text-gray-800",children:s||(0,j.jsx)("span",{className:"text-gray-400 italic",children:"Not specified"})})]}):"select"===a?(0,j.jsxs)("div",{className:"space-y-2",children:[(0,j.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:e}),(0,j.jsx)("div",{className:"p-3 bg-gray-50 rounded-lg border text-gray-800",children:s||(0,j.jsx)("span",{className:"text-gray-400 italic",children:"Not specified"})})]}):"date"===a?(0,j.jsxs)("div",{className:"space-y-2",children:[(0,j.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:e}),(0,j.jsx)("div",{className:"p-3 bg-gray-50 rounded-lg border text-gray-800",children:s?new Date(s).toLocaleDateString():(0,j.jsx)("span",{className:"text-gray-400 italic",children:"Not set"})})]}):(0,j.jsxs)("div",{className:"space-y-2",children:[(0,j.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:e}),(0,j.jsx)("div",{className:"p-3 bg-gray-50 rounded-lg border text-gray-800",children:s||(0,j.jsx)("span",{className:"text-gray-400 italic",children:"Not specified"})})]})};return a?(0,j.jsx)(s.N,{mode:"wait",onExitComplete:()=>{$(!1),L(!1),W(!1),_(),A&&A()},children:E&&(0,j.jsx)(n.P.div,{initial:"hidden",animate:"visible",exit:"exit",variants:k,className:"fixed inset-0 bg-black flex items-center justify-center z-50",style:{willChange:"backdrop-filter, opacity",backfaceVisibility:"hidden",transform:"translate3d(0, 0, 0)"},onClick:e=>e.target===e.currentTarget&&ee(),children:(0,j.jsxs)(n.P.div,{initial:"hidden",animate:"visible",exit:"exit",variants:N,className:"bg-white rounded-2xl shadow-2xl max-w-4xl w-full mx-4 max-h-[85vh] overflow-hidden",style:{willChange:"transform, opacity, scale",backfaceVisibility:"hidden"},onClick:e=>e.stopPropagation(),onAnimationStart:()=>{$(!0),T&&T()},onAnimationComplete:()=>{$(!1),A&&A()},children:[(0,j.jsxs)(n.P.div,{initial:"hidden",animate:"visible",exit:"exit",variants:C,className:"bg-gradient-to-br from-slate-900 to-slate-800 text-white px-6 py-4 flex items-center justify-between",children:[(0,j.jsxs)("div",{className:"flex items-center gap-3",children:[(0,j.jsx)(l.A,{size:24}),(0,j.jsx)("h2",{className:"text-xl font-semibold",children:"Task Details"}),Q&&(0,j.jsxs)(n.P.div,{animate:{scale:[1,1.1,1]},transition:{duration:1,repeat:1/0},className:"flex items-center gap-1 px-2 py-1 bg-red-500 rounded-full text-xs font-medium",children:[(0,j.jsx)(d.A,{size:12}),"Overdue"]})]}),(0,j.jsxs)("div",{className:"flex items-center gap-2",children:[!X&&!B&&(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)("button",{onClick:()=>H(!0),className:"text-white hover:text-gray-200 p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-all",title:"Edit",children:(0,j.jsx)(o.A,{size:20})}),(0,j.jsx)("button",{onClick:ae,className:"text-white hover:text-red-200 p-2 rounded-full hover:bg-red-500 hover:bg-opacity-30 transition-all",title:"Delete",children:(0,j.jsx)(y.A,{size:20})})]}),(0,j.jsx)("button",{onClick:ee,className:"text-white hover:text-gray-200 p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-all",children:(0,j.jsx)(w.A,{size:20})})]})]}),(0,j.jsx)("div",{className:"bg-gradient-to-r from-slate-900 via-slate-800 to-slate-900 border-b border-slate-600",children:(0,j.jsx)("nav",{className:"flex flex-wrap gap-2 px-6 py-4",children:[{key:"overview",label:"Overview",icon:l.A},{key:"progress",label:"Progress",icon:v.A},{key:"connections",label:"Connections",icon:x.A},{key:"details",label:"Details",icon:p.A}].map(e=>{let{key:t,label:a,icon:i}=e;return(0,j.jsxs)(n.P.button,{onClick:()=>{V||(J(!0),q(t),setTimeout(()=>J(!1),300))},className:"relative flex items-center gap-2 px-4 py-3 rounded-xl font-medium text-sm transition-all duration-300 "+(G===t?"bg-gradient-to-r from-emerald-500 to-teal-600 text-white shadow-lg shadow-emerald-500/25":"text-slate-300 hover:text-white hover:bg-slate-700/50 hover:shadow-md"),whileHover:{scale:G===t?1:1.02},whileTap:{scale:.98},initial:!1,animate:{scale:G===t?1.05:1,boxShadow:G===t?"0 8px 25px rgba(16, 185, 129, 0.3), 0 0 20px rgba(20, 184, 166, 0.2)":"0 2px 8px rgba(0, 0, 0, 0.1)"},transition:{duration:.3,ease:"easeOut"},children:[(0,j.jsx)(i,{size:16,className:G===t?"drop-shadow-sm":""}),a,G===t&&(0,j.jsx)(n.P.div,{layoutId:"taskTabGlow",className:"absolute inset-0 bg-gradient-to-r from-emerald-400/20 to-teal-500/20 rounded-xl blur-sm",initial:!1,transition:{type:"spring",bounce:.2,duration:.6}})]},t)})})}),(0,j.jsx)(n.P.div,{className:"relative overflow-hidden bg-gradient-to-br from-slate-50 to-slate-100",layout:"position",layoutRoot:!0,transition:{layout:{duration:.4,ease:"easeInOut"},height:{duration:.4,ease:"easeInOut"}},children:(0,j.jsxs)(s.N,{mode:"wait",initial:!1,onExitComplete:()=>J(!1),children:["overview"===G&&(0,j.jsx)(n.P.div,{initial:{opacity:0,x:-30},animate:{opacity:1,x:0},exit:{opacity:0,x:30},transition:{duration:.4,ease:"easeOut"},layout:"position",layoutId:"tabContent",className:"p-6 overflow-y-auto max-h-[calc(85vh-200px)] scrollbar-thin scrollbar-thumb-slate-400 scrollbar-track-slate-200",children:(0,j.jsxs)("div",{className:"space-y-6",children:[(0,j.jsxs)("div",{className:"bg-white rounded-xl p-6 shadow-lg border border-slate-200",children:[(0,j.jsxs)("h3",{className:"text-lg font-semibold text-slate-800 mb-4 flex items-center gap-2",children:[(0,j.jsx)(f.A,{size:20,className:"text-emerald-600"}),"Task Information"]}),(0,j.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[ne("Title","title"),ne("Priority","priority","select",{choices:[{value:"low",label:"Low Priority"},{value:"medium",label:"Medium Priority"},{value:"high",label:"High Priority"},{value:"urgent",label:"Urgent"}]})]}),(0,j.jsx)("div",{className:"mt-6",children:ne("Description","description","textarea",{rows:4})})]}),(0,j.jsxs)("div",{className:"bg-white rounded-xl p-6 shadow-lg border border-slate-200",children:[(0,j.jsxs)("h3",{className:"text-lg font-semibold text-slate-800 mb-4 flex items-center gap-2",children:[(0,j.jsx)(u.A,{size:20,className:"text-blue-600"}),"Status & Timeline"]}),(0,j.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[ne("Status","status","select",{choices:[{value:"pending",label:"Pending"},{value:"in_progress",label:"In Progress"},{value:"completed",label:"Completed"},{value:"paused",label:"Paused"}]}),ne("Due Date","due_date","date")]}),(0,j.jsxs)("div",{className:"mt-6",children:[(0,j.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Quick Status Update"}),(0,j.jsx)("div",{className:"flex flex-wrap gap-3",children:Object.entries(Z).map(e=>{let[t,a]=e;const i=a.icon,s=F.status===t;return(0,j.jsxs)(n.P.button,{onClick:()=>ie(t),disabled:!X,whileHover:X?{scale:1.05}:{},whileTap:X?{scale:.95}:{},className:"flex items-center gap-2 px-4 py-2 rounded-lg font-medium text-sm transition-all "+(s?`bg-${a.color}-100 text-${a.color}-800 border-2 border-${a.color}-300`:"bg-gray-100 text-gray-600 border-2 border-gray-200 "+(X?"hover:bg-gray-200":"cursor-not-allowed opacity-50")),children:[(0,j.jsx)(i,{size:16}),a.label]},t)})})]})]})]})},"overview"),"progress"===G&&(0,j.jsx)(n.P.div,{initial:{opacity:0,x:-30},animate:{opacity:1,x:0},exit:{opacity:0,x:30},transition:{duration:.4,ease:"easeOut"},layout:"position",layoutId:"tabContent",className:"p-6 overflow-y-auto max-h-[calc(85vh-200px)] scrollbar-thin scrollbar-thumb-slate-400 scrollbar-track-slate-200",children:(0,j.jsxs)("div",{className:"bg-white rounded-xl p-6 shadow-lg border border-slate-200",children:[(0,j.jsxs)("h3",{className:"text-lg font-semibold text-slate-800 mb-6 flex items-center gap-2",children:[(0,j.jsx)(v.A,{size:20,className:"text-blue-600"}),"Task Progress"]}),(0,j.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[(0,j.jsxs)(n.P.div,{whileHover:{scale:1.02},className:"p-4 rounded-lg border-2 "+("completed"===F.status?"bg-green-50 border-green-200":"bg-gray-50 border-gray-200"),children:[(0,j.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,j.jsx)(l.A,{size:20,className:"completed"===F.status?"text-green-600":"text-gray-400"}),(0,j.jsx)("span",{className:"font-medium "+("completed"===F.status?"text-green-800":"text-gray-600"),children:"Completion"})]}),(0,j.jsx)("div",{className:"text-2xl font-bold "+("completed"===F.status?"text-green-700":"text-gray-700"),children:"completed"===F.status?"100%":"0%"})]}),(0,j.jsxs)(n.P.div,{whileHover:{scale:1.02},className:"p-4 rounded-lg border-2 "+(Q?"bg-red-50 border-red-200":"bg-blue-50 border-blue-200"),children:[(0,j.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,j.jsx)(c.A,{size:20,className:Q?"text-red-600":"text-blue-600"}),(0,j.jsx)("span",{className:"font-medium "+(Q?"text-red-800":"text-blue-800"),children:"Due Date"})]}),(0,j.jsx)("div",{className:"text-lg font-bold "+(Q?"text-red-700":"text-blue-700"),children:F.due_date?new Date(F.due_date).toLocaleDateString():"Not set"}),Q&&(0,j.jsx)("div",{className:"text-sm text-red-600 mt-1",children:"Overdue"})]}),(0,j.jsxs)(n.P.div,{whileHover:{scale:1.02},className:"p-4 rounded-lg border-2 "+("urgent"===F.priority||"high"===F.priority?"bg-orange-50 border-orange-200":"bg-gray-50 border-gray-200"),children:[(0,j.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,j.jsx)(m.A,{size:20,className:"urgent"===F.priority||"high"===F.priority?"text-orange-600":"text-gray-600"}),(0,j.jsx)("span",{className:"font-medium "+("urgent"===F.priority||"high"===F.priority?"text-orange-800":"text-gray-800"),children:"Priority"})]}),(0,j.jsx)("div",{className:"text-lg font-bold "+("urgent"===F.priority||"high"===F.priority?"text-orange-700":"text-gray-700"),children:(null===(t=K[F.priority])||void 0===t?void 0:t.label)||"Not set"})]})]})]})},"progress"),"connections"===G&&(0,j.jsx)(n.P.div,{initial:{opacity:0,x:-30},animate:{opacity:1,x:0},exit:{opacity:0,x:30},transition:{duration:.4,ease:"easeOut"},layout:"position",layoutId:"tabContent",className:"p-6 overflow-y-auto max-h-[calc(85vh-200px)] scrollbar-thin scrollbar-thumb-slate-400 scrollbar-track-slate-200",children:(0,j.jsxs)("div",{className:"bg-white rounded-xl p-6 shadow-lg border border-slate-200",children:[(0,j.jsxs)("h3",{className:"text-lg font-semibold text-slate-800 mb-6 flex items-center gap-2",children:[(0,j.jsx)(x.A,{size:20,className:"text-indigo-600"}),"Related Content"]}),(0,j.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[ne("Linked Case ID","linked_case_id"),ne("Linked Topic ID","linked_topic_id")]}),(0,j.jsxs)("div",{className:"mt-8 text-center py-8 text-gray-500",children:[(0,j.jsx)(x.A,{size:48,className:"mx-auto mb-3 text-gray-300"}),(0,j.jsx)("p",{children:"No connections found"}),(0,j.jsx)("p",{className:"text-sm mt-1",children:"Link this task to cases or topics to create connections"})]})]})},"connections"),"details"===G&&(0,j.jsx)(n.P.div,{initial:{opacity:0,x:-30},animate:{opacity:1,x:0},exit:{opacity:0,x:30},transition:{duration:.4,ease:"easeOut"},layout:"position",layoutId:"tabContent",className:"p-6 overflow-y-auto max-h-[calc(85vh-200px)] scrollbar-thin scrollbar-thumb-slate-400 scrollbar-track-slate-200",children:(0,j.jsxs)("div",{className:"bg-white rounded-xl p-6 shadow-lg border border-slate-200",children:[(0,j.jsxs)("h3",{className:"text-lg font-semibold text-slate-800 mb-6 flex items-center gap-2",children:[(0,j.jsx)(p.A,{size:20,className:"text-gray-600"}),"Additional Details"]}),(0,j.jsxs)("div",{className:"space-y-6",children:[(0,j.jsxs)("div",{className:"text-sm text-gray-600 bg-slate-50 p-4 rounded-lg",children:[(0,j.jsx)("p",{className:"font-medium mb-2",children:"Task Details"}),(0,j.jsxs)("div",{className:"space-y-2",children:[(0,j.jsxs)("p",{children:[(0,j.jsx)("span",{className:"font-medium",children:"Created:"})," ",null!==S&&void 0!==S&&S.created_at?new Date(S.created_at).toLocaleString():"Unknown"]}),(0,j.jsxs)("p",{children:[(0,j.jsx)("span",{className:"font-medium",children:"Last Updated:"})," ",null!==S&&void 0!==S&&S.updated_at?new Date(S.updated_at).toLocaleString():"Unknown"]}),(0,j.jsxs)("p",{children:[(0,j.jsx)("span",{className:"font-medium",children:"Task ID:"})," ",(null===S||void 0===S?void 0:S.id)||"Unknown"]})]})]}),(0,j.jsxs)("div",{className:"p-4 bg-blue-50 rounded-lg border border-blue-200",children:[(0,j.jsx)("h4",{className:"font-medium text-blue-800 mb-2",children:"Task Management Tips"}),(0,j.jsxs)("ul",{className:"text-blue-700 text-sm space-y-1",children:[(0,j.jsx)("li",{children:"\u2022 Break large tasks into smaller, manageable subtasks"}),(0,j.jsx)("li",{children:"\u2022 Set realistic due dates to maintain accountability"}),(0,j.jsx)("li",{children:"\u2022 Link tasks to relevant cases or topics for better organization"}),(0,j.jsx)("li",{children:"\u2022 Update status regularly to track progress"})]})]})]})]})},"details")]})}),X&&(0,j.jsxs)("div",{className:"sticky bottom-0 bg-gray-50 border-t border-gray-200 px-6 py-4 flex items-center justify-between",children:[(0,j.jsx)("div",{className:"text-sm text-gray-500",children:"Changes will be auto-saved"}),(0,j.jsxs)("div",{className:"flex items-center gap-3",children:[(0,j.jsx)("button",{onClick:()=>{H(!1),R({...S})},disabled:B,className:"px-4 py-2 text-gray-600 hover:text-gray-800 border border-gray-300 rounded-lg hover:bg-gray-100 transition-colors",children:"Cancel"}),(0,j.jsxs)("button",{onClick:te,disabled:B,className:"px-4 py-2 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 transition-colors flex items-center gap-2",children:[B?(0,j.jsx)(r.A,{size:16,className:"animate-spin"}):(0,j.jsx)(b.A,{size:16}),B?"Saving...":"Save Changes"]})]})]})]})},`task-modal-${(null===S||void 0===S?void 0:S.id)||"default"}`)}):null},_=i.memo(S,(e,t)=>{var a,i,s,n;return e.isOpen===t.isOpen&&(null===(a=e.data)||void 0===a?void 0:a.id)===(null===(i=t.data)||void 0===i?void 0:i.id)&&(null===(s=e.data)||void 0===s?void 0:s.updated_at)===(null===(n=t.data)||void 0===n?void 0:n.updated_at)})},9e3:(e,t,a)=>{a.r(t),a.d(t,{default:()=>_});var i=a(5043),s=a(3546),n=a(6446),r=a(2024),o=a(4596),l=a(4537),d=a(2626),c=a(6382),u=a(8646),p=a(5088),m=a(1680),x=a(8487),h=a(6835),g=a(1360),b=a(8693),f=a(9855),y=a(7118),v=a(614),w=a(2667),j=a(579);const N={hidden:{opacity:0,scale:.3,y:50,rotate:-5},visible:{opacity:1,scale:1,y:0,rotate:0,transition:{type:"spring",damping:25,stiffness:300,duration:.6}},exit:{opacity:0,scale:.7,y:30,rotate:-3,transition:{type:"easeInOut",duration:.4}}},k={hidden:{opacity:0,backdropFilter:"blur(0px)"},visible:{opacity:1,backdropFilter:"blur(8px)",transition:{duration:.4,ease:"easeOut"}},exit:{opacity:0,backdropFilter:"blur(0px)",transition:{duration:.3,ease:"easeIn"}}},C={hidden:{opacity:0,y:20,scale:.95},visible:{opacity:1,y:0,scale:1,transition:{type:"easeOut",duration:.3,delay:.1}},exit:{opacity:0,y:-10,scale:1.02,transition:{type:"easeIn",duration:.2}}},S={hidden:{opacity:0,y:20,scale:.95},visible:{opacity:1,y:0,scale:1,transition:{duration:.4,ease:"easeOut"}},edit:{scale:1.02,boxShadow:"0 8px 25px rgba(59, 130, 246, 0.15)",transition:{duration:.3,ease:"easeOut"}},saved:{scale:1,boxShadow:"0 4px 15px rgba(34, 197, 94, 0.15)",transition:{duration:.3,ease:"easeOut"}}},_=e=>{var t,a,_,T;let{isOpen:A,data:D,onClose:z,onAnimationStart:P,onAnimationEnd:O,setMindMapData:$,autoSaveMindMapData:E,addToast:I}=e;const[M,L]=(0,i.useState)(!1),[X,H]=(0,i.useState)(!1),[F,R]=(0,i.useState)(!1),[B,Y]=(0,i.useState)({}),[U,W]=(0,i.useState)(!1),[G,q]=(0,i.useState)(!1),[V,J]=(0,i.useState)("overview"),[K,Z]=(0,i.useState)(!1),[Q,ee]=(0,i.useState)({}),[te,ae]=(0,i.useState)({}),[ie,se]=(0,i.useState)({}),ne=(0,i.useRef)({}),[re,oe]=(0,i.useState)({name:"",dosage:"",frequency:"",effect:""}),[le,de]=(0,i.useState)(!1);(0,i.useEffect)(()=>{if(A&&D&&!G){H(!0);const e={...D,narrative_summary:D.narrative_summary||"",medications:D.medications||[],therapeutic_highlights:D.therapeutic_highlights||"",timeline:D.timeline||[],last_updated:D.last_updated||(new Date).toISOString()};Y(e),q(!0),L(!0),P&&P(),setTimeout(()=>{L(!1),O&&O()},600)}else!A&&G&&(q(!1),se({}),ee({}),ae({}))},[A,D,G,P,O]),(0,i.useEffect)(()=>{A&&D&&G&&Y(e=>({...e,...D}))},[D,A,G]);const ce=(0,i.useCallback)(()=>{M||F||(L(!0),R(!0),P&&P(),H(!1))},[P,M,F]);(0,i.useEffect)(()=>{const e=e=>{"Escape"===e.key&&ce()};if(A)return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},[A,ce]);(0,i.useCallback)(async()=>{if(!U){W(!0);try{const e={...B,last_updated:(new Date).toISOString()};$(t=>{const a=t.cases.map(t=>String(t.id)===String(null===D||void 0===D?void 0:D.id)?{...t,...e}:t),i={...t,cases:a};return E(i),i}),Y(e),I("Case updated successfully","success")}catch(e){console.error("Error saving case:",e),I("Failed to save case","error")}finally{W(!1)}}},[null===D||void 0===D?void 0:D.id,B,$,E,I,U]);const ue=(0,i.useCallback)(e=>{const t=ne.current[e];t&&se(a=>({...a,[e]:t.scrollTop}))},[]),pe=(0,i.useCallback)(e=>{setTimeout(()=>{const t=ne.current[e],a=ie[e];t&&a&&(t.scrollTop=a)},100)},[ie]),me=(0,i.useCallback)(e=>{e===V||K||(ue(V),Z(!0),J(e),setTimeout(()=>{Z(!1),pe(e)},300))},[V,K,ue,pe]),xe=(0,i.useCallback)(e=>{ee(t=>({...t,[e]:!t[e]})),Q[e]||ae(t=>({...t,[e]:{..."basic_info"===e&&{label:B.label||B.title||"",status:B.status||"active"},..."chief_complaint"===e&&{content:B.chiefComplaint||B.chief_complaint||""},..."initial_presentation"===e&&{content:B.initialPresentation||B.initial_presentation||""},..."narrative"===e&&{content:B.narrative_summary||""},..."therapeutic_highlights"===e&&{therapeutic_highlights:B.therapeutic_highlights||""}}}))},[Q,B]),he=(0,i.useCallback)((e,t,a)=>{ae(i=>({...i,[e]:{...i[e],[t]:a}}))},[]),ge=(0,i.useCallback)(e=>{ee(t=>({...t,[e]:!1})),ae(t=>{const a={...t};return delete a[e],a})},[]),be=(0,i.useCallback)(async e=>{if(!U){W(!0);try{const t=te[e]||{};let a={...B};"basic_info"===e?(t.label&&(a.label=t.label,a.title=t.label),t.status&&(a.status=t.status)):"chief_complaint"===e?void 0!==t.content&&(a.chief_complaint=t.content,a.chiefComplaint=t.content):"initial_presentation"===e?void 0!==t.content&&(a.initial_presentation=t.content,a.initialPresentation=t.content):"narrative"===e&&void 0!==t.content&&(a.narrative_summary=t.content),a.last_updated=(new Date).toISOString(),Y(a),$(e=>{const t=e.cases.map(e=>String(e.id)===String(null===D||void 0===D?void 0:D.id)?{...e,...a}:e),i={...e,cases:t};return E(i),i}),ee(t=>({...t,[e]:!1})),ae(t=>{const a={...t};return delete a[e],a}),I("Case information updated successfully","success")}catch(t){console.error("Error saving section:",t),I("Failed to save changes","error")}finally{W(!1)}}},[te,B,null===D||void 0===D?void 0:D.id,$,E,I,U]),fe=((0,i.useCallback)(async()=>{if(!U&&window.confirm("Are you sure you want to delete this case?")){W(!0);try{$(e=>{const t=e.cases.filter(e=>String(e.id)!==String(null===D||void 0===D?void 0:D.id)),a={...e,cases:t};return E(a),a}),I("Case deleted successfully","success"),ce()}catch(e){console.error("Error deleting case:",e),I("Failed to delete case","error")}finally{W(!1)}}},[null===D||void 0===D?void 0:D.id,$,E,I,ce,U]),(0,i.useCallback)(e=>{ee(t=>({...t,[e]:!0})),ae(t=>({...t,[e]:{...B}}))},[B])),ye=(0,i.useCallback)(e=>{ee(t=>({...t,[e]:!1})),ae(t=>{const a={...t};return delete a[e],a})},[]),ve=(0,i.useCallback)(async e=>{if(U)return;const t=te[e];if(t){W(!0);try{const a={...B,...t,last_updated:(new Date).toISOString()};Y(a),$(e=>{const t=e.cases.map(e=>String(e.id)===String(null===D||void 0===D?void 0:D.id)?{...e,...a}:e),i={...e,cases:t};return E(i),i}),ee(t=>({...t,[e]:!1})),ae(t=>{const a={...t};return delete a[e],a}),I("Section updated successfully","success")}catch(a){console.error("Error saving section:",a),I("Failed to save section","error")}finally{W(!1)}}},[te,B,null===D||void 0===D?void 0:D.id,$,E,I,U]),we=(0,i.useCallback)((e,t,a)=>{ae(i=>({...i,[e]:{...i[e],[t]:a}}))},[]),je=(0,i.useCallback)(()=>{if(!re.name.trim())return;const e=[...B.medications||[],{id:Date.now(),...re,dateAdded:(new Date).toISOString()}],t={...B,medications:e,last_updated:(new Date).toISOString()};Y(t),$(e=>{const a=e.cases.map(e=>String(e.id)===String(null===D||void 0===D?void 0:D.id)?{...e,...t}:e),i={...e,cases:a};return E(i),i}),oe({name:"",dosage:"",frequency:"",effect:""}),de(!1),I("Medication added successfully","success")},[re,B,null===D||void 0===D?void 0:D.id,$,E,I]),Ne=(0,i.useCallback)(e=>{const t=(B.medications||[]).filter(t=>t.id!==e),a={...B,medications:t,last_updated:(new Date).toISOString()};Y(a),$(e=>{const t=e.cases.map(e=>String(e.id)===String(null===D||void 0===D?void 0:D.id)?{...e,...a}:e),i={...e,cases:t};return E(i),i}),I("Medication removed successfully","success")},[B,null===D||void 0===D?void 0:D.id,$,E,I]),ke=(0,i.useMemo)(()=>{const e=B.timeline||[];return console.log(`Timeline entries for case ${null===D||void 0===D?void 0:D.id}:`,e),e},[B.timeline,null===D||void 0===D?void 0:D.id]),Ce=(0,i.useCallback)(((e,t)=>{let a;return function(){for(var i=arguments.length,s=new Array(i),n=0;n<i;n++)s[n]=arguments[n];clearTimeout(a),a=setTimeout(()=>e.apply(null,s),t)}})(async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;try{const t=e.map((e,t)=>{var a,i;return{id:e.id||`timeline-${null===D||void 0===D?void 0:D.id}-${Date.now()}-${t}`,title:e.title||`Timeline Entry ${t+1}`,type:e.type||"timeline_entry",timestamp:e.timestamp||e.date||(new Date).toISOString(),date:e.date||e.timestamp||(new Date).toISOString(),patient_narrative:e.patient_narrative||(null===(a=e.patientData)||void 0===a?void 0:a.notes)||"",clinical_notes:e.clinical_notes||(null===(i=e.clinicalData)||void 0===i?void 0:i.notes)||"",content:e.content||e.patient_narrative||e.clinical_notes||"",symptoms:e.symptoms||[],orderIndex:void 0!==e.orderIndex?e.orderIndex:t,x:e.x||400,y:e.y||100+200*t,created_at:e.created_at||(new Date).toISOString(),updated_at:(new Date).toISOString(),...e}}),a={...B,timeline:t,last_updated:(new Date).toISOString()};return Y(a),$(e=>{const i=e.cases.map(e=>String(e.id)===String(null===D||void 0===D?void 0:D.id)?{...e,...a,timeline:t.map(t=>({id:String(t.id||`${Date.now()}-${e.id}-timeline-${t.orderIndex||0}`),title:t.title||`Timeline Entry ${(t.orderIndex||0)+1}`,type:t.type||"timeline_entry",timestamp:t.timestamp||t.date||(new Date).toISOString(),date:t.date||t.timestamp||(new Date).toISOString(),patient_narrative:t.patient_narrative||"",clinical_notes:t.clinical_notes||"",content:t.content||t.patient_narrative||t.clinical_notes||"",symptoms:t.symptoms||[],orderIndex:void 0!==t.orderIndex?t.orderIndex:0,x:Number(t.x)||400,y:Number(t.y)||100,created_at:t.created_at||(new Date).toISOString(),updated_at:(new Date).toISOString()}))}:e),s={...e,cases:i};return E(s),s}),{success:!0,data:a}}catch(a){return console.error("Timeline save error:",a),t<3?(console.log(`Retrying timeline save (attempt ${t+1}/3)`),Ce(e,t+1)):{success:!1,error:a}}},500),[B,null===D||void 0===D?void 0:D.id,$,E]),Se=((0,i.useCallback)(async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(U&&!t.force)return;return e.some(e=>e.patient_narrative&&e.patient_narrative.trim()||e.clinical_notes&&e.clinical_notes.trim()||e.content&&e.content.trim()||400!==e.x||100!==e.y)||t.force?(console.log(`Updating timeline for case ${null===D||void 0===D?void 0:D.id} with ${e.length} entries`),Ce(e)):(console.log("Skipping timeline save - no meaningful content or changes"),{success:!0,skipped:!0})},[Ce,U,null===D||void 0===D?void 0:D.id]),(0,i.useMemo)(()=>(null!==D&&void 0!==D&&D.id,{topics:[],literature:[],cases:[]}),[null===D||void 0===D?void 0:D.id])),_e=[{id:"overview",label:"Overview",icon:y.A},{id:"medications",label:"Medications",icon:h.A},{id:"therapy",label:"Therapy & Insights",icon:c.A},{id:"timeline",label:"Timeline",icon:p.A},{id:"related",label:"Related",icon:x.A}];return A?(0,j.jsx)(s.N,{mode:"wait",onExitComplete:()=>{L(!1),R(!1),q(!1),z(),O&&O()},children:X&&(0,j.jsx)(n.P.div,{initial:"hidden",animate:"visible",exit:"exit",variants:k,className:"fixed inset-0 bg-black flex items-center justify-center z-50",style:{willChange:"backdrop-filter, opacity",backfaceVisibility:"hidden",transform:"translate3d(0, 0, 0)"},onClick:e=>e.target===e.currentTarget&&ce(),children:(0,j.jsxs)(n.P.div,{initial:"hidden",animate:"visible",exit:"exit",variants:N,className:"bg-white rounded-2xl shadow-2xl w-full mx-4 max-h-[90vh] overflow-hidden transition-all duration-500 ease-in-out "+("timeline"===V?"max-w-7xl":"max-w-4xl"),style:{willChange:"transform, opacity, scale",backfaceVisibility:"hidden"},onClick:e=>e.stopPropagation(),onAnimationStart:()=>{L(!0),P&&P()},onAnimationComplete:()=>{L(!1),O&&O()},children:[(0,j.jsxs)(n.P.div,{initial:"hidden",animate:"visible",exit:"exit",variants:C,className:"bg-gradient-to-br from-slate-900 to-slate-800 text-white px-6 py-4 flex items-center justify-between",children:[(0,j.jsxs)("div",{className:"flex items-center gap-3",children:[(0,j.jsx)(y.A,{size:24}),(0,j.jsx)("h2",{className:"text-xl font-semibold",children:"Case Details"})]}),(0,j.jsx)("button",{onClick:ce,className:"text-slate-400 hover:text-white transition-colors",children:(0,j.jsx)(v.A,{size:24})})]}),(0,j.jsx)("div",{className:"bg-gradient-to-r from-slate-900 via-slate-800 to-slate-900 border-b border-slate-600",children:(0,j.jsx)("nav",{className:"flex flex-wrap gap-2 px-6 py-4",children:_e.map(e=>{let{id:t,label:a,icon:i}=e;return(0,j.jsxs)(n.P.button,{onClick:()=>me(t),className:"relative flex items-center gap-2 px-4 py-3 rounded-xl font-medium text-sm transition-all duration-300 "+(V===t?"bg-gradient-to-r from-blue-500 to-indigo-600 text-white shadow-lg shadow-blue-500/25":"text-slate-300 hover:text-white hover:bg-slate-700/50 hover:shadow-md"),whileHover:{scale:V===t?1:1.02},whileTap:{scale:.98},disabled:K,children:[(0,j.jsx)(i,{size:16,className:V===t?"drop-shadow-sm":""}),a,V===t&&(0,j.jsx)(n.P.div,{layoutId:"caseActiveTab",className:"absolute inset-0 bg-gradient-to-r from-blue-400/20 to-indigo-500/20 rounded-xl blur-sm",initial:!1,transition:{duration:.3,ease:"easeOut"}})]},t)})})}),(0,j.jsx)(n.P.div,{className:"flex-1 bg-gradient-to-br from-slate-900 to-slate-800 overflow-hidden",animate:{opacity:K?.7:1},transition:{duration:.2},children:(0,j.jsxs)(s.N,{mode:"wait",children:["overview"===V&&(0,j.jsxs)(n.P.div,{ref:e=>ne.current.overview=e,initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{duration:.3},className:"h-full overflow-y-auto p-6 space-y-6",children:[(0,j.jsxs)(n.P.div,{variants:S,initial:"hidden",animate:"visible",className:"bg-slate-800/50 backdrop-blur-sm rounded-xl p-6 border border-slate-700",children:[(0,j.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,j.jsx)("h3",{className:"text-lg font-semibold text-white",children:"Case Information"}),(0,j.jsx)(n.P.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>xe("basic_info"),className:"text-blue-400 hover:text-blue-300 transition-colors p-2 rounded-lg hover:bg-slate-700/50",title:"Edit case information",children:(0,j.jsx)(o.A,{size:16})})]}),Q.basic_info?(0,j.jsxs)("div",{className:"space-y-4",children:[(0,j.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,j.jsxs)("div",{children:[(0,j.jsx)("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Case Title/Label"}),(0,j.jsx)("input",{type:"text",value:void 0!==(null===(t=te.basic_info)||void 0===t?void 0:t.label)?te.basic_info.label:B.label||B.title||"",onChange:e=>he("basic_info","label",e.target.value),className:"w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-white placeholder-slate-400 focus:ring-2 focus:ring-blue-400 focus:border-blue-400",placeholder:"Enter case title/label"})]}),(0,j.jsxs)("div",{children:[(0,j.jsx)("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Status"}),(0,j.jsxs)("select",{value:void 0!==(null===(a=te.basic_info)||void 0===a?void 0:a.status)?te.basic_info.status:B.status||"active",onChange:e=>he("basic_info","status",e.target.value),className:"w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-white focus:ring-2 focus:ring-blue-400 focus:border-blue-400",children:[(0,j.jsx)("option",{value:"active",children:"Active"}),(0,j.jsx)("option",{value:"archived",children:"Archived"}),(0,j.jsx)("option",{value:"follow_up",children:"Follow-up"}),(0,j.jsx)("option",{value:"completed",children:"Completed"})]})]})]}),(0,j.jsxs)("div",{className:"flex gap-2 justify-end min-h-[44px] items-center",children:[(0,j.jsx)(n.P.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>ge("basic_info"),className:"px-4 py-2 bg-slate-600 text-white rounded-lg hover:bg-slate-500 transition-colors",children:"Cancel"}),(0,j.jsxs)(n.P.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>be("basic_info"),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2",children:[(0,j.jsx)(b.A,{size:16}),"Save Changes"]})]})]}):(0,j.jsxs)("div",{className:"space-y-4",children:[(0,j.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,j.jsxs)("div",{children:[(0,j.jsx)("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Case Title/Label"}),(0,j.jsx)("div",{className:"bg-slate-700/50 rounded-lg p-3 "+(B.label||B.title?"text-white":"text-slate-400 italic"),children:B.label||B.title||"Untitled case"})]}),(0,j.jsxs)("div",{children:[(0,j.jsx)("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Status"}),(0,j.jsx)("div",{className:"text-white bg-slate-700/50 rounded-lg p-3",children:B.status||"Active"})]})]}),(0,j.jsx)("div",{className:"flex gap-2 justify-end min-h-[44px] items-center"})]})]}),(0,j.jsxs)(n.P.div,{variants:S,initial:"hidden",animate:"visible",className:"bg-slate-800/50 backdrop-blur-sm rounded-xl p-6 border border-slate-700",children:[(0,j.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,j.jsxs)("h3",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[(0,j.jsx)(m.A,{size:20,className:"text-blue-400"}),"Case Narrative"]}),(0,j.jsx)(n.P.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>xe("narrative"),className:"text-blue-400 hover:text-blue-300 transition-colors p-2 rounded-lg hover:bg-slate-700/50",title:"Edit narrative summary",children:(0,j.jsx)(o.A,{size:16})})]}),Q.narrative?(0,j.jsxs)("div",{className:"space-y-4",children:[(0,j.jsx)("textarea",{value:void 0!==(null===(_=te.narrative)||void 0===_?void 0:_.content)?te.narrative.content:B.narrative_summary||"",onChange:e=>he("narrative","content",e.target.value),rows:8,className:"w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-white placeholder-slate-400 focus:ring-2 focus:ring-blue-400 focus:border-blue-400 resize-none",placeholder:"Enter the narrative summary for this case..."}),(0,j.jsxs)("div",{className:"flex gap-2 justify-end min-h-[44px] items-center",children:[(0,j.jsx)(n.P.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>ge("narrative"),className:"px-4 py-2 bg-slate-600 text-white rounded-lg hover:bg-slate-500 transition-colors",children:"Cancel"}),(0,j.jsxs)(n.P.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>be("narrative"),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2",children:[(0,j.jsx)(b.A,{size:16}),"Save Changes"]})]})]}):(0,j.jsxs)("div",{className:"space-y-4",children:[(0,j.jsx)("div",{className:"leading-relaxed bg-slate-700/30 rounded-lg p-4 "+(B.narrative_summary?"text-slate-300":"text-slate-400 italic"),children:B.narrative_summary||"No narrative summary documented"}),(0,j.jsx)("div",{className:"flex gap-2 justify-end min-h-[44px] items-center"})]})]}),(0,j.jsxs)("div",{className:"text-xs text-slate-500 text-right",children:["Last updated: ",B.last_updated?new Date(B.last_updated).toLocaleString():"Never"]})]},"overview"),"medications"===V&&(0,j.jsx)(n.P.div,{ref:e=>ne.current.medications=e,initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{duration:.3},className:"h-full overflow-y-auto p-6 space-y-6",children:(0,j.jsxs)(n.P.div,{variants:S,initial:"hidden",animate:"visible",className:"bg-slate-800/50 backdrop-blur-sm rounded-xl p-6 border border-slate-700",children:[(0,j.jsxs)("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[(0,j.jsx)(h.A,{size:20,className:"text-green-400"}),"Current Medications"]}),(0,j.jsx)("div",{className:"space-y-4 mb-6",children:(0,j.jsx)(s.N,{children:(B.medications||[]).map((e,t)=>(0,j.jsx)(n.P.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},className:"bg-green-600/10 border border-green-600/20 rounded-lg p-4 group hover:bg-green-600/15 transition-colors",children:(0,j.jsxs)("div",{className:"flex items-start justify-between",children:[(0,j.jsxs)("div",{className:"flex-1",children:[(0,j.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,j.jsx)("h4",{className:"font-semibold text-green-300",children:e.name}),e.dosage&&(0,j.jsx)("span",{className:"text-xs bg-green-600/20 text-green-300 px-2 py-1 rounded",children:e.dosage})]}),(0,j.jsxs)("div",{className:"space-y-1 text-sm text-slate-300",children:[e.frequency&&(0,j.jsxs)("div",{className:"flex items-center gap-2",children:[(0,j.jsx)(p.A,{size:14,className:"text-green-400"}),(0,j.jsxs)("span",{children:["Frequency: ",e.frequency]})]}),e.effect&&(0,j.jsxs)("div",{className:"flex items-center gap-2",children:[(0,j.jsx)(l.A,{size:14,className:"text-green-400"}),(0,j.jsxs)("span",{children:["Effect: ",e.effect]})]}),e.dateAdded&&(0,j.jsxs)("div",{className:"flex items-center gap-2",children:[(0,j.jsx)(u.A,{size:14,className:"text-green-400"}),(0,j.jsxs)("span",{children:["Added: ",new Date(e.dateAdded).toLocaleDateString()]})]})]})]}),(0,j.jsx)(n.P.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:()=>Ne(e.id),className:"text-green-400 hover:text-green-200 opacity-0 group-hover:opacity-100 transition-opacity p-1 rounded",title:"Remove medication",children:(0,j.jsx)(f.A,{size:16})})]})},e.id||t))})}),le?(0,j.jsxs)(n.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-slate-700/30 rounded-lg p-4 space-y-4",children:[(0,j.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,j.jsxs)("div",{children:[(0,j.jsxs)("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:["Medication Name ",(0,j.jsx)("span",{className:"text-red-400",children:"*"})]}),(0,j.jsx)("input",{type:"text",value:re.name,onChange:e=>oe(t=>({...t,name:e.target.value})),className:"w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-white placeholder-slate-400 focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"Enter medication name"})]}),(0,j.jsxs)("div",{children:[(0,j.jsx)("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Dosage"}),(0,j.jsx)("input",{type:"text",value:re.dosage,onChange:e=>oe(t=>({...t,dosage:e.target.value})),className:"w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-white placeholder-slate-400 focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"e.g., 50mg"})]})]}),(0,j.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,j.jsxs)("div",{children:[(0,j.jsx)("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Frequency"}),(0,j.jsx)("input",{type:"text",value:re.frequency,onChange:e=>oe(t=>({...t,frequency:e.target.value})),className:"w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-white placeholder-slate-400 focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"e.g., Once daily"})]}),(0,j.jsxs)("div",{children:[(0,j.jsx)("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Effect/Notes"}),(0,j.jsx)("input",{type:"text",value:re.effect,onChange:e=>oe(t=>({...t,effect:e.target.value})),className:"w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-white placeholder-slate-400 focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"e.g., Improved mood"})]})]}),(0,j.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,j.jsx)(n.P.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>{de(!1),oe({name:"",dosage:"",frequency:"",effect:""})},className:"px-4 py-2 text-slate-300 hover:text-white border border-slate-600 rounded-lg hover:bg-slate-700 transition-colors",children:"Cancel"}),(0,j.jsxs)(n.P.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:je,disabled:!re.name.trim(),className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[(0,j.jsx)(g.A,{size:16}),"Add Medication"]})]})]}):(0,j.jsxs)(n.P.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>de(!0),className:"w-full flex items-center justify-center gap-2 p-4 border-2 border-dashed border-green-600/30 rounded-lg text-green-400 hover:border-green-600/50 hover:bg-green-600/5 transition-colors",children:[(0,j.jsx)(g.A,{size:16}),"Add New Medication"]}),0===(B.medications||[]).length&&!le&&(0,j.jsx)("p",{className:"text-slate-500 italic text-center py-8",children:"No medications documented yet"})]})},"medications"),"therapy"===V&&(0,j.jsx)(n.P.div,{ref:e=>ne.current.therapy=e,initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{duration:.3},className:"h-full overflow-y-auto p-6 space-y-6",children:(0,j.jsxs)(n.P.div,{variants:S,animate:Q.therapeutic_highlights?"edit":"visible",className:"bg-slate-800/50 backdrop-blur-sm rounded-xl p-6 border border-slate-700",children:[(0,j.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,j.jsxs)("h3",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[(0,j.jsx)(c.A,{size:20,className:"text-purple-400"}),"Therapeutic Highlights"]}),!Q.therapeutic_highlights&&(0,j.jsx)(n.P.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:()=>fe("therapeutic_highlights"),className:"text-slate-400 hover:text-white transition-colors p-1 rounded",title:"Edit therapeutic highlights",children:(0,j.jsx)(o.A,{size:16})})]}),Q.therapeutic_highlights?(0,j.jsxs)(n.P.div,{className:"space-y-4",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},children:[(0,j.jsx)("textarea",{value:void 0!==(null===(T=te.therapeutic_highlights)||void 0===T?void 0:T.therapeutic_highlights)?te.therapeutic_highlights.therapeutic_highlights:B.therapeutic_highlights||"",onChange:e=>we("therapeutic_highlights","therapeutic_highlights",e.target.value),rows:10,className:"w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-3 text-white placeholder-slate-400 focus:ring-2 focus:ring-purple-500 focus:border-purple-500 resize-none",placeholder:"Enter key therapeutic moments, insights, breakthroughs, or notes on therapy process..."}),(0,j.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,j.jsx)(n.P.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>ye("therapeutic_highlights"),className:"px-3 py-2 text-slate-300 hover:text-white border border-slate-600 rounded-lg hover:bg-slate-700 transition-colors text-sm",children:"Cancel"}),(0,j.jsxs)(n.P.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>ve("therapeutic_highlights"),disabled:U,className:"px-3 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors text-sm flex items-center gap-2",children:[U?(0,j.jsx)(r.A,{size:14,className:"animate-spin"}):(0,j.jsx)(b.A,{size:14}),"Save"]})]})]}):(0,j.jsx)(n.P.div,{className:"text-slate-300 leading-relaxed cursor-pointer hover:bg-slate-700/20 rounded-lg p-4 transition-colors min-h-[200px]",whileHover:{scale:1.01},transition:{duration:.2},onClick:()=>fe("therapeutic_highlights"),children:B.therapeutic_highlights?(0,j.jsx)("div",{className:"whitespace-pre-wrap",children:B.therapeutic_highlights}):(0,j.jsx)("span",{className:"text-slate-500 italic",children:"Click to add therapeutic highlights, key moments, insights, breakthroughs, or therapy process notes..."})})]})},"therapy"),"timeline"===V&&(0,j.jsx)(n.P.div,{ref:e=>ne.current.timeline=e,initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{duration:.3},className:"h-full",children:(0,j.jsx)(w.A,{data:ke,caseId:null===D||void 0===D?void 0:D.id,setMindMapData:$,autoSaveMindMapData:E,onDataChange:e=>{console.log("Timeline data updated:",e),I("Timeline updated successfully","success")}})},"timeline"),"related"===V&&(0,j.jsx)(n.P.div,{ref:e=>ne.current.related=e,initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{duration:.3},className:"h-full overflow-y-auto p-6 space-y-6",children:(0,j.jsxs)(n.P.div,{variants:S,initial:"hidden",animate:"visible",className:"bg-slate-800/50 backdrop-blur-sm rounded-xl p-6 border border-slate-700",children:[(0,j.jsxs)("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[(0,j.jsx)(x.A,{size:20,className:"text-cyan-400"}),"Connected Nodes"]}),(0,j.jsxs)("div",{className:"mb-6",children:[(0,j.jsxs)("h4",{className:"text-md font-medium text-slate-300 mb-3 flex items-center gap-2",children:[(0,j.jsx)(c.A,{size:16,className:"text-blue-400"}),"Related Topics"]}),Se.topics.length>0?(0,j.jsx)("div",{className:"space-y-2",children:Se.topics.map((e,t)=>(0,j.jsxs)("div",{className:"flex items-center gap-3 p-3 bg-blue-600/10 border border-blue-600/20 rounded-lg",children:[(0,j.jsx)(c.A,{size:16,className:"text-blue-400"}),(0,j.jsx)("span",{className:"text-blue-300",children:e.title})]},t))}):(0,j.jsx)("p",{className:"text-slate-500 italic text-sm",children:"No connected topics"})]}),(0,j.jsxs)("div",{className:"mb-6",children:[(0,j.jsxs)("h4",{className:"text-md font-medium text-slate-300 mb-3 flex items-center gap-2",children:[(0,j.jsx)(d.A,{size:16,className:"text-purple-400"}),"Related Literature"]}),Se.literature.length>0?(0,j.jsx)("div",{className:"space-y-2",children:Se.literature.map((e,t)=>(0,j.jsxs)("div",{className:"flex items-center gap-3 p-3 bg-purple-600/10 border border-purple-600/20 rounded-lg",children:[(0,j.jsx)(d.A,{size:16,className:"text-purple-400"}),(0,j.jsx)("span",{className:"text-purple-300",children:e.title})]},t))}):(0,j.jsx)("p",{className:"text-slate-500 italic text-sm",children:"No connected literature"})]}),(0,j.jsxs)("div",{children:[(0,j.jsxs)("h4",{className:"text-md font-medium text-slate-300 mb-3 flex items-center gap-2",children:[(0,j.jsx)(y.A,{size:16,className:"text-green-400"}),"Related Cases"]}),Se.cases.length>0?(0,j.jsx)("div",{className:"space-y-2",children:Se.cases.map((e,t)=>(0,j.jsxs)("div",{className:"flex items-center gap-3 p-3 bg-green-600/10 border border-green-600/20 rounded-lg",children:[(0,j.jsx)(y.A,{size:16,className:"text-green-400"}),(0,j.jsx)("span",{className:"text-green-300",children:e.title})]},t))}):(0,j.jsx)("p",{className:"text-slate-500 italic text-sm",children:"No connected cases"})]}),(0,j.jsx)("div",{className:"mt-6 p-4 bg-slate-700/20 rounded-lg border border-slate-600",children:(0,j.jsx)("p",{className:"text-slate-400 text-sm italic",children:"Connected nodes will be automatically populated based on mind map relationships and connections created in the graph view."})})]})},"related")]})})]})},`case-modal-${(null===D||void 0===D?void 0:D.id)||"default"}`)}):null}}},t={};function a(i){var s=t[i];if(void 0!==s)return s.exports;var n=t[i]={id:i,loaded:!1,exports:{}};return e[i](n,n.exports,a),n.loaded=!0,n.exports}a.m=e,(()=>{var e=[];a.O=(t,i,s,n)=>{if(!i){var r=1/0;for(c=0;c<e.length;c++){i=e[c][0],s=e[c][1],n=e[c][2];for(var o=!0,l=0;l<i.length;l++)(!1&n||r>=n)&&Object.keys(a.O).every(e=>a.O[e](i[l]))?i.splice(l--,1):(o=!1,n<r&&(r=n));if(o){e.splice(c--,1);var d=s();void 0!==d&&(t=d)}}return t}n=n||0;for(var c=e.length;c>0&&e[c-1][2]>n;c--)e[c]=e[c-1];e[c]=[i,s,n]}})(),(()=>{var e,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__;a.t=function(i,s){if(1&s&&(i=this(i)),8&s)return i;if("object"===typeof i&&i){if(4&s&&i.__esModule)return i;if(16&s&&"function"===typeof i.then)return i}var n=Object.create(null);a.r(n);var r={};e=e||[null,t({}),t([]),t(t)];for(var o=2&s&&i;("object"==typeof o||"function"==typeof o)&&!~e.indexOf(o);o=t(o))Object.getOwnPropertyNames(o).forEach(e=>r[e]=()=>i[e]);return r.default=()=>i,a.d(n,r),n}})(),a.d=(e,t)=>{for(var i in t)a.o(t,i)&&!a.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},a.f={},a.e=e=>Promise.all(Object.keys(a.f).reduce((t,i)=>(a.f[i](e,t),t),[])),a.u=e=>"static/js/"+e+"."+{213:"953ef4c7",261:"de3004f3",524:"7d493d91"}[e]+".chunk.js",a.miniCssF=e=>{},a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={},t="frontend:";a.l=(i,s,n,r)=>{if(e[i])e[i].push(s);else{var o,l;if(void 0!==n)for(var d=document.getElementsByTagName("script"),c=0;c<d.length;c++){var u=d[c];if(u.getAttribute("src")==i||u.getAttribute("data-webpack")==t+n){o=u;break}}o||(l=!0,(o=document.createElement("script")).charset="utf-8",o.timeout=120,a.nc&&o.setAttribute("nonce",a.nc),o.setAttribute("data-webpack",t+n),o.src=i),e[i]=[s];var p=(t,a)=>{o.onerror=o.onload=null,clearTimeout(m);var s=e[i];if(delete e[i],o.parentNode&&o.parentNode.removeChild(o),s&&s.forEach(e=>e(a)),t)return t(a)},m=setTimeout(p.bind(null,void 0,{type:"timeout",target:o}),12e4);o.onerror=p.bind(null,o.onerror),o.onload=p.bind(null,o.onload),l&&document.head.appendChild(o)}}})(),a.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),a.p="./",(()=>{var e={792:0};a.f.j=(t,i)=>{var s=a.o(e,t)?e[t]:void 0;if(0!==s)if(s)i.push(s[2]);else{var n=new Promise((a,i)=>s=e[t]=[a,i]);i.push(s[2]=n);var r=a.p+a.u(t),o=new Error;a.l(r,i=>{if(a.o(e,t)&&(0!==(s=e[t])&&(e[t]=void 0),s)){var n=i&&("load"===i.type?"missing":i.type),r=i&&i.target&&i.target.src;o.message="Loading chunk "+t+" failed.\n("+n+": "+r+")",o.name="ChunkLoadError",o.type=n,o.request=r,s[1](o)}},"chunk-"+t,t)}},a.O.j=t=>0===e[t];var t=(t,i)=>{var s,n,r=i[0],o=i[1],l=i[2],d=0;if(r.some(t=>0!==e[t])){for(s in o)a.o(o,s)&&(a.m[s]=o[s]);if(l)var c=l(a)}for(t&&t(i);d<r.length;d++)n=r[d],a.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return a.O(c)},i=self.webpackChunkfrontend=self.webpackChunkfrontend||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))})();var i=a.O(void 0,[967,497,96],()=>a(964));i=a.O(i)})();
//# sourceMappingURL=main.ba5ef7fb.js.map