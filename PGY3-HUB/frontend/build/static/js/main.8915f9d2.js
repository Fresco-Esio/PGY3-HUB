(()=>{"use strict";var e={8806:(e,t,a)=>{var s=a(5043),i=a(4391),r=(a(411),a(6213)),o=a(3546),l=a(7845),n=a(7782),c=a(6833),d=a(7819),u=a(7856),p=a(2024),m=a(614),h=a(6382),x=a(9350),g=a(5088),b=a(7118),y=a(8646),v=a(9917),f=a(2626),j=a(5469),N=a(1360),w=a(1680),k=a(8693),C=a(2054),S=a(1827),_=a(2119),A=a(3528),T=a(4596),z=a(9855),P=a(5087),O=a(579);const D=e=>{let{message:t="Loading..."}=e;return(0,O.jsx)("div",{className:"flex items-center justify-center p-8",children:(0,O.jsxs)("div",{className:"flex flex-col items-center gap-2",children:[(0,O.jsx)(p.A,{className:"w-6 h-6 animate-spin text-blue-600"}),(0,O.jsx)("span",{className:"text-sm text-gray-600",children:t})]})})},E=(0,s.lazy)(()=>Promise.all([a.e(96),a.e(261)]).then(a.bind(a,6261))),M=(0,s.lazy)(()=>Promise.all([a.e(96),a.e(524)]).then(a.bind(a,4524))),I=(0,s.lazy)(()=>Promise.all([a.e(96),a.e(213)]).then(a.bind(a,4213))),$=(e,t)=>a=>(0,O.jsx)(s.Suspense,{fallback:(0,O.jsx)(D,{message:t}),children:(0,O.jsx)(e,{...a})}),L=($(E,"Loading editor..."),$(M,"Loading templates...")),X=$(I,"Loading literature viewer...");var H=a(844),F=a(6835),R=a(8487),B=a(4537);const Y={hidden:{opacity:0,scale:.3,y:50,rotate:-5},visible:{opacity:1,scale:1,y:0,rotate:0,transition:{type:"spring",damping:25,stiffness:300,duration:.6}},exit:{opacity:0,scale:.7,y:30,rotate:-3,transition:{type:"easeInOut",duration:.4}}},U={hidden:{opacity:0,backdropFilter:"blur(0px)"},visible:{opacity:1,backdropFilter:"blur(8px)",transition:{duration:.4,ease:"easeOut"}},exit:{opacity:0,backdropFilter:"blur(0px)",transition:{duration:.3,ease:"easeIn"}}},J={hidden:{opacity:0,y:20,scale:.95},visible:{opacity:1,y:0,scale:1,transition:{type:"easeOut",duration:.3,delay:.1}},exit:{opacity:0,y:-10,scale:1.02,transition:{type:"easeIn",duration:.2}}},q={hidden:{opacity:0,y:20,scale:.95},visible:{opacity:1,y:0,scale:1,transition:{duration:.4,ease:"easeOut"}},edit:{scale:1.02,boxShadow:"0 8px 25px rgba(59, 130, 246, 0.15)",transition:{duration:.3,ease:"easeOut"}},saved:{scale:1,boxShadow:"0 4px 15px rgba(34, 197, 94, 0.15)",transition:{duration:.3,ease:"easeOut"}}},W=e=>{let{entry:t,onChange:a,onSave:i,onCancel:r,isNew:o=!1}=e;const[l,n]=(0,s.useState)(t);(0,s.useEffect)(()=>{n(t)},[t]);const c=(e,t)=>{const s={...l,[e]:t};n(s),o&&a(s)};return(0,O.jsx)(H.P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"bg-slate-800/70 backdrop-blur-sm rounded-xl p-4 border border-slate-600",children:(0,O.jsxs)("div",{className:"space-y-4",children:[(0,O.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,O.jsxs)("div",{children:[(0,O.jsx)("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Entry Type"}),(0,O.jsxs)("select",{value:l.type,onChange:e=>c("type",e.target.value),className:"w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-white focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500",children:[(0,O.jsx)("option",{value:"Assessment",children:"Assessment"}),(0,O.jsx)("option",{value:"Medication",children:"Medication"}),(0,O.jsx)("option",{value:"Therapy",children:"Therapy"}),(0,O.jsx)("option",{value:"Follow-up",children:"Follow-up"}),(0,O.jsx)("option",{value:"Note",children:"Note"})]})]}),(0,O.jsxs)("div",{children:[(0,O.jsx)("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Timestamp"}),(0,O.jsx)("input",{type:"datetime-local",value:l.timestamp.slice(0,16),onChange:e=>c("timestamp",e.target.value),className:"w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-white focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500"})]})]}),(0,O.jsxs)("div",{children:[(0,O.jsx)("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Content"}),(0,O.jsx)("textarea",{value:l.content,onChange:e=>c("content",e.target.value),className:"w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-white placeholder-slate-400 focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500",rows:4,placeholder:"Describe what happened, observations, decisions made, or notes..."})]}),!o&&(0,O.jsxs)("div",{children:[(0,O.jsx)("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Author"}),(0,O.jsx)("input",{type:"text",value:l.author||"",onChange:e=>c("author",e.target.value),className:"w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-white placeholder-slate-400 focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500",placeholder:"Author name"})]}),(0,O.jsxs)("div",{className:"flex justify-end gap-2 pt-2",children:[(0,O.jsx)(H.P.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:r,className:"px-4 py-2 text-slate-300 hover:text-white border border-slate-600 rounded-lg hover:bg-slate-700 transition-colors",children:"Cancel"}),(0,O.jsxs)(H.P.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>{l.content.trim()&&(o?i():i(l))},disabled:!l.content.trim(),className:"px-4 py-2 bg-cyan-600 text-white rounded-lg hover:bg-cyan-700 transition-colors flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[(0,O.jsx)(k.A,{size:16}),o?"Add Entry":"Save Changes"]})]})]})})},V=e=>{let{entry:t,onSave:a,onCancel:s}=e;return(0,O.jsx)(W,{entry:t,onChange:()=>{},onSave:a,onCancel:s,isNew:!1})},K=e=>{var t,a,i,r,l;let{isOpen:n,data:c,onClose:d,onAnimationStart:u,onAnimationEnd:x,setMindMapData:v,autoSaveMindMapData:j,addToast:C}=e;const[S,_]=(0,s.useState)(!1),[A,P]=(0,s.useState)(!1),[D,E]=(0,s.useState)(!1),[M,I]=(0,s.useState)({}),[$,L]=(0,s.useState)(!1),[X,K]=(0,s.useState)(!1),[G,Q]=(0,s.useState)("overview"),[Z,ee]=(0,s.useState)(!1),[te,ae]=(0,s.useState)({}),[se,ie]=(0,s.useState)({}),[re,oe]=(0,s.useState)({}),le=(0,s.useRef)({}),[ne,ce]=(0,s.useState)({name:"",dosage:"",frequency:"",effect:""}),[de,ue]=(0,s.useState)(!1),[pe,me]=(0,s.useState)({type:"Assessment",timestamp:(new Date).toISOString().slice(0,16),content:"",author:"Current User"}),[he,xe]=(0,s.useState)(!1),[ge,be]=(0,s.useState)(null),ye=(0,s.useRef)(null);(0,s.useEffect)(()=>{if(n&&c&&!X){P(!0);const e={...c,narrative_summary:c.narrative_summary||"",medications:c.medications||[],therapeutic_highlights:c.therapeutic_highlights||"",timeline:c.timeline||[],last_updated:c.last_updated||(new Date).toISOString()};I(e),K(!0),_(!0),u&&u(),setTimeout(()=>{_(!1),x&&x()},600)}else!n&&X&&(K(!1),oe({}),ae({}),ie({}))},[n,c,X,u,x]),(0,s.useEffect)(()=>{n&&c&&X&&I(e=>({...e,...c}))},[c,n,X]);const ve=(0,s.useCallback)(()=>{S||D||(_(!0),E(!0),u&&u(),P(!1))},[u,S,D]),fe=((0,s.useCallback)(async()=>{if(!$){L(!0);try{const e={...M,last_updated:(new Date).toISOString()};v(t=>{const a=t.cases.map(t=>String(t.id)===String(null===c||void 0===c?void 0:c.id)?{...t,...e}:t),s={...t,cases:a};return j(s),s}),I(e),C("Case updated successfully","success")}catch(e){console.error("Error saving case:",e),C("Failed to save case","error")}finally{L(!1)}}},[null===c||void 0===c?void 0:c.id,M,v,j,C,$]),(0,s.useCallback)(e=>{const t=le.current[e];t&&oe(a=>({...a,[e]:t.scrollTop}))},[])),je=(0,s.useCallback)(e=>{setTimeout(()=>{const t=le.current[e],a=re[e];t&&a&&(t.scrollTop=a)},100)},[re]),Ne=(0,s.useCallback)(e=>{e===G||Z||(fe(G),ee(!0),Q(e),setTimeout(()=>{ee(!1),je(e)},300))},[G,Z,fe,je]),we=((0,s.useCallback)(async()=>{if(!$&&window.confirm("Are you sure you want to delete this case?")){L(!0);try{v(e=>{const t=e.cases.filter(e=>String(e.id)!==String(null===c||void 0===c?void 0:c.id)),a={...e,cases:t};return j(a),a}),C("Case deleted successfully","success"),ve()}catch(e){console.error("Error deleting case:",e),C("Failed to delete case","error")}finally{L(!1)}}},[null===c||void 0===c?void 0:c.id,v,j,C,ve,$]),(0,s.useCallback)(e=>{ae(t=>({...t,[e]:!0})),ie(t=>({...t,[e]:{...M}}))},[M])),ke=(0,s.useCallback)(e=>{ae(t=>({...t,[e]:!1})),ie(t=>{const a={...t};return delete a[e],a})},[]),Ce=(0,s.useCallback)(async e=>{if($)return;const t=se[e];if(t){L(!0);try{const a={...M,...t,last_updated:(new Date).toISOString()};I(a),v(e=>{const t=e.cases.map(e=>String(e.id)===String(null===c||void 0===c?void 0:c.id)?{...e,...a}:e),s={...e,cases:t};return j(s),s}),ae(t=>({...t,[e]:!1})),ie(t=>{const a={...t};return delete a[e],a}),C("Section updated successfully","success")}catch(a){console.error("Error saving section:",a),C("Failed to save section","error")}finally{L(!1)}}},[se,M,null===c||void 0===c?void 0:c.id,v,j,C,$]),Se=(0,s.useCallback)((e,t,a)=>{ie(s=>({...s,[e]:{...s[e],[t]:a}}))},[]),_e=(0,s.useCallback)(()=>{if(!ne.name.trim())return;const e=[...M.medications||[],{id:Date.now(),...ne,dateAdded:(new Date).toISOString()}],t={...M,medications:e,last_updated:(new Date).toISOString()};I(t),v(e=>{const a=e.cases.map(e=>String(e.id)===String(null===c||void 0===c?void 0:c.id)?{...e,...t}:e),s={...e,cases:a};return j(s),s}),ce({name:"",dosage:"",frequency:"",effect:""}),ue(!1),C("Medication added successfully","success")},[ne,M,null===c||void 0===c?void 0:c.id,v,j,C]),Ae=(0,s.useCallback)(e=>{const t=(M.medications||[]).filter(t=>t.id!==e),a={...M,medications:t,last_updated:(new Date).toISOString()};I(a),v(e=>{const t=e.cases.map(e=>String(e.id)===String(null===c||void 0===c?void 0:c.id)?{...e,...a}:e),s={...e,cases:t};return j(s),s}),C("Medication removed successfully","success")},[M,null===c||void 0===c?void 0:c.id,v,j,C]),Te=(0,s.useCallback)(e=>({Assessment:"border-green-500",Medication:"border-blue-500",Therapy:"border-purple-500","Follow-up":"border-orange-500",Note:"border-gray-500"}[e]||"border-gray-500"),[]),ze=(0,s.useCallback)(()=>{if(!pe.content.trim())return;const e={id:Date.now().toString(),...pe,timestamp:new Date(pe.timestamp).toISOString(),dateAdded:(new Date).toISOString()},t=[...M.timeline||[],e],a={...M,timeline:t,last_updated:(new Date).toISOString()};I(a),v(e=>{const t=e.cases.map(e=>String(e.id)===String(null===c||void 0===c?void 0:c.id)?{...e,...a}:e),s={...e,cases:t};return j(s),s}),me({type:"Assessment",timestamp:(new Date).toISOString().slice(0,16),content:"",author:"Current User"}),xe(!1),C("Timeline entry added successfully","success"),setTimeout(()=>{ye.current&&(ye.current.scrollTop=ye.current.scrollHeight)},300)},[pe,M,null===c||void 0===c?void 0:c.id,v,j,C]),Pe=(0,s.useCallback)((e,t)=>{const a=(M.timeline||[]).map(a=>a.id===e?{...a,...t,last_updated:(new Date).toISOString()}:a),s={...M,timeline:a,last_updated:(new Date).toISOString()};I(s),v(e=>{const t=e.cases.map(e=>String(e.id)===String(null===c||void 0===c?void 0:c.id)?{...e,...s}:e),a={...e,cases:t};return j(a),a}),be(null),C("Timeline entry updated successfully","success")},[M,null===c||void 0===c?void 0:c.id,v,j,C]),Oe=(0,s.useCallback)(e=>{const t=(M.timeline||[]).filter(t=>t.id!==e),a={...M,timeline:t,last_updated:(new Date).toISOString()};I(a),v(e=>{const t=e.cases.map(e=>String(e.id)===String(null===c||void 0===c?void 0:c.id)?{...e,...a}:e),s={...e,cases:t};return j(s),s}),C("Timeline entry removed successfully","success")},[M,null===c||void 0===c?void 0:c.id,v,j,C]),De=(0,s.useCallback)(()=>{ye.current&&ye.current.scrollTo({top:ye.current.scrollHeight,behavior:"smooth"})},[]),Ee=(0,s.useCallback)(()=>{setTimeout(()=>{if(ye.current){const e=ye.current.scrollTop,t=ye.current.scrollHeight;t-e-ye.current.clientHeight<100&&ye.current.scrollTo({top:t,behavior:"smooth"})}},300)},[]),Me=(0,s.useMemo)(()=>(null!==c&&void 0!==c&&c.id,{topics:[],literature:[],cases:[]}),[null===c||void 0===c?void 0:c.id]),Ie=[{id:"overview",label:"Overview",icon:b.A},{id:"narrative",label:"Narrative",icon:w.A},{id:"medications",label:"Medications",icon:F.A},{id:"therapy",label:"Therapy & Insights",icon:h.A},{id:"timeline",label:"Timeline",icon:g.A},{id:"related",label:"Related",icon:R.A}];return n?(0,O.jsx)(o.N,{mode:"wait",onExitComplete:()=>{_(!1),E(!1),K(!1),d(),x&&x()},children:A&&(0,O.jsx)(H.P.div,{initial:"hidden",animate:"visible",exit:"exit",variants:U,className:"fixed inset-0 bg-black flex items-center justify-center z-50",style:{willChange:"backdrop-filter, opacity",backfaceVisibility:"hidden",transform:"translate3d(0, 0, 0)"},onClick:e=>e.target===e.currentTarget&&ve(),children:(0,O.jsxs)(H.P.div,{initial:"hidden",animate:"visible",exit:"exit",variants:Y,className:"bg-white rounded-2xl shadow-2xl max-w-4xl w-full mx-4 max-h-[85vh] overflow-hidden",style:{willChange:"transform, opacity, scale",backfaceVisibility:"hidden"},onClick:e=>e.stopPropagation(),onAnimationStart:()=>{_(!0),u&&u()},onAnimationComplete:()=>{_(!1),x&&x()},children:[(0,O.jsxs)(H.P.div,{initial:"hidden",animate:"visible",exit:"exit",variants:J,className:"bg-gradient-to-br from-slate-900 to-slate-800 text-white px-6 py-4 flex items-center justify-between",children:[(0,O.jsxs)("div",{className:"flex items-center gap-3",children:[(0,O.jsx)(b.A,{size:24}),(0,O.jsx)("h2",{className:"text-xl font-semibold",children:"Case Details"})]}),(0,O.jsx)("button",{onClick:ve,className:"text-slate-400 hover:text-white transition-colors",children:(0,O.jsx)(m.A,{size:24})})]}),(0,O.jsx)("div",{className:"bg-gradient-to-r from-slate-900 via-slate-800 to-slate-900 border-b border-slate-600",children:(0,O.jsx)("nav",{className:"flex flex-wrap gap-2 px-6 py-4",children:Ie.map(e=>{let{id:t,label:a,icon:s}=e;return(0,O.jsxs)(H.P.button,{onClick:()=>Ne(t),className:"relative flex items-center gap-2 px-4 py-3 rounded-xl font-medium text-sm transition-all duration-300 "+(G===t?"bg-gradient-to-r from-blue-500 to-indigo-600 text-white shadow-lg shadow-blue-500/25":"text-slate-300 hover:text-white hover:bg-slate-700/50 hover:shadow-md"),whileHover:{scale:G===t?1:1.02},whileTap:{scale:.98},disabled:Z,children:[(0,O.jsx)(s,{size:16,className:G===t?"drop-shadow-sm":""}),a,G===t&&(0,O.jsx)(H.P.div,{layoutId:"caseActiveTab",className:"absolute inset-0 bg-gradient-to-r from-blue-400/20 to-indigo-500/20 rounded-xl blur-sm",initial:!1,transition:{duration:.3,ease:"easeOut"}})]},t)})})}),(0,O.jsx)(H.P.div,{className:"flex-1 bg-gradient-to-br from-slate-900 to-slate-800 overflow-hidden",animate:{opacity:Z?.7:1},transition:{duration:.2},children:(0,O.jsxs)(o.N,{mode:"wait",children:["overview"===G&&(0,O.jsxs)(H.P.div,{ref:e=>le.current.overview=e,initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{duration:.3},className:"h-full overflow-y-auto p-6 space-y-6",children:[(0,O.jsxs)(H.P.div,{variants:q,animate:te.basic_info?"edit":"visible",className:"bg-slate-800/50 backdrop-blur-sm rounded-xl p-6 border border-slate-700",children:[(0,O.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,O.jsx)("h3",{className:"text-lg font-semibold text-white",children:"Case Information"}),!te.basic_info&&(0,O.jsx)(H.P.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:()=>we("basic_info"),className:"text-slate-400 hover:text-white transition-colors p-1 rounded",title:"Edit case information",children:(0,O.jsx)(T.A,{size:16})})]}),te.basic_info?(0,O.jsxs)(H.P.div,{className:"space-y-4",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},children:[(0,O.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,O.jsxs)("div",{children:[(0,O.jsx)("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Case Name"}),(0,O.jsx)("input",{type:"text",value:(null===(t=se.basic_info)||void 0===t?void 0:t.caseName)||M.caseName||M.case_name||M.title||"",onChange:e=>Se("basic_info","caseName",e.target.value),className:"w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-3 text-white placeholder-slate-400 focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"Enter case name..."})]}),(0,O.jsxs)("div",{children:[(0,O.jsx)("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Status"}),(0,O.jsxs)("select",{value:(null===(a=se.basic_info)||void 0===a?void 0:a.status)||M.status||"Active",onChange:e=>Se("basic_info","status",e.target.value),className:"w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-3 text-white focus:ring-2 focus:ring-green-500 focus:border-green-500",children:[(0,O.jsx)("option",{value:"Active",children:"Active"}),(0,O.jsx)("option",{value:"Closed",children:"Closed"}),(0,O.jsx)("option",{value:"On Hold",children:"On Hold"}),(0,O.jsx)("option",{value:"Follow-up",children:"Follow-up"})]})]})]}),(0,O.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,O.jsx)(H.P.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>ke("basic_info"),className:"px-3 py-2 text-slate-300 hover:text-white border border-slate-600 rounded-lg hover:bg-slate-700 transition-colors text-sm",children:"Cancel"}),(0,O.jsxs)(H.P.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>Ce("basic_info"),disabled:$,className:"px-3 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm flex items-center gap-2",children:[$?(0,O.jsx)(p.A,{size:14,className:"animate-spin"}):(0,O.jsx)(k.A,{size:14}),"Save"]})]})]}):(0,O.jsx)(H.P.div,{className:"cursor-pointer hover:bg-slate-700/20 rounded-lg p-4 transition-colors",whileHover:{scale:1.01},transition:{duration:.2},onClick:()=>we("basic_info"),children:(0,O.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,O.jsxs)("div",{children:[(0,O.jsx)("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Case Name"}),(0,O.jsx)("div",{className:"text-white bg-slate-700/50 rounded-lg p-3",children:M.caseName||M.case_name||M.title||"No case name specified"})]}),(0,O.jsxs)("div",{children:[(0,O.jsx)("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Status"}),(0,O.jsx)("div",{className:"text-white bg-slate-700/50 rounded-lg p-3",children:M.status||"Active"})]})]})})]}),(0,O.jsxs)(H.P.div,{variants:q,animate:te.initial_presentation?"edit":"visible",className:"bg-slate-800/50 backdrop-blur-sm rounded-xl p-6 border border-slate-700",children:[(0,O.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,O.jsx)("h4",{className:"text-lg font-semibold text-white",children:"Initial Presentation"}),!te.initial_presentation&&(0,O.jsx)(H.P.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:()=>we("initial_presentation"),className:"text-slate-400 hover:text-white transition-colors p-1 rounded",title:"Edit initial presentation",children:(0,O.jsx)(T.A,{size:16})})]}),te.initial_presentation?(0,O.jsxs)(H.P.div,{className:"space-y-4",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},children:[(0,O.jsx)("textarea",{value:(null===(i=se.initial_presentation)||void 0===i?void 0:i.initialPresentation)||M.initialPresentation||"",onChange:e=>Se("initial_presentation","initialPresentation",e.target.value),rows:6,className:"w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-3 text-white placeholder-slate-400 focus:ring-2 focus:ring-green-500 focus:border-green-500 resize-none",placeholder:"Describe the initial presentation, symptoms, and circumstances..."}),(0,O.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,O.jsx)(H.P.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>ke("initial_presentation"),className:"px-3 py-2 text-slate-300 hover:text-white border border-slate-600 rounded-lg hover:bg-slate-700 transition-colors text-sm",children:"Cancel"}),(0,O.jsxs)(H.P.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>Ce("initial_presentation"),disabled:$,className:"px-3 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm flex items-center gap-2",children:[$?(0,O.jsx)(p.A,{size:14,className:"animate-spin"}):(0,O.jsx)(k.A,{size:14}),"Save"]})]})]}):(0,O.jsx)(H.P.div,{className:"text-slate-300 leading-relaxed cursor-pointer hover:bg-slate-700/20 rounded-lg p-4 transition-colors",whileHover:{scale:1.01},transition:{duration:.2},onClick:()=>we("initial_presentation"),children:M.initialPresentation?(0,O.jsx)("div",{className:"whitespace-pre-wrap",children:M.initialPresentation}):(0,O.jsx)("span",{className:"text-slate-500 italic",children:"Click to add initial presentation details..."})})]}),(0,O.jsxs)("div",{className:"text-xs text-slate-500 text-right",children:["Last updated: ",M.last_updated?new Date(M.last_updated).toLocaleString():"Never"]})]},"overview"),"narrative"===G&&(0,O.jsx)(H.P.div,{ref:e=>le.current.narrative=e,initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{duration:.3},className:"h-full overflow-y-auto p-6 space-y-6",children:(0,O.jsxs)(H.P.div,{variants:q,animate:te.narrative?"edit":"visible",className:"bg-slate-800/50 backdrop-blur-sm rounded-xl p-6 border border-slate-700",children:[(0,O.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,O.jsxs)("h3",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[(0,O.jsx)(w.A,{size:20,className:"text-blue-400"}),"Narrative Summary"]}),!te.narrative&&(0,O.jsx)(H.P.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:()=>we("narrative"),className:"text-slate-400 hover:text-white transition-colors p-1 rounded",title:"Edit narrative summary",children:(0,O.jsx)(T.A,{size:16})})]}),te.narrative?(0,O.jsxs)(H.P.div,{className:"space-y-4",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},children:[(0,O.jsx)("textarea",{value:(null===(r=se.narrative)||void 0===r?void 0:r.narrative_summary)||M.narrative_summary||"",onChange:e=>Se("narrative","narrative_summary",e.target.value),rows:8,className:"w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-3 text-white placeholder-slate-400 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 resize-none",placeholder:"Enter the narrative summary for this case..."}),(0,O.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,O.jsx)(H.P.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>ke("narrative"),className:"px-3 py-2 text-slate-300 hover:text-white border border-slate-600 rounded-lg hover:bg-slate-700 transition-colors text-sm",children:"Cancel"}),(0,O.jsxs)(H.P.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>Ce("narrative"),disabled:$,className:"px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm flex items-center gap-2",children:[$?(0,O.jsx)(p.A,{size:14,className:"animate-spin"}):(0,O.jsx)(k.A,{size:14}),"Save"]})]})]}):(0,O.jsx)(H.P.div,{className:"text-slate-300 leading-relaxed cursor-pointer hover:bg-slate-700/20 rounded-lg p-4 transition-colors",whileHover:{scale:1.01},transition:{duration:.2},onClick:()=>we("narrative"),children:M.narrative_summary||(0,O.jsx)("span",{className:"text-slate-500 italic",children:"Click to add narrative summary..."})})]})},"narrative"),"medications"===G&&(0,O.jsx)(H.P.div,{ref:e=>le.current.medications=e,initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{duration:.3},className:"h-full overflow-y-auto p-6 space-y-6",children:(0,O.jsxs)(H.P.div,{variants:q,initial:"hidden",animate:"visible",className:"bg-slate-800/50 backdrop-blur-sm rounded-xl p-6 border border-slate-700",children:[(0,O.jsxs)("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[(0,O.jsx)(F.A,{size:20,className:"text-green-400"}),"Current Medications"]}),(0,O.jsx)("div",{className:"space-y-4 mb-6",children:(0,O.jsx)(o.N,{children:(M.medications||[]).map((e,t)=>(0,O.jsx)(H.P.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},className:"bg-green-600/10 border border-green-600/20 rounded-lg p-4 group hover:bg-green-600/15 transition-colors",children:(0,O.jsxs)("div",{className:"flex items-start justify-between",children:[(0,O.jsxs)("div",{className:"flex-1",children:[(0,O.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,O.jsx)("h4",{className:"font-semibold text-green-300",children:e.name}),e.dosage&&(0,O.jsx)("span",{className:"text-xs bg-green-600/20 text-green-300 px-2 py-1 rounded",children:e.dosage})]}),(0,O.jsxs)("div",{className:"space-y-1 text-sm text-slate-300",children:[e.frequency&&(0,O.jsxs)("div",{className:"flex items-center gap-2",children:[(0,O.jsx)(g.A,{size:14,className:"text-green-400"}),(0,O.jsxs)("span",{children:["Frequency: ",e.frequency]})]}),e.effect&&(0,O.jsxs)("div",{className:"flex items-center gap-2",children:[(0,O.jsx)(B.A,{size:14,className:"text-green-400"}),(0,O.jsxs)("span",{children:["Effect: ",e.effect]})]}),e.dateAdded&&(0,O.jsxs)("div",{className:"flex items-center gap-2",children:[(0,O.jsx)(y.A,{size:14,className:"text-green-400"}),(0,O.jsxs)("span",{children:["Added: ",new Date(e.dateAdded).toLocaleDateString()]})]})]})]}),(0,O.jsx)(H.P.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:()=>Ae(e.id),className:"text-green-400 hover:text-green-200 opacity-0 group-hover:opacity-100 transition-opacity p-1 rounded",title:"Remove medication",children:(0,O.jsx)(z.A,{size:16})})]})},e.id||t))})}),de?(0,O.jsxs)(H.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-slate-700/30 rounded-lg p-4 space-y-4",children:[(0,O.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,O.jsxs)("div",{children:[(0,O.jsxs)("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:["Medication Name ",(0,O.jsx)("span",{className:"text-red-400",children:"*"})]}),(0,O.jsx)("input",{type:"text",value:ne.name,onChange:e=>ce(t=>({...t,name:e.target.value})),className:"w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-white placeholder-slate-400 focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"Enter medication name"})]}),(0,O.jsxs)("div",{children:[(0,O.jsx)("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Dosage"}),(0,O.jsx)("input",{type:"text",value:ne.dosage,onChange:e=>ce(t=>({...t,dosage:e.target.value})),className:"w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-white placeholder-slate-400 focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"e.g., 50mg"})]})]}),(0,O.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,O.jsxs)("div",{children:[(0,O.jsx)("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Frequency"}),(0,O.jsx)("input",{type:"text",value:ne.frequency,onChange:e=>ce(t=>({...t,frequency:e.target.value})),className:"w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-white placeholder-slate-400 focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"e.g., Once daily"})]}),(0,O.jsxs)("div",{children:[(0,O.jsx)("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Effect/Notes"}),(0,O.jsx)("input",{type:"text",value:ne.effect,onChange:e=>ce(t=>({...t,effect:e.target.value})),className:"w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-white placeholder-slate-400 focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"e.g., Improved mood"})]})]}),(0,O.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,O.jsx)(H.P.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>{ue(!1),ce({name:"",dosage:"",frequency:"",effect:""})},className:"px-4 py-2 text-slate-300 hover:text-white border border-slate-600 rounded-lg hover:bg-slate-700 transition-colors",children:"Cancel"}),(0,O.jsxs)(H.P.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:_e,disabled:!ne.name.trim(),className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[(0,O.jsx)(N.A,{size:16}),"Add Medication"]})]})]}):(0,O.jsxs)(H.P.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>ue(!0),className:"w-full flex items-center justify-center gap-2 p-4 border-2 border-dashed border-green-600/30 rounded-lg text-green-400 hover:border-green-600/50 hover:bg-green-600/5 transition-colors",children:[(0,O.jsx)(N.A,{size:16}),"Add New Medication"]}),0===(M.medications||[]).length&&!de&&(0,O.jsx)("p",{className:"text-slate-500 italic text-center py-8",children:"No medications documented yet"})]})},"medications"),"therapy"===G&&(0,O.jsx)(H.P.div,{ref:e=>le.current.therapy=e,initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{duration:.3},className:"h-full overflow-y-auto p-6 space-y-6",children:(0,O.jsxs)(H.P.div,{variants:q,animate:te.therapeutic_highlights?"edit":"visible",className:"bg-slate-800/50 backdrop-blur-sm rounded-xl p-6 border border-slate-700",children:[(0,O.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,O.jsxs)("h3",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[(0,O.jsx)(h.A,{size:20,className:"text-purple-400"}),"Therapeutic Highlights"]}),!te.therapeutic_highlights&&(0,O.jsx)(H.P.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:()=>we("therapeutic_highlights"),className:"text-slate-400 hover:text-white transition-colors p-1 rounded",title:"Edit therapeutic highlights",children:(0,O.jsx)(T.A,{size:16})})]}),te.therapeutic_highlights?(0,O.jsxs)(H.P.div,{className:"space-y-4",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},children:[(0,O.jsx)("textarea",{value:(null===(l=se.therapeutic_highlights)||void 0===l?void 0:l.therapeutic_highlights)||M.therapeutic_highlights||"",onChange:e=>Se("therapeutic_highlights","therapeutic_highlights",e.target.value),rows:10,className:"w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-3 text-white placeholder-slate-400 focus:ring-2 focus:ring-purple-500 focus:border-purple-500 resize-none",placeholder:"Enter key therapeutic moments, insights, breakthroughs, or notes on therapy process..."}),(0,O.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,O.jsx)(H.P.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>ke("therapeutic_highlights"),className:"px-3 py-2 text-slate-300 hover:text-white border border-slate-600 rounded-lg hover:bg-slate-700 transition-colors text-sm",children:"Cancel"}),(0,O.jsxs)(H.P.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>Ce("therapeutic_highlights"),disabled:$,className:"px-3 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors text-sm flex items-center gap-2",children:[$?(0,O.jsx)(p.A,{size:14,className:"animate-spin"}):(0,O.jsx)(k.A,{size:14}),"Save"]})]})]}):(0,O.jsx)(H.P.div,{className:"text-slate-300 leading-relaxed cursor-pointer hover:bg-slate-700/20 rounded-lg p-4 transition-colors min-h-[200px]",whileHover:{scale:1.01},transition:{duration:.2},onClick:()=>we("therapeutic_highlights"),children:M.therapeutic_highlights?(0,O.jsx)("div",{className:"whitespace-pre-wrap",children:M.therapeutic_highlights}):(0,O.jsx)("span",{className:"text-slate-500 italic",children:"Click to add therapeutic highlights, key moments, insights, breakthroughs, or therapy process notes..."})})]})},"therapy"),"timeline"===G&&(0,O.jsxs)(H.P.div,{ref:e=>le.current.timeline=e,initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{duration:.3},className:"h-full overflow-hidden p-6",children:[(0,O.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,O.jsxs)("h3",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[(0,O.jsx)(g.A,{size:20,className:"text-cyan-400"}),"Case Timeline"]}),(0,O.jsxs)("div",{className:"flex gap-2",children:[(0,O.jsxs)(H.P.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:De,className:"px-3 py-1 bg-cyan-600/20 text-cyan-300 border border-cyan-600/30 rounded-lg hover:bg-cyan-600/30 transition-colors text-sm flex items-center gap-1",children:[(0,O.jsx)(B.A,{size:14}),"Scroll to Latest"]}),(0,O.jsxs)(H.P.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>{xe(!0),Ee()},disabled:he,className:"px-3 py-1 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm flex items-center gap-1 disabled:opacity-50 disabled:cursor-not-allowed",children:[(0,O.jsx)(N.A,{size:14}),"Add Entry"]})]})]}),(0,O.jsxs)("div",{className:"relative h-full",children:[(0,O.jsx)("div",{className:"absolute top-0 left-0 right-0 h-6 bg-gradient-to-b from-slate-900 to-transparent z-10 pointer-events-none"}),(0,O.jsx)("div",{className:"absolute bottom-0 left-0 right-0 h-6 bg-gradient-to-t from-slate-900 to-transparent z-10 pointer-events-none"}),(0,O.jsx)("div",{ref:ye,className:"h-full overflow-y-auto timeline-scroll pr-2",children:(0,O.jsxs)("div",{className:"relative",children:[(0,O.jsx)("div",{className:"absolute left-6 top-0 bottom-0 w-0.5 bg-gradient-to-b from-cyan-500 via-purple-500 to-cyan-500 opacity-30"}),(0,O.jsxs)("div",{className:"space-y-4",children:[(0,O.jsx)(o.N,{children:(M.timeline||[]).map((e,t)=>(0,O.jsxs)(H.P.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{duration:.3,delay:.05*t},className:"relative",children:[(0,O.jsx)("div",{className:`absolute left-5 w-3 h-3 rounded-full border-2 ${Te(e.type)} bg-slate-900 z-10`}),(0,O.jsx)("div",{className:"ml-12 pb-4",children:ge===e.id?(0,O.jsx)(V,{entry:e,onSave:t=>Pe(e.id,t),onCancel:()=>be(null)}):(0,O.jsxs)(H.P.div,{className:`bg-slate-800/50 backdrop-blur-sm rounded-xl p-4 border-l-4 ${Te(e.type)} border border-slate-700 cursor-pointer hover:bg-slate-700/50 transition-colors group`,whileHover:{scale:1.01},transition:{duration:.2},onClick:()=>be(e.id),children:[(0,O.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,O.jsxs)("div",{className:"flex items-center gap-2",children:[(0,O.jsx)("span",{className:"text-xs font-medium px-2 py-1 rounded "+("Assessment"===e.type?"bg-green-600/20 text-green-300":"Medication"===e.type?"bg-blue-600/20 text-blue-300":"Therapy"===e.type?"bg-purple-600/20 text-purple-300":"Follow-up"===e.type?"bg-orange-600/20 text-orange-300":"bg-gray-600/20 text-gray-300"),children:e.type}),(0,O.jsx)("span",{className:"text-xs text-slate-400",children:new Date(e.timestamp).toLocaleString()})]}),(0,O.jsx)(H.P.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:t=>{t.stopPropagation(),Oe(e.id)},className:"opacity-0 group-hover:opacity-100 text-red-400 hover:text-red-300 p-1 transition-opacity",children:(0,O.jsx)(z.A,{size:14})})]}),(0,O.jsx)("div",{className:"text-slate-300 text-sm leading-relaxed",children:e.content}),e.author&&(0,O.jsxs)("div",{className:"text-xs text-slate-500 mt-2",children:["by ",e.author]})]})})]},e.id))}),he&&(0,O.jsxs)(H.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},className:"relative",children:[(0,O.jsx)("div",{className:"absolute left-5 w-3 h-3 rounded-full border-2 border-cyan-500 bg-slate-900 z-10 animate-pulse"}),(0,O.jsx)("div",{className:"ml-12",children:(0,O.jsx)(W,{entry:pe,onChange:me,onSave:ze,onCancel:()=>{xe(!1),me({type:"Assessment",timestamp:(new Date).toISOString().slice(0,16),content:"",author:"Current User"})},isNew:!0})})]}),0===(M.timeline||[]).length&&!he&&(0,O.jsxs)(H.P.div,{initial:{opacity:0},animate:{opacity:1},className:"text-center py-12",children:[(0,O.jsx)(g.A,{size:48,className:"mx-auto text-slate-600 mb-4"}),(0,O.jsx)("p",{className:"text-slate-500 mb-4",children:"No timeline entries yet"}),(0,O.jsxs)(H.P.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>xe(!0),className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center gap-2 mx-auto",children:[(0,O.jsx)(N.A,{size:16}),"Add First Entry"]})]})]})]})})]})]},"timeline"),"related"===G&&(0,O.jsx)(H.P.div,{ref:e=>le.current.related=e,initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{duration:.3},className:"h-full overflow-y-auto p-6 space-y-6",children:(0,O.jsxs)(H.P.div,{variants:q,initial:"hidden",animate:"visible",className:"bg-slate-800/50 backdrop-blur-sm rounded-xl p-6 border border-slate-700",children:[(0,O.jsxs)("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[(0,O.jsx)(R.A,{size:20,className:"text-cyan-400"}),"Connected Nodes"]}),(0,O.jsxs)("div",{className:"mb-6",children:[(0,O.jsxs)("h4",{className:"text-md font-medium text-slate-300 mb-3 flex items-center gap-2",children:[(0,O.jsx)(h.A,{size:16,className:"text-blue-400"}),"Related Topics"]}),Me.topics.length>0?(0,O.jsx)("div",{className:"space-y-2",children:Me.topics.map((e,t)=>(0,O.jsxs)("div",{className:"flex items-center gap-3 p-3 bg-blue-600/10 border border-blue-600/20 rounded-lg",children:[(0,O.jsx)(h.A,{size:16,className:"text-blue-400"}),(0,O.jsx)("span",{className:"text-blue-300",children:e.title})]},t))}):(0,O.jsx)("p",{className:"text-slate-500 italic text-sm",children:"No connected topics"})]}),(0,O.jsxs)("div",{className:"mb-6",children:[(0,O.jsxs)("h4",{className:"text-md font-medium text-slate-300 mb-3 flex items-center gap-2",children:[(0,O.jsx)(f.A,{size:16,className:"text-purple-400"}),"Related Literature"]}),Me.literature.length>0?(0,O.jsx)("div",{className:"space-y-2",children:Me.literature.map((e,t)=>(0,O.jsxs)("div",{className:"flex items-center gap-3 p-3 bg-purple-600/10 border border-purple-600/20 rounded-lg",children:[(0,O.jsx)(f.A,{size:16,className:"text-purple-400"}),(0,O.jsx)("span",{className:"text-purple-300",children:e.title})]},t))}):(0,O.jsx)("p",{className:"text-slate-500 italic text-sm",children:"No connected literature"})]}),(0,O.jsxs)("div",{children:[(0,O.jsxs)("h4",{className:"text-md font-medium text-slate-300 mb-3 flex items-center gap-2",children:[(0,O.jsx)(b.A,{size:16,className:"text-green-400"}),"Related Cases"]}),Me.cases.length>0?(0,O.jsx)("div",{className:"space-y-2",children:Me.cases.map((e,t)=>(0,O.jsxs)("div",{className:"flex items-center gap-3 p-3 bg-green-600/10 border border-green-600/20 rounded-lg",children:[(0,O.jsx)(b.A,{size:16,className:"text-green-400"}),(0,O.jsx)("span",{className:"text-green-300",children:e.title})]},t))}):(0,O.jsx)("p",{className:"text-slate-500 italic text-sm",children:"No connected cases"})]}),(0,O.jsx)("div",{className:"mt-6 p-4 bg-slate-700/20 rounded-lg border border-slate-600",children:(0,O.jsx)("p",{className:"text-slate-400 text-sm italic",children:"Connected nodes will be automatically populated based on mind map relationships and connections created in the graph view."})})]})},"related")]})})]})},`case-modal-${(null===c||void 0===c?void 0:c.id)||"default"}`)}):null};var G=a(4935),Q=a(2382),Z=a(8326);const ee={hidden:{opacity:0,scale:.3,y:50,rotate:-5},visible:{opacity:1,scale:1,y:0,rotate:0,transition:{type:"spring",damping:25,stiffness:300,duration:.6}},exit:{opacity:0,scale:.7,y:30,rotate:-3,transition:{type:"easeInOut",duration:.4}}},te={hidden:{opacity:0,backdropFilter:"blur(0px)"},visible:{opacity:1,backdropFilter:"blur(8px)",transition:{duration:.4,ease:"easeOut"}},exit:{opacity:0,backdropFilter:"blur(0px)",transition:{duration:.3,ease:"easeIn"}}},ae={hidden:{opacity:0,y:20,scale:.95},visible:{opacity:1,y:0,scale:1,transition:{type:"easeOut",duration:.3,delay:.1}},exit:{opacity:0,y:-10,scale:1.02,transition:{type:"easeIn",duration:.2}}},se={hidden:{opacity:0,y:20,scale:.95},visible:{opacity:1,y:0,scale:1,transition:{duration:.4,ease:"easeOut"}},edit:{scale:1.02,boxShadow:"0 8px 25px rgba(59, 130, 246, 0.15)",transition:{duration:.3,ease:"easeOut"}},saved:{scale:1,boxShadow:"0 4px 15px rgba(34, 197, 94, 0.15)",transition:{duration:.3,ease:"easeOut"}}},ie=e=>{var t,a,i,r;let{isOpen:l,data:n,onClose:c,onAnimationStart:d,onAnimationEnd:u,setMindMapData:x,autoSaveMindMapData:g,addToast:y,syncNodeData:v,forceNodeUpdate:j}=e;const[C,S]=(0,s.useState)(!1),[_,A]=(0,s.useState)(!1),[z,P]=(0,s.useState)(!1),[D,E]=(0,s.useState)({}),[M,I]=(0,s.useState)(!1),[$,L]=(0,s.useState)(!1),[X,Y]=(0,s.useState)("overview"),[U,J]=(0,s.useState)(!1),[q,W]=(0,s.useState)({}),[V,K]=(0,s.useState)({}),[ie,re]=(0,s.useState)({}),oe=(0,s.useRef)({}),[le,ne]=(0,s.useState)(!1),[ce,de]=(0,s.useState)({}),[ue,pe]=(0,s.useState)(""),[me,he]=(0,s.useState)(!1),xe={"Mood Disorders":{primary:"#ef4444",secondary:"#fca5a5"},"Anxiety Disorders":{primary:"#f59e0b",secondary:"#fbbf24"},"Psychotic Disorders":{primary:"#8b5cf6",secondary:"#c4b5fd"},"Personality Disorders":{primary:"#10b981",secondary:"#6ee7b7"},"Neurodevelopmental Disorders":{primary:"#3b82f6",secondary:"#93c5fd"},"Trauma Related Disorders":{primary:"#dc2626",secondary:"#f87171"},"Substance Use Disorders":{primary:"#059669",secondary:"#34d399"},"Eating Disorders":{primary:"#d946ef",secondary:"#e879f9"},"Sleep Disorders":{primary:"#6366f1",secondary:"#a5b4fc"},"Cognitive Disorders":{primary:"#ea580c",secondary:"#fb923c"},Other:{primary:"#6b7280",secondary:"#9ca3af"}},ge=[{id:"overview",label:"Overview",icon:f.A},{id:"concept",label:"Concept",icon:h.A},{id:"clinical",label:"Clinical Associations",icon:G.A},{id:"treatment",label:"Treatment",icon:F.A},{id:"connections",label:"Connections",icon:R.A}];(0,s.useEffect)(()=>{if(l&&n&&!$){A(!0);const e={...n,category:n.category||"Other",definition:n.definition||"",diagnostic_criteria:n.diagnostic_criteria||[],comorbidities:n.comorbidities||[],differential_diagnoses:n.differential_diagnoses||[],medications:n.medications||[],psychotherapy_modalities:n.psychotherapy_modalities||[],flashcard_count:n.flashcard_count||0,completed_flashcards:n.completed_flashcards||0,last_updated:n.last_updated||(new Date).toISOString()};E(e),L(!0),S(!0),d&&d(),setTimeout(()=>{S(!1),u&&u()},600)}else!l&&$&&(L(!1),re({}),W({}),K({}))},[l,n,$,d,u]),(0,s.useEffect)(()=>{l&&n&&$&&E(e=>({...e,...n,category:n.category||e.category||"Other",definition:n.definition||e.definition||"",diagnostic_criteria:n.diagnostic_criteria||e.diagnostic_criteria||[],comorbidities:n.comorbidities||e.comorbidities||[],differential_diagnoses:n.differential_diagnoses||e.differential_diagnoses||[],medications:n.medications||e.medications||[],psychotherapy_modalities:n.psychotherapy_modalities||e.psychotherapy_modalities||[],flashcard_count:n.flashcard_count||e.flashcard_count||0,completed_flashcards:n.completed_flashcards||e.completed_flashcards||0,last_updated:n.last_updated||e.last_updated||(new Date).toISOString()}))},[n,l,$]);const be=(0,s.useMemo)(()=>{const e=D.flashcard_count||0,t=D.completed_flashcards||0;return e>0?Math.round(t/e*100):0},[D.flashcard_count,D.completed_flashcards]),ye=(0,s.useCallback)(()=>{C||z||(S(!0),P(!0),d&&d(),A(!1))},[d,C,z]),ve=((0,s.useCallback)(async()=>{if(!M){I(!0);try{const e={...D,last_updated:(new Date).toISOString()};x(t=>{const a=t.topics.map(t=>String(t.id)===String(null===n||void 0===n?void 0:n.id)?{...t,...e}:t),s={...t,topics:a};return g(s),s}),E(e),y("Topic updated successfully","success")}catch(e){console.error("Error saving topic:",e),y("Failed to save topic","error")}finally{I(!1)}}},[null===n||void 0===n?void 0:n.id,D,x,g,y,M]),(0,s.useCallback)(e=>{const t=oe.current[e];t&&re(a=>({...a,[e]:t.scrollTop}))},[])),fe=(0,s.useCallback)(e=>{setTimeout(()=>{const t=oe.current[e],a=ie[e];t&&a&&(t.scrollTop=a)},100)},[ie]),je=(0,s.useCallback)(e=>{e===X||U||(ve(X),J(!0),Y(e),setTimeout(()=>{J(!1),fe(e)},300))},[X,U,ve,fe]),Ne=(0,s.useCallback)(async e=>{var t;console.log("Category changing to:",e);const a=(null===(t=xe[e])||void 0===t?void 0:t.primary)||xe.Other.primary;console.log("New color for category:",a);const s={...D,category:e,color:a,last_updated:(new Date).toISOString()};E(s),x(t=>{const s=t.topics.map(t=>String(t.id)===String(null===n||void 0===n?void 0:n.id)?{...t,category:e,color:a,last_updated:(new Date).toISOString()}:t),i={...t,topics:s};return console.log("Saving category change to backend:",e,a),g(i),setTimeout(()=>{console.log("Triggering force node update"),j&&j(),v&&v()},200),i}),y(`Category updated to ${e}`,"success")},[null===n||void 0===n?void 0:n.id,D,x,xe,g,y,v,j]),we=((0,s.useMemo)(()=>(null!==n&&void 0!==n&&n.id,{cases:[],literature:[]}),[null===n||void 0===n?void 0:n.id]),(0,s.useCallback)(async()=>{if(!M&&window.confirm("Are you sure you want to delete this topic?")){I(!0);try{x(e=>{const t=e.topics.filter(e=>String(e.id)!==String(null===n||void 0===n?void 0:n.id)),a={...e,topics:t};return g(a),a}),y("Topic deleted successfully","success"),ye()}catch(e){console.error("Error deleting topic:",e),y("Failed to delete topic","error")}finally{I(!1)}}},[null===n||void 0===n?void 0:n.id,x,g,y,ye,M]),(0,s.useCallback)(e=>{W(t=>({...t,[e]:!0})),K(t=>({...t,[e]:{...D}}))},[D])),ke=(0,s.useCallback)(e=>{W(t=>({...t,[e]:!1})),K(t=>{const a={...t};return delete a[e],a})},[]),Ce=(0,s.useCallback)(async e=>{if(M)return;const t=V[e];if(t){I(!0);try{const a={...D,...t,last_updated:(new Date).toISOString()};E(a),x(e=>{const t=e.topics.map(e=>String(e.id)===String(null===n||void 0===n?void 0:n.id)?{...e,...a}:e),s={...e,topics:t};return g(s),s}),W(t=>({...t,[e]:!1})),K(t=>{const a={...t};return delete a[e],a}),y("Section updated successfully","success")}catch(a){console.error("Error saving section:",a),y("Failed to save section","error")}finally{I(!1)}}},[V,D,null===n||void 0===n?void 0:n.id,x,g,y,M]),Se=(0,s.useCallback)((e,t,a)=>{K(s=>({...s,[e]:{...s[e],[t]:a}}))},[]),_e=((0,s.useCallback)((e,t,a)=>{var s;if(!a.trim())return;const i=(null===(s=V[e])||void 0===s?void 0:s[t])||D[t]||[];i.includes(a.trim())||Se(e,t,[...i,a.trim()])},[V,D,Se]),(0,s.useCallback)((e,t,a)=>{var s;const i=(null===(s=V[e])||void 0===s?void 0:s[t])||D[t]||[];Se(e,t,i.filter(e=>e!==a))},[V,D,Se]),(0,s.useCallback)((e,t)=>{de(a=>({...a,[e]:t}))},[])),Ae=(0,s.useCallback)(e=>ce[e]||"",[ce]),Te=(0,s.useCallback)(e=>{de(t=>{const a={...t};return delete a[e],a})},[]),ze=(0,s.useCallback)((e,t)=>{if(!t.trim())return;const a=D[e]||[];if(!a.includes(t.trim())){const s=[...a,t.trim()],i={...D,[e]:s,last_updated:(new Date).toISOString()};E(i),x(e=>{const t=e.topics.map(e=>String(e.id)===String(null===n||void 0===n?void 0:n.id)?{...e,...i}:e),a={...e,topics:t};return g(a),a}),y(`${e} updated successfully`,"success")}},[D,null===n||void 0===n?void 0:n.id,x,g,y]),Pe=(0,s.useCallback)((e,t)=>{const a=(D[e]||[]).filter(e=>e!==t),s={...D,[e]:a,last_updated:(new Date).toISOString()};E(s),x(e=>{const t=e.topics.map(e=>String(e.id)===String(null===n||void 0===n?void 0:n.id)?{...e,...s}:e),a={...e,topics:t};return g(a),a}),y(`${e} updated successfully`,"success")},[D,null===n||void 0===n?void 0:n.id,x,g,y]);return l?(0,O.jsx)(o.N,{mode:"wait",onExitComplete:()=>{S(!1),P(!1),L(!1),c(),u&&u()},children:_&&(0,O.jsx)(H.P.div,{initial:"hidden",animate:"visible",exit:"exit",variants:te,className:"fixed inset-0 bg-black flex items-center justify-center z-50",style:{willChange:"backdrop-filter, opacity",backfaceVisibility:"hidden",transform:"translate3d(0, 0, 0)"},onClick:e=>e.target===e.currentTarget&&ye(),children:(0,O.jsxs)(H.P.div,{initial:"hidden",animate:"visible",exit:"exit",variants:ee,className:"bg-white rounded-2xl shadow-2xl max-w-4xl w-full mx-4 max-h-[85vh] overflow-hidden",style:{willChange:"transform, opacity, scale",backfaceVisibility:"hidden"},onClick:e=>e.stopPropagation(),onAnimationStart:()=>{S(!0),d&&d()},onAnimationComplete:()=>{S(!1),u&&u()},children:[(0,O.jsxs)(H.P.div,{initial:"hidden",animate:"visible",exit:"exit",variants:ae,className:"bg-gradient-to-br from-slate-900 to-slate-800 text-white px-6 py-4 flex items-center justify-between",children:[(0,O.jsxs)("div",{className:"flex items-center gap-3",children:[(0,O.jsx)(f.A,{size:24}),(0,O.jsx)("h2",{className:"text-xl font-semibold",children:"Topic Details"})]}),(0,O.jsx)("button",{onClick:ye,className:"text-slate-400 hover:text-white transition-colors",children:(0,O.jsx)(m.A,{size:24})})]}),(0,O.jsx)("div",{className:"bg-gradient-to-r from-slate-900 via-slate-800 to-slate-900 border-b border-slate-600",children:(0,O.jsx)("nav",{className:"flex flex-wrap gap-2 px-6 py-4",children:ge.map(e=>{let{id:t,label:a,icon:s}=e;return(0,O.jsxs)(H.P.button,{onClick:()=>je(t),className:"relative flex items-center gap-2 px-4 py-3 rounded-xl font-medium text-sm transition-all duration-300 "+(X===t?"bg-gradient-to-r from-purple-500 to-indigo-600 text-white shadow-lg shadow-purple-500/25":"text-slate-300 hover:text-white hover:bg-slate-700/50 hover:shadow-md"),whileHover:{scale:X===t?1:1.02},whileTap:{scale:.98},disabled:U,children:[(0,O.jsx)(s,{size:16,className:X===t?"drop-shadow-sm":""}),a,X===t&&(0,O.jsx)(H.P.div,{layoutId:"topicActiveTab",className:"absolute inset-0 bg-gradient-to-r from-purple-400/20 to-indigo-500/20 rounded-xl blur-sm",initial:!1,transition:{duration:.3,ease:"easeOut"}})]},t)})})}),(0,O.jsx)(H.P.div,{className:"flex-1 bg-gradient-to-br from-slate-900 to-slate-800 overflow-hidden",animate:{opacity:U?.7:1},transition:{duration:.2},children:(0,O.jsxs)(o.N,{mode:"wait",children:["overview"===X&&(0,O.jsxs)(H.P.div,{ref:e=>oe.current.overview=e,initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{duration:.3},className:"h-full overflow-y-auto p-6 space-y-6",children:[(0,O.jsxs)(H.P.div,{variants:se,animate:q.title?"edit":"visible",className:"bg-slate-800/50 backdrop-blur-sm rounded-xl p-6 border border-slate-700",children:[(0,O.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,O.jsx)("h3",{className:"text-lg font-semibold text-white",children:"Title"}),!q.title&&(0,O.jsx)(H.P.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:()=>we("title"),className:"text-slate-400 hover:text-white transition-colors p-1 rounded",title:"Edit title",children:(0,O.jsx)(T.A,{size:16})})]}),q.title?(0,O.jsxs)(H.P.div,{className:"space-y-4",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},children:[(0,O.jsx)("input",{type:"text",value:(null===(t=V.title)||void 0===t?void 0:t.title)||D.title||"",onChange:e=>Se("title","title",e.target.value),className:"w-full text-xl font-bold bg-slate-700 border border-slate-600 rounded-lg px-4 py-3 text-white placeholder-slate-400 focus:ring-2 focus:ring-purple-500 focus:border-purple-500",placeholder:"Topic title..."}),(0,O.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,O.jsx)(H.P.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>ke("title"),className:"px-3 py-2 text-slate-300 hover:text-white border border-slate-600 rounded-lg hover:bg-slate-700 transition-colors text-sm",children:"Cancel"}),(0,O.jsxs)(H.P.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>Ce("title"),disabled:M,className:"px-3 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors text-sm flex items-center gap-2",children:[M?(0,O.jsx)(p.A,{size:14,className:"animate-spin"}):(0,O.jsx)(k.A,{size:14}),"Save"]})]})]}):(0,O.jsx)(H.P.h1,{className:"text-2xl font-bold text-white",whileHover:{scale:1.01},transition:{duration:.2},children:D.title||"Untitled Topic"})]}),(0,O.jsxs)("div",{className:"grid md:grid-cols-2 gap-6",children:[(0,O.jsxs)(H.P.div,{variants:se,initial:"hidden",animate:"visible",className:"bg-slate-800/50 backdrop-blur-sm rounded-xl p-6 border border-slate-700",children:[(0,O.jsx)("label",{className:"block text-sm font-medium text-slate-300 mb-3",children:"Category"}),(0,O.jsx)(H.P.select,{value:D.category||"Other",onChange:e=>Ne(e.target.value),className:"w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-3 text-white focus:ring-2 focus:ring-purple-500 focus:border-purple-500 hover:bg-slate-650 transition-colors cursor-pointer",whileFocus:{scale:1.02},children:Object.keys(xe).map(e=>(0,O.jsx)("option",{value:e,children:e},e))}),(0,O.jsx)("p",{className:"text-xs text-slate-400 mt-2",children:"Changes are saved automatically and will update the node color"})]}),(0,O.jsxs)(H.P.div,{variants:se,initial:"hidden",animate:"visible",className:"bg-slate-800/50 backdrop-blur-sm rounded-xl p-6 border border-slate-700",children:[(0,O.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,O.jsx)("span",{className:"text-sm font-medium text-slate-300",children:"Flashcard Progress"}),(0,O.jsxs)("span",{className:"text-sm text-slate-400",children:[D.completed_flashcards||0," / ",D.flashcard_count||0]})]}),(0,O.jsx)("div",{className:"w-full bg-slate-700 rounded-full h-3 mb-2",children:(0,O.jsx)(H.P.div,{className:"h-3 rounded-full bg-gradient-to-r from-purple-500 to-indigo-600",initial:{width:0},animate:{width:`${be}%`},transition:{duration:1,ease:"easeOut"}})}),(0,O.jsxs)("div",{className:"text-right",children:[(0,O.jsxs)("span",{className:"text-lg font-bold text-white",children:[be,"%"]}),(0,O.jsx)("span",{className:"text-sm text-slate-400 ml-1",children:"complete"})]})]})]}),(0,O.jsxs)("div",{className:"text-xs text-slate-500 text-right",children:["Last updated: ",D.last_updated?new Date(D.last_updated).toLocaleString():"Never"]})]},"overview"),"concept"===X&&(0,O.jsxs)(H.P.div,{ref:e=>oe.current.concept=e,initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{duration:.3},className:"h-full overflow-y-auto p-6 space-y-6",children:[(0,O.jsxs)(H.P.div,{variants:se,animate:q.definition?"edit":"visible",className:"bg-slate-800/50 backdrop-blur-sm rounded-xl p-6 border border-slate-700",children:[(0,O.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,O.jsxs)("h3",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[(0,O.jsx)(h.A,{size:20,className:"text-purple-400"}),"Definition"]}),!q.definition&&(0,O.jsx)(H.P.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:()=>we("definition"),className:"text-slate-400 hover:text-white transition-colors p-1 rounded",title:"Edit definition",children:(0,O.jsx)(T.A,{size:16})})]}),q.definition?(0,O.jsxs)(H.P.div,{className:"space-y-4",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},children:[(0,O.jsx)("textarea",{value:(null===(a=V.definition)||void 0===a?void 0:a.definition)||D.definition||"",onChange:e=>Se("definition","definition",e.target.value),rows:4,className:"w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-3 text-white placeholder-slate-400 focus:ring-2 focus:ring-purple-500 focus:border-purple-500 resize-none",placeholder:"Enter the definition of this topic..."}),(0,O.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,O.jsx)(H.P.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>ke("definition"),className:"px-3 py-2 text-slate-300 hover:text-white border border-slate-600 rounded-lg hover:bg-slate-700 transition-colors text-sm",children:"Cancel"}),(0,O.jsxs)(H.P.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>Ce("definition"),disabled:M,className:"px-3 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors text-sm flex items-center gap-2",children:[M?(0,O.jsx)(p.A,{size:14,className:"animate-spin"}):(0,O.jsx)(k.A,{size:14}),"Save"]})]})]}):(0,O.jsx)(H.P.div,{className:"text-slate-300 leading-relaxed",whileHover:{scale:1.01},transition:{duration:.2},children:D.definition||(0,O.jsx)("span",{className:"text-slate-500 italic",children:"No definition provided"})})]}),(0,O.jsxs)(H.P.div,{variants:se,animate:q.diagnostic_criteria?"edit":"visible",className:"bg-slate-800/50 backdrop-blur-sm rounded-xl p-6 border border-slate-700",children:[(0,O.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,O.jsxs)("h3",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[(0,O.jsx)(w.A,{size:20,className:"text-indigo-400"}),"Diagnostic Criteria"]}),(0,O.jsxs)("div",{className:"flex items-center gap-2",children:[!q.diagnostic_criteria&&(0,O.jsx)(H.P.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:()=>we("diagnostic_criteria"),className:"text-slate-400 hover:text-white transition-colors p-1 rounded",title:"Edit diagnostic criteria",children:(0,O.jsx)(T.A,{size:16})}),(0,O.jsx)("button",{onClick:()=>ne(!le),className:"text-slate-400 hover:text-white transition-colors",children:le?(0,O.jsx)(Q.A,{size:20}):(0,O.jsx)(Z.A,{size:20})})]})]}),(0,O.jsx)(o.N,{children:le&&(0,O.jsx)(H.P.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3},className:"overflow-hidden",children:q.diagnostic_criteria?(0,O.jsxs)("div",{className:"space-y-4",children:[(0,O.jsx)("textarea",{value:Array.isArray(null===(i=V.diagnostic_criteria)||void 0===i?void 0:i.diagnostic_criteria)?V.diagnostic_criteria.diagnostic_criteria.join("\n"):Array.isArray(D.diagnostic_criteria)?D.diagnostic_criteria.join("\n"):D.diagnostic_criteria||"",onChange:e=>Se("diagnostic_criteria","diagnostic_criteria",e.target.value.split("\n").filter(e=>e.trim())),rows:6,className:"w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-3 text-white placeholder-slate-400 focus:ring-2 focus:ring-purple-500 focus:border-purple-500 resize-none",placeholder:"Enter diagnostic criteria (one per line)..."}),(0,O.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,O.jsx)("button",{onClick:()=>ke("diagnostic_criteria"),className:"px-3 py-2 text-slate-300 hover:text-white border border-slate-600 rounded-lg hover:bg-slate-700 transition-colors text-sm",children:"Cancel"}),(0,O.jsxs)(H.P.button,{onClick:()=>Ce("diagnostic_criteria"),disabled:M,className:"px-3 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors text-sm flex items-center gap-2",children:[M?(0,O.jsx)(p.A,{size:14,className:"animate-spin"}):(0,O.jsx)(k.A,{size:14}),"Save"]})]})]}):(0,O.jsx)("div",{className:"space-y-2",children:(D.diagnostic_criteria||[]).length>0?D.diagnostic_criteria.map((e,t)=>(0,O.jsxs)("div",{className:"flex items-start gap-3",children:[(0,O.jsxs)("span",{className:"text-purple-400 font-medium",children:[t+1,"."]}),(0,O.jsx)("span",{className:"text-slate-300",children:e})]},t)):(0,O.jsx)("span",{className:"text-slate-500 italic",children:"No diagnostic criteria provided"})})})})]})]},"concept"),"clinical"===X&&(0,O.jsxs)(H.P.div,{ref:e=>oe.current.clinical=e,initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{duration:.3},className:"h-full overflow-y-auto p-6 space-y-6",children:[(0,O.jsxs)(H.P.div,{variants:se,initial:"hidden",animate:"visible",className:"bg-slate-800/50 backdrop-blur-sm rounded-xl p-6 border border-slate-700",children:[(0,O.jsxs)("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[(0,O.jsx)(b.A,{size:20,className:"text-amber-400"}),"Comorbidities"]}),(0,O.jsx)("div",{className:"space-y-2 mb-4",children:(0,O.jsx)(o.N,{children:(D.comorbidities||[]).map((e,t)=>(0,O.jsxs)(H.P.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},className:"flex items-center justify-between p-3 bg-amber-600/10 rounded-lg border border-amber-600/20 group hover:bg-amber-600/15 transition-colors",children:[(0,O.jsx)("span",{className:"text-amber-300",children:e}),(0,O.jsx)(H.P.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:()=>Pe("comorbidities",e),className:"text-amber-400 hover:text-amber-200 opacity-0 group-hover:opacity-100 transition-opacity p-1 rounded",title:"Remove comorbidity",children:(0,O.jsx)(m.A,{size:16})})]},t))})}),(0,O.jsxs)("div",{className:"flex gap-2",children:[(0,O.jsx)("input",{type:"text",value:Ae("comorbidities"),onChange:e=>_e("comorbidities",e.target.value),placeholder:"Add comorbidity...",className:"flex-1 bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-white placeholder-slate-400 focus:ring-2 focus:ring-amber-500 focus:border-amber-500 transition-colors",onKeyPress:e=>{"Enter"===e.key&&Ae("comorbidities").trim()&&(ze("comorbidities",Ae("comorbidities")),Te("comorbidities"))}}),(0,O.jsxs)(H.P.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>{Ae("comorbidities").trim()&&(ze("comorbidities",Ae("comorbidities")),Te("comorbidities"))},className:"px-4 py-2 bg-amber-600 text-white rounded-lg hover:bg-amber-700 transition-colors flex items-center gap-2",children:[(0,O.jsx)(N.A,{size:16}),"Add"]})]}),0===(D.comorbidities||[]).length&&(0,O.jsx)("p",{className:"text-slate-500 italic text-center py-4",children:"No comorbidities added yet"})]}),(0,O.jsxs)(H.P.div,{variants:se,initial:"hidden",animate:"visible",className:"bg-slate-800/50 backdrop-blur-sm rounded-xl p-6 border border-slate-700",children:[(0,O.jsxs)("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[(0,O.jsx)(B.A,{size:20,className:"text-cyan-400"}),"Differential Diagnoses"]}),(0,O.jsx)("div",{className:"space-y-2 mb-4",children:(0,O.jsx)(o.N,{children:(D.differential_diagnoses||[]).map((e,t)=>(0,O.jsxs)(H.P.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},className:"flex items-center justify-between p-3 bg-cyan-600/10 rounded-lg border border-cyan-600/20 group hover:bg-cyan-600/15 transition-colors",children:[(0,O.jsx)("span",{className:"text-cyan-300",children:e}),(0,O.jsx)(H.P.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:()=>Pe("differential_diagnoses",e),className:"text-cyan-400 hover:text-cyan-200 opacity-0 group-hover:opacity-100 transition-opacity p-1 rounded",title:"Remove differential diagnosis",children:(0,O.jsx)(m.A,{size:16})})]},t))})}),(0,O.jsxs)("div",{className:"flex gap-2",children:[(0,O.jsx)("input",{type:"text",value:Ae("differential_diagnoses"),onChange:e=>_e("differential_diagnoses",e.target.value),placeholder:"Add differential diagnosis...",className:"flex-1 bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-white placeholder-slate-400 focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500 transition-colors",onKeyPress:e=>{"Enter"===e.key&&Ae("differential_diagnoses").trim()&&(ze("differential_diagnoses",Ae("differential_diagnoses")),Te("differential_diagnoses"))}}),(0,O.jsxs)(H.P.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>{Ae("differential_diagnoses").trim()&&(ze("differential_diagnoses",Ae("differential_diagnoses")),Te("differential_diagnoses"))},className:"px-4 py-2 bg-cyan-600 text-white rounded-lg hover:bg-cyan-700 transition-colors flex items-center gap-2",children:[(0,O.jsx)(N.A,{size:16}),"Add"]})]}),0===(D.differential_diagnoses||[]).length&&(0,O.jsx)("p",{className:"text-slate-500 italic text-center py-4",children:"No differential diagnoses added yet"})]})]},"clinical"),"treatment"===X&&(0,O.jsxs)(H.P.div,{ref:e=>oe.current.treatment=e,initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{duration:.3},className:"h-full overflow-y-auto p-6 space-y-6",children:[(0,O.jsxs)(H.P.div,{variants:se,initial:"hidden",animate:"visible",className:"bg-slate-800/50 backdrop-blur-sm rounded-xl p-6 border border-slate-700",children:[(0,O.jsxs)("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[(0,O.jsx)(F.A,{size:20,className:"text-green-400"}),"Medications"]}),(0,O.jsx)("div",{className:"space-y-2 mb-4",children:(0,O.jsx)(o.N,{children:(D.medications||[]).map((e,t)=>(0,O.jsxs)(H.P.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},className:"flex items-center justify-between p-3 bg-green-600/10 rounded-lg border border-green-600/20 group hover:bg-green-600/15 transition-colors",children:[(0,O.jsx)("span",{className:"text-green-300",children:e}),(0,O.jsx)(H.P.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:()=>Pe("medications",e),className:"text-green-400 hover:text-green-200 opacity-0 group-hover:opacity-100 transition-opacity p-1 rounded",title:"Remove medication",children:(0,O.jsx)(m.A,{size:16})})]},t))})}),(0,O.jsxs)("div",{className:"flex gap-2",children:[(0,O.jsx)("input",{type:"text",value:Ae("medications"),onChange:e=>_e("medications",e.target.value),placeholder:"Add medication...",className:"flex-1 bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-white placeholder-slate-400 focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-colors",onKeyPress:e=>{"Enter"===e.key&&Ae("medications").trim()&&(ze("medications",Ae("medications")),Te("medications"))}}),(0,O.jsxs)(H.P.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>{Ae("medications").trim()&&(ze("medications",Ae("medications")),Te("medications"))},className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center gap-2",children:[(0,O.jsx)(N.A,{size:16}),"Add"]})]}),0===(D.medications||[]).length&&(0,O.jsx)("p",{className:"text-slate-500 italic text-center py-4",children:"No medications added yet"})]}),(0,O.jsxs)(H.P.div,{variants:se,animate:q.psychotherapy_modalities?"edit":"visible",className:"bg-slate-800/50 backdrop-blur-sm rounded-xl p-6 border border-slate-700",children:[(0,O.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,O.jsxs)("h3",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[(0,O.jsx)(h.A,{size:20,className:"text-purple-400"}),"Psychotherapy Modalities"]}),!q.psychotherapy_modalities&&(0,O.jsx)(H.P.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:()=>we("psychotherapy_modalities"),className:"text-slate-400 hover:text-white transition-colors p-1 rounded",title:"Edit psychotherapy modalities",children:(0,O.jsx)(T.A,{size:16})})]}),q.psychotherapy_modalities?(0,O.jsxs)("div",{className:"space-y-4",children:[(0,O.jsx)("textarea",{value:Array.isArray(null===(r=V.psychotherapy_modalities)||void 0===r?void 0:r.psychotherapy_modalities)?V.psychotherapy_modalities.psychotherapy_modalities.join("\n"):Array.isArray(D.psychotherapy_modalities)?D.psychotherapy_modalities.join("\n"):D.psychotherapy_modalities||"",onChange:e=>Se("psychotherapy_modalities","psychotherapy_modalities",e.target.value.split("\n").filter(e=>e.trim())),rows:4,className:"w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-3 text-white placeholder-slate-400 focus:ring-2 focus:ring-purple-500 focus:border-purple-500 resize-none",placeholder:"Enter psychotherapy modalities (one per line)..."}),(0,O.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,O.jsx)("button",{onClick:()=>ke("psychotherapy_modalities"),className:"px-3 py-2 text-slate-300 hover:text-white border border-slate-600 rounded-lg hover:bg-slate-700 transition-colors text-sm",children:"Cancel"}),(0,O.jsxs)(H.P.button,{onClick:()=>Ce("psychotherapy_modalities"),disabled:M,className:"px-3 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors text-sm flex items-center gap-2",children:[M?(0,O.jsx)(p.A,{size:14,className:"animate-spin"}):(0,O.jsx)(k.A,{size:14}),"Save"]})]})]}):(0,O.jsx)("div",{className:"space-y-2",children:(D.psychotherapy_modalities||[]).length>0?D.psychotherapy_modalities.map((e,t)=>(0,O.jsxs)("div",{className:"flex items-center gap-3",children:[(0,O.jsx)("span",{className:"text-purple-400 font-medium",children:"\u2022"}),(0,O.jsx)("span",{className:"text-slate-300",children:e})]},t)):(0,O.jsx)("span",{className:"text-slate-500 italic",children:"No psychotherapy modalities added"})})]})]},"treatment"),"connections"===X&&(0,O.jsx)(H.P.div,{ref:e=>oe.current.connections=e,initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{duration:.3},className:"h-full overflow-y-auto p-6 space-y-6",children:(0,O.jsxs)(H.P.div,{variants:se,initial:"hidden",animate:"visible",className:"bg-slate-800/50 backdrop-blur-sm rounded-xl p-6 border border-slate-700",children:[(0,O.jsxs)("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[(0,O.jsx)(R.A,{size:20,className:"text-blue-400"}),"Connected Nodes"]}),(0,O.jsx)("p",{className:"text-slate-400 text-center py-8",children:"This section will show nodes connected to this topic in the mind map."})]})},"connections")]})})]})},`topic-modal-${(null===n||void 0===n?void 0:n.id)||"default"}`)}):null};var re=a(1482),oe=a(7719),le=a(4830),ne=a(9340),ce=a(4919),de=a(3165);const ue={hidden:{opacity:0,scale:.3,y:50,rotate:-5},visible:{opacity:1,scale:1,y:0,rotate:0,transition:{type:"spring",damping:25,stiffness:300,duration:.6}},exit:{opacity:0,scale:.7,y:30,rotate:-3,transition:{type:"easeInOut",duration:.4}}},pe={hidden:{opacity:0,backdropFilter:"blur(0px)"},visible:{opacity:1,backdropFilter:"blur(8px)",transition:{duration:.4,ease:"easeOut"}},exit:{opacity:0,backdropFilter:"blur(0px)",transition:{duration:.3,ease:"easeIn"}}},me={hidden:{opacity:0,y:20,scale:.95},visible:{opacity:1,y:0,scale:1,transition:{type:"easeOut",duration:.3,delay:.1}},exit:{opacity:0,y:-10,scale:1.02,transition:{type:"easeIn",duration:.2}}},he=e=>{var t;let{isOpen:a,data:i,onClose:r,onAnimationStart:l,onAnimationEnd:n,setMindMapData:c,autoSaveMindMapData:d,addToast:u}=e;const[h,x]=(0,s.useState)(!1),[b,f]=(0,s.useState)(!1),[j,N]=(0,s.useState)(!1),[C,S]=(0,s.useState)(!1),[_,A]=(0,s.useState)({}),[P,D]=(0,s.useState)(!1),[E,M]=(0,s.useState)(!1),[I,$]=(0,s.useState)("overview"),[L,X]=(0,s.useState)(!1);(0,s.useEffect)(()=>{a&&i&&!E?(f(!0),A({...i,status:i.status||"pending",priority:i.priority||"medium"}),M(!0),x(!0),l&&l(),setTimeout(()=>{x(!1),n&&n()},600)):!a&&E&&M(!1)},[a,E,l,n]),(0,s.useEffect)(()=>{!(a&&i&&E)||C||P||L||h||A({...i,status:i.status||"pending",priority:i.priority||"medium"})},[null===i||void 0===i?void 0:i.id,a,E,C,P,L,h]);const F=(0,s.useMemo)(()=>({low:{color:"green",label:"Low Priority",icon:re.A},medium:{color:"yellow",label:"Medium Priority",icon:re.A},high:{color:"red",label:"High Priority",icon:re.A},urgent:{color:"purple",label:"Urgent",icon:oe.A}}),[]),B=(0,s.useMemo)(()=>({pending:{color:"gray",label:"Pending",icon:g.A},in_progress:{color:"blue",label:"In Progress",icon:le.A},completed:{color:"green",label:"Completed",icon:v.A},paused:{color:"orange",label:"Paused",icon:ne.A}}),[]),Y=(0,s.useMemo)(()=>{if(!_.due_date)return!1;return new Date(_.due_date)<new Date&&"completed"!==_.status},[_.due_date,_.status]),U=(0,s.useCallback)(()=>{h||j||(x(!0),N(!0),l&&l(),f(!1))},[l,h,j]),J=(0,s.useCallback)(async()=>{if(!P){D(!0);try{c(e=>{const t=e.tasks.map(e=>String(e.id)===String(null===i||void 0===i?void 0:i.id)?{...e,..._}:e),a={...e,tasks:t};return d(a),a}),S(!1),u("Task updated successfully","success")}catch(e){console.error("Error saving task:",e),u("Failed to save task","error")}finally{D(!1)}}},[null===i||void 0===i?void 0:i.id,_,c,d,u,P]),q=(0,s.useCallback)(async()=>{if(!P&&window.confirm("Are you sure you want to delete this task?")){D(!0);try{c(e=>{const t=e.tasks.filter(e=>String(e.id)!==String(null===i||void 0===i?void 0:i.id)),a={...e,tasks:t};return d(a),a}),u("Task deleted successfully","success"),U()}catch(e){console.error("Error deleting task:",e),u("Failed to delete task","error")}finally{D(!1)}}},[null===i||void 0===i?void 0:i.id,c,d,u,U,P]),W=(0,s.useCallback)(e=>{A(t=>({...t,status:e}))},[]),V=(0,s.useCallback)((e,t)=>{A(a=>({...a,[e]:t}))},[]),K=function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"text",s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const i=_[t]||"";return C?"textarea"===a?(0,O.jsxs)("div",{className:"space-y-2",children:[(0,O.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:e}),(0,O.jsx)("textarea",{value:i,onChange:e=>V(t,e.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors",rows:s.rows||3,placeholder:`Enter ${e.toLowerCase()}...`})]}):"select"===a&&s.choices?(0,O.jsxs)("div",{className:"space-y-2",children:[(0,O.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:e}),(0,O.jsxs)("select",{value:i,onChange:e=>V(t,e.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors",children:[(0,O.jsxs)("option",{value:"",children:["Select ",e.toLowerCase(),"..."]}),s.choices.map(e=>(0,O.jsx)("option",{value:e.value,children:e.label},e.value))]})]}):"date"===a?(0,O.jsxs)("div",{className:"space-y-2",children:[(0,O.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:e}),(0,O.jsx)("input",{type:"date",value:i,onChange:e=>V(t,e.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors"})]}):(0,O.jsxs)("div",{className:"space-y-2",children:[(0,O.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:e}),(0,O.jsx)("input",{type:a,value:i,onChange:e=>V(t,"number"===a?Number(e.target.value):e.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors",placeholder:`Enter ${e.toLowerCase()}...`})]}):"textarea"===a?(0,O.jsxs)("div",{className:"space-y-2",children:[(0,O.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:e}),(0,O.jsx)("div",{className:"p-3 bg-gray-50 rounded-lg border min-h-[2.5rem] text-gray-800",children:i||(0,O.jsx)("span",{className:"text-gray-400 italic",children:"Not specified"})})]}):"select"===a?(0,O.jsxs)("div",{className:"space-y-2",children:[(0,O.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:e}),(0,O.jsx)("div",{className:"p-3 bg-gray-50 rounded-lg border text-gray-800",children:i||(0,O.jsx)("span",{className:"text-gray-400 italic",children:"Not specified"})})]}):"date"===a?(0,O.jsxs)("div",{className:"space-y-2",children:[(0,O.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:e}),(0,O.jsx)("div",{className:"p-3 bg-gray-50 rounded-lg border text-gray-800",children:i?new Date(i).toLocaleDateString():(0,O.jsx)("span",{className:"text-gray-400 italic",children:"Not set"})})]}):(0,O.jsxs)("div",{className:"space-y-2",children:[(0,O.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:e}),(0,O.jsx)("div",{className:"p-3 bg-gray-50 rounded-lg border text-gray-800",children:i||(0,O.jsx)("span",{className:"text-gray-400 italic",children:"Not specified"})})]})};return a?(0,O.jsx)(o.N,{mode:"wait",onExitComplete:()=>{x(!1),N(!1),M(!1),r(),n&&n()},children:b&&(0,O.jsx)(H.P.div,{initial:"hidden",animate:"visible",exit:"exit",variants:pe,className:"fixed inset-0 bg-black flex items-center justify-center z-50",style:{willChange:"backdrop-filter, opacity",backfaceVisibility:"hidden",transform:"translate3d(0, 0, 0)"},onClick:e=>e.target===e.currentTarget&&U(),children:(0,O.jsxs)(H.P.div,{initial:"hidden",animate:"visible",exit:"exit",variants:ue,className:"bg-white rounded-2xl shadow-2xl max-w-4xl w-full mx-4 max-h-[85vh] overflow-hidden",style:{willChange:"transform, opacity, scale",backfaceVisibility:"hidden"},onClick:e=>e.stopPropagation(),onAnimationStart:()=>{x(!0),l&&l()},onAnimationComplete:()=>{x(!1),n&&n()},children:[(0,O.jsxs)(H.P.div,{initial:"hidden",animate:"visible",exit:"exit",variants:me,className:"bg-gradient-to-br from-slate-900 to-slate-800 text-white px-6 py-4 flex items-center justify-between",children:[(0,O.jsxs)("div",{className:"flex items-center gap-3",children:[(0,O.jsx)(v.A,{size:24}),(0,O.jsx)("h2",{className:"text-xl font-semibold",children:"Task Details"}),Y&&(0,O.jsxs)(H.P.div,{animate:{scale:[1,1.1,1]},transition:{duration:1,repeat:1/0},className:"flex items-center gap-1 px-2 py-1 bg-red-500 rounded-full text-xs font-medium",children:[(0,O.jsx)(oe.A,{size:12}),"Overdue"]})]}),(0,O.jsxs)("div",{className:"flex items-center gap-2",children:[!C&&!P&&(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)("button",{onClick:()=>S(!0),className:"text-white hover:text-gray-200 p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-all",title:"Edit",children:(0,O.jsx)(T.A,{size:20})}),(0,O.jsx)("button",{onClick:q,className:"text-white hover:text-red-200 p-2 rounded-full hover:bg-red-500 hover:bg-opacity-30 transition-all",title:"Delete",children:(0,O.jsx)(z.A,{size:20})})]}),(0,O.jsx)("button",{onClick:U,className:"text-white hover:text-gray-200 p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-all",children:(0,O.jsx)(m.A,{size:20})})]})]}),(0,O.jsx)("div",{className:"bg-gradient-to-r from-slate-900 via-slate-800 to-slate-900 border-b border-slate-600",children:(0,O.jsx)("nav",{className:"flex flex-wrap gap-2 px-6 py-4",children:[{key:"overview",label:"Overview",icon:v.A},{key:"progress",label:"Progress",icon:ce.A},{key:"connections",label:"Connections",icon:R.A},{key:"details",label:"Details",icon:w.A}].map(e=>{let{key:t,label:a,icon:s}=e;return(0,O.jsxs)(H.P.button,{onClick:()=>{L||(X(!0),$(t),setTimeout(()=>X(!1),300))},className:"relative flex items-center gap-2 px-4 py-3 rounded-xl font-medium text-sm transition-all duration-300 "+(I===t?"bg-gradient-to-r from-emerald-500 to-teal-600 text-white shadow-lg shadow-emerald-500/25":"text-slate-300 hover:text-white hover:bg-slate-700/50 hover:shadow-md"),whileHover:{scale:I===t?1:1.02},whileTap:{scale:.98},initial:!1,animate:{scale:I===t?1.05:1,boxShadow:I===t?"0 8px 25px rgba(16, 185, 129, 0.3), 0 0 20px rgba(20, 184, 166, 0.2)":"0 2px 8px rgba(0, 0, 0, 0.1)"},transition:{duration:.3,ease:"easeOut"},children:[(0,O.jsx)(s,{size:16,className:I===t?"drop-shadow-sm":""}),a,I===t&&(0,O.jsx)(H.P.div,{layoutId:"taskTabGlow",className:"absolute inset-0 bg-gradient-to-r from-emerald-400/20 to-teal-500/20 rounded-xl blur-sm",initial:!1,transition:{type:"spring",bounce:.2,duration:.6}})]},t)})})}),(0,O.jsx)(H.P.div,{className:"relative overflow-hidden bg-gradient-to-br from-slate-50 to-slate-100",layout:"position",layoutRoot:!0,transition:{layout:{duration:.4,ease:"easeInOut"},height:{duration:.4,ease:"easeInOut"}},children:(0,O.jsxs)(o.N,{mode:"wait",initial:!1,onExitComplete:()=>X(!1),children:["overview"===I&&(0,O.jsx)(H.P.div,{initial:{opacity:0,x:-30},animate:{opacity:1,x:0},exit:{opacity:0,x:30},transition:{duration:.4,ease:"easeOut"},layout:"position",layoutId:"tabContent",className:"p-6 overflow-y-auto max-h-[calc(85vh-200px)] scrollbar-thin scrollbar-thumb-slate-400 scrollbar-track-slate-200",children:(0,O.jsxs)("div",{className:"space-y-6",children:[(0,O.jsxs)("div",{className:"bg-white rounded-xl p-6 shadow-lg border border-slate-200",children:[(0,O.jsxs)("h3",{className:"text-lg font-semibold text-slate-800 mb-4 flex items-center gap-2",children:[(0,O.jsx)(de.A,{size:20,className:"text-emerald-600"}),"Task Information"]}),(0,O.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[K("Title","title"),K("Priority","priority","select",{choices:[{value:"low",label:"Low Priority"},{value:"medium",label:"Medium Priority"},{value:"high",label:"High Priority"},{value:"urgent",label:"Urgent"}]})]}),(0,O.jsx)("div",{className:"mt-6",children:K("Description","description","textarea",{rows:4})})]}),(0,O.jsxs)("div",{className:"bg-white rounded-xl p-6 shadow-lg border border-slate-200",children:[(0,O.jsxs)("h3",{className:"text-lg font-semibold text-slate-800 mb-4 flex items-center gap-2",children:[(0,O.jsx)(g.A,{size:20,className:"text-blue-600"}),"Status & Timeline"]}),(0,O.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[K("Status","status","select",{choices:[{value:"pending",label:"Pending"},{value:"in_progress",label:"In Progress"},{value:"completed",label:"Completed"},{value:"paused",label:"Paused"}]}),K("Due Date","due_date","date")]}),(0,O.jsxs)("div",{className:"mt-6",children:[(0,O.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Quick Status Update"}),(0,O.jsx)("div",{className:"flex flex-wrap gap-3",children:Object.entries(B).map(e=>{let[t,a]=e;const s=a.icon,i=_.status===t;return(0,O.jsxs)(H.P.button,{onClick:()=>W(t),disabled:!C,whileHover:C?{scale:1.05}:{},whileTap:C?{scale:.95}:{},className:"flex items-center gap-2 px-4 py-2 rounded-lg font-medium text-sm transition-all "+(i?`bg-${a.color}-100 text-${a.color}-800 border-2 border-${a.color}-300`:"bg-gray-100 text-gray-600 border-2 border-gray-200 "+(C?"hover:bg-gray-200":"cursor-not-allowed opacity-50")),children:[(0,O.jsx)(s,{size:16}),a.label]},t)})})]})]})]})},"overview"),"progress"===I&&(0,O.jsx)(H.P.div,{initial:{opacity:0,x:-30},animate:{opacity:1,x:0},exit:{opacity:0,x:30},transition:{duration:.4,ease:"easeOut"},layout:"position",layoutId:"tabContent",className:"p-6 overflow-y-auto max-h-[calc(85vh-200px)] scrollbar-thin scrollbar-thumb-slate-400 scrollbar-track-slate-200",children:(0,O.jsxs)("div",{className:"bg-white rounded-xl p-6 shadow-lg border border-slate-200",children:[(0,O.jsxs)("h3",{className:"text-lg font-semibold text-slate-800 mb-6 flex items-center gap-2",children:[(0,O.jsx)(ce.A,{size:20,className:"text-blue-600"}),"Task Progress"]}),(0,O.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[(0,O.jsxs)(H.P.div,{whileHover:{scale:1.02},className:"p-4 rounded-lg border-2 "+("completed"===_.status?"bg-green-50 border-green-200":"bg-gray-50 border-gray-200"),children:[(0,O.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,O.jsx)(v.A,{size:20,className:"completed"===_.status?"text-green-600":"text-gray-400"}),(0,O.jsx)("span",{className:"font-medium "+("completed"===_.status?"text-green-800":"text-gray-600"),children:"Completion"})]}),(0,O.jsx)("div",{className:"text-2xl font-bold "+("completed"===_.status?"text-green-700":"text-gray-700"),children:"completed"===_.status?"100%":"0%"})]}),(0,O.jsxs)(H.P.div,{whileHover:{scale:1.02},className:"p-4 rounded-lg border-2 "+(Y?"bg-red-50 border-red-200":"bg-blue-50 border-blue-200"),children:[(0,O.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,O.jsx)(y.A,{size:20,className:Y?"text-red-600":"text-blue-600"}),(0,O.jsx)("span",{className:"font-medium "+(Y?"text-red-800":"text-blue-800"),children:"Due Date"})]}),(0,O.jsx)("div",{className:"text-lg font-bold "+(Y?"text-red-700":"text-blue-700"),children:_.due_date?new Date(_.due_date).toLocaleDateString():"Not set"}),Y&&(0,O.jsx)("div",{className:"text-sm text-red-600 mt-1",children:"Overdue"})]}),(0,O.jsxs)(H.P.div,{whileHover:{scale:1.02},className:"p-4 rounded-lg border-2 "+("urgent"===_.priority||"high"===_.priority?"bg-orange-50 border-orange-200":"bg-gray-50 border-gray-200"),children:[(0,O.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,O.jsx)(re.A,{size:20,className:"urgent"===_.priority||"high"===_.priority?"text-orange-600":"text-gray-600"}),(0,O.jsx)("span",{className:"font-medium "+("urgent"===_.priority||"high"===_.priority?"text-orange-800":"text-gray-800"),children:"Priority"})]}),(0,O.jsx)("div",{className:"text-lg font-bold "+("urgent"===_.priority||"high"===_.priority?"text-orange-700":"text-gray-700"),children:(null===(t=F[_.priority])||void 0===t?void 0:t.label)||"Not set"})]})]})]})},"progress"),"connections"===I&&(0,O.jsx)(H.P.div,{initial:{opacity:0,x:-30},animate:{opacity:1,x:0},exit:{opacity:0,x:30},transition:{duration:.4,ease:"easeOut"},layout:"position",layoutId:"tabContent",className:"p-6 overflow-y-auto max-h-[calc(85vh-200px)] scrollbar-thin scrollbar-thumb-slate-400 scrollbar-track-slate-200",children:(0,O.jsxs)("div",{className:"bg-white rounded-xl p-6 shadow-lg border border-slate-200",children:[(0,O.jsxs)("h3",{className:"text-lg font-semibold text-slate-800 mb-6 flex items-center gap-2",children:[(0,O.jsx)(R.A,{size:20,className:"text-indigo-600"}),"Related Content"]}),(0,O.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[K("Linked Case ID","linked_case_id"),K("Linked Topic ID","linked_topic_id")]}),(0,O.jsxs)("div",{className:"mt-8 text-center py-8 text-gray-500",children:[(0,O.jsx)(R.A,{size:48,className:"mx-auto mb-3 text-gray-300"}),(0,O.jsx)("p",{children:"No connections found"}),(0,O.jsx)("p",{className:"text-sm mt-1",children:"Link this task to cases or topics to create connections"})]})]})},"connections"),"details"===I&&(0,O.jsx)(H.P.div,{initial:{opacity:0,x:-30},animate:{opacity:1,x:0},exit:{opacity:0,x:30},transition:{duration:.4,ease:"easeOut"},layout:"position",layoutId:"tabContent",className:"p-6 overflow-y-auto max-h-[calc(85vh-200px)] scrollbar-thin scrollbar-thumb-slate-400 scrollbar-track-slate-200",children:(0,O.jsxs)("div",{className:"bg-white rounded-xl p-6 shadow-lg border border-slate-200",children:[(0,O.jsxs)("h3",{className:"text-lg font-semibold text-slate-800 mb-6 flex items-center gap-2",children:[(0,O.jsx)(w.A,{size:20,className:"text-gray-600"}),"Additional Details"]}),(0,O.jsxs)("div",{className:"space-y-6",children:[(0,O.jsxs)("div",{className:"text-sm text-gray-600 bg-slate-50 p-4 rounded-lg",children:[(0,O.jsx)("p",{className:"font-medium mb-2",children:"Task Details"}),(0,O.jsxs)("div",{className:"space-y-2",children:[(0,O.jsxs)("p",{children:[(0,O.jsx)("span",{className:"font-medium",children:"Created:"})," ",null!==i&&void 0!==i&&i.created_at?new Date(i.created_at).toLocaleString():"Unknown"]}),(0,O.jsxs)("p",{children:[(0,O.jsx)("span",{className:"font-medium",children:"Last Updated:"})," ",null!==i&&void 0!==i&&i.updated_at?new Date(i.updated_at).toLocaleString():"Unknown"]}),(0,O.jsxs)("p",{children:[(0,O.jsx)("span",{className:"font-medium",children:"Task ID:"})," ",(null===i||void 0===i?void 0:i.id)||"Unknown"]})]})]}),(0,O.jsxs)("div",{className:"p-4 bg-blue-50 rounded-lg border border-blue-200",children:[(0,O.jsx)("h4",{className:"font-medium text-blue-800 mb-2",children:"Task Management Tips"}),(0,O.jsxs)("ul",{className:"text-blue-700 text-sm space-y-1",children:[(0,O.jsx)("li",{children:"\u2022 Break large tasks into smaller, manageable subtasks"}),(0,O.jsx)("li",{children:"\u2022 Set realistic due dates to maintain accountability"}),(0,O.jsx)("li",{children:"\u2022 Link tasks to relevant cases or topics for better organization"}),(0,O.jsx)("li",{children:"\u2022 Update status regularly to track progress"})]})]})]})]})},"details")]})}),C&&(0,O.jsxs)("div",{className:"sticky bottom-0 bg-gray-50 border-t border-gray-200 px-6 py-4 flex items-center justify-between",children:[(0,O.jsx)("div",{className:"text-sm text-gray-500",children:"Changes will be auto-saved"}),(0,O.jsxs)("div",{className:"flex items-center gap-3",children:[(0,O.jsx)("button",{onClick:()=>{S(!1),A({...i})},disabled:P,className:"px-4 py-2 text-gray-600 hover:text-gray-800 border border-gray-300 rounded-lg hover:bg-gray-100 transition-colors",children:"Cancel"}),(0,O.jsxs)("button",{onClick:J,disabled:P,className:"px-4 py-2 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 transition-colors flex items-center gap-2",children:[P?(0,O.jsx)(p.A,{size:16,className:"animate-spin"}):(0,O.jsx)(k.A,{size:16}),P?"Saving...":"Save Changes"]})]})]})]})},`task-modal-${(null===i||void 0===i?void 0:i.id)||"default"}`)}):null},xe=s.memo(he,(e,t)=>{var a,s,i,r;return e.isOpen===t.isOpen&&(null===(a=e.data)||void 0===a?void 0:a.id)===(null===(s=t.data)||void 0===s?void 0:s.id)&&(null===(i=e.data)||void 0===i?void 0:i.updated_at)===(null===(r=t.data)||void 0===r?void 0:r.updated_at)});function ge(e,t,a){const{x:s,y:i,width:r,height:o}=e,{x:l,y:n}=t,{x:c,y:d}=a,u=s,p=s+r,m=i,h=i+o,x=c-l,g=d-n;if(Math.abs(x)<.001)return{x:l,y:g>0?h:m,side:g>0?"bottom":"top"};if(Math.abs(g)<.001)return{x:x>0?p:u,y:n,side:x>0?"right":"left"};const b=g/x,y=n-b*l,v=[],f=b*u+y;f>=m&&f<=h&&v.push({x:u,y:f,side:"left",distance:Math.hypot(u-l,f-n)});const j=b*p+y;j>=m&&j<=h&&v.push({x:p,y:j,side:"right",distance:Math.hypot(p-l,j-n)});const N=(m-y)/b;N>=u&&N<=p&&v.push({x:N,y:m,side:"top",distance:Math.hypot(N-l,m-n)});const w=(h-y)/b;w>=u&&w<=p&&v.push({x:w,y:h,side:"bottom",distance:Math.hypot(w-l,h-n)});const k=v.filter(e=>{const t=e.x-l,a=e.y-n;return(x>0&&t>=0||x<0&&t<=0)&&(g>0&&a>=0||g<0&&a<=0)});return k.sort((e,t)=>e.distance-t.distance),k[0]||{x:l,y:n,side:"center"}}const be=(0,s.memo)(e=>{var t,a,i,r,o,n;let{id:c,source:d,target:u,sourceX:p,sourceY:m,targetX:h,targetY:x,sourcePosition:g,targetPosition:b,style:y={},markerEnd:v,markerStart:f,data:j,...N}=e;const{getNode:w}=(0,l.VH)();let k,C;try{k=w(d),C=w(u)}catch(T){k=null,C=null}const{edgePath:S,labelX:_,labelY:A}=(0,s.useMemo)(()=>{if(null!==j&&void 0!==j&&j.__isAnimating||null!==j&&void 0!==j&&j.__forceUpdate)return{edgePath:`M${p},${m} L${h},${x}`,labelX:(p+h)/2,labelY:(m+x)/2};if(!k||!C)return{edgePath:`M${p},${m} L${h},${x}`,labelX:(p+h)/2,labelY:(m+x)/2};try{var e,t,a,s,i,r,o,l,n,c;const d=Boolean(k.width||(null===(e=k.dimensions)||void 0===e?void 0:e.width)||(null===(t=k.data)||void 0===t?void 0:t.width)||(null===(a=k.style)||void 0===a?void 0:a.width)),u=Boolean(C.width||(null===(s=C.dimensions)||void 0===s?void 0:s.width)||(null===(i=C.data)||void 0===i?void 0:i.width)||(null===(r=C.style)||void 0===r?void 0:r.width));if(!d||!u)return{edgePath:`M${p},${m} L${h},${x}`,labelX:(p+h)/2,labelY:(m+x)/2};const g=e=>{var t,a,s,i;const r="topic"===e.type?180:200,o="topic"===e.type?50:100;return{width:e.width||(null===(t=e.dimensions)||void 0===t?void 0:t.width)||(null===(a=e.data)||void 0===a?void 0:a.width)||r,height:e.height||(null===(s=e.dimensions)||void 0===s?void 0:s.height)||(null===(i=e.data)||void 0===i?void 0:i.height)||o}},b=g(k),y=g(C),v=function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{sourcePosition:s={x:0,y:0},targetPosition:i={x:0,y:0},sourceWidth:r=200,sourceHeight:o=100,targetWidth:l=200,targetHeight:n=100,sourceX:c,sourceY:d,targetX:u,targetY:p,offset:m=0}=a;if(void 0!==c&&void 0!==d&&void 0!==u&&void 0!==p&&(r<=10||l<=10))return{sourceX:c,sourceY:d,targetX:u,targetY:p,sourceSide:"direct",targetSide:"direct"};const h={x:s.x+r/2,y:s.y+o/2},x={x:i.x+l/2,y:i.y+n/2},g={x:s.x,y:s.y,width:r,height:o},b={x:i.x,y:i.y,width:l,height:n},y=ge(g,h,x),v=ge(b,x,h),f=x.x-h.x,j=x.y-h.y,N=Math.sqrt(f*f+j*j);if(N>0){const e=f/N,t=j/N,a=3;y.x-=e*a,y.y-=t*a,v.x+=e*a,v.y+=t*a,m>0&&(y.x+=e*m,y.y+=t*m,v.x-=e*m,v.y-=t*m)}return!!a.debug&&(console.log("Source Node:",e),console.log("Target Node:",t),console.log("Source Intersection:",y),console.log("Target Intersection:",v)),{sourceX:y.x,sourceY:y.y,targetX:v.x,targetY:v.y,sourceSide:y.side,targetSide:v.side}}(k,C,{sourcePosition:{x:(null===(o=k.positionAbsolute)||void 0===o?void 0:o.x)||k.position.x,y:(null===(l=k.positionAbsolute)||void 0===l?void 0:l.y)||k.position.y},targetPosition:{x:(null===(n=C.positionAbsolute)||void 0===n?void 0:n.x)||C.position.x,y:(null===(c=C.positionAbsolute)||void 0===c?void 0:c.y)||C.position.y},sourceX:p,sourceY:m,targetX:h,targetY:x,sourceWidth:b.width,sourceHeight:b.height,targetWidth:y.width,targetHeight:y.height,debug:!1}),{sourceX:f,sourceY:j,targetX:N,targetY:w}=v;return{edgePath:`M ${f},${j} L ${N},${w}`,labelX:(f+N)/2,labelY:(j+w)/2}}catch(T){return console.warn("FloatingEdge calculation error:",T),{edgePath:`M${p},${m} L${h},${x}`,labelX:(p+h)/2,labelY:(m+x)/2}}},[d,u,p,m,h,x,null===j||void 0===j?void 0:j.__forceUpdate,null===j||void 0===j?void 0:j.__isAnimating,null===(t=k)||void 0===t?void 0:t.id,null===(a=C)||void 0===a?void 0:a.id,null===(i=k)||void 0===i?void 0:i.width,null===(r=k)||void 0===r?void 0:r.height,null===(o=C)||void 0===o?void 0:o.width,null===(n=C)||void 0===n?void 0:n.height]);return(0,O.jsx)(l.tE,{id:c,path:S,labelX:_,labelY:A,style:{stroke:"#64748b",strokeWidth:3,strokeLinecap:"round",strokeOpacity:.95,transition:"none",...y},markerEnd:v,markerStart:f})},(e,t)=>{var a,s;return e.sourceX===t.sourceX&&e.sourceY===t.sourceY&&e.targetX===t.targetX&&e.targetY===t.targetY&&e.source===t.source&&e.target===t.target&&(null===(a=e.data)||void 0===a?void 0:a.__forceUpdate)===(null===(s=t.data)||void 0===s?void 0:s.__forceUpdate)}),ye=be,ve=(0,s.memo)(e=>{let{id:t,source:a,target:s,sourceX:i,sourceY:r,targetX:o,targetY:c,sourcePosition:d,targetPosition:u,style:p={},markerEnd:m,markerStart:h,label:x,sourceHandleId:g,targetHandleId:b,data:y,selected:v,animated:f}=e;const[j,N,w]=(0,n.Fp)({sourceX:i,sourceY:r,sourcePosition:d,targetX:o,targetY:c,targetPosition:u});return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(l.tE,{id:t,path:j,style:p,markerEnd:m,markerStart:h}),x&&(0,O.jsx)(l.rV,{children:(0,O.jsx)("div",{style:{position:"absolute",transform:`translate(-50%, -50%) translate(${N}px,${w}px)`,fontSize:12,pointerEvents:"all"},className:"nodrag nopan bg-white px-2 py-1 rounded shadow border text-xs",children:x})})]})});ve.displayName="EnhancedEdge";const fe=ve,je=e=>{let{fromX:t,fromY:a,toX:s,toY:i,connectionLineStyle:r}=e;const o=`M ${t},${a} L ${s},${i}`,l={stroke:"#3b82f6",strokeWidth:3.5,strokeLinecap:"round",strokeDasharray:"5,3",filter:"drop-shadow(0 0 6px rgba(59, 130, 246, 0.6))",animation:"flowingDash 1s linear infinite",...r};return(0,O.jsxs)("g",{children:[(0,O.jsx)("path",{d:o,fill:"none",style:l}),(0,O.jsx)("path",{d:o,fill:"none",stroke:"transparent",strokeWidth:15,style:{pointerEvents:"stroke"}})]})};var Ne=a(6099);const we=e=>{let{message:t="Loading your mind map...",progress:a=null}=e;return(0,O.jsx)("div",{className:"fixed inset-0 bg-gradient-to-br from-blue-50 to-purple-50 flex items-center justify-center z-50",children:(0,O.jsxs)("div",{className:"text-center",children:[(0,O.jsxs)("div",{className:"relative mb-6",children:[(0,O.jsx)(h.A,{className:"w-16 h-16 text-blue-600 mx-auto animate-pulse"}),(0,O.jsx)(Ne.A,{className:"w-6 h-6 text-purple-500 absolute -top-2 -right-2 animate-bounce"})]}),(0,O.jsxs)("div",{className:"flex items-center justify-center gap-3 mb-4",children:[(0,O.jsx)(p.A,{className:"w-6 h-6 animate-spin text-blue-600"}),(0,O.jsx)("span",{className:"text-lg font-medium text-gray-700",children:t})]}),null!==a&&(0,O.jsx)("div",{className:"w-64 bg-gray-200 rounded-full h-2 mx-auto mb-2",children:(0,O.jsx)("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300 ease-out",style:{width:`${Math.max(0,Math.min(100,a))}%`}})}),(0,O.jsx)("div",{className:"text-sm text-gray-500 max-w-md mx-auto mt-4",children:(0,O.jsx)("p",{children:"\ud83d\udca1 Tip: Use the force layout button to auto-arrange your nodes"})})]})})};const ke=[{id:1,title:"Efficacy of Cognitive Behavioral Therapy for Depression: A Meta-Analysis",authors:"Smith, J.A., Johnson, B.K., Williams, C.D.",year:"2023",type:"meta-analysis",journal:"Journal of Clinical Psychology",volume:"79",pages:"234-251",doi:"10.1002/jclp.23456",abstract:"This meta-analysis examines the efficacy of cognitive behavioral therapy (CBT) for treating major depressive disorder across 45 randomized controlled trials involving 3,242 participants. Results indicate that CBT shows significant effectiveness with a large effect size (d = 0.85) compared to control conditions. The analysis also reveals that individual CBT may be more effective than group CBT for severe depression cases.",keywords:"cognitive behavioral therapy, depression, meta-analysis, psychotherapy, mental health",notes:"",pdf_url:"https://example.com/sample-cbt-meta-analysis.pdf",position:{x:300,y:100}},{id:2,title:"DSM-5-TR Clinical Cases",authors:"American Psychiatric Association",year:"2022",type:"guideline",journal:"American Psychiatric Publishing",abstract:"A comprehensive collection of clinical cases that illustrate the diagnostic criteria and clinical features of mental disorders as defined in the DSM-5-TR. Each case includes detailed patient presentations, differential diagnoses, and treatment considerations.",keywords:"DSM-5, diagnosis, clinical cases, psychiatric disorders, differential diagnosis",notes:"Essential reference for diagnostic clarity",position:{x:500,y:200}},{id:3,title:"Pharmacological Treatment of Bipolar Disorder: Current Evidence",authors:"Rodriguez, M.L., Chen, K.H., Anderson, P.R.",year:"2023",type:"review",journal:"Bipolar Disorders",volume:"25",pages:"123-145",doi:"10.1111/bdi.13289",abstract:"This comprehensive review examines current evidence for pharmacological treatments of bipolar disorder, including mood stabilizers, antipsychotics, and adjunctive therapies. The review covers efficacy, safety profiles, and treatment-resistant cases.",keywords:"bipolar disorder, pharmacotherapy, mood stabilizers, lithium, antipsychotics",notes:"Important for medication management decisions",position:{x:700,y:150}},{id:4,title:"Mindfulness-Based Interventions for Anxiety Disorders: A Systematic Review",authors:"Taylor, S.M., Brown, A.J., Davis, L.K.",year:"2023",type:"review",journal:"Clinical Psychology Review",volume:"88",pages:"102-118",abstract:"Systematic review of mindfulness-based interventions for treating various anxiety disorders. Analysis of 28 studies shows moderate to large effect sizes for reducing anxiety symptoms, with particular effectiveness for generalized anxiety disorder.",keywords:"mindfulness, anxiety disorders, meditation, systematic review, GAD",notes:"Good evidence for mindfulness approaches",position:{x:400,y:300}},{id:5,title:"Case Study: Treatment-Resistant Schizophrenia with Clozapine",authors:"Wilson, K.R., Martinez, E.S.",year:"2022",type:"case-study",journal:"Schizophrenia Bulletin",volume:"48",pages:"567-572",abstract:"Detailed case study of a 28-year-old male with treatment-resistant schizophrenia who showed significant improvement after clozapine initiation. The case discusses monitoring protocols, side effect management, and long-term outcomes.",keywords:"schizophrenia, clozapine, treatment-resistant, case study, antipsychotics",notes:"Useful for understanding clozapine protocols",position:{x:600,y:400}}],Ce=[{id:"conn-1",source:"literature-1",target:"case-101",label:"Treatment approach"},{id:"conn-2",source:"literature-2",target:"topic-201",label:"Reference guide"},{id:"conn-3",source:"literature-3",target:"case-102",label:"Medication guidance"},{id:"conn-4",source:"literature-4",target:"case-103",label:"Treatment option"},{id:"conn-5",source:"literature-5",target:"case-104",label:"Treatment protocol"}],Se=(e,t,a)=>{e(e=>{const s=new Set(e.literature.map(e=>e.id)),i=ke.filter(e=>!s.has(e.id));if(0===i.length)return a("Sample literature data already exists","info"),e;const r=new Set(e.cases.map(e=>e.id)),o=new Set(e.topics.map(e=>e.id)),l=[{id:101,label:"Major Depression Case",primary_diagnosis:"Major Depressive Disorder",chief_complaint:"Persistent sadness and loss of interest",secondary_diagnoses:["Anxiety","Insomnia"],position:{x:100,y:100}},{id:102,label:"Bipolar Disorder Case",primary_diagnosis:"Bipolar I Disorder",chief_complaint:"Mood swings and impulsivity",position:{x:200,y:200}},{id:103,label:"Generalized Anxiety Case",primary_diagnosis:"Generalized Anxiety Disorder",chief_complaint:"Excessive worry and restlessness",position:{x:300,y:300}},{id:104,label:"Schizophrenia Case",primary_diagnosis:"Schizophrenia",chief_complaint:"Auditory hallucinations and delusions",position:{x:400,y:400}}].filter(e=>!r.has(e.id)),n=[{id:201,title:"Diagnostic Criteria",category:"Assessment",tags:["DSM-5","diagnosis","criteria"],position:{x:150,y:50}}].filter(e=>!o.has(e.id)),c=new Set(e.connections.map(e=>e.id)),d=Ce.filter(e=>!c.has(e.id)),u={...e,literature:[...e.literature,...i],cases:[...e.cases,...l],topics:[...e.topics,...n],connections:[...e.connections,...d]};return t(u),a(`Added ${i.length} literature items, ${l.length} cases, and ${n.length} topics`,"success"),u})},_e=()=>a.e(497).then(a.bind(a,9930)),Ae=`${"https://336d4c80-d84e-4815-a915-e2ffd980488a.preview.emergentagent.com".replace(/\/$/,"")}/api`,Te=console.error;console.error=function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];t[0]&&t[0].includes&&t[0].includes("ResizeObserver loop")||Te(...t)};const ze=e=>{let{message:t,type:a="success",onClose:i,duration:r=3e3}=e;(0,s.useEffect)(()=>{const e=setTimeout(i,r);return()=>clearTimeout(e)},[i,r]);return(0,O.jsx)("div",{className:`fixed top-4 right-4 z-50 px-6 py-3 rounded-lg shadow-lg transition-all duration-500 transform ${{success:"bg-green-600 text-white border-l-4 border-green-400",error:"bg-red-600 text-white border-l-4 border-red-400",info:"bg-blue-600 text-white border-l-4 border-blue-400",saving:"bg-purple-600 text-white border-l-4 border-purple-400"}[a]}`,children:(0,O.jsxs)("div",{className:"flex items-center",children:[(()=>{switch(a){case"success":default:return(0,O.jsx)(c.A,{size:16,className:"mr-2"});case"error":return(0,O.jsx)(d.A,{size:16,className:"mr-2"});case"info":return(0,O.jsx)(u.A,{size:16,className:"mr-2"});case"saving":return(0,O.jsx)(p.A,{size:16,className:"mr-2 animate-spin"})}})(),(0,O.jsx)("span",{className:"text-sm font-medium",children:t}),(0,O.jsx)("button",{onClick:i,className:"ml-4 text-white hover:text-gray-200 transition-colors",children:(0,O.jsx)(m.A,{size:14})})]})})},Pe=e=>{let{onClick:t,loading:a,disabled:s,children:i,className:r,icon:o,...l}=e;return(0,O.jsx)("button",{onClick:t,disabled:s||a,className:`${r} transform transition-all duration-200 hover:scale-105 active:scale-95 ${s||a?"cursor-not-allowed opacity-50":"hover:shadow-lg"}`,...l,children:(0,O.jsxs)("div",{className:"flex items-center gap-2",children:[a?(0,O.jsx)(p.A,{size:16,className:"animate-spin"}):o?(0,O.jsx)(o,{size:16}):null,i]})})},Oe="pgy3_mindmap_data",De={save:(()=>{let e;return function(t,a,s){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];clearTimeout(e),a&&a();e=setTimeout(()=>{try{const e={version:"1.1",timestamp:(new Date).toISOString(),data:t};localStorage.setItem(Oe,JSON.stringify(e)),console.log("Mind map data auto-saved to localStorage"),s&&s(!0)}catch(e){if(console.error("Error saving to localStorage:",e),s&&s(!1,e),"QuotaExceededError"===e.name){console.warn("localStorage quota exceeded, clearing old data...");try{localStorage.removeItem(Oe)}catch(a){console.error("Error clearing localStorage:",a)}}}},i?1200:800)}})(),load:()=>{try{const e=localStorage.getItem(Oe);if(!e)return console.log("No localStorage data found"),null;const t=JSON.parse(e);return"1.1"!==t.version?(console.log("localStorage version mismatch, clearing old data"),localStorage.removeItem(Oe),null):(console.log("Mind map data loaded from localStorage",t.timestamp),t.data)}catch(e){console.error("Error loading from localStorage:",e);try{localStorage.removeItem(Oe)}catch(t){console.error("Error clearing corrupted localStorage:",t)}return null}},clear:()=>{try{localStorage.removeItem(Oe),console.log("localStorage data cleared")}catch(e){console.error("Error clearing localStorage:",e)}},getStorageInfo:()=>{try{const e=localStorage.getItem(Oe);if(!e)return null;const t=JSON.parse(e);return{version:t.version,timestamp:t.timestamp,size:new Blob([e]).size}}catch(e){return null}}},Ee={topic:e=>{let{data:t,selected:a}=e;const[i,r]=(0,s.useState)(t.skipAnimation||!1);(0,s.useEffect)(()=>{if(!t.skipAnimation){const e=setTimeout(()=>r(!0),100);return()=>clearTimeout(e)}},[t.skipAnimation]);const o=t.flashcard_count>0?(t.completed_flashcards||0)/t.flashcard_count*100:0;return(0,O.jsxs)("div",{className:`group px-4 py-3 shadow-lg border-2 transition-all duration-700 min-w-[220px] relative hover:shadow-2xl transform hover:scale-105 backdrop-blur-sm ${a?"border-teal-400 shadow-xl scale-105 ring-4 ring-teal-200 animate-pulse":"border-transparent hover:border-teal-300 hover:ring-2 hover:ring-teal-100"} ${i?"opacity-100 scale-100 translate-y-0":"opacity-0 scale-75 translate-y-8"}`,style:{backgroundColor:t.color||"#3B82F6",color:"white",borderRadius:"12px !important",WebkitBorderRadius:"12px",MozBorderRadius:"12px",overflow:"hidden",boxShadow:a?`0 0 20px ${t.color||"#3B82F6"}40`:`0 4px 20px ${t.color||"#3B82F6"}20`,transition:"all 0.7s cubic-bezier(0.34, 1.56, 0.64, 1), transform 0.3s ease"},children:[(0,O.jsx)(l.h7,{id:"top",type:"source",position:n.yX.Top,className:"w-3 h-3 !bg-blue-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{left:"50%",transform:"translateX(-50%)",zIndex:2},isConnectable:!0}),(0,O.jsx)(l.h7,{id:"top",type:"target",position:n.yX.Top,className:"w-3 h-3 !bg-blue-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{left:"50%",transform:"translateX(-50%)",zIndex:1},isConnectable:!0}),(0,O.jsx)(l.h7,{id:"right",type:"source",position:n.yX.Right,className:"w-3 h-3 !bg-blue-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{top:"50%",transform:"translateY(-50%)",zIndex:2},isConnectable:!0}),(0,O.jsx)(l.h7,{id:"right",type:"target",position:n.yX.Right,className:"w-3 h-3 !bg-blue-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{top:"50%",transform:"translateY(-50%)",zIndex:1},isConnectable:!0}),(0,O.jsx)(l.h7,{id:"bottom",type:"source",position:n.yX.Bottom,className:"w-3 h-3 !bg-blue-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{left:"50%",transform:"translateX(-50%)",zIndex:2},isConnectable:!0}),(0,O.jsx)(l.h7,{id:"bottom",type:"target",position:n.yX.Bottom,className:"w-3 h-3 !bg-blue-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{left:"50%",transform:"translateX(-50%)",zIndex:1},isConnectable:!0}),(0,O.jsx)(l.h7,{id:"left",type:"source",position:n.yX.Left,className:"w-3 h-3 !bg-blue-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{top:"50%",transform:"translateY(-50%)",zIndex:2},isConnectable:!0}),(0,O.jsx)(l.h7,{id:"left",type:"target",position:n.yX.Left,className:"w-3 h-3 !bg-blue-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{top:"50%",transform:"translateY(-50%)",zIndex:1},isConnectable:!0}),t.priority&&(0,O.jsx)("div",{className:"absolute -top-2 -right-2",children:(0,O.jsx)("div",{className:"w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold border-2 border-white "+("high"===t.priority?"bg-red-500":"medium"===t.priority?"bg-yellow-500":"bg-green-500"),children:"high"===t.priority?"!":"medium"===t.priority?"\u2022":"\u2713"})}),(0,O.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,O.jsxs)("div",{className:"flex items-center gap-1",children:[(0,O.jsx)(h.A,{size:16,className:"drop-shadow-sm"}),t.tags&&t.tags.length>0&&(0,O.jsx)(x.A,{size:12,className:"opacity-75"})]}),(0,O.jsx)("div",{className:"font-semibold text-sm truncate flex-1",children:t.label}),t.onDelete&&(0,O.jsx)("button",{onClick:e=>{e.preventDefault();const a=setTimeout(()=>{e.stopPropagation(),t.onDelete()},300);e.currentTarget.deleteTimeout=a},onDoubleClick:e=>{e.currentTarget.deleteTimeout&&(clearTimeout(e.currentTarget.deleteTimeout),e.currentTarget.deleteTimeout=null)},className:"ml-auto p-1 hover:bg-white hover:bg-opacity-20 rounded transition-all duration-200 hover:scale-110 opacity-70 hover:opacity-100",children:(0,O.jsx)(m.A,{size:12})})]}),(0,O.jsx)("div",{className:"text-xs opacity-90 mb-2",children:t.category}),t.flashcard_count>0&&(0,O.jsxs)("div",{className:"text-xs mt-2 space-y-1",children:[(0,O.jsxs)("div",{className:"flex justify-between items-center",children:[(0,O.jsxs)("span",{className:"opacity-90",children:[t.completed_flashcards,"/",t.flashcard_count," flashcards"]}),(0,O.jsxs)("span",{className:"font-semibold",children:[Math.round(o),"%"]})]}),(0,O.jsx)("div",{className:"w-full bg-white bg-opacity-20 rounded-full h-2 overflow-hidden",children:(0,O.jsx)("div",{className:"h-full bg-white rounded-full transition-all duration-1000 ease-out",style:{width:`${o}%`}})})]}),t.tags&&t.tags.length>0&&(0,O.jsxs)("div",{className:"flex flex-wrap gap-1 mt-2",children:[t.tags.slice(0,3).map((e,t)=>(0,O.jsx)("span",{className:"px-2 py-1 bg-white bg-opacity-20 rounded-full text-xs",children:e},t)),t.tags.length>3&&(0,O.jsxs)("span",{className:"px-2 py-1 bg-white bg-opacity-20 rounded-full text-xs",children:["+",t.tags.length-3]})]}),t.updated_at&&(0,O.jsx)("div",{className:"absolute bottom-1 right-1 opacity-50",children:(0,O.jsx)(g.A,{size:10})})]})},case:e=>{let{data:t,selected:a}=e;const[i,r]=(0,s.useState)(t.skipAnimation||!1);(0,s.useEffect)(()=>{if(!t.skipAnimation){const e=setTimeout(()=>r(!0),150);return()=>clearTimeout(e)}},[t.skipAnimation]);const o=(e=>{var t,a;const s=(null===(t=e.chief_complaint)||void 0===t?void 0:t.toLowerCase())||"",i=(null===(a=e.diagnosis)||void 0===a?void 0:a.toLowerCase())||"";return["emergency","urgent","crisis","acute","severe"].some(e=>s.includes(e)||i.includes(e))?"high":"normal"})(t);return(0,O.jsxs)("div",{className:`group px-4 py-3 rounded-xl shadow-lg border-2 transition-all duration-600 min-w-[220px] bg-white relative hover:shadow-2xl transform hover:scale-105 ${a?"border-blue-400 shadow-xl scale-105 ring-4 ring-blue-200":"border-gray-200 hover:border-blue-300 hover:ring-2 hover:ring-blue-100"} ${"high"===o?"ring-2 ring-red-300":""} ${i?"opacity-100 scale-100 translate-y-0 rotate-0":"opacity-0 scale-90 translate-y-6 rotate-1"}`,style:{transition:"all 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94), transform 0.3s ease"},children:[(0,O.jsx)(l.h7,{id:"top",type:"source",position:n.yX.Top,className:"w-3 h-3 !bg-blue-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{left:"50%",transform:"translateX(-50%)",zIndex:2},isConnectable:!0}),(0,O.jsx)(l.h7,{id:"top",type:"target",position:n.yX.Top,className:"w-3 h-3 !bg-blue-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{left:"50%",transform:"translateX(-50%)",zIndex:1},isConnectable:!0}),(0,O.jsx)(l.h7,{id:"right",type:"source",position:n.yX.Right,className:"w-3 h-3 !bg-blue-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{top:"50%",transform:"translateY(-50%)",zIndex:2},isConnectable:!0}),(0,O.jsx)(l.h7,{id:"right",type:"target",position:n.yX.Right,className:"w-3 h-3 !bg-blue-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{top:"50%",transform:"translateY(-50%)",zIndex:1},isConnectable:!0}),(0,O.jsx)(l.h7,{id:"bottom",type:"source",position:n.yX.Bottom,className:"w-3 h-3 !bg-blue-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{left:"50%",transform:"translateX(-50%)",zIndex:2},isConnectable:!0}),(0,O.jsx)(l.h7,{id:"bottom",type:"target",position:n.yX.Bottom,className:"w-3 h-3 !bg-blue-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{left:"50%",transform:"translateX(-50%)",zIndex:1},isConnectable:!0}),(0,O.jsx)(l.h7,{id:"left",type:"source",position:n.yX.Left,className:"w-3 h-3 !bg-blue-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{top:"50%",transform:"translateY(-50%)",zIndex:2},isConnectable:!0}),(0,O.jsx)(l.h7,{id:"left",type:"target",position:n.yX.Left,className:"w-3 h-3 !bg-blue-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{top:"50%",transform:"translateY(-50%)",zIndex:1},isConnectable:!0}),"high"===o&&(0,O.jsx)("div",{className:"absolute -top-2 -right-2",children:(0,O.jsx)("div",{className:"w-6 h-6 bg-red-500 rounded-full flex items-center justify-center border-2 border-white animate-pulse",children:(0,O.jsx)(d.A,{size:14,className:"text-white"})})}),(0,O.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,O.jsxs)("div",{className:"flex items-center gap-1",children:[(0,O.jsx)(b.A,{size:16,className:"text-blue-600"}),t.linked_topics&&t.linked_topics.length>0&&(0,O.jsx)("div",{className:"text-xs bg-blue-100 text-blue-600 px-1 rounded",children:t.linked_topics.length})]}),(0,O.jsx)("div",{className:"font-semibold text-sm text-gray-800 truncate flex-1",children:t.label}),t.onDelete&&(0,O.jsx)("button",{onClick:e=>{e.preventDefault();const a=setTimeout(()=>{e.stopPropagation(),t.onDelete()},300);e.currentTarget.deleteTimeout=a},onDoubleClick:e=>{e.currentTarget.deleteTimeout&&(clearTimeout(e.currentTarget.deleteTimeout),e.currentTarget.deleteTimeout=null)},className:"ml-auto p-1 hover:bg-gray-200 rounded transition-all duration-200 hover:scale-110 opacity-70 hover:opacity-100",children:(0,O.jsx)(m.A,{size:12})})]}),(0,O.jsx)("div",{className:"text-xs text-gray-600 mb-2 truncate",children:t.case_name||t.label}),(0,O.jsxs)("div",{className:"space-y-1",children:[t.age&&(0,O.jsxs)("div",{className:"text-xs text-blue-600 flex items-center gap-1",children:[(0,O.jsx)(y.A,{size:10}),"Age: ",t.age]}),t.status&&(0,O.jsx)("span",{className:`inline-block px-2 py-1 rounded-full text-xs border ${(e=>{switch(e){case"active":return"bg-green-100 text-green-800 border-green-200";case"archived":return"bg-gray-100 text-gray-800 border-gray-200";case"follow_up":return"bg-yellow-100 text-yellow-800 border-yellow-200";default:return"bg-blue-100 text-blue-800 border-blue-200"}})(t.status)}`,children:t.status})]}),t.tasks_count&&t.tasks_count>0&&(0,O.jsxs)("div",{className:"mt-2 text-xs text-gray-500 flex items-center gap-1",children:[(0,O.jsx)(v.A,{size:10}),t.completed_tasks||0,"/",t.tasks_count," tasks"]}),t.updated_at&&(0,O.jsx)("div",{className:"absolute bottom-1 right-1 opacity-30",children:(0,O.jsx)(g.A,{size:10})})]})},task:e=>{let{data:t,selected:a}=e;const[i,r]=(0,s.useState)(t.skipAnimation||!1);(0,s.useEffect)(()=>{if(!t.skipAnimation){const e=setTimeout(()=>r(!0),200);return()=>clearTimeout(e)}},[t.skipAnimation]);return(0,O.jsxs)("div",{className:`group px-4 py-3 rounded-xl shadow-lg border-2 transition-all duration-500 min-w-[200px] text-white relative hover:shadow-2xl transform hover:scale-105 ${a?"border-yellow-400 shadow-xl scale-105 ring-4 ring-yellow-200":"border-transparent hover:border-yellow-300 hover:ring-2 hover:ring-yellow-100"} ${{pending:"bg-yellow-500",in_progress:"bg-blue-600",completed:"bg-green-700 opacity-60"}[t.status]||"bg-gray-500"} ${i?"opacity-100 scale-100 translate-x-0":"opacity-0 scale-85 -translate-x-4"}`,style:{transition:"all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55), transform 0.3s ease"},children:[(0,O.jsx)(l.h7,{id:"top",type:"source",position:n.yX.Top,className:"w-3 h-3 !bg-blue-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{left:"50%",transform:"translateX(-50%)",zIndex:2},isConnectable:!0}),(0,O.jsx)(l.h7,{id:"top",type:"target",position:n.yX.Top,className:"w-3 h-3 !bg-blue-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{left:"50%",transform:"translateX(-50%)",zIndex:1},isConnectable:!0}),(0,O.jsx)(l.h7,{id:"right",type:"source",position:n.yX.Right,className:"w-3 h-3 !bg-blue-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{top:"50%",transform:"translateY(-50%)",zIndex:2},isConnectable:!0}),(0,O.jsx)(l.h7,{id:"right",type:"target",position:n.yX.Right,className:"w-3 h-3 !bg-blue-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{top:"50%",transform:"translateY(-50%)",zIndex:1},isConnectable:!0}),(0,O.jsx)(l.h7,{id:"bottom",type:"source",position:n.yX.Bottom,className:"w-3 h-3 !bg-blue-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{left:"50%",transform:"translateX(-50%)",zIndex:2},isConnectable:!0}),(0,O.jsx)(l.h7,{id:"bottom",type:"target",position:n.yX.Bottom,className:"w-3 h-3 !bg-blue-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{left:"50%",transform:"translateX(-50%)",zIndex:1},isConnectable:!0}),(0,O.jsx)(l.h7,{id:"left",type:"source",position:n.yX.Left,className:"w-3 h-3 !bg-blue-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{top:"50%",transform:"translateY(-50%)",zIndex:2},isConnectable:!0}),(0,O.jsx)(l.h7,{id:"left",type:"target",position:n.yX.Left,className:"w-3 h-3 !bg-blue-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{top:"50%",transform:"translateY(-50%)",zIndex:1},isConnectable:!0}),(0,O.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,O.jsx)(v.A,{size:16}),(0,O.jsx)("div",{className:"font-semibold text-sm",children:t.label}),t.onDelete&&(0,O.jsx)("button",{onClick:e=>{e.preventDefault();const a=setTimeout(()=>{e.stopPropagation(),t.onDelete()},300);e.currentTarget.deleteTimeout=a},onDoubleClick:e=>{e.currentTarget.deleteTimeout&&(clearTimeout(e.currentTarget.deleteTimeout),e.currentTarget.deleteTimeout=null)},className:"ml-auto p-1 hover:bg-white hover:bg-opacity-20 rounded transition-all duration-200 hover:scale-110 opacity-70 hover:opacity-100",children:(0,O.jsx)(m.A,{size:12})})]}),(0,O.jsxs)("div",{className:"text-xs opacity-90",children:["Priority: ",t.priority]}),t.due_date&&(0,O.jsxs)("div",{className:"text-xs mt-1 opacity-90",children:["Due: ",new Date(t.due_date).toLocaleDateString()]})]})},literature:e=>{let{data:t,selected:a}=e;const[i,r]=(0,s.useState)(t.skipAnimation||!1);return(0,s.useEffect)(()=>{if(!t.skipAnimation){const e=setTimeout(()=>r(!0),250);return()=>clearTimeout(e)}},[t.skipAnimation]),(0,O.jsxs)("div",{className:`group px-4 py-3 rounded-xl shadow-lg border-2 transition-all duration-650 min-w-[200px] bg-purple-50 relative hover:shadow-2xl transform hover:scale-105 ${a?"border-purple-400 shadow-xl scale-105 ring-4 ring-purple-200":"border-purple-200 hover:border-purple-300 hover:ring-2 hover:ring-purple-100"} ${i?"opacity-100 scale-100 translate-x-0 rotate-0":"opacity-0 scale-95 translate-x-4 -rotate-1"}`,style:{transition:"all 0.65s cubic-bezier(0.175, 0.885, 0.32, 1.275), transform 0.3s ease"},children:[(0,O.jsx)(l.h7,{id:"top",type:"source",position:n.yX.Top,className:"w-3 h-3 !bg-purple-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{left:"50%",transform:"translateX(-50%)",zIndex:2},isConnectable:!0}),(0,O.jsx)(l.h7,{id:"top",type:"target",position:n.yX.Top,className:"w-3 h-3 !bg-purple-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{left:"50%",transform:"translateX(-50%)",zIndex:1},isConnectable:!0}),(0,O.jsx)(l.h7,{id:"right",type:"source",position:n.yX.Right,className:"w-3 h-3 !bg-purple-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{top:"50%",transform:"translateY(-50%)",zIndex:2},isConnectable:!0}),(0,O.jsx)(l.h7,{id:"right",type:"target",position:n.yX.Right,className:"w-3 h-3 !bg-purple-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{top:"50%",transform:"translateY(-50%)",zIndex:1},isConnectable:!0}),(0,O.jsx)(l.h7,{id:"bottom",type:"source",position:n.yX.Bottom,className:"w-3 h-3 !bg-purple-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{left:"50%",transform:"translateX(-50%)",zIndex:2},isConnectable:!0}),(0,O.jsx)(l.h7,{id:"bottom",type:"target",position:n.yX.Bottom,className:"w-3 h-3 !bg-purple-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{left:"50%",transform:"translateX(-50%)",zIndex:1},isConnectable:!0}),(0,O.jsx)(l.h7,{id:"left",type:"source",position:n.yX.Left,className:"w-3 h-3 !bg-purple-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{top:"50%",transform:"translateY(-50%)",zIndex:2},isConnectable:!0}),(0,O.jsx)(l.h7,{id:"left",type:"target",position:n.yX.Left,className:"w-3 h-3 !bg-purple-500 transition-all duration-300 hover:scale-150 cursor-pointer opacity-0 group-hover:opacity-100",style:{top:"50%",transform:"translateY(-50%)",zIndex:1},isConnectable:!0}),(0,O.jsxs)("div",{className:"flex items-center gap-2 mb-1 cursor-pointer",onClick:e=>{e.preventDefault();const a=setTimeout(()=>{e.stopPropagation(),t.onLiteratureClick&&t.onLiteratureClick(t)},300);e.currentTarget.clickTimeout=a},onDoubleClick:e=>{e.currentTarget.clickTimeout&&(clearTimeout(e.currentTarget.clickTimeout),e.currentTarget.clickTimeout=null)},children:[(0,O.jsx)(f.A,{size:16,className:"text-purple-600"}),(0,O.jsx)("div",{className:"font-semibold text-sm text-gray-800",children:t.label}),t.onDelete&&(0,O.jsx)("button",{onClick:e=>{e.preventDefault();const a=setTimeout(()=>{e.stopPropagation(),t.onDelete()},300);e.currentTarget.deleteTimeout=a},onDoubleClick:e=>{e.currentTarget.deleteTimeout&&(clearTimeout(e.currentTarget.deleteTimeout),e.currentTarget.deleteTimeout=null)},className:"ml-auto p-1 hover:bg-purple-200 rounded transition-all duration-200 hover:scale-110 opacity-70 hover:opacity-100",children:(0,O.jsx)(m.A,{size:12})})]}),(0,O.jsx)("div",{className:"text-xs text-gray-600",children:t.authors}),(0,O.jsx)("div",{className:"text-xs text-purple-600 mt-1",children:t.year})]})}},Me=e=>{let{isOpen:t,onClose:a,onSelect:i,templates:r}=e;const[o,l]=(0,s.useState)(null);if((0,s.useEffect)(()=>{if(!t){const e=setTimeout(()=>l(null),300);return()=>clearTimeout(e)}},[t]),!t)return null;const n=[{type:"topic",label:"Psychiatric Topic",icon:h.A,color:"bg-blue-600",description:"Add a new psychiatric topic or disorder"},{type:"literature",label:"Literature",icon:f.A,color:"bg-purple-600",description:"Add research papers, articles, or references"},{type:"case",label:"Patient Case",icon:b.A,color:"bg-indigo-600",description:"Add a new patient case study"},{type:"task",label:"Task",icon:v.A,color:"bg-amber-600",description:"Add a task or to-do item"}],c=function(){i(o,arguments.length>0&&void 0!==arguments[0]?arguments[0]:null),a()},d=o?(r||[]).filter(e=>e.nodeType===o):[];return(0,O.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 backdrop-blur-sm animate-in fade-in-25 duration-300",children:(0,O.jsxs)("div",{className:"bg-white rounded-xl shadow-2xl p-6 max-w-md w-full mx-4 transform transition-all duration-300 ease-out",children:[(0,O.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,O.jsxs)("div",{className:"flex items-center gap-3",children:[o&&(0,O.jsx)("button",{onClick:()=>l(null),className:"text-gray-400 hover:text-gray-600 p-1 rounded-full hover:bg-gray-100 transition-colors",children:(0,O.jsx)(j.A,{size:20})}),(0,O.jsx)("h3",{className:"text-xl font-semibold text-gray-800",children:o?`Select a ${o} template`:"Add New Node"})]}),(0,O.jsx)("button",{onClick:a,className:"text-gray-400 hover:text-gray-600 p-1",children:(0,O.jsx)(m.A,{size:20})})]}),(0,O.jsxs)("div",{className:"relative overflow-hidden",style:{minHeight:"200px"},children:[(0,O.jsx)("div",{className:"transition-transform duration-300 ease-in-out "+(o?"-translate-x-full opacity-0":"translate-x-0 opacity-100"),children:(0,O.jsx)("div",{className:"space-y-3",children:n.map(e=>{let{type:t,label:a,icon:s,color:i,description:r}=e;return(0,O.jsxs)("button",{onClick:()=>{l(t)},className:"w-full flex items-center gap-4 p-4 rounded-lg border-2 border-gray-200 hover:border-blue-400 hover:bg-blue-50 transition-all text-left",children:[(0,O.jsx)("div",{className:`${i} p-2 rounded-lg text-white`,children:(0,O.jsx)(s,{size:20})}),(0,O.jsxs)("div",{children:[(0,O.jsx)("div",{className:"font-medium text-gray-800",children:a}),(0,O.jsx)("div",{className:"text-sm text-gray-500",children:r})]})]},t)})})}),(0,O.jsx)("div",{className:"absolute top-0 left-0 w-full transition-transform duration-300 ease-in-out "+(o?"translate-x-0 opacity-100":"translate-x-full opacity-0"),children:o&&(0,O.jsxs)("div",{className:"space-y-3",children:[(0,O.jsxs)("button",{onClick:()=>c(null),className:"w-full flex items-center gap-4 p-4 rounded-lg border-2 border-dashed border-gray-300 hover:border-blue-400 hover:bg-blue-50 transition-all text-left",children:[(0,O.jsx)("div",{className:"bg-gray-200 p-2 rounded-lg text-gray-600",children:(0,O.jsx)(N.A,{size:20})}),(0,O.jsxs)("div",{children:[(0,O.jsxs)("div",{className:"font-medium text-gray-800",children:["Create Blank ",o]}),(0,O.jsx)("div",{className:"text-sm text-gray-500",children:"Start with an empty node."})]})]}),d.map(e=>{var t,a,s;return(0,O.jsxs)("button",{onClick:()=>c(e.id),className:"w-full flex items-center gap-4 p-4 rounded-lg border-2 border-gray-200 hover:border-blue-400 hover:bg-blue-50 transition-all text-left",children:[(0,O.jsx)("div",{className:"bg-indigo-100 p-2 rounded-lg text-indigo-600",children:(0,O.jsx)(w.A,{size:20})}),(0,O.jsxs)("div",{children:[(0,O.jsx)("div",{className:"font-medium text-gray-800",children:e.name}),(0,O.jsx)("div",{className:"text-sm text-gray-500 truncate",children:(null===(t=e.data)||void 0===t?void 0:t.description)||(null===(a=e.data)||void 0===a?void 0:a.abstract)||(null===(s=e.data)||void 0===s?void 0:s.assessment_plan)||"No description"})]})]},e.id)}),0===d.length&&(0,O.jsx)("div",{className:"text-center text-sm text-gray-500 py-4",children:"No templates found for this node type."})]})})]})]})})},Ie=e=>{let{edge:t,isOpen:a,onClose:i,onSave:r}=e;const[o,l]=(0,s.useState)((null===t||void 0===t?void 0:t.label)||"");(0,s.useEffect)(()=>{l((null===t||void 0===t?void 0:t.label)||"")},[t]);const n=()=>{r(t.id,o),i()};return a&&t?(0,O.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 backdrop-blur-sm",children:(0,O.jsxs)("div",{className:"bg-white rounded-xl shadow-2xl p-6 max-w-md w-full mx-4 transform transition-all",children:[(0,O.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,O.jsx)("h3",{className:"text-xl font-semibold text-gray-800",children:"Edit Connection Label"}),(0,O.jsx)("button",{onClick:i,className:"text-gray-400 hover:text-gray-600 p-1 transition-colors",children:(0,O.jsx)(m.A,{size:20})})]}),(0,O.jsxs)("div",{className:"mb-6",children:[(0,O.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Connection Label"}),(0,O.jsx)("input",{type:"text",value:o,onChange:e=>l(e.target.value),onKeyPress:e=>{"Enter"===e.key?n():"Escape"===e.key&&i()},placeholder:"Enter a label for this connection...",className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all",autoFocus:!0}),(0,O.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Press Enter to save, Escape to cancel"})]}),(0,O.jsxs)("div",{className:"flex items-center justify-end gap-3",children:[(0,O.jsx)("button",{onClick:i,className:"px-4 py-2 text-gray-600 hover:text-gray-800 border border-gray-300 rounded-lg hover:bg-gray-100 transition-colors",children:"Cancel"}),(0,O.jsxs)("button",{onClick:n,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2",children:[(0,O.jsx)(k.A,{size:16}),"Save Label"]})]})]})}):null},$e=()=>{var e,t,a,i,c,d;const{fitView:u,setCenter:m,zoomTo:x,getViewport:g}=(0,l.VH)(),[y,j,w]=(0,l.ck)([]),[D,E,M]=(0,l.fM)([]),[I,$]=(0,s.useState)(0),[H,F]=(0,s.useState)({topics:[],cases:[],tasks:[],literature:[],connections:[]}),[R,B]=(0,s.useState)(!1),[Y,U]=(0,s.useState)(null),[J,q]=(0,s.useState)(!0),[W,V]=(0,s.useState)(0),[G,Q]=(0,s.useState)("Initializing..."),[Z,ee]=(0,s.useState)(!0),[te,ae]=(0,s.useState)(null),[se,re]=(0,s.useState)(!1),[oe,le]=(0,s.useState)({isOpen:!1,data:null}),[ne,ce]=(0,s.useState)({isOpen:!1,data:null}),[de,ue]=(0,s.useState)({isOpen:!1,data:null}),pe=(0,s.useRef)(null),me=(0,s.useRef)(null),he=(0,s.useRef)(null),[ge,be]=(0,s.useState)(!1),[ve,Ne]=(0,s.useState)(!1),[ke,Ce]=(0,s.useState)(!1),[Te,Oe]=(0,s.useState)(null),[$e,Xe]=(0,s.useState)(!1),[He,Fe]=(0,s.useState)({isOpen:!1,edge:null}),[Re,Be]=(0,s.useState)([]),[Ye,Ue]=(0,s.useState)({show:!1,progress:0,message:""}),[Je,qe]=(0,s.useState)([]),[We,Ve]=(0,s.useState)(!1),[Ke,Ge]=(0,s.useState)({isOpen:!1,data:null}),[Qe,Ze]=(0,s.useState)(!1),[et,tt]=(0,s.useState)({case:!1,topic:!1,task:!1,literature:!1}),at=(0,s.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3e3;const s={id:Date.now(),message:e,type:t,duration:a};qe(e=>[...e,s])},[]),st=(0,s.useCallback)(e=>{qe(t=>t.filter(t=>t.id!==e))},[]),it=(0,s.useCallback)(e=>{var t,a,s;const i=oe.isOpen||ne.isOpen||de.isOpen||Ke.isOpen,r=Object.values(et).some(e=>e),o=oe.isOpen&&(null===(t=oe.data)||void 0===t?void 0:t.isTabTransitioning)||ne.isOpen&&(null===(a=ne.data)||void 0===a?void 0:a.isTabTransitioning)||de.isOpen&&(null===(s=de.data)||void 0===s?void 0:s.isTabTransitioning);if(Qe||i||o||r){console.log("Deferring auto-save during animation, modal interaction, or tab transition");return void setTimeout(()=>it(e),o||r?2e3:1e3)}De.save(e,()=>Xe(!0),(e,t)=>{Xe(!1),e?Oe(new Date):(at("Auto-save failed","error",4e3),console.error("Auto-save error:",t))},Qe),window.requestIdleCallback?window.requestIdleCallback(()=>{Qe||Object.values(et).some(e=>e)||ct(e)},{timeout:5e3}):setTimeout(()=>{Qe||Object.values(et).some(e=>e)||ct(e)},100)},[at,Qe,et,oe.isOpen,ne.isOpen,de.isOpen,Ke.isOpen]);(0,s.useCallback)(e=>{const t=oe.isOpen||ne.isOpen||de.isOpen||Ke.isOpen,a=Object.values(et).some(e=>e);Qe||t||a||(De.save(e,null,null,Qe),clearTimeout(window.positionBackendSaveTimeout),window.positionBackendSaveTimeout=setTimeout(()=>{it(e)},800))},[Qe,et,oe.isOpen,ne.isOpen,de.isOpen,Ke.isOpen,it]);(0,s.useEffect)(()=>{oe.isOpen&&oe.data?pe.current={...oe.data}:oe.isOpen||(pe.current=null)},[oe.isOpen,null===(e=oe.data)||void 0===e?void 0:e.id]),(0,s.useEffect)(()=>{ne.isOpen&&ne.data?me.current={...ne.data}:ne.isOpen||(me.current=null)},[ne.isOpen,null===(t=ne.data)||void 0===t?void 0:t.id]),(0,s.useEffect)(()=>{de.isOpen&&de.data?he.current={...de.data}:de.isOpen||(he.current=null)},[de.isOpen,null===(a=de.data)||void 0===a?void 0:a.id]);const rt=(0,s.useCallback)(e=>{console.log("Deleting node with full ID:",e);const[t,...a]=e.split("-"),s=a.join("-"),i="literature"===t?"literature":`${t}s`;F(a=>{const r=(a[i]||[]).filter(e=>String(e.id)!==s),o=(a.connections||[]).filter(t=>t.source!==e&&t.target!==e),l={...a,[i]:r,connections:o};return it(l),at(`${t.charAt(0).toUpperCase()+t.slice(1)} deleted.`,"success"),l}),j(t=>t.filter(t=>t.id!==e)),E(t=>t.filter(t=>t.source!==e&&t.target!==e))},[F,it,at,j,E]),ot=(0,s.useCallback)(e=>{Ze(!0),Ge({isOpen:!0,data:e}),setTimeout(()=>Ze(!1),700)},[]),lt=(0,s.useCallback)(()=>{console.log("syncNodeData called - syncing node colors and labels"),j(e=>{let t=!1;const a=e.map(e=>{const a=e.id.split("-")[0],s=e.id.split("-")[1];let i=e.data.label,r=e.data.color,o=!1;if("case"===a){var l;const t=null===(l=H.cases)||void 0===l?void 0:l.find(e=>String(e.id)===s);if(t){const a=t.primaryDiagnosis||t.primary_diagnosis||t.title||"Untitled Case";a!==e.data.label&&(i=a,o=!0)}}else if("topic"===a){var n;const t=null===(n=H.topics)||void 0===n?void 0:n.find(e=>String(e.id)===s);if(t){const a=t.title||"Untitled Topic",l=t.color||"#3B82F6";a!==e.data.label&&(i=a,o=!0),l!==e.data.color&&(r=l,o=!0,console.log(`Topic ${s}: Color changing from ${e.data.color} to ${l}`))}}else if("task"===a){var c;const t=null===(c=H.tasks)||void 0===c?void 0:c.find(e=>String(e.id)===s);if(t){const a=t.title||"Untitled Task";a!==e.data.label&&(i=a,o=!0)}}else if("literature"===a){var d;const t=null===(d=H.literature)||void 0===d?void 0:d.find(e=>String(e.id)===s);if(t){const a=t.title||"Untitled Literature";a!==e.data.label&&(i=a,o=!0)}}if(o){t=!0;const s=Date.now();return{id:e.id,type:e.type,position:{...e.position},data:{...e.data,label:i,color:r,lastUpdated:s},style:"topic"===a?{backgroundColor:r,color:"white",boxShadow:`0 4px 20px ${r}20`,transition:"all 0.7s cubic-bezier(0.34, 1.56, 0.64, 1), transform 0.3s ease",zIndex:s%1e3}:e.style,key:`${e.id}-${s}`}}return e});return t?(console.log("syncNodeData: Changes detected, updating nodes with forced re-render"),[...a]):(console.log("syncNodeData: No changes needed"),e)})},[H,j]);(0,s.useEffect)(()=>{var e,t,a,s;if(H&&((null===(e=H.cases)||void 0===e?void 0:e.length)>0||(null===(t=H.topics)||void 0===t?void 0:t.length)>0||(null===(a=H.tasks)||void 0===a?void 0:a.length)>0||(null===(s=H.literature)||void 0===s?void 0:s.length)>0)){const e=setTimeout(()=>{console.log("useEffect triggered syncNodeData due to mindMapData change"),lt()},50);return 0===y.length&&(console.log("Converting data to React Flow nodes due to data change"),setTimeout(()=>{nt(H,!1)},100)),()=>clearTimeout(e)}},[H,lt,y.length]),(0,s.useEffect)(()=>{I>0&&(console.log("Force update triggered by nodeUpdateTrigger:",I),setTimeout(()=>{lt()},100))},[I,lt]);const nt=(0,s.useCallback)(async function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const a=[...e.topics.map(e=>({...e,type:"topic"})),...e.cases.map(e=>({...e,type:"case"})),...e.tasks.map(e=>({...e,type:"task"})),...e.literature.map(e=>({...e,type:"literature"}))];let s;const i=a.some(e=>e.position&&"number"===typeof e.position.x&&"number"===typeof e.position.y);if(a.length>0&&t&&!i)try{const{forceSimulation:t,forceManyBody:i,forceLink:r,forceCenter:o,forceCollide:l}=await _e(),n=a.map((e,t)=>{var a,s;return{id:`${e.type}-${e.id}`,x:(null===(a=e.position)||void 0===a?void 0:a.x)||200*(Math.random()-.5),y:(null===(s=e.position)||void 0===s?void 0:s.y)||200*(Math.random()-.5),type:e.type}}),c=(e.connections||[]).map(e=>({source:e.source,target:e.target,id:e.id})).filter(e=>{const t=new Set(n.map(e=>e.id));return t.has(e.source)&&t.has(e.target)}),d=t(n).force("link",r(c).id(e=>e.id).distance(200).strength(.5)).force("charge",i().strength(-800).distanceMax(400)).force("center",o(window.innerWidth/3,window.innerHeight/2)).force("collision",l().radius(80)).stop();for(let e=0;e<300;e++)d.tick();const u=new Map;n.forEach(e=>{u.set(e.id,{x:e.x,y:e.y})}),s=a.map(e=>{const t=`${e.type}-${e.id}`,a=u.get(t)||{x:0,y:0};return{...e,position:a}})}catch(l){console.warn("Failed to apply initial layout, using fallback positioning:",l),s=a}else s=a;const r=(s||a).map((e,t)=>{const s=`${e.type}-${e.id}`,i="case"===e.type?{...e,chiefComplaint:e.chiefComplaint||e.chief_complaint||"",initialPresentation:e.initialPresentation||e.initial_presentation||"",currentPresentation:e.currentPresentation||e.current_presentation||"",medicationHistory:e.medicationHistory||e.medication_history||"",therapyProgress:e.therapyProgress||e.therapy_progress||"",defensePatterns:e.defensePatterns||e.defense_patterns||"",clinicalReflection:e.clinicalReflection||e.clinical_reflection||""}:e;let r;if(e.position&&"number"===typeof e.position.x&&"number"===typeof e.position.y)r=e.position;else{const e=Math.ceil(Math.sqrt(a.length)),s=250,i=150;r={x:t%e*s+300,y:Math.floor(t/e)*s+i}}return{id:s,type:e.type,position:r,data:{...i,label:e.title||e.label||`Untitled ${e.type}`,color:e.color||"#3B82F6",onDelete:()=>rt(s),onLiteratureClick:"literature"===e.type?ot:void 0,skipAnimation:Z},style:"topic"===e.type?{backgroundColor:e.color||"#3B82F6"}:void 0}}),o=((e,t)=>{const a=new Set(t);return e.filter(e=>a.has(e.source)&&a.has(e.target)).map(e=>({id:e.id,source:e.source,target:e.target,label:e.label,type:"floating",style:{strokeWidth:2,stroke:"#64748b",opacity:.85},animated:!1,updatable:!0}))})(e.connections||[],r.map(e=>e.id));j(r),E(o)},[j,E,rt,ot,Z]),ct=(0,s.useCallback)(async e=>{const t={topics:JSON.parse(JSON.stringify(e.topics||[])),cases:JSON.parse(JSON.stringify(e.cases||[])),tasks:JSON.parse(JSON.stringify(e.tasks||[])),literature:JSON.parse(JSON.stringify(e.literature||[])),connections:JSON.parse(JSON.stringify(e.connections||[]))};try{const e=(new Date).toISOString();t.topics=t.topics.map((t,a)=>{var s,i;return{id:String(t.id||`${Date.now()}-${a}-topic`),title:t.title||"Untitled Topic",description:t.description||"",category:t.category||"Uncategorized",color:t.color||"#3B82F6",position:{x:Number(null===(s=t.position)||void 0===s?void 0:s.x)||0,y:Number(null===(i=t.position)||void 0===i?void 0:i.y)||0},flashcard_count:Number(t.flashcard_count)||0,completed_flashcards:Number(t.completed_flashcards)||0,resources:Array.isArray(t.resources)?t.resources:[],created_at:t.created_at||e,updated_at:e}}),t.cases=t.cases.map((t,a)=>{var s,i;return{id:String(t.id||`${Date.now()}-${a}-case`),case_id:t.case_id||`CASE-${Date.now()}-${a}`,encounter_date:t.encounter_date||e,primary_diagnosis:t.primary_diagnosis||"Unspecified",secondary_diagnoses:Array.isArray(t.secondary_diagnoses)?t.secondary_diagnoses:[],age:void 0!==t.age?Number(t.age):null,gender:t.gender||null,chief_complaint:t.chiefComplaint||t.chief_complaint||"",initial_presentation:t.initialPresentation||t.initial_presentation||"",current_presentation:t.currentPresentation||t.current_presentation||"",medication_history:t.medicationHistory||t.medication_history||"",therapy_progress:t.therapyProgress||t.therapy_progress||"",defense_patterns:t.defensePatterns||t.defense_patterns||"",clinical_reflection:t.clinicalReflection||t.clinical_reflection||"",history_present_illness:t.history_present_illness||null,medical_history:t.medical_history||null,medications:Array.isArray(t.medications)?t.medications:[],mental_status_exam:t.mental_status_exam||null,assessment_plan:t.assessment_plan||null,notes:t.notes||null,status:t.status||"active",linked_topics:Array.isArray(t.linked_topics)?t.linked_topics:[],position:{x:Number(null===(s=t.position)||void 0===s?void 0:s.x)||0,y:Number(null===(i=t.position)||void 0===i?void 0:i.y)||0},created_at:t.created_at||e,updated_at:e}}),t.tasks=t.tasks.map((t,a)=>{var s,i;return{id:String(t.id||`${Date.now()}-${a}-task`),title:t.title||"Untitled Task",description:t.description||null,status:t.status||"pending",priority:t.priority||"medium",due_date:t.due_date||null,linked_case_id:t.linked_case_id||null,linked_topic_id:t.linked_topic_id||null,position:{x:Number(null===(s=t.position)||void 0===s?void 0:s.x)||0,y:Number(null===(i=t.position)||void 0===i?void 0:i.y)||0},created_at:t.created_at||e,updated_at:e}}),t.literature=t.literature.map((t,a)=>{var s,i;return{id:String(t.id||`${Date.now()}-${a}-lit`),title:t.title||"Untitled Literature",authors:t.authors||null,publication:t.publication||null,year:void 0!==t.year?Number(t.year):null,doi:t.doi||null,abstract:t.abstract||null,notes:t.notes||null,pdf_path:t.pdf_path||null,linked_topics:Array.isArray(t.linked_topics)?t.linked_topics:[],position:{x:Number(null===(s=t.position)||void 0===s?void 0:s.x)||0,y:Number(null===(i=t.position)||void 0===i?void 0:i.y)||0},created_at:t.created_at||e,updated_at:e}}),t.connections=t.connections.map((e,t)=>({id:String(e.id||`${Date.now()}-${t}-conn`),source:e.source||"",target:e.target||"",label:e.label||""})),t.connections=t.connections.filter(e=>e.source&&e.target&&"string"===typeof e.source&&"string"===typeof e.target&&e.source.length>0&&e.target.length>0),console.log("Sending cleaned data to backend:",t);const a=await r.A.put(`${Ae}/mindmap-data`,t,{headers:{"Content-Type":"application/json"}});console.log("Backend save successful:",a.data)}catch(l){var a,s,i,o;console.error("Failed to save to backend:",(null===(a=l.response)||void 0===a?void 0:a.data)||l.message),422===(null===(s=l.response)||void 0===s?void 0:s.status)&&null!==(i=l.response)&&void 0!==i&&null!==(o=i.data)&&void 0!==o&&o.detail&&(console.error("Validation errors:"),console.error(JSON.stringify(l.response.data.detail,null,2)),console.error("Request data that caused validation error:"),console.error(JSON.stringify(t,null,2)))}},[]),dt=(0,s.useCallback)(e=>{const t=`conn-${Date.now()}`,a={...e,id:t,type:"floating",style:{strokeWidth:2,stroke:"#64748b",opacity:.85,transition:"none"},data:{__forceUpdate:Date.now()},interactionWidth:20};E(e=>(0,n.rN)(a,e)),F(t=>{const s=[...t.connections,{id:a.id,source:e.source,target:e.target,label:""}],i={...t,connections:s};return it(i),i})},[E,F,it]),ut=(0,s.useCallback)((e,t)=>{U(t),j(e=>e.map(e=>({...e,selected:e.id===t.id})))},[j]),pt=(0,s.useCallback)((e,t)=>{const a=t.id.split("-"),s=a[0],i=a.slice(1).join("-");if(("case"!==s||!oe.isOpen)&&("topic"!==s||!ne.isOpen)&&("task"!==s||!de.isOpen)&&("literature"!==s||!Ke.isOpen)){if("literature"===s){const e=H.literature.find(e=>String(e.id)===i);return void(e&&Ge({isOpen:!0,data:e}))}if("case"===s){const e=H.cases.find(e=>String(e.id)===i);return void(e&&(tt(e=>({...e,case:!0})),le({isOpen:!0,data:e}),setTimeout(()=>{tt(e=>({...e,case:!1}))},800)))}if("topic"===s){const e=H.topics.find(e=>String(e.id)===i);return void(e&&(tt(e=>({...e,topic:!0})),ce({isOpen:!0,data:e}),setTimeout(()=>{tt(e=>({...e,topic:!1}))},800)))}if("task"===s){const e=H.tasks.find(e=>String(e.id)===i);return void(e&&(tt(e=>({...e,task:!0})),ue({isOpen:!0,data:e}),setTimeout(()=>{tt(e=>({...e,task:!1}))},800)))}}},[H,oe.isOpen,ne.isOpen,de.isOpen,Ke.isOpen]),mt=(0,s.useCallback)((e,t)=>{E(e=>e.filter(e=>e.id!==t.id)),F(e=>{const a=e.connections.filter(e=>e.id!==t.id),s={...e,connections:a};return it(s),at("Connection deleted","success"),s})},[E,F,it,at]),ht=(0,s.useCallback)((e,t)=>{e.preventDefault(),Fe({isOpen:!0,edge:t})},[]),xt=(0,s.useCallback)((e,t)=>{E(a=>a.map(a=>a.id===e?{...a,label:t}:a)),F(a=>{const s=a.connections.map(a=>a.id===e?{...a,label:t}:a),i={...a,connections:s};return it(i),i})},[E,F,it]),gt=(0,s.useCallback)((e,t)=>{E(e=>e.map(e=>e.id===t.id?{...e,className:"highlighted"}:e))},[E]),bt=(0,s.useCallback)((e,t)=>{E(e=>e.map(e=>e.id===t.id?{...e,className:""}:e))},[E]),yt=(0,s.useCallback)(async()=>{if(0!==y.length)try{const{forceSimulation:e,forceManyBody:t,forceLink:a,forceCenter:s,forceCollide:i}=await _e(),r=[...D],o=new Set(y.map(e=>e.id)),l=r.filter(e=>o.has(e.source)&&o.has(e.target)),n=l.map(e=>({source:e.source,target:e.target,id:e.id})),c=y.map(e=>({id:e.id,x:e.position.x,y:e.position.y,fx:null,fy:null})),d=e(c).force("link",a(n).id(e=>e.id).distance(200).strength(.5)).force("charge",t().strength(-800).distanceMax(400)).force("center",s(window.innerWidth/3,window.innerHeight/2)).force("collision",i().radius(80)).stop(),p=50,m=400;let h=0;const x=()=>{const e=Math.min(p,m-h);for(let t=0;t<e;t++)d.tick();if(h+=e,h<m)requestAnimationFrame(x);else{const e=c.map(e=>({...y.find(t=>t.id===e.id),position:{x:e.x,y:e.y}}));j(e),E(l),F(t=>{const a={...t};return e.forEach(e=>{var t;const[s,i]=e.id.split("-"),r=null===(t=a["literature"===s?"literature":`${s}s`])||void 0===t?void 0:t.find(e=>String(e.id)===i);r&&(r.position=e.position)}),a}),setTimeout(()=>{u({duration:800,padding:.2})},200)}};requestAnimationFrame(x)}catch(e){console.error("Force layout failed:",e),at("Layout calculation failed","error")}},[y,D,j,E,F,u,at]),vt=(0,s.useCallback)(()=>{try{yt(),at("Nodes realigned successfully","success")}catch(e){console.error("Force layout error:",e),at("Failed to realign nodes","error")}},[yt,at]),ft=(0,s.useCallback)(()=>{if(!window.confirm("Are you sure you want to clear the entire mind map?"))return;const e={topics:[],cases:[],tasks:[],literature:[],connections:[]};F(e),j([]),E([]),U(null),le({isOpen:!1,data:null}),ce({isOpen:!1,data:null}),ue({isOpen:!1,data:null}),Ge({isOpen:!1,data:null}),ae(null),it(e),at("Mind map cleared successfully","success")},[j,E,it,at]),jt=(0,s.useCallback)(e=>{if(w(e),Qe)return void console.log("Skipping position updates during animation");const t=e.filter(e=>"position"===e.type&&e.position);t.length>0&&(console.log("Processing position changes:",t),F(e=>{const a={...e};return t.forEach(e=>{if(e.position){var t;const[s,i]=e.id.split("-"),r=null===(t=a["literature"===s?"literature":`${s}s`])||void 0===t?void 0:t.find(e=>String(e.id)===i);r&&(r.position={...e.position},console.log(`Updated ${s} ${i} position to:`,e.position))}}),De.save(a,null,null,!1),a}),setTimeout(()=>{it(H)},500))},[w,F,Qe,it,H]),Nt=(0,s.useCallback)((e,t)=>{clearTimeout(window.dragSaveTimeout),window.dragSaveTimeout=setTimeout(()=>{F(e=>(it(e),e))},500)},[it]),wt=(0,s.useCallback)(async()=>{q(!0),V(10),Q("Checking local data...");try{const t=De.load();if(t)return V(30),Q("Loading from cache..."),t.connections||(t.connections=[]),F(t),V(60),Q("Applying layout..."),await nt(t,!0),V(90),Q("Finalizing..."),q(!1),ee(!1),V(100),void setTimeout(async()=>{try{const e=await r.A.get(`${Ae}/mindmap-data`);JSON.stringify(e.data)!==JSON.stringify(t)&&(e.data.connections||(e.data.connections=[]),F(e.data),await nt(e.data),it(e.data),at("Data synchronized with server","info"))}catch(e){console.warn("Background sync failed:",e)}},500);V(20),Q("Loading from server...");try{const e=await r.A.get(`${Ae}/mindmap-data`);e.data.connections||(e.data.connections=[]),V(50),Q("Processing data..."),F(e.data),V(80),Q("Applying layout..."),await nt(e.data,!0),it(e.data),V(100),q(!1),ee(!1)}catch(e){console.warn("Backend loading failed, populating with sample data:",e),V(60),Q("Loading sample data...");F({topics:[],cases:[],tasks:[],literature:[],connections:[]}),setTimeout(()=>{Se(F,it,at)},100),V(100),q(!1),ee(!1)}}catch(t){console.error("Error loading mind map:",t),at("Failed to load mind map","error"),q(!1),ee(!1)}},[at,it,nt]);(0,s.useEffect)(()=>{wt(),Be([{id:"template1",name:"Schizophrenia Workup",nodeType:"case",data:{primary_diagnosis:"Schizophrenia",chief_complaint:"Auditory hallucinations"}},{id:"template2",name:"MDD Follow-up",nodeType:"case",data:{primary_diagnosis:"Major Depressive Disorder",status:"follow_up"}},{id:"template3",name:"CBT for Anxiety",nodeType:"topic",data:{title:"CBT for Anxiety",category:"Anxiety Disorders"}}])},[]);const kt=(0,s.useCallback)((e,t)=>{if(!e||!e.id||!e.data)return!1;if(!t)return!0;const a=t.toLowerCase().trim();if(!a)return!0;try{const t=e.id.split("-"),s=t.length>0?t[0]:"",i=t.length>1?t[1]:"";let r=!1;if(!r&&e.data.label){r=e.data.label.toLowerCase().includes(a)}if(!r&&s&&(r=s.includes(a)),!r&&"case"===s&&i&&(r=`case-${i}`.toLowerCase().includes(a)),!r)if("case"===s){r=(e.data.primary_diagnosis||e.data.primaryDiagnosis||"").toLowerCase().includes(a)}else if("topic"===s){r=(e.data.title||"").toLowerCase().includes(a)}else if("literature"===s){const t=(e.data.title||"").toLowerCase(),s=(e.data.authors||"").toLowerCase();r=t.includes(a)||s.includes(a)}if(!r&&e.data.category){r=e.data.category.toLowerCase().includes(a)}return r}catch(s){return console.error("Error in nodeMatchesSearch for node:",e.id,s),!1}},[]);if((0,s.useEffect)(()=>{const e=e=>{var t;if("INPUT"!==e.target.tagName&&"TEXTAREA"!==e.target.tagName){if(e.ctrlKey||e.metaKey)switch(e.key){case"n":e.preventDefault(),re(!0);break;case"e":e.preventDefault(),B(!R);break;case"r":e.preventDefault(),vt();break;case"f":e.preventDefault(),null===(t=document.querySelector('input[type="text"][placeholder*="Search"]'))||void 0===t||t.focus()}"Escape"===e.key&&(U(null),le({isOpen:!1,data:null}),ce({isOpen:!1,data:null}),ue({isOpen:!1,data:null}),Ge({isOpen:!1,data:null}),re(!1),Ve(!1),!oe.isOpen&&!ne.isOpen&&!de.isOpen&&Ke.isOpen)}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[R,vt,oe,ne,de,Ke,se,We]),(0,s.useEffect)(()=>{(ge&&!ve&&y.length>0||Z&&y.length>0)&&Ne(!0)},[ge,ve,y,Z]),(0,s.useEffect)(()=>{if(0===y.length)return;Object.values(et).some(e=>e)},[te,y,kt,Qe,et]),(0,s.useEffect)(()=>{if(!ge)return;const e=document.getElementById("search-filter-styles")||document.createElement("style");e.id="search-filter-styles",document.getElementById("search-filter-styles")||document.head.appendChild(e);e.textContent="\n      /* Default node styling */\n      .react-flow__node {\n        transition: opacity 0.3s ease, transform 0.3s ease, filter 0.3s ease !important;\n      }\n      \n      /* Search dimmed nodes */\n      .react-flow__node.search-dimmed {\n        opacity: 0.15 !important;\n        filter: grayscale(0.7) !important;\n        transform: scale(0.9) !important;\n      }\n      \n      /* Selected node highlighting */\n      .react-flow__node.search-selected {\n        box-shadow: 0 0 0 2px #10b981, 0 0 20px rgba(16, 185, 129, 0.6) !important;\n        z-index: 1000 !important;\n      }\n      \n      /* Ensure dragging still works */\n      .react-flow__node.search-dimmed {\n        pointer-events: auto !important;\n      }\n    "},[ge]),J)return(0,O.jsx)(we,{message:G,progress:W});return(0,O.jsxs)("div",{className:"min-h-screen bg-gray-50 flex",children:[(0,O.jsxs)("div",{className:"w-80 bg-gradient-to-b from-slate-800 to-slate-900 text-white p-6 shadow-2xl flex flex-col",children:[(0,O.jsxs)("div",{className:"mb-8",children:[(0,O.jsx)("div",{className:"text-3xl font-bold tracking-wide text-white",children:"PGY-3 HQ"}),(0,O.jsx)("div",{className:"text-sm text-slate-300 mt-2",children:"Psychiatry Resident Dashboard"})]}),(0,O.jsxs)("div",{className:"mb-6",children:[(0,O.jsx)("h3",{className:"text-sm font-semibold text-slate-300 mb-3",children:"Filter by Category"}),(0,O.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,O.jsx)("button",{onClick:()=>ae(null),className:"px-3 py-2 rounded-lg text-xs transition-all "+(null===te?"bg-teal-600 text-white":"bg-slate-700 text-slate-300 hover:bg-slate-600"),children:"All"}),(0,O.jsxs)("button",{onClick:()=>ae("topic"),className:"px-3 py-2 rounded-lg text-xs transition-all flex items-center gap-1 "+("topic"===te?"bg-blue-600 text-white":"bg-slate-700 text-slate-300 hover:bg-slate-600"),children:[(0,O.jsx)(h.A,{size:12}),"Topics"]}),(0,O.jsxs)("button",{onClick:()=>ae("case"),className:"px-3 py-2 rounded-lg text-xs transition-all flex items-center gap-1 "+("case"===te?"bg-indigo-600 text-white":"bg-slate-700 text-slate-300 hover:bg-slate-600"),children:[(0,O.jsx)(b.A,{size:12}),"Cases"]}),(0,O.jsxs)("button",{onClick:()=>ae("task"),className:"px-3 py-2 rounded-lg text-xs transition-all flex items-center gap-1 "+("task"===te?"bg-amber-600 text-white":"bg-slate-700 text-slate-300 hover:bg-slate-600"),children:[(0,O.jsx)(v.A,{size:12}),"Tasks"]}),(0,O.jsxs)("button",{onClick:()=>ae("literature"),className:"px-3 py-2 rounded-lg text-xs transition-all flex items-center gap-1 "+("literature"===te?"bg-purple-600 text-white":"bg-slate-700 text-slate-300 hover:bg-slate-600"),children:[(0,O.jsx)(f.A,{size:12}),"Literature"]})]})]}),(0,O.jsx)("div",{className:"mb-4 p-3 bg-slate-700 bg-opacity-50 rounded-lg",children:(0,O.jsx)("div",{className:"flex items-center gap-2 text-xs",children:$e?(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(p.A,{size:12,className:"animate-spin"}),(0,O.jsx)("span",{className:"text-amber-300",children:"Saving..."})]}):Te?(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(C.A,{size:12,className:"text-green-400"}),(0,O.jsxs)("span",{className:"text-slate-300",children:["Last saved: ",Te.toLocaleTimeString()]})]}):(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(S.A,{size:12,className:"text-slate-400"}),(0,O.jsx)("span",{className:"text-slate-400",children:"Auto-save enabled"})]})})}),(0,O.jsxs)("div",{className:"space-y-3 mb-6",children:[(0,O.jsx)(Pe,{onClick:vt,icon:_.A,className:"w-full bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-md text-sm",children:"Realign Nodes"}),(0,O.jsx)(Pe,{onClick:()=>Ve(!0),icon:A.A,className:"w-full bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-md text-sm",children:"Manage Templates"}),(0,O.jsx)(Pe,{onClick:()=>Se(F,it,at),icon:f.A,className:"w-full bg-emerald-600 hover:bg-emerald-700 text-white px-4 py-2 rounded-md text-sm",children:"Add Sample Literature"}),(0,O.jsx)(Pe,{onClick:()=>B(!R),icon:R?k.A:T.A,className:"w-full px-4 py-2 rounded-md text-sm "+(R?"bg-teal-600":"bg-slate-600"),children:R?"Exit Edit Mode":"Edit Mind Map"}),(0,O.jsx)(Pe,{onClick:()=>re(!0),icon:N.A,className:"w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md text-sm",children:"Add New Node"}),(0,O.jsx)(Pe,{onClick:ft,icon:z.A,className:"w-full bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-md text-sm",children:"Clear All Data"})]}),Y&&(0,O.jsxs)("div",{className:"mt-auto p-4 bg-slate-700 bg-opacity-50 rounded-lg",children:[(0,O.jsx)("h3",{className:"text-sm font-semibold text-slate-300 mb-2",children:"Selected Node"}),(0,O.jsxs)("div",{className:"space-y-2",children:[(0,O.jsxs)("div",{className:"flex items-center gap-2",children:["topic"===Y.type&&(0,O.jsx)(h.A,{size:14,className:"text-blue-400"}),"case"===Y.type&&(0,O.jsx)(b.A,{size:14,className:"text-indigo-400"}),"task"===Y.type&&(0,O.jsx)(v.A,{size:14,className:"text-amber-400"}),"literature"===Y.type&&(0,O.jsx)(f.A,{size:14,className:"text-purple-400"}),(0,O.jsx)("span",{className:"text-sm text-white font-medium truncate",children:Y.data.label})]}),Y.data.category&&(0,O.jsxs)("div",{className:"text-xs text-slate-400",children:["Category: ",Y.data.category]}),Y.data.status&&(0,O.jsxs)("div",{className:"text-xs text-slate-400",children:["Status: ",Y.data.status]}),(0,O.jsxs)("button",{onClick:()=>{const[e,t]=Y.id.split("-"),a=H["literature"===e?"literature":`${e}s`].find(e=>String(e.id)===t);a&&("case"===e?le({isOpen:!0,data:a}):"topic"===e?ce({isOpen:!0,data:a}):"task"===e?ue({isOpen:!0,data:a}):"literature"===e&&ot(a))},className:"w-full mt-2 px-3 py-2 bg-slate-600 hover:bg-slate-500 text-white text-xs rounded-lg transition-colors flex items-center gap-2",children:[(0,O.jsx)(P.A,{size:12}),"View Details"]})]})]}),!Y&&(0,O.jsxs)("div",{className:"mt-auto p-3 bg-slate-700 bg-opacity-30 rounded-lg",children:[(0,O.jsx)("h4",{className:"text-xs font-semibold text-slate-300 mb-2",children:"Keyboard Shortcuts"}),(0,O.jsxs)("div",{className:"space-y-1 text-xs text-slate-400",children:[(0,O.jsx)("div",{children:"Ctrl+N - Add Node"}),(0,O.jsx)("div",{children:"Ctrl+E - Toggle Edit Mode"}),(0,O.jsx)("div",{children:"Ctrl+R - Realign Nodes"}),(0,O.jsx)("div",{children:"Esc - Clear Selection"})]})]})]}),(0,O.jsx)("div",{className:"flex-1 relative",children:(0,O.jsx)(Le,{children:(0,O.jsxs)(l.Gc,{nodes:y,edges:D,onNodesChange:jt,onEdgesChange:M,onConnect:dt,onNodeClick:ut,onNodeDoubleClick:pt,onNodeDragStop:Nt,onEdgeDoubleClick:mt,onEdgeContextMenu:ht,onEdgeMouseEnter:gt,onEdgeMouseLeave:bt,nodeTypes:Ee,edgeTypes:{floating:ye,enhanced:fe},nodesDraggable:!0,nodesConnectable:R,elementsSelectable:!0,onInit:e=>{be(!0),window.reactFlowInstance=e},onError:(e,t)=>{console.warn("React Flow Error:",e,t),!Qe||t.includes("dimensions")},fitView:!0,snapToGrid:!1,snapGrid:[15,15],elevateEdgesOnSelect:!1,connectionLineComponent:je,connectionLineStyle:{stroke:"#3b82f6",strokeWidth:3.5,opacity:.9,strokeLinecap:"round",strokeDasharray:"5,3",filter:"drop-shadow(0 0 6px rgba(59, 130, 246, 0.6))",animation:"flowingDash 1s linear infinite"},defaultEdgeOptions:{type:"enhanced",style:{strokeWidth:2.5,stroke:"#64748b",opacity:.9,strokeLinecap:"round",transition:"none"}},className:"bg-gradient-to-br from-blue-50 to-indigo-100",children:[(0,O.jsx)(l.VS,{color:"#aaa",gap:16}),(0,O.jsx)(l.H2,{}),(0,O.jsx)(l.of,{})]})})}),We&&(0,O.jsx)(L,{isOpen:We,onClose:()=>Ve(!1),templates:Re,setTemplates:Be}),Ke.isOpen&&(0,O.jsx)(X,{isOpen:Ke.isOpen,onClose:()=>{Ze(!0),Ge({isOpen:!1,data:null}),setTimeout(()=>Ze(!1),500)},onAnimationStart:()=>Ze(!0),onAnimationEnd:()=>Ze(!1),literatureData:Ke.data,allNodes:y,connections:H.connections||[],setMindMapData:F,autoSaveMindMapData:it,addToast:at}),se&&(0,O.jsx)(Me,{isOpen:se,onClose:()=>re(!1),onSelect:(e,t)=>{var a,s,i,r;re(!1);const o=Date.now(),l=`${e}-${o}`;let n={id:o,label:`New ${e}`};"case"===e&&(n={...n,chiefComplaint:"",initialPresentation:"",currentPresentation:"",medicationHistory:"",therapyProgress:"",defensePatterns:"",clinicalReflection:""});const c=((null===(a=H.topics)||void 0===a?void 0:a.length)||0)+((null===(s=H.cases)||void 0===s?void 0:s.length)||0)+((null===(i=H.tasks)||void 0===i?void 0:i.length)||0)+((null===(r=H.literature)||void 0===r?void 0:r.length)||0),d=Math.ceil(Math.sqrt(c+1)),u={x:c%d*280+400,y:280*Math.floor(c/d)+150},p={id:l,type:e,position:u,data:{...n,onDelete:()=>rt(l)}};F(t=>{const a="literature"===e?"literature":`${e}s`,s={...p.data,position:p.position};delete s.onDelete;const i={...t,[a]:[...t[a]||[],s]};return it(i),i}),j(e=>e.concat(p))},templates:Re}),(0,O.jsx)(o.N,{mode:"wait",children:oe.isOpen&&(0,O.jsx)(K,{isOpen:oe.isOpen,data:pe.current||oe.data,onClose:()=>{tt(e=>({...e,case:!0})),le({isOpen:!1,data:null})},onAnimationStart:()=>{Ze(!0),tt(e=>({...e,case:!0}))},onAnimationEnd:()=>{Ze(!1),tt(e=>({...e,case:!1}))},setMindMapData:F,autoSaveMindMapData:it,addToast:at},`case-modal-${(null===(i=oe.data)||void 0===i?void 0:i.id)||"default"}`)}),(0,O.jsx)(o.N,{mode:"wait",children:ne.isOpen&&(0,O.jsx)(ie,{isOpen:ne.isOpen,data:me.current||ne.data,onClose:()=>{tt(e=>({...e,topic:!0})),ce({isOpen:!1,data:null})},onAnimationStart:()=>{Ze(!0),tt(e=>({...e,topic:!0}))},onAnimationEnd:()=>{Ze(!1),tt(e=>({...e,topic:!1}))},setMindMapData:F,autoSaveMindMapData:it,addToast:at,syncNodeData:lt,forceNodeUpdate:()=>$(e=>e+1)},`topic-modal-${(null===(c=ne.data)||void 0===c?void 0:c.id)||"default"}`)}),(0,O.jsx)(o.N,{mode:"wait",children:de.isOpen&&(0,O.jsx)(xe,{isOpen:de.isOpen,data:he.current||de.data,onClose:()=>{tt(e=>({...e,task:!0})),ue({isOpen:!1,data:null})},onAnimationStart:()=>{Ze(!0),tt(e=>({...e,task:!0}))},onAnimationEnd:()=>{Ze(!1),tt(e=>({...e,task:!1}))},setMindMapData:F,autoSaveMindMapData:it,addToast:at},`task-modal-${(null===(d=de.data)||void 0===d?void 0:d.id)||"default"}`)}),(0,O.jsx)(Ie,{isOpen:He.isOpen,edge:He.edge,onClose:()=>Fe({isOpen:!1,edge:null}),onSave:xt}),J&&(0,O.jsx)("div",{className:"absolute inset-0 bg-white bg-opacity-80 flex items-center justify-center z-50",children:(0,O.jsx)(p.A,{size:48,className:"animate-spin text-blue-600"})}),Je.map(e=>(0,O.jsx)(ze,{message:e.message,type:e.type,duration:e.duration,onClose:()=>st(e.id)},e.id))]})};class Le extends s.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(e){return e.message&&e.message.includes("dimensions")?(console.warn("React Flow dimension error caught, recovering..."),{hasError:!1}):{hasError:!0}}componentDidCatch(e,t){e.message&&e.message.includes("dimensions")?setTimeout(()=>{window.reactFlowInstance&&window.reactFlowInstance.fitView()},100):console.error("React Flow Error:",e,t)}render(){return this.state.hasError?(0,O.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,O.jsxs)("div",{className:"text-center",children:[(0,O.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Mind Map Temporarily Unavailable"}),(0,O.jsx)("p",{className:"text-gray-600 mb-4",children:"There was an issue with the mind map. Please refresh the page."}),(0,O.jsx)("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Refresh Page"})]})}):this.props.children}}const Xe=()=>(0,O.jsx)(l.Ln,{children:(0,O.jsx)($e,{})});const He=function(){return(0,O.jsx)(Xe,{})};i.createRoot(document.getElementById("root")).render((0,O.jsx)(s.StrictMode,{children:(0,O.jsx)(He,{})}))}},t={};function a(s){var i=t[s];if(void 0!==i)return i.exports;var r=t[s]={id:s,loaded:!1,exports:{}};return e[s](r,r.exports,a),r.loaded=!0,r.exports}a.m=e,(()=>{var e=[];a.O=(t,s,i,r)=>{if(!s){var o=1/0;for(d=0;d<e.length;d++){s=e[d][0],i=e[d][1],r=e[d][2];for(var l=!0,n=0;n<s.length;n++)(!1&r||o>=r)&&Object.keys(a.O).every(e=>a.O[e](s[n]))?s.splice(n--,1):(l=!1,r<o&&(o=r));if(l){e.splice(d--,1);var c=i();void 0!==c&&(t=c)}}return t}r=r||0;for(var d=e.length;d>0&&e[d-1][2]>r;d--)e[d]=e[d-1];e[d]=[s,i,r]}})(),(()=>{var e,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__;a.t=function(s,i){if(1&i&&(s=this(s)),8&i)return s;if("object"===typeof s&&s){if(4&i&&s.__esModule)return s;if(16&i&&"function"===typeof s.then)return s}var r=Object.create(null);a.r(r);var o={};e=e||[null,t({}),t([]),t(t)];for(var l=2&i&&s;("object"==typeof l||"function"==typeof l)&&!~e.indexOf(l);l=t(l))Object.getOwnPropertyNames(l).forEach(e=>o[e]=()=>s[e]);return o.default=()=>s,a.d(r,o),r}})(),a.d=(e,t)=>{for(var s in t)a.o(t,s)&&!a.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},a.f={},a.e=e=>Promise.all(Object.keys(a.f).reduce((t,s)=>(a.f[s](e,t),t),[])),a.u=e=>"static/js/"+e+"."+{213:"0262575f",261:"de3004f3",524:"c4c81a9f"}[e]+".chunk.js",a.miniCssF=e=>{},a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={},t="frontend:";a.l=(s,i,r,o)=>{if(e[s])e[s].push(i);else{var l,n;if(void 0!==r)for(var c=document.getElementsByTagName("script"),d=0;d<c.length;d++){var u=c[d];if(u.getAttribute("src")==s||u.getAttribute("data-webpack")==t+r){l=u;break}}l||(n=!0,(l=document.createElement("script")).charset="utf-8",l.timeout=120,a.nc&&l.setAttribute("nonce",a.nc),l.setAttribute("data-webpack",t+r),l.src=s),e[s]=[i];var p=(t,a)=>{l.onerror=l.onload=null,clearTimeout(m);var i=e[s];if(delete e[s],l.parentNode&&l.parentNode.removeChild(l),i&&i.forEach(e=>e(a)),t)return t(a)},m=setTimeout(p.bind(null,void 0,{type:"timeout",target:l}),12e4);l.onerror=p.bind(null,l.onerror),l.onload=p.bind(null,l.onload),n&&document.head.appendChild(l)}}})(),a.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),a.p="./",(()=>{var e={792:0};a.f.j=(t,s)=>{var i=a.o(e,t)?e[t]:void 0;if(0!==i)if(i)s.push(i[2]);else{var r=new Promise((a,s)=>i=e[t]=[a,s]);s.push(i[2]=r);var o=a.p+a.u(t),l=new Error;a.l(o,s=>{if(a.o(e,t)&&(0!==(i=e[t])&&(e[t]=void 0),i)){var r=s&&("load"===s.type?"missing":s.type),o=s&&s.target&&s.target.src;l.message="Loading chunk "+t+" failed.\n("+r+": "+o+")",l.name="ChunkLoadError",l.type=r,l.request=o,i[1](l)}},"chunk-"+t,t)}},a.O.j=t=>0===e[t];var t=(t,s)=>{var i,r,o=s[0],l=s[1],n=s[2],c=0;if(o.some(t=>0!==e[t])){for(i in l)a.o(l,i)&&(a.m[i]=l[i]);if(n)var d=n(a)}for(t&&t(s);c<o.length;c++)r=o[c],a.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return a.O(d)},s=self.webpackChunkfrontend=self.webpackChunkfrontend||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})();var s=a.O(void 0,[967,497,96],()=>a(8806));s=a.O(s)})();
//# sourceMappingURL=main.8915f9d2.js.map